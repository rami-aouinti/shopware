const{ApiService:f}=Shopware.Classes;class E extends f{constructor(t,r,s="external-orders"){super(t,r,s),this.name="externalOrderService"}async list({channel:t=null,search:r=null}={}){const s={};t&&(s.channel=t),r&&(s.search=r);const l=await this.httpClient.get(`_action/${this.getApiBasePath()}/list`,{headers:this.getBasicHeaders(),params:s}),a=f.handleResponse(l)??(l==null?void 0:l.data);return(a==null?void 0:a.data)??a}async detail(t){const r=await this.httpClient.get(`_action/${this.getApiBasePath()}/detail/${t}`,{headers:this.getBasicHeaders()}),s=f.handleResponse(r)??(r==null?void 0:r.data);return(s==null?void 0:s.data)??s}async seedTestData(){const t=await this.httpClient.post(`_action/${this.getApiBasePath()}/test-data`,{},{headers:this.getBasicHeaders()}),r=f.handleResponse(t)??(t==null?void 0:t.data);return(r==null?void 0:r.data)??r}}Shopware.Application.addServiceProvider("externalOrderService",e=>{const t=Shopware.Application.getContainer("init"),r=(t==null?void 0:t.httpClient)??e.httpClient,s=e.loginService??Shopware.Service("loginService");return new E(r,s)});const{Component:L,Mixin:R}=Shopware;L.register("external-orders-testdata-button",{template:`
        <div class="external-orders-testdata-button">
            <label class="sw-field__label" v-if="label">{{ label }}</label>
            <sw-button
                variant="primary"
                size="small"
                :disabled="isSeeding"
                @click="seedTestData"
            >
                Testdaten speichern
            </sw-button>
            <div v-if="helpText" class="sw-field__help-text">
                {{ helpText }}
            </div>
        </div>
    `,inject:["externalOrderService"],mixins:[R.getByName("notification")],props:{element:{type:Object,required:!1,default:null}},data(){return{isSeeding:!1}},computed:{label(){var e;return((e=this.element)==null?void 0:e.label)??""},helpText(){var e;return((e=this.element)==null?void 0:e.helpText)??""}},methods:{async seedTestData(){if(!this.isSeeding){this.isSeeding=!0;try{const e=await this.externalOrderService.seedTestData(),t=(e==null?void 0:e.inserted)??0;this.createNotificationSuccess({title:"Testdaten gespeichert",message:t>0?`Es wurden ${t} Testbestellungen gespeichert.`:"Keine neuen Testbestellungen wurden gespeichert."})}catch(e){this.createNotificationError({title:"Testdaten konnten nicht gespeichert werden",message:(e==null?void 0:e.message)||"Bitte prüfen Sie die Konfiguration der externen APIs."})}finally{this.isSeeding=!1}}}}});const $=`<div class="external-orders"> <header class="external-orders__header"> <div class="external-orders__header-content"> <h2>{{ pageTitle }}</h2> <div class="external-orders__summary external-orders__summary--header"> <div class="external-orders__summary-metrics"> <div class="external-orders__summary-item"> <span class="external-orders__summary-label">Bestellungen</span> <span class="external-orders__summary-value">{{ summary.orderCount }}</span> </div> <div class="external-orders__summary-item"> <span class="external-orders__summary-label">Gesamtumsatz</span> <span class="external-orders__summary-value">{{ formatCurrency(summary.totalRevenue) }}</span> </div> <div class="external-orders__summary-item"> <span class="external-orders__summary-label">Stück</span> <span class="external-orders__summary-value">{{ summary.totalItems }}</span> </div> </div> <div class="external-orders__summary-actions"> <button class="external-orders__button external-orders__button--primary" type="button" @click="exportSelectedOrdersPdf" > <sw-icon name="regular-file-text" size="16" class="external-orders__download-icon"></sw-icon> PDF herunterladen ({{ selectedOrders.length > 0 ? selectedOrders.length : filteredOrders.length }}) </button> <button class="external-orders__button external-orders__button--secondary" type="button" @click="exportSelectedOrdersExcel" > <sw-icon name="regular-file" size="16" class="external-orders__download-icon"></sw-icon> Excel herunterladen ({{ selectedOrders.length > 0 ? selectedOrders.length : filteredOrders.length }}) </button> </div> </div> </div> </header> <main id="main" class="sw-page__main-content" tabindex="-1"> <div class="external-orders__page"> <sw-card class="external-orders__channels" style="max-width: none; width: 100%;"> <div class="external-orders__channel-tabs"> <button v-for="channel in channels" :key="channel.id" class="external-orders__channel-tab" :class="{ 'is--active': activeChannel === channel.id }" type="button" @click="activeChannel = channel.id; loadOrders()" > <span class="external-orders__channel-logo"> <img :src="channel.logo" :alt="channel.label" /> </span> <span class="external-orders__channel-label">{{ channel.label }}</span> </button> </div> </sw-card> <sw-card class="external-orders__filters-card" style="max-width: none; width: 100%;"> <div class="external-orders__filters-bar"> <div class="external-orders__filters"> <button class="external-orders__button external-orders__button--primary" type="button" @click="resetFilters" > <sw-icon name="regular-filter" size="16"></sw-icon> Filter löschen </button> <sw-datepicker v-model="dateFilters.start" placeholder="Start Datum" class="external-orders__date" size="small" date-type="date" @change="setDateFilter('start', $event)" /> <sw-datepicker v-model="dateFilters.end" placeholder="End Datum" class="external-orders__date" size="small" date-type="date" @change="setDateFilter('end', $event)" /> <button class="external-orders__button external-orders__button--primary" type="button" @click="applyDateFilter" > Anwenden </button> </div> <div class="external-orders__filters-actions"> <sw-text-field v-model="tableSearchTerm" placeholder="Suche Bestellungen" class="external-orders__search" size="small" type="search"></sw-text-field> <button class="external-orders__button external-orders__button--primary" type="button" :disabled="!hasSelectedOrders" @click="openTestMarkingModal" > Testmarkierung Anwenden </button> </div> </div> <div v-if="paginatedOrders.length > 0" class="external-orders__table-wrapper" > <table class="external-orders__table"> <thead> <tr> <th class="external-orders__cell external-orders__cell--checkbox"> <input type="checkbox" class="external-orders__checkbox" :checked="isAllSelected" @change="toggleSelectAll($event)" /> </th> <th class="external-orders__cell"> <div class="external-orders__column-header"> <button class="external-orders__column-sort" type="button" @click="onSortColumn('orderNumber')" > BestellNr <span class="external-orders__sort-indicator"> {{ getSortIndicator('orderNumber') }} </span> </button> <button class="external-orders__column-filter-button" :class="{ 'is--active': isColumnFilterActive('orderNumber') }" type="button" @click.stop="toggleColumnFilter('orderNumber')" > <sw-icon name="regular-filter" size="16" /> </button> <div v-if="activeColumnFilter === 'orderNumber'" class="external-orders__column-filter-panel" @click.stop > <sw-single-select v-model:value="columnFilterMatchMode" :options="columnFilterMatchOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterMatchMode" /> <sw-single-select v-model:value="columnFilters.orderNumber.operator" :options="columnFilterOperatorOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterOperator('orderNumber', $event)" /> <sw-text-field v-model="columnFilters.orderNumber.value" size="small" class="external-orders__column-filter-field"></sw-text-field> <button class="external-orders__column-filter-add external-orders__button external-orders__button--primary external-orders__button--small" disabled type="button"> + Add Rule </button> <div class="external-orders__column-filter-actions"> <button class="external-orders__button external-orders__button--secondary external-orders__button--small" @click="clearColumnFilter('orderNumber')" type="button"> Clear </button> <button class="external-orders__button external-orders__button--primary external-orders__button--small" @click="applyColumnFilter" type="button"> Apply </button> </div> </div> </div> </th> <th class="external-orders__cell"> <div class="external-orders__column-header"> <button class="external-orders__column-sort" type="button" @click="onSortColumn('customerName')" > Kundenname <span class="external-orders__sort-indicator"> {{ getSortIndicator('customerName') }} </span> </button> <button class="external-orders__column-filter-button" :class="{ 'is--active': isColumnFilterActive('customerName') }" type="button" @click.stop="toggleColumnFilter('customerName')" > <sw-icon name="regular-filter" size="16"></sw-icon> </button> <div v-if="activeColumnFilter === 'customerName'" class="external-orders__column-filter-panel" @click.stop > <sw-single-select v-model:value="columnFilterMatchMode" :options="columnFilterMatchOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterMatchMode" /> <sw-single-select v-model:value="columnFilters.customerName.operator" :options="columnFilterOperatorOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterOperator('customerName', $event)" /> <sw-text-field v-model="columnFilters.customerName.value" size="small" class="external-orders__column-filter-field"></sw-text-field> <button class="external-orders__column-filter-add external-orders__button external-orders__button--primary external-orders__button--small" disabled type="button"> + Add Rule </button> <div class="external-orders__column-filter-actions"> <button class="external-orders__button external-orders__button--secondary external-orders__button--small" @click="clearColumnFilter('customerName')" type="button"> Clear </button> <button class="external-orders__button external-orders__button--primary external-orders__button--small" @click="applyColumnFilter" type="button"> Apply </button> </div> </div> </div> </th> <th class="external-orders__cell"> <div class="external-orders__column-header"> <button class="external-orders__column-sort" type="button" @click="onSortColumn('orderReference')" > AuftragsNr <span class="external-orders__sort-indicator"> {{ getSortIndicator('orderReference') }} </span> </button> <button class="external-orders__column-filter-button" :class="{ 'is--active': isColumnFilterActive('orderReference') }" type="button" @click.stop="toggleColumnFilter('orderReference')" > <sw-icon name="regular-filter" size="16"></sw-icon> </button> <div v-if="activeColumnFilter === 'orderReference'" class="external-orders__column-filter-panel" @click.stop > <sw-single-select v-model:value="columnFilterMatchMode" :options="columnFilterMatchOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterMatchMode" /> <sw-single-select v-model:value="columnFilters.orderReference.operator" :options="columnFilterOperatorOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterOperator('orderReference', $event)" /> <sw-text-field v-model="columnFilters.orderReference.value" size="small" class="external-orders__column-filter-field"></sw-text-field> <button class="external-orders__column-filter-add external-orders__button external-orders__button--primary external-orders__button--small" disabled type="button"> + Add Rule </button> <div class="external-orders__column-filter-actions"> <button class="external-orders__button external-orders__button--secondary external-orders__button--small" @click="clearColumnFilter('orderReference')" type="button"> Clear </button> <button class="external-orders__button external-orders__button--primary external-orders__button--small" @click="applyColumnFilter" type="button"> Apply </button> </div> </div> </div> </th> <th class="external-orders__cell"> <div class="external-orders__column-header"> <button class="external-orders__column-sort" type="button" @click="onSortColumn('email')" > Email <span class="external-orders__sort-indicator"> {{ getSortIndicator('email') }} </span> </button> <button class="external-orders__column-filter-button" :class="{ 'is--active': isColumnFilterActive('email') }" type="button" @click.stop="toggleColumnFilter('email')" > <sw-icon name="regular-filter" size="16" /> </button> <div v-if="activeColumnFilter === 'email'" class="external-orders__column-filter-panel" @click.stop > <sw-single-select v-model:value="columnFilterMatchMode" :options="columnFilterMatchOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterMatchMode" /> <sw-single-select v-model:value="columnFilters.email.operator" :options="columnFilterOperatorOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterOperator('email', $event)" /> <sw-text-field v-model="columnFilters.email.value" size="small" class="external-orders__column-filter-field"></sw-text-field> <button class="external-orders__column-filter-add external-orders__button external-orders__button--primary external-orders__button--small" disabled type="button"> + Add Rule </button> <div class="external-orders__column-filter-actions"> <button class="external-orders__button external-orders__button--secondary external-orders__button--small" @click="clearColumnFilter('email')" type="button"> Clear </button> <button class="external-orders__button external-orders__button--primary external-orders__button--small" @click="applyColumnFilter" type="button"> Apply </button> </div> </div> </div> </th> <th class="external-orders__cell"> <div class="external-orders__column-header"> <button class="external-orders__column-sort" type="button" @click="onSortColumn('date')" > Datum <span class="external-orders__sort-indicator"> {{ getSortIndicator('date') }} </span> </button> <button class="external-orders__column-filter-button" :class="{ 'is--active': isColumnFilterActive('date') }" type="button" @click.stop="toggleColumnFilter('date')" > <sw-icon name="regular-filter" size="16"></sw-icon> </button> <div v-if="activeColumnFilter === 'date'" class="external-orders__column-filter-panel" @click.stop > <sw-single-select v-model:value="columnFilterMatchMode" :options="columnFilterMatchOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterMatchMode" /> <sw-single-select v-model:value="columnFilters.date.operator" :options="columnFilterOperatorOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterOperator('date', $event)" /> <sw-text-field v-model="columnFilters.date.value" size="small" class="external-orders__column-filter-field"></sw-text-field> <button class="external-orders__column-filter-add external-orders__button external-orders__button--primary external-orders__button--small" disabled type="button"> + Add Rule </button> <div class="external-orders__column-filter-actions"> <button class="external-orders__button external-orders__button--secondary external-orders__button--small" @click="clearColumnFilter('date')" type="button"> Clear </button> <button class="external-orders__button external-orders__button--primary external-orders__button--small" @click="applyColumnFilter" type="button"> Apply </button> </div> </div> </div> </th> <th class="external-orders__cell"> <div class="external-orders__column-header"> <button class="external-orders__column-sort" type="button" @click="onSortColumn('statusLabel')" > Bestellstatus <span class="external-orders__sort-indicator"> {{ getSortIndicator('statusLabel') }} </span> </button> <button class="external-orders__column-filter-button" :class="{ 'is--active': isColumnFilterActive('statusLabel') }" type="button" @click.stop="toggleColumnFilter('statusLabel')" > <sw-icon name="regular-filter" size="16"></sw-icon> </button> <div v-if="activeColumnFilter === 'statusLabel'" class="external-orders__column-filter-panel" @click.stop > <sw-single-select v-model:value="columnFilterMatchMode" :options="columnFilterMatchOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterMatchMode" /> <sw-single-select v-model:value="columnFilters.statusLabel.operator" :options="columnFilterOperatorOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterOperator('statusLabel', $event)" /> <sw-text-field v-model="columnFilters.statusLabel.value" size="small" class="external-orders__column-filter-field"></sw-text-field> <button class="external-orders__column-filter-add external-orders__button external-orders__button--primary external-orders__button--small" disabled type="button"> + Add Rule </button> <div class="external-orders__column-filter-actions"> <button class="external-orders__button external-orders__button--secondary external-orders__button--small" @click="clearColumnFilter('statusLabel')" type="button"> Clear </button> <button class="external-orders__button external-orders__button--primary external-orders__button--small" @click="applyColumnFilter" type="button"> Apply </button> </div> </div> </div> </th> <th class="external-orders__cell external-orders__cell--actions"> Ansicht </th> </tr> </thead> <tbody> <tr v-for="order in paginatedOrders" :key="getOrderKey(order)"> <td class="external-orders__cell external-orders__cell--checkbox"> <input type="checkbox" class="external-orders__checkbox" :checked="isOrderSelected(order)" @change="toggleOrderSelection(order, $event)" /> </td> <td class="external-orders__cell">{{ order.orderNumber }}</td> <td class="external-orders__cell">{{ order.customerName }}</td> <td class="external-orders__cell">{{ order.orderReference }}</td> <td class="external-orders__cell">{{ order.email }}</td> <td class="external-orders__cell">{{ order.date }}</td> <td class="external-orders__cell"> <sw-label :variant="statusVariant(order.status)" size="small"> {{ order.statusLabel }} </sw-label> </td> <td class="external-orders__cell external-orders__cell--actions"> <button class="external-orders__action external-orders__button external-orders__button--ghost external-orders__button--small" @click="openDetail(order)" type="button"> <sw-icon name="regular-eye" size="16"></sw-icon> </button> </td> </tr> </tbody> </table> </div> <div v-if="paginatedOrders.length > 0" class="external-orders__pagination" > <div class="external-orders__pagination-controls"> <button type="button" class="external-orders__pagination-nav" :disabled="page <= 1" @click="goToFirstPage" > « </button> <button type="button" class="external-orders__pagination-nav" :disabled="page <= 1" @click="goToPreviousPage" > ‹ </button> <div class="external-orders__pagination-pages"> <button v-for="pageNumber in visiblePages" :key="pageNumber" type="button" class="external-orders__pagination-page" :class="{ 'is--active': pageNumber === page }" @click="goToPage(pageNumber)" > {{ pageNumber }} </button> </div> <button type="button" class="external-orders__pagination-nav" :disabled="page >= totalPages" @click="goToNextPage" > › </button> <button type="button" class="external-orders__pagination-nav" :disabled="page >= totalPages" @click="goToLastPage" > » </button> <sw-single-select :value="limitSelection" :options="limitSelectOptions" size="small" class="external-orders__pagination-limit"></sw-single-select> </div> </div> <sw-empty-state v-else icon="regular-shopping-cart" title="Keine Bestellungen gefunden" subline="Es wurden keine Bestellungen für die aktuelle Auswahl geladen."></sw-empty-state> </sw-card> <div v-if="showDetailModal && selectedOrder" class="external-orders__detail-overlay" @click.self="closeDetail" > <div class="external-orders__detail-dialog" role="dialog" aria-modal="true"> <header class="external-orders__detail-header"> <h3>Bestellübersicht für {{ selectedOrder.orderNumber }}</h3> <button class="external-orders__detail-close" type="button" @click="closeDetail">×</button> </header> <div class="external-orders__detail-body"> <div class="external-orders__detail"> <section class="external-orders__detail-card"> <div class="external-orders__detail-card-header"> <h4>Zusätzliche Bestellinformationen</h4> </div> <div class="external-orders__detail-card-body"> <div class="external-orders__detail-grid"> <div class="external-orders__detail-section"> <h4>Kundendetails</h4> <dl> <dt>Kundenname</dt> <dd>{{ selectedOrder.customer.firstName }} {{ selectedOrder.customer.lastName }}</dd> <dt>Kundennummer</dt> <dd>{{ selectedOrder.customer.number }}</dd> <dt>Vorname</dt> <dd>{{ selectedOrder.customer.firstName }}</dd> <dt>Nachname</dt> <dd>{{ selectedOrder.customer.lastName }}</dd> <dt>Kunden-Mail-Adresse</dt> <dd>{{ selectedOrder.customer.email }}</dd> <dt>Kundengruppe</dt> <dd>{{ selectedOrder.customer.group }}</dd> </dl> </div> <div class="external-orders__detail-section"> <h4>Zahlungsdetails</h4> <dl> <dt>Zahlungsmethode</dt> <dd>{{ selectedOrder.payment.method }}</dd> <dt>Zahlungscode</dt> <dd>{{ selectedOrder.payment.code }}</dd> <dt>Fälligkeitsdatum</dt> <dd>{{ selectedOrder.payment.dueDate }}</dd> <dt>Ausstehender Betrag</dt> <dd>{{ selectedOrder.payment.outstanding }}</dd> <dt>Abgerechnet</dt> <dd>{{ selectedOrder.payment.settled }}</dd> <dt>Zusatzinfo</dt> <dd>{{ selectedOrder.payment.extra }}</dd> </dl> </div> <div class="external-orders__detail-section"> <h4>Rechnungsanschrift</h4> <dl> <dt>Straße</dt> <dd>{{ selectedOrder.billingAddress.street }}</dd> <dt>PLZ</dt> <dd>{{ selectedOrder.billingAddress.zip }}</dd> <dt>Stadt</dt> <dd>{{ selectedOrder.billingAddress.city }}</dd> <dt>Land</dt> <dd>{{ selectedOrder.billingAddress.country }}</dd> </dl> </div> <div class="external-orders__detail-section"> <h4>Lieferanschrift</h4> <dl> <dt>Lieferadresse</dt> <dd>{{ selectedOrder.shippingAddress.name }}</dd> <dt>Lieferstraße</dt> <dd>{{ selectedOrder.shippingAddress.street }}</dd> <dt>Postleitzahl/Stadt</dt> <dd>{{ selectedOrder.shippingAddress.zipCity }}</dd> <dt>Land</dt> <dd>{{ selectedOrder.shippingAddress.country }}</dd> </dl> </div> <div class="external-orders__detail-section"> <h4>Weitere Details</h4> <dl> <dt>Bestelldatum</dt> <dd>{{ selectedOrder.additional.orderDate }}</dd> <dt>Status</dt> <dd>{{ selectedOrder.additional.status }}</dd> <dt>Bestelltyp</dt> <dd>{{ selectedOrder.additional.orderType }}</dd> <dt>Notizen</dt> <dd>{{ selectedOrder.additional.notes }}</dd> <dt>Fachberater</dt> <dd>{{ selectedOrder.additional.consultant }}</dd> <dt>Mandant</dt> <dd>{{ selectedOrder.additional.tenant }}</dd> <dt>San6 Auftragsnummer</dt> <dd>{{ selectedOrder.additional.san6OrderNumber }}</dd> </dl> </div> <div class="external-orders__detail-section"> <h4>Erweiterte Bestelldaten</h4> <dl> <dt>Versanddienstleister</dt> <dd>{{ selectedOrder.shipping.carrier }}</dd> <dt>Trackingnummer(n)</dt> <dd>{{ selectedOrder.shipping.trackingNumbers.join(', ') }}</dd> <dt>Einträge in Orgas San6</dt> <dd>{{ selectedOrder.additional.orgaEntries.join(', ') }}</dd> <dt>Dokumente aus Bildarchiv San6</dt> <dd>{{ selectedOrder.additional.documents.join(', ') }}</dd> <dt>PDMS ID + Variante</dt> <dd>{{ selectedOrder.additional.pdmsId }} / {{ selectedOrder.additional.pdmsVariant }}</dd> <dt>TopM Artikelnummer + Ausführung</dt> <dd>{{ selectedOrder.additional.topmArticleNumber }} / {{ selectedOrder.additional.topmExecution }}</dd> <dt>Bestellstatushistorie Gambio/Shopware</dt> <dd>{{ selectedOrder.additional.statusHistorySource }}</dd> </dl> </div> </div> </div> </section> <section class="external-orders__detail-card"> <div class="external-orders__detail-card-header"> <h4>Bestellprodukte</h4> </div> <div class="external-orders__detail-card-body"> <sw-data-grid :data-source="selectedOrder.items" :columns="[ { property: 'name', label: 'Produktname' }, { property: 'quantity', label: 'Menge' }, { property: 'netPrice', label: 'Nettowert' }, { property: 'taxRate', label: 'Steuersatz' }, { property: 'grossPrice', label: 'Bruttowert' }, { property: 'totalPrice', label: 'Gesamtwert' }, ]" identifier="external-orders-items" > <template #column-netPrice="{ item }"> {{ formatCurrency(item.netPrice) }} </template> <template #column-taxRate="{ item }"> {{ item.taxRate }}% </template> <template #column-grossPrice="{ item }"> {{ formatCurrency(item.grossPrice) }} </template> <template #column-totalPrice="{ item }"> {{ formatCurrency(item.totalPrice) }} </template> </sw-data-grid> </div> </section> <section class="external-orders__detail-card"> <div class="external-orders__detail-card-header"> <h4>Statusverlauf</h4> </div> <div class="external-orders__detail-card-body"> <sw-data-grid :data-source="selectedOrder.statusHistory" :columns="[ { property: 'status', label: 'Status' }, { property: 'date', label: 'Datum' }, { property: 'comment', label: 'Kommentare' }, ]" identifier="external-orders-history"></sw-data-grid> </div> </section> <section class="external-orders__detail-card"> <div class="external-orders__detail-card-header"> <h4>Bestellgesamtsummen</h4> </div> <div class="external-orders__detail-card-body"> <div class="external-orders__totals"> <div class="external-orders__totals-row"> <span>Warenwert</span> <span>{{ formatCurrency(selectedOrder.totals.items) }}</span> </div> <div class="external-orders__totals-row"> <span>Versandkosten</span> <span>{{ formatCurrency(selectedOrder.totals.shipping) }}</span> </div> <div class="external-orders__totals-row"> <span>Summe</span> <span>{{ formatCurrency(selectedOrder.totals.sum) }}</span> </div> <div class="external-orders__totals-row"> <span>inkl. MwSt.</span> <span>{{ formatCurrency(selectedOrder.totals.tax) }}</span> </div> <div class="external-orders__totals-row"> <span>Summe netto</span> <span>{{ formatCurrency(selectedOrder.totals.net) }}</span> </div> </div> </div> </section> </div> </div> </div> </div> <div v-if="showTestMarkingModal" class="external-orders__testmarking-overlay" role="dialog" aria-modal="true" > <div class="external-orders__testmarking-dialog"> <header class="external-orders__testmarking-header"> <h3>Bestätigen von Änderungen der Testmarkierung</h3> <button type="button" class="external-orders__testmarking-close" aria-label="Modal schließen" @click="closeTestMarkingModal" > × </button> </header> <div class="external-orders__testmarking-body"> <p class="external-orders__testmarking-intro"> Sie sind dabei, die folgenden Bestellungen als Testbestellungen zu markieren bzw. die Markierung aufzuheben. Bitte überprüfen Sie die Änderungen, bevor Sie sie bestätigen. </p> <div class="external-orders__testmarking-grid"> <div class="external-orders__testmarking-card"> <h4 class="external-orders__testmarking-title is--positive"> Als Test zu markierende Bestellungen </h4> <ul class="external-orders__testmarking-list"> <li v-for="order in testMarkingOrders" :key="getOrderKey(order)" > {{ getOrderDisplayLabel(order) }} </li> <li v-if="testMarkingOrders.length === 0"> Keine Bestellungen ausgewählt. </li> </ul> </div> <div class="external-orders__testmarking-card"> <h4 class="external-orders__testmarking-title is--negative"> Bestellungen, die nicht als Test markieren </h4> <ul class="external-orders__testmarking-list"> <li v-for="order in unmarkedTestOrders" :key="getOrderKey(order)" > {{ getOrderDisplayLabel(order) }} </li> <li v-if="unmarkedTestOrders.length === 0"> Keine Bestellungen ausgewählt. </li> </ul> </div> </div> </div> <footer class="external-orders__testmarking-footer"> <sw-button variant="secondary" @click="closeTestMarkingModal"> Abbrechen </sw-button> <sw-button variant="primary" @click="applyTestMarking"> Bestätige </sw-button> </footer> </div> </div> </div> </main> </div>`,{Component:I,Mixin:K}=Shopware;I.register("external-orders-list",{template:$,inject:["externalOrderService","systemConfigApiService"],mixins:[K.getByName("notification")],data(){return{isLoading:!1,isSeedingTestData:!1,pageTitle:"Bestellübersichten",orders:[],summary:{orderCount:0,totalRevenue:0,totalItems:0},channelSources:{},channels:[{id:"b2b",label:"First-medical-shop.de",logo:"http://controlling.first-medical.de:8480/assets/images/b2b1.png"},{id:"ebay_de",label:"Ebay.DE",logo:"http://controlling.first-medical.de:8480/assets/images/ebay1.png"},{id:"kaufland",label:"KaufLand",logo:"http://controlling.first-medical.de:8480/assets/images/kaufland1.png"},{id:"ebay_at",label:"Ebay.AT",logo:"http://controlling.first-medical.de:8480/assets/images/ebayAT.png"},{id:"zonami",label:"Zonami",logo:"http://controlling.first-medical.de:8480/assets/images/zonami1.png"},{id:"peg",label:"PEG",logo:"http://controlling.first-medical.de:8480/assets/images/peg2.png"},{id:"bezb",label:"BEZB",logo:"http://controlling.first-medical.de:8480/assets/images/bezb1.png"}],activeChannel:"b2b",tableSearchTerm:"",columnFilterMatchMode:"all",columnFilterMatchOptions:[{value:"all",label:"Match All"}],columnFilterOperatorOptions:[{value:"startsWith",label:"Starts with"},{value:"contains",label:"Contains"},{value:"equals",label:"Equals"}],columnFilters:{orderNumber:{value:"",operator:"startsWith"},customerName:{value:"",operator:"startsWith"},orderReference:{value:"",operator:"startsWith"},email:{value:"",operator:"startsWith"},date:{value:"",operator:"startsWith"},statusLabel:{value:"",operator:"startsWith"}},activeColumnFilter:null,selectedOrder:null,selectedOrders:[],showDetailModal:!1,showTestMarkingModal:!1,dateFilters:{start:null,end:null},page:1,limit:10,limitOptions:[10,25,50,100],sortBy:"date",sortDirection:"DESC"}},computed:{columns(){return[{property:"order-number",dataIndex:"orderNumber",sortBy:"orderNumber",label:"BestellNr",sortable:!0,primary:!0,allowResize:!0},{property:"customer-name",dataIndex:"customerName",sortBy:"customerName",label:"Kundenname",sortable:!0,allowResize:!0},{property:"order-reference",dataIndex:"orderReference",sortBy:"orderReference",label:"AuftragsNr",sortable:!0,allowResize:!0},{property:"email",dataIndex:"email",sortBy:"email",label:"Email",sortable:!0,allowResize:!0},{property:"date",dataIndex:"date",sortBy:"date",label:"Datum",sortable:!0,allowResize:!0},{property:"status-label",dataIndex:"statusLabel",sortBy:"statusLabel",label:"Bestellstatus",sortable:!0,allowResize:!0},{property:"actions",label:"Ansicht",sortable:!1,width:"90px"}]},activeChannelLabel(){var e;return((e=this.channels.find(t=>t.id===this.activeChannel))==null?void 0:e.label)||""},activeChannelSource(){return this.channelSources[this.activeChannel]||""},filteredOrders(){const e=this.tableSearchTerm.trim().toLowerCase();this.orders.filter(a=>a.channel?a.channel===this.activeChannel:!0);const t=this.activeChannel==="all"?null:this.activeChannel,r=this.orders.filter(a=>{if(!t)return!0;const n=a.channel??a.channelId??a.salesChannelId??a.salesChannel;return String(n??"").toLowerCase()===t}),s=this.applyColumnFilters(r),l=this.applyDateFilters(s);return e?l.filter(a=>[a.orderNumber,a.customerName,a.orderReference,a.email,a.statusLabel,a.date].some(i=>String(i??"").toLowerCase().includes(e))):l},sortedOrders(){const e=this.sortBy,t=this.sortDirection==="DESC"?-1:1;return[...this.filteredOrders].sort((r,s)=>{const l=this.getSortValue(r,e),a=this.getSortValue(s,e);return l===a?0:l>a?t:-t})},paginatedOrders(){const e=(this.page-1)*this.limit;return this.sortedOrders.slice(e,e+this.limit)},paginationTotal(){return this.sortedOrders.length},totalPages(){return this.limit<=0?1:Math.max(1,Math.ceil(this.paginationTotal/this.limit))},visiblePages(){const t=this.totalPages,r=this.page;if(t<=5)return Array.from({length:t},(n,i)=>i+1);const s=Math.floor(5/2);let l=Math.max(1,r-s),a=l+5-1;return a>t&&(a=t,l=a-5+1),Array.from({length:a-l+1},(n,i)=>l+i)},limitSelectOptions(){return this.limitOptions.map(e=>({value:String(e),label:String(e)}))},limitSelection(){return this.limitSelectOptions.find(e=>e.value===String(this.limit))||null},isAllSelected(){return this.paginatedOrders.length===0?!1:this.paginatedOrders.every(e=>this.isOrderSelected(e))},hasSelectedOrders(){return this.selectedOrders.length>0},testMarkingOrders(){return this.selectedOrders},unmarkedTestOrders(){const e=new Set(this.selectedOrders.map(t=>this.getOrderKey(t)));return this.filteredOrders.filter(t=>!e.has(this.getOrderKey(t)))}},watch:{tableSearchTerm(){this.page=1},activeChannel(){this.page=1},columnFilterMatchMode(){this.page=1},columnFilters:{handler(){this.page=1},deep:!0}},created(){this.initializePage()},methods:{async initializePage(){await this.loadOverviewConfiguration(),await this.loadOrders()},async loadOverviewConfiguration(){var e;try{const t=await this.systemConfigApiService.getValues("ExternalOrders"),r=o=>(t==null?void 0:t[`ExternalOrders.config.${o}`])??"",l=(((e=Shopware.Store.get("session"))==null?void 0:e.currentLocale)??"").toLowerCase().startsWith("de"),a=r("pageNameDe"),n=r("pageNameEn"),i=Number.parseInt(r("defaultColumnsPerPage"),10);this.channelSources={b2b:r("externalOrdersApiUrlB2b"),ebay_de:r("externalOrdersApiUrlEbayDe"),kaufland:r("externalOrdersApiUrlKaufland"),ebay_at:r("externalOrdersApiUrlEbayAt"),zonami:r("externalOrdersApiUrlZonami"),peg:r("externalOrdersApiUrlPeg"),bezb:r("externalOrdersApiUrlBezb")},this.pageTitle=(l?a:n)||this.pageTitle,Number.isFinite(i)&&i>0&&(this.limit=i,this.limitOptions.includes(i)||(this.limitOptions=[...this.limitOptions,i].sort((o,c)=>o-c)))}catch(t){this.channelSources={},this.createNotificationWarning({title:"Konfiguration konnte nicht geladen werden",message:(t==null?void 0:t.message)||"Die Quellen der Übersichten konnten nicht geladen werden."})}},async loadOrders(){var e;this.isLoading=!0,this.page=1;try{const t=this.activeChannel||null,r=await this.externalOrderService.list({channel:t}),s=((e=r==null?void 0:r.data)==null?void 0:e.data)??(r==null?void 0:r.data)??r,l=Array.isArray(s==null?void 0:s.orders)?s.orders:[];this.orders=l,this.page=1,s!=null&&s.summary?this.summary=s.summary:this.summary={orderCount:l.length,totalRevenue:l.reduce((a,n)=>a+(n.totalRevenue||0),0),totalItems:l.reduce((a,n)=>a+(n.totalItems||0),0)}}catch(t){this.orders=[],this.summary={orderCount:0,totalRevenue:0,totalItems:0},this.createNotificationError({title:"Bestellungen konnten nicht geladen werden",message:(t==null?void 0:t.message)||"Bitte prüfen Sie die Verbindung zu den externen APIs."})}finally{this.isLoading=!1}},onPageChange(e){if(typeof e=="number"){this.page=e;return}const{page:t,limit:r}=e??{},s=typeof t=="number"?t:this.page,l=typeof r=="number"?r:this.limit;this.page=s,this.limit=l},goToPreviousPage(){this.page<=1||(this.page-=1)},goToFirstPage(){this.page=1},goToLastPage(){this.page=this.totalPages},goToPage(e){if(typeof e!="number")return;const t=Math.max(1,Math.min(this.totalPages,e));this.page=t},goToNextPage(){this.page>=this.totalPages||(this.page+=1)},onLimitChange(e){const t=Number(this.normalizeSelectValue(e));Number.isNaN(t)||t<=0||(this.limit=t,this.page=1)},onSearch(){this.page=1},applyDateFilter(){this.page=1},setDateFilter(e,t){Object.prototype.hasOwnProperty.call(this.dateFilters,e)&&(this.dateFilters[e]=t)},setColumnFilterMatchMode(e){this.columnFilterMatchMode=this.normalizeSelectValue(e)??"all"},setColumnFilterOperator(e,t){this.columnFilters[e]&&(this.columnFilters[e].operator=this.normalizeSelectValue(t)??"startsWith")},resetFilters(){this.tableSearchTerm="",this.columnFilterMatchMode="all",this.dateFilters={start:null,end:null},Object.keys(this.columnFilters).forEach(e=>{this.columnFilters[e].value="",this.columnFilters[e].operator="startsWith"}),this.page=1},toggleColumnFilter(e){if(this.activeColumnFilter===e){this.activeColumnFilter=null;return}this.activeColumnFilter=e},applyColumnFilter(){this.page=1,this.activeColumnFilter=null},clearColumnFilter(e){this.columnFilters[e]&&(this.columnFilters[e].value="",this.columnFilters[e].operator="startsWith",this.activeColumnFilter=null)},isColumnFilterActive(e){const t=this.columnFilters[e];return!!(t&&String(t.value??"").trim())},applyColumnFilters(e){const t=Object.entries(this.columnFilters).filter(([,r])=>String(r.value??"").trim().length>0);return t.length?e.filter(r=>t.every(([s,l])=>{const a=this.getColumnFilterValue(r,s);return this.matchesColumnFilter(a,l)})):e},getColumnFilterValue(e,t){return(e==null?void 0:e[t])??""},matchesColumnFilter(e,t){const r=String(e??"").toLowerCase(),s=String(t.value??"").toLowerCase(),l=this.normalizeSelectValue(t.operator)??"startsWith";return s?l==="equals"?r===s:l==="contains"?r.includes(s):r.startsWith(s):!0},normalizeSelectValue(e){return e&&typeof e=="object"?e.value??e.id??e.name??"":e},applyDateFilters(e){const t=this.getDateFilterTimestamp(this.dateFilters.start,"start"),r=this.getDateFilterTimestamp(this.dateFilters.end,"end");return!t&&!r?e:e.filter(s=>{const l=this.parseOrderDate(s==null?void 0:s.date);return!(!Number.isFinite(l)||t&&l<t||r&&l>r)})},getDateFilterTimestamp(e,t){if(!e)return null;const r=e instanceof Date?new Date(e.getTime()):new Date(e);return Number.isNaN(r.getTime())?null:(t==="start"?r.setHours(0,0,0,0):r.setHours(23,59,59,999),r.getTime())},normalizeSortValue(e,t=this.sortBy){if(e==null)return"";if(String(t).toLowerCase().includes("date")){const s=this.parseOrderDate(e);return Number.isNaN(s)?String(e):s}if(typeof e=="number")return e;const r=String(e).trim();return/^-?\d+(\.\d+)?$/.test(r)?Number(r):r.toLowerCase()},onSortColumn(e){const t=(e==null?void 0:e.sortBy)??(e==null?void 0:e.dataIndex)??(e==null?void 0:e.property)??e;if(!t)return;const r=(e==null?void 0:e.sortDirection)??(e==null?void 0:e.direction);this.sortBy===t&&!r?this.sortDirection=this.sortDirection==="ASC"?"DESC":"ASC":(this.sortBy=t,this.sortDirection=r??"ASC"),this.page=1},onSelectionChange(e){if(Array.isArray(e)){this.selectedOrders=e;return}if(e&&typeof e=="object"){this.selectedOrders=Object.values(e);return}this.selectedOrders=[]},toggleSelectAll(e){var s;if(!((s=e==null?void 0:e.target)==null?void 0:s.checked)){const l=new Set(this.paginatedOrders.map(a=>this.getOrderKey(a)));this.selectedOrders=this.selectedOrders.filter(a=>!l.has(this.getOrderKey(a)));return}const r=new Map(this.selectedOrders.map(l=>[this.getOrderKey(l),l]));this.paginatedOrders.forEach(l=>{r.set(this.getOrderKey(l),l)}),this.selectedOrders=Array.from(r.values())},toggleOrderSelection(e,t){var l;const r=(l=t==null?void 0:t.target)==null?void 0:l.checked,s=this.getOrderKey(e);if(s){if(r){const a=new Map(this.selectedOrders.map(n=>[this.getOrderKey(n),n]));a.set(s,e),this.selectedOrders=Array.from(a.values());return}this.selectedOrders=this.selectedOrders.filter(a=>this.getOrderKey(a)!==s)}},isOrderSelected(e){const t=this.getOrderKey(e);return this.selectedOrders.some(r=>this.getOrderKey(r)===t)},getSortIndicator(e){return this.sortBy!==e?"↕":this.sortDirection==="ASC"?"↑":"↓"},async openDetail(e){this.isLoading=!0;try{if(this.isFakeOrder(e))this.selectedOrder=this.normalizeOrderDetail(this.buildFakeOrderDetail(e));else{const t=await this.externalOrderService.detail(e.id);this.selectedOrder=this.normalizeOrderDetail(t)}this.showDetailModal=!0}catch(t){this.createNotificationError({title:"Bestelldetails konnten nicht geladen werden",message:(t==null?void 0:t.message)||"Bitte prüfen Sie die Verbindung zu den externen APIs."})}finally{this.isLoading=!1}},closeDetail(){this.showDetailModal=!1,this.selectedOrder=null},normalizeOrderDetail(e){const t=e??{},r=t.totals??{};return{...t,customer:{number:"",firstName:"",lastName:"",email:"",group:"",...t.customer??{}},payment:{method:"",code:"",dueDate:"",outstanding:"",settled:"",extra:"",...t.payment??{}},billingAddress:{street:"",zip:"",city:"",country:"",...t.billingAddress??{}},shippingAddress:{name:"",street:"",zipCity:"",country:"",...t.shippingAddress??{}},additional:{orderDate:"",status:"",orderType:"",notes:"",consultant:"",tenant:"",san6OrderNumber:"",orgaEntries:[],documents:[],pdmsId:"",pdmsVariant:"",topmArticleNumber:"",topmExecution:"",statusHistorySource:"",...t.additional??{}},shipping:{carrier:"",trackingNumbers:[],...t.shipping??{}},items:Array.isArray(t.items)?t.items:[],statusHistory:Array.isArray(t.statusHistory)?t.statusHistory:[],totals:{items:r.items??0,shipping:r.shipping??0,sum:r.sum??0,tax:r.tax??0,net:r.net??0}}},openTestMarkingModal(){this.hasSelectedOrders&&(this.showTestMarkingModal=!0)},closeTestMarkingModal(){this.showTestMarkingModal=!1},applyTestMarking(){this.showTestMarkingModal=!1},getOrderKey(e){return(e==null?void 0:e.id)??(e==null?void 0:e.orderNumber)??""},getOrderDisplayLabel(e){const t=e!=null&&e.orderNumber?`#${e.orderNumber}`:"",r=(e==null?void 0:e.customerName)??"";return t&&r?`Order ${t} - ${r}`:t?`Order ${t}`:r||"Order"},formatCurrency(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e)},statusVariant(e){return e==="processing"?"info":e==="shipped"?"success":e==="closed"?"danger":"neutral"},isFakeOrder(e){const t=(e==null?void 0:e.id)??"";return typeof t=="string"&&t.startsWith("order-")},buildFakeOrderDetail(e){const t=String((e==null?void 0:e.customerName)??"Max Mustermann").split(" "),r=t[0]||"Max",s=t.slice(1).join(" ")||"Mustermann",l=(e==null?void 0:e.orderNumber)??"0000000",a=(e==null?void 0:e.totalItems)??1,n=79.5,i=Number((n/1.19).toFixed(2)),o=19,c=Array.from({length:Math.min(a,6)},(m,h)=>({name:`Medizinisches Produkt ${h+1}`,quantity:1,netPrice:i,taxRate:o,grossPrice:n,totalPrice:n})),p=c.reduce((m,h)=>m+h.totalPrice,0);return{...e,customer:{number:`KND-${l}`,firstName:r,lastName:s,email:(e==null?void 0:e.email)??"kunde@example.com",group:"Standard"},payment:{method:"Kreditkarte",code:`PAY-${l}`,dueDate:(e==null?void 0:e.date)??"2025-12-31",outstanding:this.formatCurrency(0),settled:this.formatCurrency(p),extra:"Transaktion bestätigt"},billingAddress:{street:"Hauptstraße 12",zip:"20354",city:"Hamburg",country:"Deutschland"},shippingAddress:{name:(e==null?void 0:e.customerName)??"Max Mustermann",street:"Hauptstraße 12",zipCity:"20354 Hamburg",country:"Deutschland"},additional:{orderDate:(e==null?void 0:e.date)??"2025-12-30 09:31",status:(e==null?void 0:e.statusLabel)??"Bezahlt / in Bearbeitung",orderType:"Standard",notes:"Testbestellung aus externer Übersicht",consultant:"Lisa Berger",tenant:"FM Shop",san6OrderNumber:`SAN6-${l}`,orgaEntries:["ORG-394","ORG-402"],documents:["Archiv 2025-12","Scan 444"],pdmsId:"PDMS-7742",pdmsVariant:"V2",topmArticleNumber:"TOPM-331",topmExecution:"Standard",statusHistorySource:"System"},shipping:{carrier:"DHL",trackingNumbers:[`00340434${l}`]},items:c,statusHistory:[{status:"Bestellung angelegt",date:(e==null?void 0:e.date)??"2025-12-30 09:31",comment:"Automatisch"},{status:(e==null?void 0:e.statusLabel)??"Bezahlt / in Bearbeitung",date:(e==null?void 0:e.date)??"2025-12-30 10:15",comment:"Zahlung bestätigt"},{status:"Versand vorbereitet",date:"2025-12-31 08:10",comment:"Kommissionierung gestartet"}]}},exportSelectedOrdersPdf(){const e=this.getOrdersForExport();if(!e.length){this.createNotificationWarning({title:"Keine Bestellungen gefunden",message:"Für den aktuellen Filter sind keine Bestellungen verfügbar."});return}const t=this.buildTablePdf(e);this.downloadBlob("external-orders.pdf","application/pdf",t)},exportSelectedOrdersExcel(){const e=this.getOrdersForExport();if(!e.length){this.createNotificationWarning({title:"Keine Bestellungen gefunden",message:"Für den aktuellen Filter sind keine Bestellungen verfügbar."});return}const t=this.buildExportRows(e),r=this.buildCsv(t);this.downloadBlob("external-orders.csv","text/csv;charset=utf-8;",r)},async seedTestData(){if(!this.isSeedingTestData){this.isSeedingTestData=!0;try{const e=await this.externalOrderService.seedTestData(),t=(e==null?void 0:e.inserted)??0;this.createNotificationSuccess({title:"Testdaten gespeichert",message:t>0?`Es wurden ${t} Testbestellungen gespeichert.`:"Keine neuen Testbestellungen wurden gespeichert."}),await this.loadOrders()}catch(e){this.createNotificationError({title:"Testdaten konnten nicht gespeichert werden",message:(e==null?void 0:e.message)||"Bitte prüfen Sie die Konfiguration der externen APIs."})}finally{this.isSeedingTestData=!1}}},getOrdersForExport(){return this.filteredOrders},buildExportRows(e){const t=["Bestellnummer","Kundenname","Land","Zahlungsmethode","Datum","Bestellstatus","Stück","Summe"],r=e.map(s=>[s.orderNumber??"",s.customerName??"",this.getOrderCountry(s),this.getOrderPaymentMethod(s),this.formatDateForExport(s.date),s.statusLabel??"",this.getOrderItemCount(s),this.formatNumberForExport(this.getOrderTotal(s))]);return[t,...r]},buildExportLines(e){const r=this.buildExportRows(e).map(o=>o.map(c=>String(c??""))),s=r[0].map((o,c)=>{const p=Math.max(...r.map(m=>m[c].length));return Math.min(Math.max(p,6),24)}),l=r.map(o=>o.map((c,p)=>(c.length>s[p]?`${c.slice(0,s[p]-1)}…`:c).padEnd(s[p]))),a=l[0].join(" | "),n=s.map(o=>"-".repeat(o)).join("-|-"),i=l.slice(1).map(o=>o.join(" | "));return[this.buildExportSummaryLine(e),a,n,...i]},buildCsv(e){const r=l=>{const a=String(l??""),n=a.replace(/"/g,'""');return a.includes(";")||a.includes(`
`)||a.includes("\r")||a.includes('"')?`"${n}"`:n};return`\uFEFF${e.map(l=>l.map(r).join(";")).join(`\r
`)}`},buildExportSummaryLine(e){const t=e.reduce((a,n)=>a+this.getOrderItemCount(n),0),r=e.reduce((a,n)=>a+this.getOrderTotal(n),0),s=this.getExportDateRange(e),l=this.formatCurrency(r);return["Shopbestellungen",s?`${s}`:null,`${e.length} Bestellungen`,`${l} Gesamtumsatz`,`${t} Stück`].filter(Boolean).join(" | ")},getExportDateRange(e){const t=e.map(l=>this.parseOrderDate(l.date)).filter(l=>Number.isFinite(l));if(!t.length)return"";const r=new Date(Math.min(...t)),s=new Date(Math.max(...t));return`${this.formatDateForExport(r)} - ${this.formatDateForExport(s)}`},parseOrderDate(e){if(!e)return NaN;const t=String(e).replace(" ","T"),r=Date.parse(t);return Number.isNaN(r)?NaN:r},formatDateForExport(e){if(!e)return"";if(e instanceof Date)return e.toLocaleDateString("de-DE");const t=this.parseOrderDate(e);return Number.isNaN(t)?String(e):new Date(t).toISOString().slice(0,10)},formatNumberForExport(e){const t=typeof e=="number"?e:Number(e);return Number.isFinite(t)?new Intl.NumberFormat("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t):""},getOrderCountry(e){var t,r;return((t=e==null?void 0:e.billingAddress)==null?void 0:t.country)??((r=e==null?void 0:e.shippingAddress)==null?void 0:r.country)??(e==null?void 0:e.country)??""},getOrderPaymentMethod(e){var t;return((t=e==null?void 0:e.payment)==null?void 0:t.method)??(e==null?void 0:e.paymentMethod)??(e==null?void 0:e.payment)??""},getOrderItemCount(e){var t;return(e==null?void 0:e.totalItems)??(e==null?void 0:e.itemsCount)??((t=e==null?void 0:e.items)==null?void 0:t.length)??0},getOrderTotal(e){return(e==null?void 0:e.totalPrice)??(e==null?void 0:e.totalRevenue)??(e==null?void 0:e.amountTotal)??(e==null?void 0:e.priceTotal)??0},buildTablePdf(e){const t=this.buildExportRows(e),r=this.buildExportSummaryLine(e),s=595,l=842,a=30,i=l-40,o=s-a*2,{columnWidths:c,scale:p}=this.getPdfColumnWidths(t,o),m=Math.max(8,Math.floor(10*p)),h=Math.max(14,Math.round(m*1.8)),x=i-h*2,C=c.reduce((d,b)=>d+b,0),O=c.reduce((d,b)=>{const v=d[d.length-1];return d.push(v+b),d},[a]),k=t.length*h,M=x-k,u=[];u.push("BT"),u.push(`/F1 ${m} Tf`),u.push(`1 0 0 1 ${a} ${i} Tm`),u.push(`(${this.escapePdfText(r)}) Tj`),u.push("ET"),u.push("0.5 w"),O.forEach(d=>{u.push(`${d} ${x} m ${d} ${M} l S`)});for(let d=0;d<=t.length;d+=1){const b=x-d*h;u.push(`${a} ${b} m ${a+C} ${b} l S`)}const N=d=>Math.floor((d-6)/(m*.55));t.forEach((d,b)=>{const v=x-(b+1)*h+Math.round(m*.6);d.forEach((D,F)=>{const A=O[F]+3,P=c[F],B=String(D??""),z=this.trimPdfText(B,N(P));u.push("BT"),u.push(`/F1 ${m} Tf`),u.push(`1 0 0 1 ${A} ${v} Tm`),u.push(`(${this.escapePdfText(z)}) Tj`),u.push("ET")})});const w=u.join(`
`),g=[];g.push(`1 0 obj
<< /Type /Catalog /Pages 2 0 R >>
endobj
`),g.push(`2 0 obj
<< /Type /Pages /Kids [3 0 R] /Count 1 >>
endobj
`),g.push(`3 0 obj
<< /Type /Page /Parent 2 0 R /MediaBox [0 0 595 842] /Contents 5 0 R /Resources << /Font << /F1 4 0 R >> >> >>
endobj
`),g.push(`4 0 obj
<< /Type /Font /Subtype /Type1 /BaseFont /Helvetica >>
endobj
`),g.push(`5 0 obj
<< /Length ${w.length} >>
stream
${w}
endstream
endobj
`);let _=`%PDF-1.4
`;const S=[],y=new TextEncoder;g.forEach(d=>{S.push(y.encode(_).length),_+=d});const T=y.encode(_).length;return _+=`xref
0 ${g.length+1}
0000000000 65535 f 
`,S.forEach(d=>{_+=`${String(d).padStart(10,"0")} 00000 n 
`}),_+=`trailer
<< /Size ${g.length+1} /Root 1 0 R >>
startxref
${T}
%%EOF`,y.encode(_)},getPdfColumnWidths(e,t){const r=e[0].map((i,o)=>Math.max(...e.map(c=>String(c[o]??"").length))),s=[60,120,55,95,65,110,45,70],l=r.map((i,o)=>Math.max(s[o],i*6)),a=l.reduce((i,o)=>i+o,0),n=a>t?t/a:1;return{columnWidths:l.map(i=>Math.floor(i*n)),scale:n}},trimPdfText(e,t){return t<=0?"":e.length<=t?e:t===1?"…":`${e.slice(0,t-1)}…`},escapePdfText(e){return String(e).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},downloadBlob(e,t,r){const s=r instanceof Uint8Array?new Blob([r],{type:t}):new Blob([r],{type:t}),l=URL.createObjectURL(s),a=document.createElement("a");a.href=l,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(l)},getSortValue(e,t){if(!t)return"";const r=e==null?void 0:e[t];return this.normalizeSortValue(r,t)}}});const{Module:V}=Shopware;V.register("external-orders",{type:"plugin",name:"external-orders",title:"Bestellübersichten",description:"Zentrale Übersicht für externe Bestellungen",color:"#009ee3",icon:"regular-shopping-cart",routes:{index:{component:"external-orders-list",path:"index",meta:{privilege:"admin"}}},navigation:[{id:"external-orders",label:"Bestellübersichten",color:"#009ee3",path:"external.orders.index",icon:"regular-shopping-cart",parent:"sw-order",position:45}]});
//# sourceMappingURL=external-orders-CsyiabBY.js.map
