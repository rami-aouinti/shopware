const{ApiService:f}=Shopware.Classes;class K extends f{constructor(t,s,r="external-orders"){super(t,s,r),this.name="externalOrderService"}async list({channel:t=null,search:s=null}={}){const r={};t&&(r.channel=t),s&&(r.search=s);const a=await this.httpClient.get(`_action/${this.getApiBasePath()}/list`,{headers:this.getBasicHeaders(),params:r}),l=f.handleResponse(a)??(a==null?void 0:a.data);return(l==null?void 0:l.data)??l}async detail(t){const s=await this.httpClient.get(`_action/${this.getApiBasePath()}/detail/${t}`,{headers:this.getBasicHeaders()}),r=f.handleResponse(s)??(s==null?void 0:s.data);return(r==null?void 0:r.data)??r}async markOrdersAsTest(t){const s=await this.httpClient.post(`_action/${this.getApiBasePath()}/mark-test`,{orderIds:t},{headers:this.getBasicHeaders()}),r=f.handleResponse(s)??(s==null?void 0:s.data);return(r==null?void 0:r.data)??r}async runSyncNow(){const t=await this.httpClient.post(`_action/${this.getApiBasePath()}/sync-now`,{},{headers:this.getBasicHeaders()}),s=f.handleResponse(t)??(t==null?void 0:t.data);return(s==null?void 0:s.data)??s}async getSyncStatus(){const t=await this.httpClient.get(`_action/${this.getApiBasePath()}/sync-status`,{headers:this.getBasicHeaders()}),s=f.handleResponse(t)??(t==null?void 0:t.data);return(s==null?void 0:s.data)??s}async getTestDataStatus(){const t=await this.httpClient.get(`_action/${this.getApiBasePath()}/test-data/status`,{headers:this.getBasicHeaders()}),s=f.handleResponse(t)??(t==null?void 0:t.data);return(s==null?void 0:s.data)??s}async toggleTestData(){const t=await this.httpClient.post(`_action/${this.getApiBasePath()}/test-data/toggle`,{},{headers:this.getBasicHeaders()}),s=f.handleResponse(t)??(t==null?void 0:t.data);return(s==null?void 0:s.data)??s}async seedTestData(){const t=await this.httpClient.post(`_action/${this.getApiBasePath()}/test-data`,{},{headers:this.getBasicHeaders()}),s=f.handleResponse(t)??(t==null?void 0:t.data);return(s==null?void 0:s.data)??s}}Shopware.Application.addServiceProvider("externalOrderService",e=>{const t=Shopware.Application.getContainer("init"),s=(t==null?void 0:t.httpClient)??e.httpClient,r=e.loginService??Shopware.Service("loginService");return new K(s,r)});const{Component:I,Mixin:j}=Shopware;I.register("external-orders-testdata-button",{template:`
        <div class="external-orders-testdata-button">
            <label class="sw-field__label" v-if="label">{{ label }}</label>
            <sw-button
                variant="primary"
                size="small"
                :disabled="isLoading"
                @click="onToggleDemoData"
            >
                {{ buttonLabel }}
            </sw-button>
            <div v-if="helpText" class="sw-field__help-text">
                {{ helpText }}
            </div>
        </div>
    `,inject:["externalOrderService"],mixins:[j.getByName("notification")],props:{element:{type:Object,required:!1,default:null}},data(){return{isLoading:!1,hasDemoData:!1}},computed:{label(){var e;return((e=this.element)==null?void 0:e.label)??""},helpText(){var e;return((e=this.element)==null?void 0:e.helpText)??""},buttonLabel(){return this.hasDemoData?"Demo-Daten entfernen":"Demo-Daten speichern"}},async created(){await this.loadStatus()},methods:{async loadStatus(){this.isLoading=!0;try{const e=await this.externalOrderService.getTestDataStatus();this.hasDemoData=!!(e!=null&&e.hasDemoData)}catch(e){this.createNotificationError({title:"Demo-Daten Status",message:(e==null?void 0:e.message)||"Status konnte nicht geladen werden."})}finally{this.isLoading=!1}},async onToggleDemoData(){if(!this.isLoading){this.isLoading=!0;try{const e=await this.externalOrderService.toggleTestData();if(this.hasDemoData=!!(e!=null&&e.hasDemoData),(e==null?void 0:e.action)==="removed"){const s=(e==null?void 0:e.removed)??0;this.createNotificationSuccess({title:"Demo-Daten entfernt",message:s>0?`${s} Demo-Bestellungen wurden entfernt.`:"Keine Demo-Bestellungen waren vorhanden."});return}const t=(e==null?void 0:e.inserted)??0;this.createNotificationSuccess({title:"Demo-Daten gespeichert",message:t>0?`Es wurden ${t} Demo-Bestellungen gespeichert.`:"Keine neuen Demo-Bestellungen wurden gespeichert."})}catch(e){this.createNotificationError({title:"Demo-Daten",message:(e==null?void 0:e.message)||"Aktion konnte nicht ausgeführt werden."})}finally{this.isLoading=!1}}}}});var N,E;function V(){var e;return E||(E=1,N=(e=window.Shopware)==null?void 0:e.Vue),N}var M=V();const W={xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"title desc",viewBox:"0 0 420 280"};function H(e,t){return M.openBlock(),M.createElementBlock("svg",W,[...t[0]||(t[0]=[M.createStaticVNode('<desc>Stylized package and global channels for external order sync.</desc><defs><linearGradient id="a" x1="0" x2="1" y1="0" y2="1"><stop offset="0%" stop-color="#e9f2ff"></stop><stop offset="100%" stop-color="#d7e7ff"></stop></linearGradient><linearGradient id="b" x1="0" x2="0" y1="0" y2="1"><stop offset="0%" stop-color="#4f8cff"></stop><stop offset="100%" stop-color="#2c62d6"></stop></linearGradient></defs><rect width="400" height="260" x="10" y="10" fill="url(#a)" rx="24"></rect><circle cx="75" cy="65" r="26" fill="#fff" opacity=".9"></circle><circle cx="350" cy="210" r="18" fill="#fff" opacity=".75"></circle><g transform="translate(100 70)"><rect width="120" height="110" x="60" y="25" fill="url(#b)" rx="12"></rect><path fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="8" d="m60 62 60-35 60 35"></path><path fill="none" stroke="#fff" stroke-width="7" d="M120 27v108"></path><circle cx="30" cy="80" r="18" fill="#28c76f"></circle><circle cx="210" cy="80" r="18" fill="#ff9f43"></circle><circle cx="120" cy="160" r="20" fill="#7367f0"></circle><path stroke="#5a6b82" stroke-linecap="round" stroke-width="4" d="M48 80h36m108 0h-36m-36 60v-28"></path></g><text x="210" y="245" fill="#1f3b73" font-family="Arial, sans-serif" font-size="20" font-weight="700" text-anchor="middle"> External Orders </text>',7)])])}const U={render:H},{Component:Z,Mixin:G}=Shopware;Z.register("external-orders-channel-config",{template:`
        <div class="external-orders-channel-config">
            <div class="external-orders-channel-config__header">
                <div>
                    <label class="sw-field__label" v-if="label">{{ label }}</label>
                    <h3 class="external-orders-channel-config__headline">External Orders Hub</h3>
                    <p class="external-orders-channel-config__subtitle">
                        Verwalte alle Zugangsdaten zentral und starte den Sync mit einem Klick.
                    </p>
                </div>
                <img
                    class="external-orders-channel-config__hero-image"
                    :src="channelIllustration"
                    alt="External orders"
                />
            </div>

            <div class="external-orders-channel-config__panel">
                <div class="external-orders-channel-config__grid">
                    <button
                        v-for="channel in channels"
                        :key="channel.id"
                        type="button"
                        class="external-orders-channel-config__item"
                        @click="openChannelModal(channel)"
                    >
                        <span class="external-orders-channel-config__logo">
                            <img :src="channel.logo" :alt="channel.label" />
                        </span>
                        <span class="external-orders-channel-config__title">{{ channel.label }}</span>
                    </button>
                </div>
            </div>

            <div class="external-orders-channel-config__cron">
                <sw-button variant="primary" size="small" :disabled="isRunningCron" @click="runSyncNow">
                    Cron job jetzt starten
                </sw-button>
                <div class="external-orders-channel-config__cron-status">
                    Letzter Cronjob:
                    <strong>{{ cronStatusLabel }}</strong>
                </div>
            </div>

            <sw-modal
                v-if="showModal"
                :title="modalTitle"
                @modal-close="closeModal"
            >
                <sw-text-field
                    v-model="channelForm.apiUrl"
                    label="API URL"
                    placeholder="https://..."
                />
                <sw-text-field
                    v-model="channelForm.apiToken"
                    label="API Token"
                    placeholder="Token"
                />

                <template #modal-footer>
                    <sw-button size="small" @click="closeModal">Schließen</sw-button>
                    <sw-button variant="primary" size="small" :disabled="isSaving" @click="saveChannelConfig">
                        Save & Close
                    </sw-button>
                </template>
            </sw-modal>

            <div v-if="helpText" class="sw-field__help-text">{{ helpText }}</div>
        </div>
    `,inject:["systemConfigApiService","externalOrderService"],mixins:[G.getByName("notification")],props:{element:{type:Object,required:!1,default:null}},data(){return{channelIllustration:U,showModal:!1,selectedChannel:null,isSaving:!1,isRunningCron:!1,cronStatus:{status:null,isSuccess:null,lastExecutionTime:null},channelForm:{apiUrl:"",apiToken:""},channels:[{id:"b2b",label:"First-medical-shop.de",logo:"http://controlling.first-medical.de:8480/assets/images/b2b1.png",urlKey:"externalOrdersApiUrlB2b",tokenKey:"externalOrdersApiTokenB2b"},{id:"ebay_de",label:"Ebay.DE",logo:"http://controlling.first-medical.de:8480/assets/images/ebay1.png",urlKey:"externalOrdersApiUrlEbayDe",tokenKey:"externalOrdersApiTokenEbayDe"},{id:"kaufland",label:"Kaufland",logo:"http://controlling.first-medical.de:8480/assets/images/kaufland1.png",urlKey:"externalOrdersApiUrlKaufland",tokenKey:"externalOrdersApiTokenKaufland"},{id:"ebay_at",label:"Ebay.AT",logo:"http://controlling.first-medical.de:8480/assets/images/ebayAT.png",urlKey:"externalOrdersApiUrlEbayAt",tokenKey:"externalOrdersApiTokenEbayAt"},{id:"zonami",label:"Zonami",logo:"http://controlling.first-medical.de:8480/assets/images/zonami1.png",urlKey:"externalOrdersApiUrlZonami",tokenKey:"externalOrdersApiTokenZonami"},{id:"peg",label:"PEG",logo:"http://controlling.first-medical.de:8480/assets/images/peg2.png",urlKey:"externalOrdersApiUrlPeg",tokenKey:"externalOrdersApiTokenPeg"},{id:"bezb",label:"BEZB",logo:"http://controlling.first-medical.de:8480/assets/images/bezb1.png",urlKey:"externalOrdersApiUrlBezb",tokenKey:"externalOrdersApiTokenBezb"}]}},computed:{modalTitle(){var e;return`Zugangsdaten: ${((e=this.selectedChannel)==null?void 0:e.label)||""}`},label(){var e;return((e=this.element)==null?void 0:e.label)??""},helpText(){var e;return((e=this.element)==null?void 0:e.helpText)??""},cronStatusLabel(){if(!this.cronStatus.lastExecutionTime)return"Noch kein Lauf erkannt";const e=this.formatDate(this.cronStatus.lastExecutionTime);return`${this.cronStatus.isSuccess?"Erfolgreich":"Fehlgeschlagen"} (${e})`}},created(){this.loadCronStatus()},methods:{getConfigKey(e){return`ExternalOrders.config.${e}`},async openChannelModal(e){this.selectedChannel=e;const t=await this.systemConfigApiService.getValues("ExternalOrders.config");this.channelForm.apiUrl=t[this.getConfigKey(e.urlKey)]||"",this.channelForm.apiToken=t[this.getConfigKey(e.tokenKey)]||"",this.showModal=!0},closeModal(){this.showModal=!1,this.selectedChannel=null,this.channelForm.apiUrl="",this.channelForm.apiToken=""},async saveChannelConfig(){if(!(!this.selectedChannel||this.isSaving)){this.isSaving=!0;try{await this.systemConfigApiService.saveValues({[this.getConfigKey(this.selectedChannel.urlKey)]:this.channelForm.apiUrl,[this.getConfigKey(this.selectedChannel.tokenKey)]:this.channelForm.apiToken}),this.createNotificationSuccess({title:"Gespeichert",message:`${this.selectedChannel.label} wurde aktualisiert.`}),this.closeModal()}catch(e){this.createNotificationError({title:"Speichern fehlgeschlagen",message:(e==null?void 0:e.message)||"Die Zugangsdaten konnten nicht gespeichert werden."})}finally{this.isSaving=!1}}},async loadCronStatus(){try{const e=await this.externalOrderService.getSyncStatus();this.cronStatus={status:(e==null?void 0:e.status)||null,isSuccess:(e==null?void 0:e.isSuccess)??null,lastExecutionTime:(e==null?void 0:e.lastExecutionTime)||null}}catch{this.cronStatus={status:null,isSuccess:null,lastExecutionTime:null}}},async runSyncNow(){if(!this.isRunningCron){this.isRunningCron=!0;try{const e=await this.externalOrderService.runSyncNow();this.createNotificationSuccess({title:"Cronjob gestartet",message:e!=null&&e.success?"Der Sync wurde erfolgreich ausgeführt.":"Der Sync wurde ausgeführt."})}catch(e){this.createNotificationError({title:"Cronjob fehlgeschlagen",message:(e==null?void 0:e.message)||"Der Cronjob konnte nicht gestartet werden."})}finally{this.isRunningCron=!1,await this.loadCronStatus()}}},formatDate(e){const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString("de-DE")}}});const q=`<div class="external-orders"> <header class="external-orders__header"> <div class="external-orders__header-content"> <h2>{{ pageTitle }}</h2> <div class="external-orders__summary external-orders__summary--header"> <div class="external-orders__summary-metrics"> <div class="external-orders__summary-item"> <span class="external-orders__summary-label">Bestellungen</span> <span class="external-orders__summary-value">{{ summary.orderCount }}</span> </div> <div class="external-orders__summary-item"> <span class="external-orders__summary-label">Gesamtumsatz</span> <span class="external-orders__summary-value">{{ formatCurrency(summary.totalRevenue) }}</span> </div> <div class="external-orders__summary-item"> <span class="external-orders__summary-label">Stück</span> <span class="external-orders__summary-value">{{ summary.totalItems }}</span> </div> </div> <div class="external-orders__summary-actions"> <button class="external-orders__button external-orders__button--primary" type="button" @click="exportSelectedOrdersPdf" > <sw-icon name="regular-file-text" size="16" class="external-orders__download-icon"></sw-icon> PDF herunterladen ({{ selectedOrders.length > 0 ? selectedOrders.length : filteredOrders.length }}) </button> <button class="external-orders__button external-orders__button--secondary" type="button" @click="exportSelectedOrdersExcel" > <sw-icon name="regular-file" size="16" class="external-orders__download-icon"></sw-icon> Excel herunterladen ({{ selectedOrders.length > 0 ? selectedOrders.length : filteredOrders.length }}) </button> </div> </div> </div> </header> <main id="main" class="sw-page__main-content" tabindex="-1"> <div class="external-orders__page"> <sw-card class="external-orders__channels" style="max-width: none; width: 100%;"> <div class="external-orders__channel-tabs"> <button v-for="channel in channels" :key="channel.id" class="external-orders__channel-tab" :class="{ 'is--active': activeChannel === channel.id }" type="button" @click="activeChannel = channel.id; loadOrders()" > <span class="external-orders__channel-logo"> <img :src="channel.logo" :alt="channel.label" /> </span> <span class="external-orders__channel-label">{{ channel.label }}</span> </button> </div> </sw-card> <sw-card class="external-orders__filters-card" style="max-width: none; width: 100%;"> <div class="external-orders__filters-bar"> <div class="external-orders__filters"> <button class="external-orders__button external-orders__button--primary" type="button" @click="resetFilters" > <sw-icon name="regular-filter" size="16"></sw-icon> Filter löschen </button> <sw-datepicker v-model="dateFilters.start" placeholder="Start Datum" class="external-orders__date" size="small" date-type="date" @change="setDateFilter('start', $event)" /> <sw-datepicker v-model="dateFilters.end" placeholder="End Datum" class="external-orders__date" size="small" date-type="date" @change="setDateFilter('end', $event)" /> <button class="external-orders__button external-orders__button--primary" type="button" @click="applyDateFilter" > Anwenden </button> </div> <div class="external-orders__filters-actions"> <sw-text-field v-model="tableSearchTerm" placeholder="Suche Bestellungen" class="external-orders__search" size="small" type="search"></sw-text-field> <button class="external-orders__button external-orders__button--primary" type="button" :disabled="!hasSelectedOrders" @click="openTestMarkingModal" > Testmarkierung Anwenden </button> </div> </div> <div v-if="paginatedOrders.length > 0" class="external-orders__table-wrapper" > <table class="external-orders__table"> <thead> <tr> <th class="external-orders__cell external-orders__cell--checkbox"> <input type="checkbox" class="external-orders__checkbox" :checked="isAllSelected" @change="toggleSelectAll($event)" /> </th> <th class="external-orders__cell"> <div class="external-orders__column-header"> <button class="external-orders__column-sort" type="button" @click="onSortColumn('orderNumber')" > BestellNr <span class="external-orders__sort-indicator"> {{ getSortIndicator('orderNumber') }} </span> </button> <button class="external-orders__column-filter-button" :class="{ 'is--active': isColumnFilterActive('orderNumber') }" type="button" @click.stop="toggleColumnFilter('orderNumber')" > <sw-icon name="regular-filter" size="16" /> </button> <div v-if="activeColumnFilter === 'orderNumber'" class="external-orders__column-filter-panel" @click.stop > <sw-single-select v-model:value="columnFilterMatchMode" :options="columnFilterMatchOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterMatchMode" /> <sw-single-select v-model:value="columnFilters.orderNumber.operator" :options="columnFilterOperatorOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterOperator('orderNumber', $event)" /> <sw-text-field v-model="columnFilters.orderNumber.value" size="small" class="external-orders__column-filter-field"></sw-text-field> <button class="external-orders__column-filter-add external-orders__button external-orders__button--primary external-orders__button--small" disabled type="button"> + Add Rule </button> <div class="external-orders__column-filter-actions"> <button class="external-orders__button external-orders__button--secondary external-orders__button--small" @click="clearColumnFilter('orderNumber')" type="button"> Clear </button> <button class="external-orders__button external-orders__button--primary external-orders__button--small" @click="applyColumnFilter" type="button"> Apply </button> </div> </div> </div> </th> <th class="external-orders__cell"> <div class="external-orders__column-header"> <button class="external-orders__column-sort" type="button" @click="onSortColumn('customerName')" > Kundenname <span class="external-orders__sort-indicator"> {{ getSortIndicator('customerName') }} </span> </button> <button class="external-orders__column-filter-button" :class="{ 'is--active': isColumnFilterActive('customerName') }" type="button" @click.stop="toggleColumnFilter('customerName')" > <sw-icon name="regular-filter" size="16"></sw-icon> </button> <div v-if="activeColumnFilter === 'customerName'" class="external-orders__column-filter-panel" @click.stop > <sw-single-select v-model:value="columnFilterMatchMode" :options="columnFilterMatchOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterMatchMode" /> <sw-single-select v-model:value="columnFilters.customerName.operator" :options="columnFilterOperatorOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterOperator('customerName', $event)" /> <sw-text-field v-model="columnFilters.customerName.value" size="small" class="external-orders__column-filter-field"></sw-text-field> <button class="external-orders__column-filter-add external-orders__button external-orders__button--primary external-orders__button--small" disabled type="button"> + Add Rule </button> <div class="external-orders__column-filter-actions"> <button class="external-orders__button external-orders__button--secondary external-orders__button--small" @click="clearColumnFilter('customerName')" type="button"> Clear </button> <button class="external-orders__button external-orders__button--primary external-orders__button--small" @click="applyColumnFilter" type="button"> Apply </button> </div> </div> </div> </th> <th class="external-orders__cell"> <div class="external-orders__column-header"> <button class="external-orders__column-sort" type="button" @click="onSortColumn('orderReference')" > AuftragsNr <span class="external-orders__sort-indicator"> {{ getSortIndicator('orderReference') }} </span> </button> <button class="external-orders__column-filter-button" :class="{ 'is--active': isColumnFilterActive('orderReference') }" type="button" @click.stop="toggleColumnFilter('orderReference')" > <sw-icon name="regular-filter" size="16"></sw-icon> </button> <div v-if="activeColumnFilter === 'orderReference'" class="external-orders__column-filter-panel" @click.stop > <sw-single-select v-model:value="columnFilterMatchMode" :options="columnFilterMatchOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterMatchMode" /> <sw-single-select v-model:value="columnFilters.orderReference.operator" :options="columnFilterOperatorOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterOperator('orderReference', $event)" /> <sw-text-field v-model="columnFilters.orderReference.value" size="small" class="external-orders__column-filter-field"></sw-text-field> <button class="external-orders__column-filter-add external-orders__button external-orders__button--primary external-orders__button--small" disabled type="button"> + Add Rule </button> <div class="external-orders__column-filter-actions"> <button class="external-orders__button external-orders__button--secondary external-orders__button--small" @click="clearColumnFilter('orderReference')" type="button"> Clear </button> <button class="external-orders__button external-orders__button--primary external-orders__button--small" @click="applyColumnFilter" type="button"> Apply </button> </div> </div> </div> </th> <th class="external-orders__cell"> <div class="external-orders__column-header"> <button class="external-orders__column-sort" type="button" @click="onSortColumn('email')" > Email <span class="external-orders__sort-indicator"> {{ getSortIndicator('email') }} </span> </button> <button class="external-orders__column-filter-button" :class="{ 'is--active': isColumnFilterActive('email') }" type="button" @click.stop="toggleColumnFilter('email')" > <sw-icon name="regular-filter" size="16" /> </button> <div v-if="activeColumnFilter === 'email'" class="external-orders__column-filter-panel" @click.stop > <sw-single-select v-model:value="columnFilterMatchMode" :options="columnFilterMatchOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterMatchMode" /> <sw-single-select v-model:value="columnFilters.email.operator" :options="columnFilterOperatorOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterOperator('email', $event)" /> <sw-text-field v-model="columnFilters.email.value" size="small" class="external-orders__column-filter-field"></sw-text-field> <button class="external-orders__column-filter-add external-orders__button external-orders__button--primary external-orders__button--small" disabled type="button"> + Add Rule </button> <div class="external-orders__column-filter-actions"> <button class="external-orders__button external-orders__button--secondary external-orders__button--small" @click="clearColumnFilter('email')" type="button"> Clear </button> <button class="external-orders__button external-orders__button--primary external-orders__button--small" @click="applyColumnFilter" type="button"> Apply </button> </div> </div> </div> </th> <th class="external-orders__cell"> <div class="external-orders__column-header"> <button class="external-orders__column-sort" type="button" @click="onSortColumn('date')" > Datum <span class="external-orders__sort-indicator"> {{ getSortIndicator('date') }} </span> </button> <button class="external-orders__column-filter-button" :class="{ 'is--active': isColumnFilterActive('date') }" type="button" @click.stop="toggleColumnFilter('date')" > <sw-icon name="regular-filter" size="16"></sw-icon> </button> <div v-if="activeColumnFilter === 'date'" class="external-orders__column-filter-panel" @click.stop > <sw-single-select v-model:value="columnFilterMatchMode" :options="columnFilterMatchOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterMatchMode" /> <sw-single-select v-model:value="columnFilters.date.operator" :options="columnFilterOperatorOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterOperator('date', $event)" /> <sw-text-field v-model="columnFilters.date.value" size="small" class="external-orders__column-filter-field"></sw-text-field> <button class="external-orders__column-filter-add external-orders__button external-orders__button--primary external-orders__button--small" disabled type="button"> + Add Rule </button> <div class="external-orders__column-filter-actions"> <button class="external-orders__button external-orders__button--secondary external-orders__button--small" @click="clearColumnFilter('date')" type="button"> Clear </button> <button class="external-orders__button external-orders__button--primary external-orders__button--small" @click="applyColumnFilter" type="button"> Apply </button> </div> </div> </div> </th> <th class="external-orders__cell"> <div class="external-orders__column-header"> <button class="external-orders__column-sort" type="button" @click="onSortColumn('statusLabel')" > Bestellstatus <span class="external-orders__sort-indicator"> {{ getSortIndicator('statusLabel') }} </span> </button> <button class="external-orders__column-filter-button" :class="{ 'is--active': isColumnFilterActive('statusLabel') }" type="button" @click.stop="toggleColumnFilter('statusLabel')" > <sw-icon name="regular-filter" size="16"></sw-icon> </button> <div v-if="activeColumnFilter === 'statusLabel'" class="external-orders__column-filter-panel" @click.stop > <sw-single-select v-model:value="columnFilterMatchMode" :options="columnFilterMatchOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterMatchMode" /> <sw-single-select v-model:value="columnFilters.statusLabel.operator" :options="columnFilterOperatorOptions" value-property="value" label-property="label" size="small" class="external-orders__column-filter-field" @change="setColumnFilterOperator('statusLabel', $event)" /> <sw-text-field v-model="columnFilters.statusLabel.value" size="small" class="external-orders__column-filter-field"></sw-text-field> <button class="external-orders__column-filter-add external-orders__button external-orders__button--primary external-orders__button--small" disabled type="button"> + Add Rule </button> <div class="external-orders__column-filter-actions"> <button class="external-orders__button external-orders__button--secondary external-orders__button--small" @click="clearColumnFilter('statusLabel')" type="button"> Clear </button> <button class="external-orders__button external-orders__button--primary external-orders__button--small" @click="applyColumnFilter" type="button"> Apply </button> </div> </div> </div> </th> <th class="external-orders__cell external-orders__cell--actions"> Ansicht </th> </tr> </thead> <tbody> <tr v-for="order in paginatedOrders" :key="getOrderKey(order)"> <td class="external-orders__cell external-orders__cell--checkbox"> <input type="checkbox" class="external-orders__checkbox" :checked="isOrderSelected(order)" @change="toggleOrderSelection(order, $event)" /> </td> <td class="external-orders__cell">{{ order.orderNumber }}</td> <td class="external-orders__cell">{{ order.customerName }}</td> <td class="external-orders__cell">{{ order.orderReference }}</td> <td class="external-orders__cell">{{ order.email }}</td> <td class="external-orders__cell">{{ order.date }}</td> <td class="external-orders__cell"> <span class="external-orders__status-pill" :class="statusClass(order)"> {{ order.statusLabel }} </span> </td> <td class="external-orders__cell external-orders__cell--actions"> <button class="external-orders__action external-orders__button external-orders__button--ghost external-orders__button--small" @click="openDetail(order)" type="button"> <sw-icon name="regular-eye" size="16"></sw-icon> </button> </td> </tr> </tbody> </table> </div> <div v-if="paginatedOrders.length > 0" class="external-orders__pagination" > <div class="external-orders__pagination-controls"> <button type="button" class="external-orders__pagination-nav" :disabled="page <= 1" @click="goToFirstPage" > « </button> <button type="button" class="external-orders__pagination-nav" :disabled="page <= 1" @click="goToPreviousPage" > ‹ </button> <div class="external-orders__pagination-pages"> <button v-for="pageNumber in visiblePages" :key="pageNumber" type="button" class="external-orders__pagination-page" :class="{ 'is--active': pageNumber === page }" @click="goToPage(pageNumber)" > {{ pageNumber }} </button> </div> <button type="button" class="external-orders__pagination-nav" :disabled="page >= totalPages" @click="goToNextPage" > › </button> <button type="button" class="external-orders__pagination-nav" :disabled="page >= totalPages" @click="goToLastPage" > » </button> <label class="external-orders__pagination-limit"> <span>Pro Seite</span> <select :value="String(limit)" @change="onLimitChange($event.target.value)" > <option v-for="option in limitOptions" :key="option" :value="String(option)" > {{ option }} </option> </select> </label> </div> </div> <sw-empty-state v-else icon="regular-shopping-cart" title="Keine Bestellungen gefunden" subline="Es wurden keine Bestellungen für die aktuelle Auswahl geladen."></sw-empty-state> </sw-card> <div v-if="showDetailModal && selectedOrder" class="external-orders__detail-overlay" @click.self="closeDetail" > <div class="external-orders__detail-dialog" role="dialog" aria-modal="true"> <header class="external-orders__detail-header"> <h3>Bestellübersicht für {{ selectedOrder.orderNumber }}</h3> <button class="external-orders__detail-close" type="button" @click="closeDetail">×</button> </header> <div class="external-orders__detail-body"> <div class="external-orders__detail"> <section class="external-orders__detail-card"> <div class="external-orders__detail-card-header"> <h4>Zusätzliche Bestellinformationen</h4> </div> <div class="external-orders__detail-card-body"> <div class="external-orders__detail-grid"> <div class="external-orders__detail-section"> <h4>Kundendetails</h4> <dl> <dt>Kundenname</dt> <dd>{{ selectedOrder.customer.firstName }} {{ selectedOrder.customer.lastName }}</dd> <dt>Kundennummer</dt> <dd>{{ selectedOrder.customer.number }}</dd> <dt>Vorname</dt> <dd>{{ selectedOrder.customer.firstName }}</dd> <dt>Nachname</dt> <dd>{{ selectedOrder.customer.lastName }}</dd> <dt>Kunden-Mail-Adresse</dt> <dd>{{ selectedOrder.customer.email }}</dd> <dt>Kundengruppe</dt> <dd>{{ selectedOrder.customer.group }}</dd> </dl> </div> <div class="external-orders__detail-section"> <h4>Zahlungsdetails</h4> <dl> <dt>Zahlungsmethode</dt> <dd>{{ selectedOrder.payment.method }}</dd> <dt>Zahlungscode</dt> <dd>{{ selectedOrder.payment.code }}</dd> <dt>Fälligkeitsdatum</dt> <dd>{{ selectedOrder.payment.dueDate }}</dd> <dt>Ausstehender Betrag</dt> <dd>{{ selectedOrder.payment.outstanding }}</dd> <dt>Abgerechnet</dt> <dd>{{ selectedOrder.payment.settled }}</dd> <dt>Zusatzinfo</dt> <dd>{{ selectedOrder.payment.extra }}</dd> </dl> </div> <div class="external-orders__detail-section"> <h4>Rechnungsanschrift</h4> <dl> <dt>Straße</dt> <dd>{{ selectedOrder.billingAddress.street }}</dd> <dt>PLZ</dt> <dd>{{ selectedOrder.billingAddress.zip }}</dd> <dt>Stadt</dt> <dd>{{ selectedOrder.billingAddress.city }}</dd> <dt>Land</dt> <dd>{{ selectedOrder.billingAddress.country }}</dd> </dl> </div> <div class="external-orders__detail-section"> <h4>Lieferanschrift</h4> <dl> <dt>Lieferadresse</dt> <dd>{{ selectedOrder.shippingAddress.name }}</dd> <dt>Lieferstraße</dt> <dd>{{ selectedOrder.shippingAddress.street }}</dd> <dt>Postleitzahl/Stadt</dt> <dd>{{ selectedOrder.shippingAddress.zipCity }}</dd> <dt>Land</dt> <dd>{{ selectedOrder.shippingAddress.country }}</dd> </dl> </div> <div class="external-orders__detail-section"> <h4>Weitere Details</h4> <dl> <dt>Bestelldatum</dt> <dd>{{ selectedOrder.additional.orderDate }}</dd> <dt>Status</dt> <dd>{{ selectedOrder.additional.status }}</dd> <dt>Bestelltyp</dt> <dd>{{ selectedOrder.additional.orderType }}</dd> <dt>Notizen</dt> <dd>{{ selectedOrder.additional.notes }}</dd> <dt>Fachberater</dt> <dd>{{ selectedOrder.additional.consultant }}</dd> <dt>Mandant</dt> <dd>{{ selectedOrder.additional.tenant }}</dd> <dt>San6 Auftragsnummer</dt> <dd>{{ selectedOrder.additional.san6OrderNumber }}</dd> </dl> </div> <div class="external-orders__detail-section"> <h4>Erweiterte Bestelldaten</h4> <dl> <dt>Versanddienstleister</dt> <dd>{{ selectedOrder.shipping.carrier }}</dd> <dt>Trackingnummer(n)</dt> <dd>{{ selectedOrder.shipping.trackingNumbers.join(', ') }}</dd> <dt>Einträge in Orgas San6</dt> <dd>{{ selectedOrder.additional.orgaEntries.join(', ') }}</dd> <dt>Dokumente aus Bildarchiv San6</dt> <dd>{{ selectedOrder.additional.documents.join(', ') }}</dd> <dt>PDMS ID + Variante</dt> <dd>{{ selectedOrder.additional.pdmsId }} / {{ selectedOrder.additional.pdmsVariant }}</dd> <dt>TopM Artikelnummer + Ausführung</dt> <dd>{{ selectedOrder.additional.topmArticleNumber }} / {{ selectedOrder.additional.topmExecution }}</dd> <dt>Bestellstatushistorie Gambio/Shopware</dt> <dd>{{ selectedOrder.additional.statusHistorySource }}</dd> </dl> </div> </div> </div> </section> <section class="external-orders__detail-card"> <div class="external-orders__detail-card-header"> <h4>Bestellprodukte</h4> </div> <div class="external-orders__detail-card-body"> <div class="external-orders__detail-table-wrapper"> <table class="external-orders__detail-table"> <thead> <tr> <th>Produktname</th> <th>Menge</th> <th>Nettowert</th> <th>Steuersatz</th> <th>Bruttowert</th> <th>Gesamtwert</th> </tr> </thead> <tbody> <tr v-for="(item, index) in selectedOrder.items" :key="\`detail-item-\${index}\`"> <td>{{ item.name }}</td> <td>{{ item.quantity }}</td> <td>{{ formatCurrency(item.netPrice) }}</td> <td>{{ item.taxRate }}%</td> <td>{{ formatCurrency(item.grossPrice) }}</td> <td>{{ formatCurrency(item.totalPrice) }}</td> </tr> </tbody> </table> </div> </div> </section> <section class="external-orders__detail-card"> <div class="external-orders__detail-card-header"> <h4>Statusverlauf</h4> </div> <div class="external-orders__detail-card-body"> <div class="external-orders__detail-table-wrapper"> <table class="external-orders__detail-table"> <thead> <tr> <th>Status</th> <th>Datum</th> <th>Kommentare</th> </tr> </thead> <tbody> <tr v-for="(entry, index) in selectedOrder.statusHistory" :key="\`detail-status-\${index}\`"> <td> <span class="external-orders__status-pill" :class="statusClassFromLabel(entry.status)"> {{ entry.status }} </span> </td> <td>{{ entry.date }}</td> <td>{{ entry.comment }}</td> </tr> </tbody> </table> </div> </div> </section> <section class="external-orders__detail-card"> <div class="external-orders__detail-card-header"> <h4>Bestellgesamtsummen</h4> </div> <div class="external-orders__detail-card-body"> <div class="external-orders__totals"> <div class="external-orders__totals-row"> <span>Warenwert</span> <span>{{ formatCurrency(selectedOrder.totals.items) }}</span> </div> <div class="external-orders__totals-row"> <span>Versandkosten</span> <span>{{ formatCurrency(selectedOrder.totals.shipping) }}</span> </div> <div class="external-orders__totals-row"> <span>Summe</span> <span>{{ formatCurrency(selectedOrder.totals.sum) }}</span> </div> <div class="external-orders__totals-row"> <span>inkl. MwSt.</span> <span>{{ formatCurrency(selectedOrder.totals.tax) }}</span> </div> <div class="external-orders__totals-row"> <span>Summe netto</span> <span>{{ formatCurrency(selectedOrder.totals.net) }}</span> </div> </div> </div> </section> </div> </div> </div> </div> <div v-if="showTestMarkingModal" class="external-orders__testmarking-overlay" role="dialog" aria-modal="true" > <div class="external-orders__testmarking-dialog"> <header class="external-orders__testmarking-header"> <h3>Bestätigen von Änderungen der Testmarkierung</h3> <button type="button" class="external-orders__testmarking-close" aria-label="Modal schließen" @click="closeTestMarkingModal" > × </button> </header> <div class="external-orders__testmarking-body"> <p class="external-orders__testmarking-intro"> Sie sind dabei, die folgenden Bestellungen als Testbestellungen zu markieren bzw. die Markierung aufzuheben. Bitte überprüfen Sie die Änderungen, bevor Sie sie bestätigen. </p> <div class="external-orders__testmarking-grid"> <div class="external-orders__testmarking-card"> <h4 class="external-orders__testmarking-title is--positive"> Als Test zu markierende Bestellungen </h4> <ul class="external-orders__testmarking-list"> <li v-for="order in testMarkingOrders" :key="getOrderKey(order)" > {{ getOrderDisplayLabel(order) }} </li> <li v-if="testMarkingOrders.length === 0"> Keine Bestellungen ausgewählt. </li> </ul> </div> <div class="external-orders__testmarking-card"> <h4 class="external-orders__testmarking-title is--negative"> Bestellungen, die nicht als Test markieren </h4> <ul class="external-orders__testmarking-list"> <li v-for="order in unmarkedTestOrders" :key="getOrderKey(order)" > {{ getOrderDisplayLabel(order) }} </li> <li v-if="unmarkedTestOrders.length === 0"> Keine Bestellungen ausgewählt. </li> </ul> </div> </div> </div> <footer class="external-orders__testmarking-footer"> <sw-button variant="secondary" @click="closeTestMarkingModal"> Abbrechen </sw-button> <sw-button variant="primary" @click="applyTestMarking"> Bestätige </sw-button> </footer> </div> </div> </div> </main> </div>`,{Component:Y,Mixin:X}=Shopware;function x(e,t){const s=String(e??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r=String(t??"#166b73").replace(/"/g,""),a=`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" role="img" aria-label="${s}">
            <rect x="0" y="0" width="64" height="64" rx="12" fill="${r}" />
            <text
                x="32"
                y="37"
                text-anchor="middle"
                font-family="Arial, Helvetica, sans-serif"
                font-size="20"
                font-weight="700"
                fill="#ffffff"
            >${s}</text>
        </svg>
    `;return`data:image/svg+xml;charset=UTF-8,${encodeURIComponent(a.trim())}`}Y.register("external-orders-list",{template:q,inject:["externalOrderService","systemConfigApiService"],mixins:[X.getByName("notification")],data(){return{isLoading:!1,isSeedingTestData:!1,pageTitle:"Bestellübersichten",orders:[],summary:{orderCount:0,totalRevenue:0,totalItems:0},channelSources:{},channels:[{id:"all",label:"All",logo:x("ALL","#525F7F")},{id:"b2b",label:"First-medical-shop.de",logo:x("B2B","#0B7F8A")},{id:"ebay_de",label:"Ebay.DE",logo:x("EB","#2F4F8F")},{id:"kaufland",label:"KaufLand",logo:x("KL","#D04444")},{id:"ebay_at",label:"Ebay.AT",logo:x("AT","#6B4FD3")},{id:"zonami",label:"Zonami",logo:x("ZO","#21936B")},{id:"peg",label:"PEG",logo:x("PG","#2B6EA0")},{id:"bezb",label:"BEZB",logo:x("BZ","#6A7A1F")}],activeChannel:"all",tableSearchTerm:"",columnFilterMatchMode:"all",columnFilterMatchOptions:[{value:"all",label:"Match All"}],columnFilterOperatorOptions:[{value:"startsWith",label:"Starts with"},{value:"contains",label:"Contains"},{value:"equals",label:"Equals"}],columnFilters:{orderNumber:{value:"",operator:"startsWith"},customerName:{value:"",operator:"startsWith"},orderReference:{value:"",operator:"startsWith"},email:{value:"",operator:"startsWith"},date:{value:"",operator:"startsWith"},statusLabel:{value:"",operator:"startsWith"}},activeColumnFilter:null,selectedOrder:null,selectedOrders:[],showDetailModal:!1,showTestMarkingModal:!1,dateFilters:{start:null,end:null},page:1,limit:10,limitOptions:[10,25,50,100],sortBy:"date",sortDirection:"DESC"}},computed:{columns(){return[{property:"order-number",dataIndex:"orderNumber",sortBy:"orderNumber",label:"BestellNr",sortable:!0,primary:!0,allowResize:!0},{property:"customer-name",dataIndex:"customerName",sortBy:"customerName",label:"Kundenname",sortable:!0,allowResize:!0},{property:"order-reference",dataIndex:"orderReference",sortBy:"orderReference",label:"AuftragsNr",sortable:!0,allowResize:!0},{property:"email",dataIndex:"email",sortBy:"email",label:"Email",sortable:!0,allowResize:!0},{property:"date",dataIndex:"date",sortBy:"date",label:"Datum",sortable:!0,allowResize:!0},{property:"status-label",dataIndex:"statusLabel",sortBy:"statusLabel",label:"Bestellstatus",sortable:!0,allowResize:!0},{property:"actions",label:"Ansicht",sortable:!1,width:"90px"}]},activeChannelLabel(){var e;return((e=this.channels.find(t=>t.id===this.activeChannel))==null?void 0:e.label)||""},activeChannelSource(){return this.channelSources[this.activeChannel]||""},filteredOrders(){const e=this.tableSearchTerm.trim().toLowerCase();this.orders.filter(l=>l.channel?l.channel===this.activeChannel:!0);const t=this.activeChannel==="all"?null:this.activeChannel,s=this.orders.filter(l=>{if(!t)return!0;const i=l.channel??l.channelId??l.salesChannelId??l.salesChannel;return String(i??"").toLowerCase()===t}),r=this.applyColumnFilters(s),a=this.applyDateFilters(r);return e?a.filter(l=>[l.orderNumber,l.customerName,l.orderReference,l.email,l.statusLabel,l.date].some(o=>String(o??"").toLowerCase().includes(e))):a},sortedOrders(){const e=this.sortBy,t=this.sortDirection==="DESC"?-1:1;return[...this.filteredOrders].sort((s,r)=>{const a=this.getSortValue(s,e),l=this.getSortValue(r,e);return a===l?0:a>l?t:-t})},paginatedOrders(){const e=(this.page-1)*this.limit;return this.sortedOrders.slice(e,e+this.limit)},paginationTotal(){return this.sortedOrders.length},totalPages(){return this.limit<=0?1:Math.max(1,Math.ceil(this.paginationTotal/this.limit))},visiblePages(){const t=this.totalPages,s=this.page;if(t<=5)return Array.from({length:t},(i,o)=>o+1);const r=Math.floor(5/2);let a=Math.max(1,s-r),l=a+5-1;return l>t&&(l=t,a=l-5+1),Array.from({length:l-a+1},(i,o)=>a+o)},isAllSelected(){return this.paginatedOrders.length===0?!1:this.paginatedOrders.every(e=>this.isOrderSelected(e))},hasSelectedOrders(){return this.selectedOrders.length>0},testMarkingOrders(){return this.selectedOrders},unmarkedTestOrders(){const e=new Set(this.selectedOrders.map(t=>this.getOrderKey(t)));return this.filteredOrders.filter(t=>!e.has(this.getOrderKey(t)))}},watch:{tableSearchTerm(){this.page=1},activeChannel(){this.page=1},columnFilterMatchMode(){this.page=1},columnFilters:{handler(){this.page=1},deep:!0}},created(){this.initializePage()},methods:{async initializePage(){await this.loadOverviewConfiguration(),await this.loadOrders()},async loadOverviewConfiguration(){var e;try{const t=await this.systemConfigApiService.getValues("ExternalOrders"),s=d=>(t==null?void 0:t[`ExternalOrders.config.${d}`])??"",a=(((e=Shopware.Store.get("session"))==null?void 0:e.currentLocale)??"").toLowerCase().startsWith("de"),l=s("pageNameDe"),i=s("pageNameEn"),o=Number.parseInt(s("defaultColumnsPerPage"),10);this.channelSources={all:"Alle External Orders",b2b:s("externalOrdersApiUrlB2b"),ebay_de:s("externalOrdersApiUrlEbayDe"),kaufland:s("externalOrdersApiUrlKaufland"),ebay_at:s("externalOrdersApiUrlEbayAt"),zonami:s("externalOrdersApiUrlZonami"),peg:s("externalOrdersApiUrlPeg"),bezb:s("externalOrdersApiUrlBezb")},this.pageTitle=(a?l:i)||this.pageTitle,Number.isFinite(o)&&o>0&&(this.limit=o,this.limitOptions.includes(o)||(this.limitOptions=[...this.limitOptions,o].sort((d,c)=>d-c)))}catch(t){this.channelSources={},this.createNotificationWarning({title:"Konfiguration konnte nicht geladen werden",message:(t==null?void 0:t.message)||"Die Quellen der Übersichten konnten nicht geladen werden."})}},async loadOrders(){var e;this.isLoading=!0,this.page=1;try{const t=this.channels.map(r=>r.id).filter(r=>r!=="all");let s=[];if(this.activeChannel==="all"){const a=(await Promise.all(t.map(l=>this.externalOrderService.list({channel:l})))).flatMap(l=>{var o;const i=((o=l==null?void 0:l.data)==null?void 0:o.data)??(l==null?void 0:l.data)??l;return Array.isArray(i==null?void 0:i.orders)?i.orders:[]});s=Array.from(new Map(a.map(l=>[this.getOrderKey(l),l])).values())}else{const r=await this.externalOrderService.list({channel:this.activeChannel}),a=((e=r==null?void 0:r.data)==null?void 0:e.data)??(r==null?void 0:r.data)??r;s=Array.isArray(a==null?void 0:a.orders)?a.orders:[]}this.orders=s,this.page=1,this.summary={orderCount:s.length,totalRevenue:s.reduce((r,a)=>r+(a.totalRevenue||0),0),totalItems:s.reduce((r,a)=>r+(a.totalItems||0),0)}}catch(t){this.orders=[],this.summary={orderCount:0,totalRevenue:0,totalItems:0},this.createNotificationError({title:"Bestellungen konnten nicht geladen werden",message:(t==null?void 0:t.message)||"Bitte prüfen Sie die Verbindung zu den externen APIs."})}finally{this.isLoading=!1}},onPageChange(e){if(typeof e=="number"){this.page=e;return}const{page:t,limit:s}=e??{},r=typeof t=="number"?t:this.page,a=typeof s=="number"?s:this.limit;this.page=r,this.limit=a},goToPreviousPage(){this.page<=1||(this.page-=1)},goToFirstPage(){this.page=1},goToLastPage(){this.page=this.totalPages},goToPage(e){if(typeof e!="number")return;const t=Math.max(1,Math.min(this.totalPages,e));this.page=t},goToNextPage(){this.page>=this.totalPages||(this.page+=1)},onLimitChange(e){const t=Number(this.normalizeSelectValue(e));Number.isNaN(t)||t<=0||(this.limit=t,this.page=1)},onSearch(){this.page=1},applyDateFilter(){this.page=1},setDateFilter(e,t){Object.prototype.hasOwnProperty.call(this.dateFilters,e)&&(this.dateFilters[e]=t)},setColumnFilterMatchMode(e){this.columnFilterMatchMode=this.normalizeSelectValue(e)??"all"},setColumnFilterOperator(e,t){this.columnFilters[e]&&(this.columnFilters[e].operator=this.normalizeSelectValue(t)??"startsWith")},resetFilters(){this.tableSearchTerm="",this.columnFilterMatchMode="all",this.dateFilters={start:null,end:null},Object.keys(this.columnFilters).forEach(e=>{this.columnFilters[e].value="",this.columnFilters[e].operator="startsWith"}),this.page=1},toggleColumnFilter(e){if(this.activeColumnFilter===e){this.activeColumnFilter=null;return}this.activeColumnFilter=e},applyColumnFilter(){this.page=1,this.activeColumnFilter=null},clearColumnFilter(e){this.columnFilters[e]&&(this.columnFilters[e].value="",this.columnFilters[e].operator="startsWith",this.activeColumnFilter=null)},isColumnFilterActive(e){const t=this.columnFilters[e];return!!(t&&String(t.value??"").trim())},applyColumnFilters(e){const t=Object.entries(this.columnFilters).filter(([,s])=>String(s.value??"").trim().length>0);return t.length?e.filter(s=>t.every(([r,a])=>{const l=this.getColumnFilterValue(s,r);return this.matchesColumnFilter(l,a)})):e},getColumnFilterValue(e,t){return(e==null?void 0:e[t])??""},matchesColumnFilter(e,t){const s=String(e??"").toLowerCase(),r=String(t.value??"").toLowerCase(),a=this.normalizeSelectValue(t.operator)??"startsWith";return r?a==="equals"?s===r:a==="contains"?s.includes(r):s.startsWith(r):!0},normalizeSelectValue(e){return e&&typeof e=="object"?e.value??e.id??e.name??"":e},applyDateFilters(e){const t=this.getDateFilterTimestamp(this.dateFilters.start,"start"),s=this.getDateFilterTimestamp(this.dateFilters.end,"end");return!t&&!s?e:e.filter(r=>{const a=this.parseOrderDate(r==null?void 0:r.date);return!(!Number.isFinite(a)||t&&a<t||s&&a>s)})},getDateFilterTimestamp(e,t){if(!e)return null;const s=e instanceof Date?new Date(e.getTime()):new Date(e);return Number.isNaN(s.getTime())?null:(t==="start"?s.setHours(0,0,0,0):s.setHours(23,59,59,999),s.getTime())},normalizeSortValue(e,t=this.sortBy){if(e==null)return"";if(String(t).toLowerCase().includes("date")){const r=this.parseOrderDate(e);return Number.isNaN(r)?String(e):r}if(typeof e=="number")return e;const s=String(e).trim();return/^-?\d+(\.\d+)?$/.test(s)?Number(s):s.toLowerCase()},onSortColumn(e){const t=(e==null?void 0:e.sortBy)??(e==null?void 0:e.dataIndex)??(e==null?void 0:e.property)??e;if(!t)return;const s=(e==null?void 0:e.sortDirection)??(e==null?void 0:e.direction);this.sortBy===t&&!s?this.sortDirection=this.sortDirection==="ASC"?"DESC":"ASC":(this.sortBy=t,this.sortDirection=s??"ASC"),this.page=1},onSelectionChange(e){if(Array.isArray(e)){this.selectedOrders=e;return}if(e&&typeof e=="object"){this.selectedOrders=Object.values(e);return}this.selectedOrders=[]},toggleSelectAll(e){var r;if(!((r=e==null?void 0:e.target)==null?void 0:r.checked)){const a=new Set(this.paginatedOrders.map(l=>this.getOrderKey(l)));this.selectedOrders=this.selectedOrders.filter(l=>!a.has(this.getOrderKey(l)));return}const s=new Map(this.selectedOrders.map(a=>[this.getOrderKey(a),a]));this.paginatedOrders.forEach(a=>{s.set(this.getOrderKey(a),a)}),this.selectedOrders=Array.from(s.values())},toggleOrderSelection(e,t){var a;const s=(a=t==null?void 0:t.target)==null?void 0:a.checked,r=this.getOrderKey(e);if(r){if(s){const l=new Map(this.selectedOrders.map(i=>[this.getOrderKey(i),i]));l.set(r,e),this.selectedOrders=Array.from(l.values());return}this.selectedOrders=this.selectedOrders.filter(l=>this.getOrderKey(l)!==r)}},isOrderSelected(e){const t=this.getOrderKey(e);return this.selectedOrders.some(s=>this.getOrderKey(s)===t)},getSortIndicator(e){return this.sortBy!==e?"↕":this.sortDirection==="ASC"?"↑":"↓"},async openDetail(e){this.isLoading=!0;try{if(this.isFakeOrder(e))this.selectedOrder=this.normalizeOrderDetail(this.buildFakeOrderDetail(e));else{const t=await this.externalOrderService.detail(e.id);this.selectedOrder=this.normalizeOrderDetail(t)}this.showDetailModal=!0}catch(t){this.createNotificationError({title:"Bestelldetails konnten nicht geladen werden",message:(t==null?void 0:t.message)||"Bitte prüfen Sie die Verbindung zu den externen APIs."})}finally{this.isLoading=!1}},closeDetail(){this.showDetailModal=!1,this.selectedOrder=null},normalizeOrderDetail(e){var o,d,c,m,h,p,y,C,O,k,F,u,T,w,g,b,S,v,A;const t=e??{},s=t.billing??{},r=t.delivery??{},a=Array.isArray(t.totals)?{items:Number(((o=t.totals[0])==null?void 0:o.value)??0),shipping:Number(((d=t.totals[1])==null?void 0:d.value)??0),sum:Number(((c=t.totals[2])==null?void 0:c.value)??0),tax:Number(((m=t.totals[3])==null?void 0:m.value)??0),net:Number(((h=t.totals[4])==null?void 0:h.value)??0)}:t.totals??{},l=Array.isArray(t.statusHistory)?t.statusHistory.map(n=>({status:(n==null?void 0:n.status)??(n==null?void 0:n.statusName)??"",date:(n==null?void 0:n.date)??(n==null?void 0:n.dateAdded)??"",comment:(n==null?void 0:n.comment)??(n==null?void 0:n.comments)??""})):[],i=Array.isArray(t.items)?t.items.map(n=>({name:(n==null?void 0:n.name)??(n==null?void 0:n.productName)??"",quantity:Number((n==null?void 0:n.quantity)??0),netPrice:Number((n==null?void 0:n.netPrice)??(n==null?void 0:n.productPrice)??0),taxRate:Number((n==null?void 0:n.taxRate)??19),grossPrice:Number((n==null?void 0:n.grossPrice)??(n==null?void 0:n.finalPrice)??0),totalPrice:Number((n==null?void 0:n.totalPrice)??(n==null?void 0:n.finalPrice)??0)})):[];return{...t,customer:{number:"",firstName:"",lastName:"",email:"",group:"",...t.customer??{},number:((p=t.customer)==null?void 0:p.number)??String(((y=t.customer)==null?void 0:y.id)??""),email:((C=t.customer)==null?void 0:C.email)??((O=t.customer)==null?void 0:O.emailAddress)??"",group:((k=t.customer)==null?void 0:k.group)??((F=t.customer)==null?void 0:F.statusName)??""},payment:{method:t.paymentMethod??"",code:"",dueDate:t.datePurchased??"",outstanding:"",settled:"",extra:"",...t.payment??{}},billingAddress:{street:"",zip:"",city:"",country:"",...t.billingAddress??{},street:((u=t.billingAddress)==null?void 0:u.street)??s.streetAddress??"",zip:((T=t.billingAddress)==null?void 0:T.zip)??s.postcode??"",city:((w=t.billingAddress)==null?void 0:w.city)??s.city??"",country:((g=t.billingAddress)==null?void 0:g.country)??s.country??""},shippingAddress:{name:"",street:"",zipCity:"",country:"",...t.shippingAddress??{},name:((b=t.shippingAddress)==null?void 0:b.name)??r.name??"",street:((S=t.shippingAddress)==null?void 0:S.street)??r.streetAddress??"",zipCity:((v=t.shippingAddress)==null?void 0:v.zipCity)??`${r.postcode??""} ${r.city??""}`.trim(),country:((A=t.shippingAddress)==null?void 0:A.country)??r.country??""},additional:{orderDate:t.datePurchased??"",status:t.orderStatus??"",orderType:"",notes:"",consultant:"",tenant:"",san6OrderNumber:"",orgaEntries:[],documents:[],pdmsId:"",pdmsVariant:"",topmArticleNumber:"",topmExecution:"",statusHistorySource:"",...t.additional??{}},shipping:{carrier:"",trackingNumbers:[],...t.shipping??{}},items:i,statusHistory:l,totals:{items:a.items??0,shipping:a.shipping??0,sum:a.sum??0,tax:a.tax??0,net:a.net??0}}},openTestMarkingModal(){this.hasSelectedOrders&&(this.showTestMarkingModal=!0)},closeTestMarkingModal(){this.showTestMarkingModal=!1},async applyTestMarking(){if(!this.selectedOrders.length){this.showTestMarkingModal=!1;return}const e=this.selectedOrders.map(t=>t==null?void 0:t.id).filter(t=>typeof t=="string"&&t.length>0);if(!e.length){this.showTestMarkingModal=!1;return}this.isLoading=!0;try{const t=await this.externalOrderService.markOrdersAsTest(e),s=new Date().toISOString().slice(0,19).replace("T"," ");this.orders=this.orders.map(r=>e.includes(r==null?void 0:r.id)?{...r,isTestOrder:!0,status:"test",statusLabel:"Test",ordersStatusName:"Test",orderStatusColor:"9e9e9e",date:(r==null?void 0:r.date)||s}:r),this.createNotificationSuccess({title:"Testmarkierung gespeichert",message:`${(t==null?void 0:t.updated)??e.length} Bestellung(en) als Test markiert.`})}catch(t){this.createNotificationError({title:"Testmarkierung fehlgeschlagen",message:(t==null?void 0:t.message)||"Die ausgewählten Bestellungen konnten nicht als Test markiert werden."})}finally{this.showTestMarkingModal=!1,this.selectedOrders=[],this.isLoading=!1}},getOrderKey(e){return(e==null?void 0:e.id)??(e==null?void 0:e.orderNumber)??""},getOrderDisplayLabel(e){const t=e!=null&&e.orderNumber?`#${e.orderNumber}`:"",s=(e==null?void 0:e.customerName)??"";return t&&s?`Order ${t} - ${s}`:t?`Order ${t}`:s||"Order"},formatCurrency(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e)},statusClass(e){return this.statusClassFromLabel(e==null?void 0:e.statusLabel)},statusClassFromLabel(e){const t=String(e??"").trim().toLowerCase();return["bezahlt / in bearbeitung","nicht bezahlt / in bearbeitung"].includes(t)?"external-orders__status-pill--blue":t==="vorkasse: bezahlung offen"?"external-orders__status-pill--yellow":t==="versendet"?"external-orders__status-pill--green":t==="bestellung abgeschlossen"?"external-orders__status-pill--black":t==="stornierung abgeschlossen"?"external-orders__status-pill--gray":""},isFakeOrder(e){const t=(e==null?void 0:e.id)??"";return typeof t=="string"&&t.startsWith("order-")},buildFakeOrderDetail(e){const t=String((e==null?void 0:e.customerName)??"Max Mustermann").split(" "),s=t[0]||"Max",r=t.slice(1).join(" ")||"Mustermann",a=(e==null?void 0:e.orderNumber)??"0000000",l=(e==null?void 0:e.totalItems)??1,i=79.5,o=Number((i/1.19).toFixed(2)),d=19,c=Array.from({length:Math.min(l,6)},(h,p)=>({name:`Medizinisches Produkt ${p+1}`,quantity:1,netPrice:o,taxRate:d,grossPrice:i,totalPrice:i})),m=c.reduce((h,p)=>h+p.totalPrice,0);return{...e,customer:{number:`KND-${a}`,firstName:s,lastName:r,email:(e==null?void 0:e.email)??"kunde@example.com",group:"Standard"},payment:{method:"Kreditkarte",code:`PAY-${a}`,dueDate:(e==null?void 0:e.date)??"2025-12-31",outstanding:this.formatCurrency(0),settled:this.formatCurrency(m),extra:"Transaktion bestätigt"},billingAddress:{street:"Hauptstraße 12",zip:"20354",city:"Hamburg",country:"Deutschland"},shippingAddress:{name:(e==null?void 0:e.customerName)??"Max Mustermann",street:"Hauptstraße 12",zipCity:"20354 Hamburg",country:"Deutschland"},additional:{orderDate:(e==null?void 0:e.date)??"2025-12-30 09:31",status:(e==null?void 0:e.statusLabel)??"Bezahlt / in Bearbeitung",orderType:"Standard",notes:"Testbestellung aus externer Übersicht",consultant:"Lisa Berger",tenant:"FM Shop",san6OrderNumber:`SAN6-${a}`,orgaEntries:["ORG-394","ORG-402"],documents:["Archiv 2025-12","Scan 444"],pdmsId:"PDMS-7742",pdmsVariant:"V2",topmArticleNumber:"TOPM-331",topmExecution:"Standard",statusHistorySource:"System"},shipping:{carrier:"DHL",trackingNumbers:[`00340434${a}`]},items:c,statusHistory:[{status:"Bestellung angelegt",date:(e==null?void 0:e.date)??"2025-12-30 09:31",comment:"Automatisch"},{status:(e==null?void 0:e.statusLabel)??"Bezahlt / in Bearbeitung",date:(e==null?void 0:e.date)??"2025-12-30 10:15",comment:"Zahlung bestätigt"},{status:"Versand vorbereitet",date:"2025-12-31 08:10",comment:"Kommissionierung gestartet"}]}},exportSelectedOrdersPdf(){const e=this.getOrdersForExport();if(!e.length){this.createNotificationWarning({title:"Keine Bestellungen gefunden",message:"Für den aktuellen Filter sind keine Bestellungen verfügbar."});return}const t=this.buildTablePdf(e);this.downloadBlob("external-orders.pdf","application/pdf",t)},exportSelectedOrdersExcel(){const e=this.getOrdersForExport();if(!e.length){this.createNotificationWarning({title:"Keine Bestellungen gefunden",message:"Für den aktuellen Filter sind keine Bestellungen verfügbar."});return}const t=this.buildExportRows(e),s=this.buildCsv(t);this.downloadBlob("external-orders.csv","text/csv;charset=utf-8;",s)},async seedTestData(){if(!this.isSeedingTestData){this.isSeedingTestData=!0;try{const e=await this.externalOrderService.seedTestData(),t=(e==null?void 0:e.inserted)??0;this.createNotificationSuccess({title:"Testdaten gespeichert",message:t>0?`Es wurden ${t} Testbestellungen gespeichert.`:"Keine neuen Testbestellungen wurden gespeichert."}),await this.loadOrders()}catch(e){this.createNotificationError({title:"Testdaten konnten nicht gespeichert werden",message:(e==null?void 0:e.message)||"Bitte prüfen Sie die Konfiguration der externen APIs."})}finally{this.isSeedingTestData=!1}}},getOrdersForExport(){return this.filteredOrders.filter(e=>!this.isTestOrder(e))},isTestOrder(e){const t=String((e==null?void 0:e.statusLabel)??"").trim().toLowerCase(),s=String((e==null?void 0:e.status)??"").trim().toLowerCase();return!!(e!=null&&e.isTestOrder)||t==="test"||s==="test"},buildExportRows(e){const t=["Bestellnummer","Kundenname","Land","Zahlungsmethode","Datum","Bestellstatus","Stück","Summe"],s=e.map(r=>[r.orderNumber??"",r.customerName??"",this.getOrderCountry(r),this.getOrderPaymentMethod(r),this.formatDateForExport(r.date),r.statusLabel??"",this.getOrderItemCount(r),this.formatNumberForExport(this.getOrderTotal(r))]);return[t,...s]},buildExportLines(e){const s=this.buildExportRows(e).map(d=>d.map(c=>String(c??""))),r=s[0].map((d,c)=>{const m=Math.max(...s.map(h=>h[c].length));return Math.min(Math.max(m,6),24)}),a=s.map(d=>d.map((c,m)=>(c.length>r[m]?`${c.slice(0,r[m]-1)}…`:c).padEnd(r[m]))),l=a[0].join(" | "),i=r.map(d=>"-".repeat(d)).join("-|-"),o=a.slice(1).map(d=>d.join(" | "));return[this.buildExportSummaryLine(e),l,i,...o]},buildCsv(e){const s=a=>{const l=String(a??""),i=l.replace(/"/g,'""');return l.includes(";")||l.includes(`
`)||l.includes("\r")||l.includes('"')?`"${i}"`:i};return`\uFEFF${e.map(a=>a.map(s).join(";")).join(`\r
`)}`},buildExportSummaryLine(e){const t=e.reduce((l,i)=>l+this.getOrderItemCount(i),0),s=e.reduce((l,i)=>l+this.getOrderTotal(i),0),r=this.getExportDateRange(e),a=this.formatCurrency(s);return["Shopbestellungen",r?`${r}`:null,`${e.length} Bestellungen`,`${a} Gesamtumsatz`,`${t} Stück`].filter(Boolean).join(" | ")},getExportDateRange(e){const t=e.map(a=>this.parseOrderDate(a.date)).filter(a=>Number.isFinite(a));if(!t.length)return"";const s=new Date(Math.min(...t)),r=new Date(Math.max(...t));return`${this.formatDateForExport(s)} - ${this.formatDateForExport(r)}`},parseOrderDate(e){if(!e)return NaN;const t=String(e).replace(" ","T"),s=Date.parse(t);return Number.isNaN(s)?NaN:s},formatDateForExport(e){if(!e)return"";if(e instanceof Date)return e.toLocaleDateString("de-DE");const t=this.parseOrderDate(e);return Number.isNaN(t)?String(e):new Date(t).toISOString().slice(0,10)},formatNumberForExport(e){const t=typeof e=="number"?e:Number(e);return Number.isFinite(t)?new Intl.NumberFormat("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t):""},getOrderCountry(e){var t,s;return((t=e==null?void 0:e.billingAddress)==null?void 0:t.country)??((s=e==null?void 0:e.shippingAddress)==null?void 0:s.country)??(e==null?void 0:e.country)??""},getOrderPaymentMethod(e){var t;return((t=e==null?void 0:e.payment)==null?void 0:t.method)??(e==null?void 0:e.paymentMethod)??(e==null?void 0:e.payment)??""},getOrderItemCount(e){var t;return(e==null?void 0:e.totalItems)??(e==null?void 0:e.itemsCount)??((t=e==null?void 0:e.items)==null?void 0:t.length)??0},getOrderTotal(e){return(e==null?void 0:e.totalPrice)??(e==null?void 0:e.totalRevenue)??(e==null?void 0:e.amountTotal)??(e==null?void 0:e.priceTotal)??0},buildTablePdf(e){const t=this.buildExportRows(e),s=this.buildExportSummaryLine(e),r=595,a=842,l=30,o=a-40,d=r-l*2,{columnWidths:c,scale:m}=this.getPdfColumnWidths(t,d),h=Math.max(8,Math.floor(10*m)),p=Math.max(14,Math.round(h*1.8)),y=o-p*2,C=c.reduce((n,_)=>n+_,0),O=c.reduce((n,_)=>{const D=n[n.length-1];return n.push(D+_),n},[l]),k=t.length*p,F=y-k,u=[];u.push("BT"),u.push(`/F1 ${h} Tf`),u.push(`1 0 0 1 ${l} ${o} Tm`),u.push(`(${this.escapePdfText(s)}) Tj`),u.push("ET"),u.push("0.5 w"),O.forEach(n=>{u.push(`${n} ${y} m ${n} ${F} l S`)});for(let n=0;n<=t.length;n+=1){const _=y-n*p;u.push(`${l} ${_} m ${l+C} ${_} l S`)}const T=n=>Math.floor((n-6)/(h*.55));t.forEach((n,_)=>{const D=y-(_+1)*p+Math.round(h*.6);n.forEach((P,B)=>{const z=O[B]+3,L=c[B],$=String(P??""),R=this.trimPdfText($,T(L));u.push("BT"),u.push(`/F1 ${h} Tf`),u.push(`1 0 0 1 ${z} ${D} Tm`),u.push(`(${this.escapePdfText(R)}) Tj`),u.push("ET")})});const w=u.join(`
`),g=[];g.push(`1 0 obj
<< /Type /Catalog /Pages 2 0 R >>
endobj
`),g.push(`2 0 obj
<< /Type /Pages /Kids [3 0 R] /Count 1 >>
endobj
`),g.push(`3 0 obj
<< /Type /Page /Parent 2 0 R /MediaBox [0 0 595 842] /Contents 5 0 R /Resources << /Font << /F1 4 0 R >> >> >>
endobj
`),g.push(`4 0 obj
<< /Type /Font /Subtype /Type1 /BaseFont /Helvetica >>
endobj
`),g.push(`5 0 obj
<< /Length ${w.length} >>
stream
${w}
endstream
endobj
`);let b=`%PDF-1.4
`;const S=[],v=new TextEncoder;g.forEach(n=>{S.push(v.encode(b).length),b+=n});const A=v.encode(b).length;return b+=`xref
0 ${g.length+1}
0000000000 65535 f 
`,S.forEach(n=>{b+=`${String(n).padStart(10,"0")} 00000 n 
`}),b+=`trailer
<< /Size ${g.length+1} /Root 1 0 R >>
startxref
${A}
%%EOF`,v.encode(b)},getPdfColumnWidths(e,t){const s=e[0].map((o,d)=>Math.max(...e.map(c=>String(c[d]??"").length))),r=[60,120,55,95,65,110,45,70],a=s.map((o,d)=>Math.max(r[d],o*6)),l=a.reduce((o,d)=>o+d,0),i=l>t?t/l:1;return{columnWidths:a.map(o=>Math.floor(o*i)),scale:i}},trimPdfText(e,t){return t<=0?"":e.length<=t?e:t===1?"…":`${e.slice(0,t-1)}…`},escapePdfText(e){return String(e).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},downloadBlob(e,t,s){const r=s instanceof Uint8Array?new Blob([s],{type:t}):new Blob([s],{type:t}),a=URL.createObjectURL(r),l=document.createElement("a");l.href=a,l.download=e,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a)},getSortValue(e,t){if(!t)return"";const s=e==null?void 0:e[t];return this.normalizeSortValue(s,t)}}});const{Module:Q}=Shopware;Q.register("external-orders",{type:"plugin",name:"external-orders",title:"Bestellübersichten",description:"Zentrale Übersicht für externe Bestellungen",color:"#009ee3",icon:"regular-shopping-cart",routes:{index:{component:"external-orders-list",path:"index",meta:{privilege:"admin"}}},navigation:[{id:"external-orders",label:"Bestellübersichten",color:"#009ee3",path:"external.orders.index",icon:"regular-shopping-cart",parent:"sw-order",position:45}]});
//# sourceMappingURL=external-orders-B3DuF96q.js.map
