<sw-page class="lieferzeiten-channel-settings-list">
    <template #smart-bar-header>
        <h2>{{ $tc('lieferzeiten.lms.dashboard.title') }}</h2>
    </template>

    <template #smart-bar-actions>
        <sw-button v-if="hasEditAccess" :isLoading="isSeedingDemoData" :variant="hasDemoData ? 'danger' : 'default'" @click="onToggleDemoData">{{ hasDemoData ? $tc('lieferzeiten.lms.dashboard.removeDemoData') : $tc('lieferzeiten.lms.dashboard.seedDemoData') }}</sw-button>
        <sw-button-process v-if="hasEditAccess" variant="primary" :isLoading="isSaving" @click="onSave">{{ $tc('global.default.save') }}</sw-button-process>
    </template>

    <template #content>
        <sw-card :isLoading="isLoading" :title="$tc('lieferzeiten.lms.dashboard.cardTitle')">
            <sw-alert variant="info" appearance="default" :showIcon="true">
                {{ $tc('lieferzeiten.lms.dashboard.introText') }}
            </sw-alert>

            <sw-alert v-if="hasValidationErrors" variant="error" appearance="default" :showIcon="true" class="sw-mt-16">
                {{ $tc('lieferzeiten.lms.dashboard.validationError') }}
            </sw-alert>

            <div v-for="group in groupedChannels" :key="group.id" class="sw-mt-24">
                <h3>{{ group.title }}</h3>

                <div v-for="channel in group.channels" :key="channel.id" class="sw-mt-16">
                    <div class="sw-flex sw-flex--align-center sw-flex--justify-space-between">
                        <h4 class="sw-m-0">{{ channel.name || channel.id }}</h4>
                        <sw-label v-if="hasIncompletePdmsMapping(channel.id)" appearance="pill" variant="warning" size="small">
                            {{ $tc('lieferzeiten.lms.dashboard.incompleteMappingBadge') }}
                        </sw-label>
                    </div>

                    <sw-data-grid
                        :dataSource="getChannelPdmsLieferzeiten(channel.id)"
                        :columns="[
                            { property: 'label', label: $tc('lieferzeiten.lms.dashboard.columns.pdmsLieferzeit'), width: '160px' },
                            { property: 'shippingOverdueWorkingDays', label: $tc('lieferzeiten.lms.dashboard.columns.shippingOverdueWorkingDays') },
                            { property: 'deliveryOverdueWorkingDays', label: $tc('lieferzeiten.lms.dashboard.columns.deliveryOverdueWorkingDays') }
                        ]"
                        :showSelection="false"
                        :showActions="false"
                        :allowColumnEdit="false"
                    >
                        <template #column-label="{ item }">
                            {{ item.label }}
                        </template>

                        <template #column-shippingOverdueWorkingDays="{ item }">
                            <sw-number-field
                                numberType="int"
                                :min="0"
                                :disabled="!hasEditAccess"
                                :value="getMatrixValue(channel.id, item.key, 'shippingOverdueWorkingDays')"
                                :error="getFieldError(channel.id, item.key, 'shippingOverdueWorkingDays')"
                                @input="onChangeNumberField(channel.id, item.key, 'shippingOverdueWorkingDays', $event)"
                            />
                        </template>

                        <template #column-deliveryOverdueWorkingDays="{ item }">
                            <sw-number-field
                                numberType="int"
                                :min="0"
                                :disabled="!hasEditAccess"
                                :value="getMatrixValue(channel.id, item.key, 'deliveryOverdueWorkingDays')"
                                :error="getFieldError(channel.id, item.key, 'deliveryOverdueWorkingDays')"
                                @input="onChangeNumberField(channel.id, item.key, 'deliveryOverdueWorkingDays', $event)"
                            />
                        </template>
                    </sw-data-grid>
                </div>
            </div>
        </sw-card>
    </template>
</sw-page>
