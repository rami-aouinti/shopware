<sw-page class="lieferzeiten-channel-settings-list">
    <template #smart-bar-header>
        <h2>{{ $tc('lieferzeiten.lms.dashboard.title') }}</h2>
    </template>

    <template #smart-bar-actions>
        <sw-button v-if="hasEditAccess" :isLoading="isSeedingDemoData" :variant="hasDemoData ? 'danger' : 'default'" @click="onToggleDemoData">{{ hasDemoData ? $tc('lieferzeiten.lms.dashboard.removeDemoData') : $tc('lieferzeiten.lms.dashboard.seedDemoData') }}</sw-button>
        <sw-button-process v-if="hasEditAccess" variant="primary" :isLoading="isSaving" @click="onSave">{{ $tc('global.default.save') }}</sw-button-process>
    </template>

    <template #content>
        <sw-card :isLoading="isLoading" :title="$tc('lieferzeiten.lms.dashboard.cardTitle')">
            <sw-alert variant="info" appearance="default" :showIcon="true">
                {{ $tc('lieferzeiten.lms.dashboard.introText') }}
            </sw-alert>

            <sw-alert v-if="hasValidationErrors" variant="error" appearance="default" :showIcon="true" class="sw-mt-16">
                {{ $tc('lieferzeiten.lms.dashboard.validationError') }}
            </sw-alert>

            <section v-for="group in groupedChannels" :key="group.id" class="sw-mt-24">
                <h3 class="sw-mb-8">{{ group.title }}</h3>

                <div class="sw-flex sw-flex--wrap sw-gap-8 sw-mb-12">
                    <sw-button
                        v-for="channel in group.channels"
                        :key="`${group.id}-${channel.id}`"
                        size="small"
                        :variant="getSelectedChannelId(group.id) === channel.id ? 'primary' : 'ghost'"
                        @click="onSelectChannel(group.id, channel.id)"
                    >
                        {{ channel.name || channel.id }}
                    </sw-button>
                </div>

                <template v-if="getActiveChannel(group)">
                    <div class="sw-flex sw-flex--align-center sw-flex--justify-space-between">
                        <h4 class="sw-m-0">{{ getActiveChannel(group).name || getActiveChannel(group).id }}</h4>
                        <sw-label v-if="hasIncompletePdmsMapping(getActiveChannel(group).id)" appearance="pill" variant="warning" size="small">
                            {{ $tc('lieferzeiten.lms.dashboard.incompleteMappingBadge') }}
                        </sw-label>
                    </div>

                    <sw-alert v-if="hasIncompletePdmsMapping(getActiveChannel(group).id)" variant="warning" appearance="default" :showIcon="true" class="sw-mt-8 sw-mb-8">
                        {{ $t('lieferzeiten.lms.dashboard.incompleteMappingWarning', { channelName: getActiveChannel(group).name || getActiveChannel(group).id }) }}
                    </sw-alert>

                    <sw-data-grid
                        :dataSource="getChannelPdmsLieferzeiten(getActiveChannel(group).id)"
                        :columns="[
                            { property: 'label', label: $tc('lieferzeiten.lms.dashboard.columns.pdmsLieferzeit'), width: '160px' },
                            { property: 'shippingOverdueWorkingDays', label: $tc('lieferzeiten.lms.dashboard.columns.shippingOverdueWorkingDays') },
                            { property: 'deliveryOverdueWorkingDays', label: $tc('lieferzeiten.lms.dashboard.columns.deliveryOverdueWorkingDays') }
                        ]"
                        :showSelection="false"
                        :showActions="false"
                        :allowColumnEdit="false"
                    >
                        <template #column-label="{ item }">
                            {{ item.label }}
                        </template>

                        <template #column-shippingOverdueWorkingDays="{ item }">
                            <sw-number-field
                                numberType="int"
                                :min="0"
                                :disabled="!hasEditAccess"
                                :value="getMatrixValue(getActiveChannel(group).id, item.key, 'shippingOverdueWorkingDays')"
                                :error="getFieldError(getActiveChannel(group).id, item.key, 'shippingOverdueWorkingDays')"
                                @input="onChangeNumberField(getActiveChannel(group).id, item.key, 'shippingOverdueWorkingDays', $event)"
                            />
                        </template>

                        <template #column-deliveryOverdueWorkingDays="{ item }">
                            <sw-number-field
                                numberType="int"
                                :min="0"
                                :disabled="!hasEditAccess"
                                :value="getMatrixValue(getActiveChannel(group).id, item.key, 'deliveryOverdueWorkingDays')"
                                :error="getFieldError(getActiveChannel(group).id, item.key, 'deliveryOverdueWorkingDays')"
                                @input="onChangeNumberField(getActiveChannel(group).id, item.key, 'deliveryOverdueWorkingDays', $event)"
                            />
                        </template>
                    </sw-data-grid>
                </template>
            </section>
        </sw-card>
    </template>
</sw-page>
