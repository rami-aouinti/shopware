<sw-page class="lieferzeiten-channel-settings-list">
    <template #smart-bar-header>
        <h2>{{ $tc('lieferzeiten.lms.channelSettings.title') }}</h2>
    </template>

    <template #smart-bar-actions>
        <sw-button v-if="hasEditAccess" :isLoading="isSeedingDemoData" :variant="hasDemoData ? 'danger' : 'default'" @click="onToggleDemoData">{{ hasDemoData ? 'DemoDaten entfernen' : 'DemoDaten speichern' }}</sw-button>
        <sw-button-process v-if="hasEditAccess" variant="primary" :isLoading="isSaving" @click="onSave">{{ $tc('global.default.save') }}</sw-button-process>
    </template>

    <template #content>
        <sw-card :isLoading="isLoading">
            <sw-alert variant="info" appearance="default" :showIcon="true">
                Configuration par canal et Lieferzeit PDMS : 4 Lieferzeiten × 2 seuils (jours ouvrés).
            </sw-alert>

            <sw-alert v-if="hasValidationErrors" variant="error" appearance="default" :showIcon="true" class="sw-mt-16">
                Veuillez corriger les valeurs invalides. Seules les valeurs entières ≥ 0 sont autorisées.
            </sw-alert>

            <div v-for="channel in channels" :key="channel.id" class="sw-mt-24">
                <h3>{{ channel.name || channel.id }}</h3>

                <sw-data-grid
                    :dataSource="pdmsLieferzeiten"
                    :columns="[
                        { property: 'label', label: 'Lieferzeit PDMS', width: '160px' },
                        { property: 'shippingOverdueWorkingDays', label: 'shippingOverdueWorkingDays' },
                        { property: 'deliveryOverdueWorkingDays', label: 'deliveryOverdueWorkingDays' }
                    ]"
                    :showSelection="false"
                    :showActions="false"
                    :allowColumnEdit="false"
                >
                    <template #column-label="{ item }">
                        {{ item.label }}
                    </template>

                    <template #column-shippingOverdueWorkingDays="{ item }">
                        <sw-number-field
                            numberType="int"
                            :min="0"
                            :disabled="!hasEditAccess"
                            :value="matrixValues[channel.id][item.key].shippingOverdueWorkingDays"
                            :error="getFieldError(channel.id, item.key, 'shippingOverdueWorkingDays')"
                            @input="onChangeNumberField(channel.id, item.key, 'shippingOverdueWorkingDays', $event)"
                        />
                    </template>

                    <template #column-deliveryOverdueWorkingDays="{ item }">
                        <sw-number-field
                            numberType="int"
                            :min="0"
                            :disabled="!hasEditAccess"
                            :value="matrixValues[channel.id][item.key].deliveryOverdueWorkingDays"
                            :error="getFieldError(channel.id, item.key, 'deliveryOverdueWorkingDays')"
                            @input="onChangeNumberField(channel.id, item.key, 'deliveryOverdueWorkingDays', $event)"
                        />
                    </template>
                </sw-data-grid>
            </div>
        </sw-card>
    </template>
</sw-page>
