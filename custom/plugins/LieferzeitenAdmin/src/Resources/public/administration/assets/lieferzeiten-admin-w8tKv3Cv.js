const v=`{% block lieferzeiten_index %} <sw-page class="lieferzeiten-index"> <template #smart-bar-header> <h2> {{ $t('lieferzeiten.general.mainMenuItemGeneral') }} </h2> </template> <template #smart-bar-actions> <lieferzeiten-domain-selection v-model="selectedDomain" /> </template> <template #content> <sw-card-view> <sw-card class="lieferzeiten-index__info" :title="$t('lieferzeiten.general.infoTitle')"> <p>{{ $t('lieferzeiten.general.timezoneInfo') }}</p> <p>{{ $t('lieferzeiten.general.openDefinition') }}</p> </sw-card> <sw-card class="lieferzeiten-index__tabs"> <sw-loader v-if="isLoading" /> <sw-empty-state v-else-if="loadError" :title="$t('lieferzeiten.loading.errorTitle')" :subline="$t('lieferzeiten.loading.errorDescription')" > <template #actions> <sw-button variant="primary" @click="loadOrders"> {{ $t('lieferzeiten.loading.retry') }} </sw-button> </template> </sw-empty-state> <template v-else> <sw-tabs> <sw-tabs-item :to="{ name: 'lieferzeiten.all' }" :title="$t('lieferzeiten.tabs.all')" > {{ $t('lieferzeiten.tabs.all') }} </sw-tabs-item> <sw-tabs-item :to="{ name: 'lieferzeiten.open' }" :title="$t('lieferzeiten.tabs.open')" > {{ $t('lieferzeiten.tabs.open') }} </sw-tabs-item> <sw-tabs-item :to="{ name: 'lieferzeiten.statistics' }" :title="$t('lieferzeiten.tabs.statistics')" > {{ $t('lieferzeiten.tabs.statistics') }} </sw-tabs-item> </sw-tabs> <router-view :orders="filteredOrders" :selected-domain="selectedDomain" :on-reload-order="loadOrders" /> </template> </sw-card> </sw-card-view> </template> </sw-page> {% endblock %}`;Shopware.Component.register("lieferzeiten-index",{template:v,inject:["lieferzeitenOrdersService"],data(){return{selectedDomain:null,orders:[],isLoading:!1,loadError:null}},created(){this.loadOrders()},computed:{filteredOrders(){return this.selectedDomain?this.orders.filter(e=>e.domain===this.selectedDomain):[]}},methods:{async loadOrders(){this.isLoading=!0,this.loadError=null;try{const e=await this.lieferzeitenOrdersService.getOrders();this.orders=Array.isArray(e)?e:[]}catch(e){this.orders=[],this.loadError=e}finally{this.isLoading=!1}}}});const y=`{% block lieferzeiten_all %} <div class="lieferzeiten-all"> <sw-container columns="repeat(auto-fit, minmax(180px, 1fr))" gap="16px"> <sw-card class="lieferzeiten-kpi"> <p class="lieferzeiten-kpi__label">{{ $t('lieferzeiten.kpi.totalOrders') }}</p> <p class="lieferzeiten-kpi__value">{{ orders.length }}</p> </sw-card> <sw-card class="lieferzeiten-kpi"> <p class="lieferzeiten-kpi__label">{{ $t('lieferzeiten.kpi.openOrders') }}</p> <p class="lieferzeiten-kpi__value">{{ openOrders.length }}</p> </sw-card> <sw-card class="lieferzeiten-kpi"> <p class="lieferzeiten-kpi__label">{{ $t('lieferzeiten.kpi.closedOrders') }}</p> <p class="lieferzeiten-kpi__value">{{ closedOrders.length }}</p> </sw-card> <sw-card class="lieferzeiten-kpi"> <p class="lieferzeiten-kpi__label">{{ $t('lieferzeiten.kpi.openParcels') }}</p> <p class="lieferzeiten-kpi__value">{{ openParcelsCount }}</p> </sw-card> </sw-container> <lieferzeiten-order-table :orders="orders" :on-reload-order="onReloadOrder" /> </div> {% endblock %}`;Shopware.Component.register("lieferzeiten-all",{template:y,props:{orders:{type:Array,required:!0,default:()=>[]},selectedDomain:{type:String,required:!1,default:null},onReloadOrder:{type:Function,required:!1,default:null}},computed:{openOrders(){return this.orders.filter(e=>this.isOrderOpen(e))},closedOrders(){return this.orders.filter(e=>!this.isOrderOpen(e))},openParcelsCount(){return this.orders.reduce((e,t)=>{const i=t.parcels.filter(s=>!s.closed).length;return e+i},0)}},methods:{isOrderOpen(e){return e.parcels.some(t=>!t.closed)}}});const b=`{% block lieferzeiten_open %} <div class="lieferzeiten-open"> <sw-container columns="repeat(auto-fit, minmax(180px, 1fr))" gap="16px"> <sw-card class="lieferzeiten-kpi"> <p class="lieferzeiten-kpi__label">{{ $t('lieferzeiten.kpi.openOrders') }}</p> <p class="lieferzeiten-kpi__value">{{ openOrders.length }}</p> </sw-card> <sw-card class="lieferzeiten-kpi"> <p class="lieferzeiten-kpi__label">{{ $t('lieferzeiten.kpi.openParcels') }}</p> <p class="lieferzeiten-kpi__value">{{ openParcelsCount }}</p> </sw-card> <sw-card class="lieferzeiten-kpi"> <p class="lieferzeiten-kpi__label">{{ $t('lieferzeiten.kpi.filteredDomain') }}</p> <p class="lieferzeiten-kpi__value">{{ selectedDomain || '-' }}</p> </sw-card> </sw-container> <lieferzeiten-order-table :orders="orders" :only-open="true" :on-reload-order="onReloadOrder" /> </div> {% endblock %}`;Shopware.Component.register("lieferzeiten-open",{template:b,props:{orders:{type:Array,required:!0,default:()=>[]},selectedDomain:{type:String,required:!1,default:null},onReloadOrder:{type:Function,required:!1,default:null}},computed:{openOrders(){return this.orders.filter(e=>this.isOrderOpen(e))},openParcelsCount(){return this.openOrders.reduce((e,t)=>{const i=t.parcels.filter(s=>!s.closed).length;return e+i},0)}},methods:{isOrderOpen(e){return e.parcels.some(t=>!t.closed)}}});const w=`{% block lieferzeiten_statistics %} <div class="lieferzeiten-statistics"> <sw-container columns="1fr auto auto" gap="16px" class="lieferzeiten-statistics__filters"> <sw-single-select v-model:value="selectedPeriod" :label="$t('lieferzeiten.statistics.periodLabel')" :options="periodOptions" labelProperty="label" valueProperty="value" /> <sw-single-select v-model:value="selectedChannel" :label="$t('lieferzeiten.statistics.channelLabel')" :options="channelOptions" labelProperty="label" valueProperty="value" /> <sw-button variant="primary" @click="exportCsv"> {{ $t('lieferzeiten.statistics.exportCsv') }} </sw-button> </sw-container> <sw-loader v-if="isLoading" /> <sw-empty-state v-else-if="loadError" :title="$t('lieferzeiten.loading.errorTitle')" :description="$t('lieferzeiten.loading.errorDescription')" /> <template v-else> <sw-container columns="repeat(4, 1fr)" gap="16px" class="lieferzeiten-statistics__metrics"> <sw-card :title="$t('lieferzeiten.statistics.open')"> <div class="lieferzeiten-statistics__metric">{{ metrics.open }}</div> </sw-card> <sw-card :title="$t('lieferzeiten.statistics.overdueShipping')"> <div class="lieferzeiten-statistics__metric">{{ metrics.overdueShipping }}</div> </sw-card> <sw-card :title="$t('lieferzeiten.statistics.overdueDelivery')"> <div class="lieferzeiten-statistics__metric">{{ metrics.overdueDelivery }}</div> </sw-card> <sw-card :title="$t('lieferzeiten.statistics.activities')"> <div class="lieferzeiten-statistics__metric">{{ metrics.activities }}</div> </sw-card> </sw-container> <sw-card :title="$t('lieferzeiten.statistics.chartTitle')" class="lieferzeiten-statistics__chart-card"> <div v-if="channelChartData.length" class="lieferzeiten-statistics__chart"> <div v-for="item in channelChartData" :key="item.channel" class="lieferzeiten-statistics__chart-row"> <span>{{ item.channel }}</span> <div class="lieferzeiten-statistics__bar-wrap"> <div class="lieferzeiten-statistics__bar" :style="{ width: getChartBarWidth(item.value) }"></div> </div> <strong>{{ item.value }}</strong> </div> </div> <sw-empty-state v-else :title="$t('lieferzeiten.emptyState.title')" :description="$t('lieferzeiten.emptyState.description')" /> </sw-card> <sw-card :title="$t('lieferzeiten.statistics.tableTitle')"> <sw-data-grid :data-source="filteredOrders" :columns="tableColumns" :show-selection="false" > <template #column-status="{ item }"> <sw-label :appearance="item.status === $t('lieferzeiten.statistics.status.overdue') ? 'error' : 'info'"> {{ item.status }} </sw-label> </template> <template #column-eventAt="{ item }"> {{ formatDate(item.eventAt) }} </template> <template #column-promisedAt="{ item }"> {{ formatDate(item.promisedAt) }} </template> <template #actions="{ item }"> <sw-context-menu-item @click="onDrilldown(item)"> {{ $t('lieferzeiten.statistics.drilldown') }} </sw-context-menu-item> </template> </sw-data-grid> </sw-card> <sw-modal v-if="selectedActivity" :title="$t('lieferzeiten.statistics.drilldownTitle')" @modal-close="closeDrilldown" > <p><strong>{{ $t('lieferzeiten.table.orderNumber') }}:</strong> {{ selectedActivity.orderNumber }}</p> <p><strong>{{ $t('lieferzeiten.table.domain') }}:</strong> {{ selectedActivity.domain }}</p> <p><strong>{{ $t('lieferzeiten.table.status') }}:</strong> {{ selectedActivity.status }}</p> <p><strong>{{ $t('lieferzeiten.statistics.activityDate') }}:</strong> {{ formatDate(selectedActivity.eventAt) }}</p> <p><strong>{{ $t('lieferzeiten.statistics.promisedDate') }}:</strong> {{ formatDate(selectedActivity.promisedAt) }}</p> </sw-modal> </template> </div> {% endblock %}`;Shopware.Component.register("lieferzeiten-statistics",{template:w,inject:["lieferzeitenOrdersService"],props:{selectedDomain:{type:String,required:!1,default:null}},data(){return{periodOptions:[{value:7,label:this.$t("lieferzeiten.statistics.period.7")},{value:30,label:this.$t("lieferzeiten.statistics.period.30")},{value:90,label:this.$t("lieferzeiten.statistics.period.90")}],selectedPeriod:30,selectedChannel:"all",selectedActivity:null,isLoading:!1,loadError:null,statistics:{metrics:{openOrders:0,overdueShipping:0,overdueDelivery:0,activities:0},channels:[],timeline:[],activitiesData:[]},tableColumns:[{property:"orderNumber",label:this.$t("lieferzeiten.table.orderNumber"),primary:!0},{property:"domain",label:this.$t("lieferzeiten.table.domain")},{property:"status",label:this.$t("lieferzeiten.table.status")},{property:"eventAt",label:this.$t("lieferzeiten.statistics.activityDate")},{property:"promisedAt",label:this.$t("lieferzeiten.statistics.promisedDate")}]}},created(){this.loadStatistics()},watch:{selectedPeriod(){this.loadStatistics()},selectedChannel(){this.loadStatistics()},selectedDomain(){this.selectedChannel="all",this.loadStatistics()}},computed:{channelOptions(){return[{value:"all",label:this.$t("lieferzeiten.statistics.allChannels")},...this.statistics.channels.map(e=>({value:e.channel,label:e.channel}))]},metrics(){return{open:this.statistics.metrics.openOrders,overdueShipping:this.statistics.metrics.overdueShipping,overdueDelivery:this.statistics.metrics.overdueDelivery,activities:this.statistics.metrics.activities}},filteredOrders(){return this.statistics.activitiesData.map(e=>({...e,status:e.status==="open"?this.$t("lieferzeiten.status.open"):e.status==="done"?this.$t("lieferzeiten.status.closed"):e.status}))},channelChartData(){return this.statistics.channels},maxChartValue(){return this.channelChartData.length?Math.max(...this.channelChartData.map(e=>e.value)):1}},methods:{async loadStatistics(){this.isLoading=!0,this.loadError=null;try{const e=await this.lieferzeitenOrdersService.getStatistics({period:this.selectedPeriod,domain:this.selectedDomain,channel:this.selectedChannel});this.statistics={metrics:e.metrics??{openOrders:0,overdueShipping:0,overdueDelivery:0,activities:0},channels:Array.isArray(e.channels)?e.channels:[],timeline:Array.isArray(e.timeline)?e.timeline:[],activitiesData:Array.isArray(e.activitiesData)?e.activitiesData:[]}}catch(e){this.statistics={metrics:{openOrders:0,overdueShipping:0,overdueDelivery:0,activities:0},channels:[],timeline:[],activitiesData:[]},this.loadError=e}finally{this.isLoading=!1}},formatDate(e){return e?Shopware.Utils.format.date(e):"—"},getChartBarWidth(e){return`${Math.max(Math.round(e/this.maxChartValue*100),6)}%`},onDrilldown(e){this.selectedActivity=e},closeDrilldown(){this.selectedActivity=null},exportCsv(){const e=[this.$t("lieferzeiten.table.orderNumber"),this.$t("lieferzeiten.table.domain"),this.$t("lieferzeiten.table.status"),this.$t("lieferzeiten.statistics.activityDate"),this.$t("lieferzeiten.statistics.promisedDate")],t=this.filteredOrders.map(n=>[n.orderNumber,n.domain,n.status,this.formatDate(n.eventAt),this.formatDate(n.promisedAt)]),i=[e,...t].map(n=>n.map(r=>`"${String(r).replace(/"/g,'""')}"`).join(";")).join(`
`),s=new Blob([i],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(s),a.download="lieferzeiten-statistiken.csv",a.click(),URL.revokeObjectURL(a.href)}}});const z=`{% block lieferzeiten_domain_selection %} <div class="lieferzeiten-domain-selection"> <sw-single-select v-model="selectedDomain" :options="domains" :placeholder="$t('lieferzeiten.domainSelection.placeholder')" :clearable="false" :disabled="showDomainModal" /> <sw-button size="small" variant="ghost" class="lieferzeiten-domain-selection__reset" @click="resetDomainSelection" > {{ $t('lieferzeiten.domainSelection.reset') }} </sw-button> <sw-modal v-if="showDomainModal" :title="$t('lieferzeiten.domainSelection.modalTitle')" @modal-close="confirmDomainSelection" > <p>{{ $t('lieferzeiten.domainSelection.modalDescription') }}</p> <sw-single-select v-model="selectedDomain" :options="domains" :placeholder="$t('lieferzeiten.domainSelection.placeholder')" :clearable="false" required /> <sw-switch-field v-model="persistSelection" :label="$t('lieferzeiten.domainSelection.persistLabel')" /> <template #modal-footer> <sw-button size="small" variant="primary" :disabled="!selectedDomain" @click="confirmDomainSelection" > {{ $t('lieferzeiten.domainSelection.confirm') }} </sw-button> </template> </sw-modal> </div> {% endblock %}`,l="lieferzeitenManagementDomain";Shopware.Component.register("lieferzeiten-domain-selection",{template:z,props:{value:{type:String,required:!1,default:null}},data(){return{selectedDomain:this.value,persistSelection:!1,showDomainModal:!1,domains:[{value:"First Medical",label:"First Medical"},{value:"E-Commerce",label:"E-Commerce"},{value:"Medical Solutions",label:"Medical Solutions"}]}},created(){this.loadStoredDomain()},watch:{value(e){this.selectedDomain=e},selectedDomain(e){this.$emit("input",e),this.persistDomain(e)},persistSelection(){this.persistDomain(this.selectedDomain)}},methods:{loadStoredDomain(){const e=localStorage.getItem(l);if(e){this.persistSelection=!0,this.selectedDomain=e;return}const t=sessionStorage.getItem(l);if(t){this.persistSelection=!1,this.selectedDomain=t;return}this.showDomainModal=!0},persistDomain(e){e&&(this.persistSelection?(localStorage.setItem(l,e),sessionStorage.removeItem(l)):(sessionStorage.setItem(l,e),localStorage.removeItem(l)))},confirmDomainSelection(){this.selectedDomain&&(this.persistDomain(this.selectedDomain),this.showDomainModal=!1)},resetDomainSelection(){localStorage.removeItem(l),sessionStorage.removeItem(l),this.selectedDomain=null,this.showDomainModal=!0}}});const D=`{% block lieferzeiten_order_table %} <div class="lieferzeiten-order-table"> <table class="sw-data-grid__table"> <thead> <tr> <th colspan="4">{{ $t('lieferzeiten.zones.order') }}</th> <th colspan="5">{{ $t('lieferzeiten.zones.delivery') }}</th> <th colspan="3">{{ $t('lieferzeiten.zones.status') }}</th> </tr> <tr> <th>{{ $t('lieferzeiten.table.orderNumber') }}</th> <th>{{ $t('lieferzeiten.table.domain') }}</th> <th>{{ $t('lieferzeiten.table.positions') }}</th> <th>{{ $t('lieferzeiten.table.parcels') }}</th> <th>{{ $t('lieferzeiten.fields.supplierDate') }}</th> <th>{{ $t('lieferzeiten.fields.supplierWeek') }}</th> <th>{{ $t('lieferzeiten.fields.newDate') }}</th> <th>{{ $t('lieferzeiten.fields.comment') }}</th> <th>{{ $t('lieferzeiten.fields.history') }}</th> <th>{{ $t('lieferzeiten.table.status') }}</th> <th>{{ $t('lieferzeiten.fields.shippingType') }}</th> <th>{{ $t('lieferzeiten.fields.audit') }}</th> </tr> </thead> <tbody> <template v-for="order in displayedOrders"> <tr :key="order.id"> <td> <sw-button size="small" variant="ghost" @click="toggleOrder(order.id)"> {{ isExpanded(order.id) ? '-' : '+' }} </sw-button> {{ order.orderNumber }} </td> <td>{{ order.domain }}</td> <td>{{ order.positions.length }}</td> <td>{{ parcelSummary(order) }}</td> <td> <sw-datepicker v-model:value="order.lieferterminLieferantRange.from" :disabled="!hasEditAccess()" size="small" /> <sw-datepicker v-model:value="order.lieferterminLieferantRange.to" :disabled="!hasEditAccess()" size="small" /> <div>KW Preview: {{ weekLabelFromDate(order.lieferterminLieferantRange.to) }}</div> <sw-button v-if="hasEditAccess()" size="small" variant="primary" :disabled="!canSaveLiefertermin(order)" @click="saveLiefertermin(order)"> {{ $t('global.default.save') }} </sw-button> </td> <td>{{ weekLabelFromDate(order.lieferterminLieferantRange.to) }}</td> <td> <sw-datepicker v-model:value="order.neuerLieferterminRange.from" :disabled="!hasEditAccess() || !order.lieferterminLieferantRange.from" size="small" /> <sw-datepicker v-model:value="order.neuerLieferterminRange.to" :disabled="!hasEditAccess() || !order.lieferterminLieferantRange.to" size="small" /> <div>KW Preview: {{ weekLabelFromDate(order.neuerLieferterminRange.to) }}</div> <sw-button v-if="hasEditAccess()" size="small" variant="primary" :disabled="!canSaveNeuerLiefertermin(order)" @click="saveNeuerLiefertermin(order)"> {{ $t('global.default.save') }} </sw-button> </td> <td> <sw-text-field v-model:value="order.comment" :disabled="!hasEditAccess()" size="small" /> <sw-button v-if="hasEditAccess()" size="small" @click="saveComment(order)"> {{ $t('global.default.save') }} </sw-button> <sw-button v-if="hasEditAccess()" size="small" variant="ghost" @click="requestAdditionalDeliveryDate(order)"> {{ $t('lieferzeiten.additionalRequest.button') }} </sw-button> </td> <td> <ul> <li v-for="entry in order.lieferterminLieferantHistory" :key="entry">{{ entry }}</li> <li v-for="entry in order.neuerLieferterminHistory" :key="entry">{{ entry }}</li> <li v-for="entry in order.commentHistory" :key="entry">{{ entry }}</li> </ul> </td> <td> <sw-label :variant="isOrderOpen(order) ? 'warning' : 'success'"> {{ isOrderOpen(order) ? $t('lieferzeiten.status.open') : $t('lieferzeiten.status.closed') }} </sw-label> </td> <td>{{ shippingLabel(order) }}</td> <td>{{ order.audit || '-' }}</td> </tr> <tr v-if="isExpanded(order.id)" :key="\`\${order.id}-positions\`"> <td colspan="12"> <table class="sw-data-grid__table"> <thead> <tr> <th>{{ $t('lieferzeiten.table.position') }}</th> <th>{{ $t('lieferzeiten.table.article') }}</th> <th>{{ $t('lieferzeiten.table.quantity') }}</th> <th>{{ $t('lieferzeiten.table.packageNumbers') }}</th> </tr> </thead> <tbody> <tr v-for="position in order.positions" :key="position.id"> <td>{{ position.number }}</td> <td>{{ position.label }}</td> <td>{{ position.quantity }}</td> <td> <template v-for="entry in resolveTrackingEntries(order, position)"> <button :key="\`\${position.id}-\${entry.number}\`" type="button" class="lieferzeiten-order-table__tracking-link" @click="openTrackingHistory(entry)" > {{ entry.number }} </button> </template> </td> </tr> </tbody> </table> </td> </tr> </template> </tbody> </table> <div v-if="showTrackingModal" class="lieferzeiten-order-table__tracking-overlay" role="dialog" aria-modal="true" > <div class="lieferzeiten-order-table__tracking-dialog"> <header class="lieferzeiten-order-table__tracking-header"> <h3> Tracking {{ activeTracking && activeTracking.carrier && activeTracking.carrier.toUpperCase() }} / {{ activeTracking && activeTracking.number }} </h3> <button type="button" class="lieferzeiten-order-table__tracking-close" @click="closeTrackingModal">×</button> </header> <div class="lieferzeiten-order-table__tracking-body"> <div v-if="isTrackingLoading">{{ $t('lieferzeiten.tracking.loading') }}</div> <div v-else-if="trackingError" class="lieferzeiten-order-table__tracking-error">{{ trackingError }}</div> <div v-else-if="!trackingEvents.length">{{ $t('lieferzeiten.tracking.empty') }}</div> <ul v-else class="lieferzeiten-order-table__tracking-list"> <li v-for="(event, index) in trackingEvents" :key="\`\${event.timestamp}-\${index}\`"> <strong>{{ event.status }}</strong> <div>{{ event.label }}</div> <small>{{ event.timestamp }}<span v-if="event.location"> · {{ event.location }}</span></small> </li> </ul> </div> </div> </div> <sw-empty-state v-if="displayedOrders.length === 0" :title="$t('lieferzeiten.emptyState.title')" :description="$t('lieferzeiten.emptyState.description')" /> </div> {% endblock %}`;Shopware.Component.register("lieferzeiten-order-table",{template:D,mixins:["notification"],inject:["lieferzeitenTrackingService","lieferzeitenOrdersService"],props:{orders:{type:Array,required:!0,default:()=>[]},onlyOpen:{type:Boolean,required:!1,default:!1},onReloadOrder:{type:Function,required:!1,default:null}},data(){return{expandedOrderIds:[],editableOrders:{},showTrackingModal:!1,isTrackingLoading:!1,trackingError:"",trackingEvents:[],activeTracking:null}},computed:{displayedOrders(){return this.orders.filter(e=>this.onlyOpen?this.isOrderOpen(e):!0).map(e=>this.getEditableOrder(e))}},methods:{hasViewAccess(){return this.acl.can("lieferzeiten.viewer")||this.acl.can("admin")},hasEditAccess(){return this.acl.can("lieferzeiten.editor")||this.acl.can("admin")},isOrderOpen(e){return e.parcels.some(t=>!t.closed)},getEditableOrder(e){if(!this.editableOrders[e.id]){const t=this.resolveInitialRange(e,"lieferterminLieferant",14),i=this.resolveInitialRange(e,"neuerLiefertermin",4);this.$set(this.editableOrders,e.id,{...e,lieferterminLieferantRange:t,neuerLieferterminRange:i,originalLieferterminLieferantRange:{...t},originalNeuerLieferterminRange:{...i},additionalDeliveryRequest:e.additionalDeliveryRequest||null})}return this.notifyInitiatorIfClosed(this.editableOrders[e.id]),this.editableOrders[e.id]},resolveInitialRange(e,t,i){const s=this.normalizeDate(e[`${t}From`]),a=this.normalizeDate(e[`${t}To`]||e[t]);if(s&&a)return{from:s,to:a};const n=Number(e[`${t}Days`]);return Number.isInteger(n)&&n>=1&&n<=i?this.buildRangeFromDayOffset(n):{from:null,to:null}},normalizeDate(e){if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t.toISOString().slice(0,10)},buildRangeFromDayOffset(e){const t=new Date;t.setDate(t.getDate()+1);const i=new Date;return i.setDate(i.getDate()+e),{from:t.toISOString().slice(0,10),to:i.toISOString().slice(0,10)}},toggleOrder(e){if(this.expandedOrderIds.includes(e)){this.expandedOrderIds=this.expandedOrderIds.filter(t=>t!==e);return}this.expandedOrderIds=[...this.expandedOrderIds,e]},isExpanded(e){return this.expandedOrderIds.includes(e)},parcelSummary(e){return`${e.parcels.filter(i=>!i.closed).length}/${e.parcels.length}`},resolveTrackingEntries(e,t){const i=String(t.trackingCarrier||e.trackingCarrier||"").toLowerCase();return(t.packages||[]).map(s=>typeof s=="string"?{number:s,carrier:i}:{number:String((s==null?void 0:s.number)||""),carrier:String((s==null?void 0:s.carrier)||i).toLowerCase()}).filter(s=>s.number!=="")},async openTrackingHistory(e){var t,i;if(!(e!=null&&e.number)||!(e!=null&&e.carrier)){this.trackingError=this.$t("lieferzeiten.tracking.missingCarrier"),this.showTrackingModal=!0;return}this.activeTracking=e,this.showTrackingModal=!0,this.isTrackingLoading=!0,this.trackingError="",this.trackingEvents=[];try{const s=await this.lieferzeitenTrackingService.history(e.carrier,e.number);if((s==null?void 0:s.ok)===!1){this.trackingError=(s==null?void 0:s.message)||this.$t("lieferzeiten.tracking.loadError");return}this.trackingEvents=Array.isArray(s==null?void 0:s.events)?s.events:[]}catch(s){this.trackingError=((i=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:i.message)||(s==null?void 0:s.message)||this.$t("lieferzeiten.tracking.loadError")}finally{this.isTrackingLoading=!1}},closeTrackingModal(){this.showTrackingModal=!1,this.isTrackingLoading=!1,this.trackingError="",this.trackingEvents=[],this.activeTracking=null},shippingLabel(e){return e.versandart==="teil"?`${this.$t("lieferzeiten.shipping.partial")} (${e.partialShipment})`:{unklar:this.$t("lieferzeiten.shipping.unclear"),gesamt:this.$t("lieferzeiten.shipping.complete"),trennung:this.$t("lieferzeiten.shipping.split")}[e.versandart]||this.$t("lieferzeiten.shipping.unclear")},rangeToDays(e){if(!(e!=null&&e.from)||!(e!=null&&e.to))return null;const t=new Date(e.from),i=new Date(e.to);return Number.isNaN(t.getTime())||Number.isNaN(i.getTime())?null:Math.floor((i.getTime()-t.getTime())/864e5)+1},isRangeValid(e,t,i){const s=this.rangeToDays(e);return Number.isInteger(s)&&s>=t&&s<=i},isRangeChanged(e,t){return((e==null?void 0:e.from)||null)!==((t==null?void 0:t.from)||null)||((e==null?void 0:e.to)||null)!==((t==null?void 0:t.to)||null)},canSaveLiefertermin(e){return this.isRangeValid(e.lieferterminLieferantRange,1,14)&&this.isRangeChanged(e.lieferterminLieferantRange,e.originalLieferterminLieferantRange)},canSaveNeuerLiefertermin(e){const t=e.lieferterminLieferantRange,i=e.neuerLieferterminRange;return!this.isRangeValid(t,1,14)||!this.isRangeValid(i,1,4)||!this.isRangeChanged(i,e.originalNeuerLieferterminRange)?!1:i.from>=t.from&&i.to<=t.to},resolveConcurrencyToken(e){return e.updatedAt||e.lastChangedAt||e.currentUpdatedAt||null},applyConflictRefresh(e,t){!t||t.exists===!1||(t.updatedAt&&(e.updatedAt=t.updatedAt),t.lastChangedAt&&(e.lastChangedAt=t.lastChangedAt),Object.prototype.hasOwnProperty.call(t,"comment")&&(e.comment=t.comment||""),t.lieferterminLieferant&&(e.lieferterminLieferantRange={from:t.lieferterminLieferant.from||null,to:t.lieferterminLieferant.to||null},e.originalLieferterminLieferantRange={...e.lieferterminLieferantRange}),t.neuerLiefertermin&&(e.neuerLieferterminRange={from:t.neuerLiefertermin.from||null,to:t.neuerLiefertermin.to||null},e.originalNeuerLieferterminRange={...e.neuerLieferterminRange}))},handleConflictError(e,t){var s;const i=(s=e==null?void 0:e.response)==null?void 0:s.data;return(i==null?void 0:i.code)!=="CONCURRENT_MODIFICATION"?!1:(this.applyConflictRefresh(t,(i==null?void 0:i.refresh)||null),this.createNotificationWarning({title:this.$t("global.default.warning"),message:(i==null?void 0:i.message)||"Conflit d’édition détecté. Ligne rafraîchie, veuillez réappliquer vos modifications."}),!0)},weekLabelFromDate(e){if(!e)return"-";const t=new Date(e);if(Number.isNaN(t.getTime()))return"-";const i=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),s=i.getUTCDay()||7;i.setUTCDate(i.getUTCDate()+4-s);const a=new Date(Date.UTC(i.getUTCFullYear(),0,1));return`KW ${Math.ceil(((i-a)/864e5+1)/7)}`},async saveLiefertermin(e){var i,s;if(!this.hasEditAccess()||!this.canSaveLiefertermin(e))return;const t=this.getTargetPositionId(e);if(!t){this.createNotificationError({title:this.$t("global.default.error"),message:"Missing position id"});return}try{await this.lieferzeitenOrdersService.updateLieferterminLieferant(t,{from:e.lieferterminLieferantRange.from,to:e.lieferterminLieferantRange.to,updatedAt:this.resolveConcurrencyToken(e)}),this.createNotificationSuccess({title:this.$t("global.default.success"),message:this.$t("lieferzeiten.audit.savedSupplierDate")}),await this.reloadOrder(e)}catch(a){if(this.handleConflictError(a,e))return;this.createNotificationError({title:this.$t("global.default.error"),message:((s=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:s.message)||(a==null?void 0:a.message)||this.$t("global.default.error")})}},async saveNeuerLiefertermin(e){var i,s;if(!this.hasEditAccess()||!this.canSaveNeuerLiefertermin(e))return;const t=this.getTargetPositionId(e);if(!t){this.createNotificationError({title:this.$t("global.default.error"),message:"Missing position id"});return}try{await this.lieferzeitenOrdersService.updateNeuerLiefertermin(t,{from:e.neuerLieferterminRange.from,to:e.neuerLieferterminRange.to,updatedAt:this.resolveConcurrencyToken(e)}),this.createNotificationSuccess({title:this.$t("global.default.success"),message:this.$t("lieferzeiten.audit.savedNewDate")}),await this.reloadOrder(e)}catch(a){if(this.handleConflictError(a,e))return;this.createNotificationError({title:this.$t("global.default.error"),message:((s=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:s.message)||(a==null?void 0:a.message)||this.$t("global.default.error")})}},async saveComment(e){var i,s;if(!this.hasEditAccess())return;const t=this.getTargetPositionId(e);if(!t){this.createNotificationError({title:this.$t("global.default.error"),message:"Missing position id"});return}try{await this.lieferzeitenOrdersService.updateComment(t,{comment:e.comment||"",updatedAt:this.resolveConcurrencyToken(e)}),this.createNotificationSuccess({title:this.$t("global.default.success"),message:this.$t("lieferzeiten.audit.savedComment")}),await this.reloadOrder(e)}catch(a){if(this.handleConflictError(a,e))return;this.createNotificationError({title:this.$t("global.default.error"),message:((s=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:s.message)||(a==null?void 0:a.message)||this.$t("global.default.error")})}},async requestAdditionalDeliveryDate(e){var s,a;if(!this.hasEditAccess())return;const t=this.getTargetPositionId(e);if(!t){this.createNotificationError({title:this.$t("global.default.error"),message:"Missing position id"});return}const i=this.$t("lieferzeiten.additionalRequest.defaultInitiator");try{await this.lieferzeitenOrdersService.createAdditionalDeliveryRequest(t,i),this.createNotificationSuccess({title:this.$t("lieferzeiten.additionalRequest.notificationTitle"),message:this.$t("lieferzeiten.additionalRequest.notificationRequested",{initiator:i})}),await this.reloadOrder(e)}catch(n){this.createNotificationError({title:this.$t("global.default.error"),message:((a=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:a.message)||(n==null?void 0:n.message)||this.$t("global.default.error")})}},notifyInitiatorIfClosed(e){const t=e.additionalDeliveryRequest;!t||t.notifiedAt||this.isOrderOpen(e)||(t.notifiedAt=new Date().toISOString(),this.updateAudit(e,this.$t("lieferzeiten.additionalRequest.auditClosed")),this.createNotificationInfo({title:this.$t("lieferzeiten.additionalRequest.notificationTitle"),message:this.$t("lieferzeiten.additionalRequest.notificationClosed",{initiator:t.initiator||this.$t("lieferzeiten.additionalRequest.defaultInitiator")})}))},updateAudit(e,t){e.audit=`${t} • ${new Date().toLocaleString("de-DE")}`},getTargetPositionId(e){var t,i;return((i=(t=e==null?void 0:e.positions)==null?void 0:t[0])==null?void 0:i.id)||null},async reloadOrder(e){if(typeof this.onReloadOrder=="function"){await this.onReloadOrder(e);return}this.updateAudit(e,this.$t("lieferzeiten.audit.savedComment"))}}});const{Module:S}=Shopware;S.register("lieferzeiten",{type:"plugin",name:"lieferzeiten",title:"lieferzeiten.general.mainMenuItemGeneral",description:"lieferzeiten.general.description",color:"#2B8CBF",icon:"regular-clock",privileges:{viewer:{permissions:["lieferzeiten.viewer"],dependencies:[]},editor:{permissions:["lieferzeiten.editor"],dependencies:["lieferzeiten.viewer"]}},routes:{index:{component:"lieferzeiten-index",path:"index",redirect:{name:"lieferzeiten.all"},children:{all:{component:"lieferzeiten-all",path:"all",meta:{parentPath:"lieferzeiten.index",privilege:"lieferzeiten.viewer"}},open:{component:"lieferzeiten-open",path:"open",meta:{parentPath:"lieferzeiten.index",privilege:"lieferzeiten.viewer"}},statistics:{component:"lieferzeiten-statistics",path:"statistics",meta:{parentPath:"lieferzeiten.index",privilege:"lieferzeiten.viewer"}}}}},navigation:[{id:"lieferzeiten",label:"lieferzeiten.general.mainMenuItemGeneral",color:"#2B8CBF",path:"lieferzeiten.index",icon:"regular-clock",parent:"sw-order",position:100,privilege:"lieferzeiten.viewer"}]});const k=`<sw-page class="lieferzeiten-channel-settings-list"> <template #smart-bar-header> <h2>Channel Settings</h2> </template> <template #smart-bar-actions> <sw-button v-if="hasEditAccess" :isLoading="isSeedingDemoData" :variant="hasDemoData ? 'danger' : 'default'" @click="onToggleDemoData">{{ hasDemoData ? 'DemoDaten entfernen' : 'DemoDaten speichern' }}</sw-button> <sw-button v-if="hasEditAccess" variant="primary" @click="onCreate">Create</sw-button> </template> <template #content> <sw-card> <sw-entity-listing v-if="items" :items="items" :repository="repository" :columns="columns" :isLoading="isLoading" :showSelection="false" :allowInlineEdit="hasEditAccess" :allowDelete="hasEditAccess" :total="total" :page="page" :limit="limit" @page-change="onPageChange" @inline-edit-save="onInlineEditSave" @inline-edit-cancel="getList" @delete="onDelete" /> </sw-card> </template> </sw-page>`,{Component:L}=Shopware,{Criteria:h}=Shopware.Data;L.register("lieferzeiten-channel-settings-list",{template:k,mixins:["notification"],inject:["repositoryFactory","lieferzeitenOrdersService"],data(){return{repository:null,items:null,isLoading:!1,total:0,page:1,limit:25,isSeedingDemoData:!1,hasDemoData:!1}},computed:{hasEditAccess(){return this.acl.can("lieferzeiten.editor")||this.acl.can("admin")},columns(){return[{property:"salesChannelId",label:"Sales Channel",inlineEdit:"string",primary:!0},{property:"defaultStatus",label:"Default Status",inlineEdit:"string"},{property:"enableNotifications",label:"Notifications",inlineEdit:"boolean"},{property:"lastChangedBy",label:"Last Changed By",inlineEdit:"string"},{property:"lastChangedAt",label:"Last Changed At",inlineEdit:"date"}]}},created(){this.repository=this.repositoryFactory.create("lieferzeiten_channel_settings"),this.getList(),this.loadDemoDataStatus()},methods:{extractErrorMessage(e){var t,i,s,a,n,r;return((a=(s=(i=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:i.errors)==null?void 0:s[0])==null?void 0:a.detail)||((r=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:r.message)||(e==null?void 0:e.message)||this.$tc("global.default.error")},notifyRequestError(e,t){this.createNotificationError({title:t,message:this.extractErrorMessage(e)})},async loadDemoDataStatus(){try{const e=await this.lieferzeitenOrdersService.getDemoDataStatus();this.hasDemoData=!!(e!=null&&e.hasDemoData)}catch(e){this.notifyRequestError(e,"DemoDaten")}},async onToggleDemoData(){var e,t;if(this.hasEditAccess){this.isSeedingDemoData=!0;try{const i=await this.lieferzeitenOrdersService.toggleDemoData();if(this.hasDemoData=!!(i!=null&&i.hasDemoData),(i==null?void 0:i.action)==="removed"){const n=(i==null?void 0:i.deleted)||{},r=Object.values(n).reduce((c,d)=>c+Number(d||0),0);this.createNotificationSuccess({title:"DemoDaten",message:r>0?`Entfernt (${r} Datensätze).`:"Keine Demo-Daten vorhanden."});return}const s=(i==null?void 0:i.created)||{},a=Object.values(s).reduce((n,r)=>n+Number(r||0),0);this.createNotificationSuccess({title:"DemoDaten",message:`Erfolgreich generiert (${a} Datensätze).`})}catch(i){const s=((t=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:t.message)||(i==null?void 0:i.message)||"DemoDaten konnten nicht verarbeitet werden.";this.createNotificationError({title:"DemoDaten",message:s})}finally{this.isSeedingDemoData=!1}}},async getList(){this.isLoading=!0;const e=new h(this.page,this.limit);e.addSorting(h.sort("createdAt","DESC"));try{const t=await this.repository.search(e,Shopware.Context.api);this.items=t,this.total=t.total}catch(t){this.notifyRequestError(t,"Lieferzeiten Settings")}finally{this.isLoading=!1}},onPageChange({page:e,limit:t}){this.page=e,this.limit=t,this.getList()},async onInlineEditSave(e){if(!this.hasEditAccess)return Promise.resolve();this.isLoading=!0;try{await this.repository.save(e,Shopware.Context.api),await this.getList()}catch(t){this.notifyRequestError(t,"Lieferzeiten Settings")}},async onDelete(e){if(!this.hasEditAccess)return Promise.resolve();this.isLoading=!0;try{await this.repository.delete(e.id,Shopware.Context.api),await this.getList()}catch(t){this.notifyRequestError(t,"Lieferzeiten Settings")}},async onCreate(){if(!this.hasEditAccess)return Promise.resolve();const e=this.repository.create(Shopware.Context.api);e.salesChannelId="",e.enableNotifications=!1;try{await this.repository.save(e,Shopware.Context.api),await this.getList()}catch(t){this.notifyRequestError(t,"Lieferzeiten Settings")}}}});const C='<sw-page class="lieferzeiten-task-assignment-rule-list"> <template #smart-bar-header> <h2>Task Assignment Rules</h2> </template> <template #smart-bar-actions> <sw-button v-if="hasEditAccess" variant="primary" @click="onCreate">Create</sw-button> </template> <template #content> <sw-card> <sw-entity-listing v-if="items" :items="items" :repository="repository" :columns="columns" :isLoading="isLoading" :showSelection="false" :allowInlineEdit="hasEditAccess" :allowDelete="hasEditAccess" :total="total" :page="page" :limit="limit" @page-change="onPageChange" @inline-edit-save="onInlineEditSave" @inline-edit-cancel="getList" @delete="onDelete" /> </sw-card> </template> </sw-page>',{Component:$}=Shopware,{Criteria:m}=Shopware.Data;$.register("lieferzeiten-task-assignment-rule-list",{template:C,mixins:["notification"],inject:["repositoryFactory"],data(){return{repository:null,items:null,isLoading:!1,total:0,page:1,limit:25,triggerOptions:["versand.datum.ueberfaellig","liefertermin.anfrage.zusaetzlich","liefertermin.anfrage.geschlossen"],assigneeTypeOptions:["user","team"]}},computed:{hasEditAccess(){return this.acl.can("lieferzeiten.editor")||this.acl.can("admin")},columns(){return[{property:"name",label:"Name",inlineEdit:"string",primary:!0},{property:"status",label:"Status",inlineEdit:"string"},{property:"triggerKey",label:"Trigger",inlineEdit:"string"},{property:"ruleId",label:"Rule (Rules Engine)",inlineEdit:"string"},{property:"assigneeType",label:"Assignee type",inlineEdit:"string"},{property:"assigneeIdentifier",label:"Assignee",inlineEdit:"string"},{property:"priority",label:"Priority",inlineEdit:"number"},{property:"active",label:"Active",inlineEdit:"boolean"},{property:"lastChangedBy",label:"Last Changed By",inlineEdit:"string"},{property:"lastChangedAt",label:"Last Changed At",inlineEdit:"date"}]}},created(){this.repository=this.repositoryFactory.create("lieferzeiten_task_assignment_rule"),this.getList()},methods:{extractErrorMessage(e){var t,i,s,a,n,r;return((a=(s=(i=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:i.errors)==null?void 0:s[0])==null?void 0:a.detail)||((r=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:r.message)||(e==null?void 0:e.message)||this.$tc("global.default.error")},notifyRequestError(e,t){this.createNotificationError({title:t,message:this.extractErrorMessage(e)})},async getList(){this.isLoading=!0;const e=new m(this.page,this.limit);e.addSorting(m.sort("createdAt","DESC"));try{const t=await this.repository.search(e,Shopware.Context.api);this.items=t,this.total=t.total}catch(t){this.notifyRequestError(t,"Task Assignment Rules")}finally{this.isLoading=!1}},onPageChange({page:e,limit:t}){this.page=e,this.limit=t,this.getList()},async onInlineEditSave(e){if(!this.hasEditAccess)return Promise.resolve();this.isLoading=!0;try{await this.repository.save(e,Shopware.Context.api),await this.getList()}catch(t){this.notifyRequestError(t,"Task Assignment Rules")}},async onDelete(e){if(!this.hasEditAccess)return Promise.resolve();this.isLoading=!0;try{await this.repository.delete(e.id,Shopware.Context.api),await this.getList()}catch(t){this.notifyRequestError(t,"Task Assignment Rules")}},async onCreate(){if(!this.hasEditAccess)return Promise.resolve();const e=this.repository.create(Shopware.Context.api);e.name="New rule",e.triggerKey=this.triggerOptions[0],e.assigneeType=this.assigneeTypeOptions[0],e.active=!1;try{await this.repository.save(e,Shopware.Context.api),await this.getList()}catch(t){this.notifyRequestError(t,"Task Assignment Rules")}}}});const A='<sw-page class="lieferzeiten-notification-toggle-list"> <template #smart-bar-header> <h2>Notification Toggles par trigger/canal</h2> </template> <template #smart-bar-actions> <sw-button v-if="hasEditAccess" variant="primary" @click="onCreate">Create</sw-button> </template> <template #content> <sw-card> <sw-entity-listing v-if="items" :items="items" :repository="repository" :columns="columns" :isLoading="isLoading" :showSelection="false" :allowInlineEdit="hasEditAccess" :allowDelete="hasEditAccess" :total="total" :page="page" :limit="limit" @page-change="onPageChange" @inline-edit-save="onInlineEditSave" @inline-edit-cancel="getList" @delete="onDelete" /> </sw-card> </template> </sw-page>',{Component:E}=Shopware,{Criteria:p}=Shopware.Data;E.register("lieferzeiten-notification-toggle-list",{template:A,mixins:["notification"],inject:["repositoryFactory"],data(){return{repository:null,items:null,isLoading:!1,total:0,page:1,limit:50,triggerOptions:["commande.creee","commande.changement_statut","tracking.mis_a_jour","changements.date_livraison","douane.requise","rappel.vorkasse","versand.datum.ueberfaellig","liefertermin.anfrage.zusaetzlich","liefertermin.anfrage.geschlossen"],channelOptions:["email","sms","webhook"]}},computed:{hasEditAccess(){return this.acl.can("lieferzeiten.editor")||this.acl.can("admin")},columns(){return[{property:"triggerKey",label:"Trigger",inlineEdit:"string",primary:!0},{property:"channel",label:"Canal",inlineEdit:"string"},{property:"salesChannelId",label:"Sales Channel Scope",inlineEdit:"string"},{property:"enabled",label:"Enabled",inlineEdit:"boolean"},{property:"lastChangedBy",label:"Last Changed By",inlineEdit:"string"},{property:"lastChangedAt",label:"Last Changed At",inlineEdit:"date"}]}},created(){this.repository=this.repositoryFactory.create("lieferzeiten_notification_toggle"),this.getList()},methods:{extractErrorMessage(e){var t,i,s,a,n,r;return((a=(s=(i=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:i.errors)==null?void 0:s[0])==null?void 0:a.detail)||((r=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:r.message)||(e==null?void 0:e.message)||this.$tc("global.default.error")},notifyRequestError(e,t){this.createNotificationError({title:t,message:this.extractErrorMessage(e)})},async getList(){this.isLoading=!0;const e=new p(this.page,this.limit);e.addSorting(p.sort("triggerKey","ASC")),e.addSorting(p.sort("channel","ASC"));try{const t=await this.repository.search(e,Shopware.Context.api);this.items=t,this.total=t.total}catch(t){this.notifyRequestError(t,"Lieferzeiten Settings")}finally{this.isLoading=!1}},onPageChange({page:e,limit:t}){this.page=e,this.limit=t,this.getList()},async onInlineEditSave(e){if(!this.hasEditAccess)return Promise.resolve();this.isLoading=!0,e.code=`${e.triggerKey}:${e.channel}`;try{await this.repository.save(e,Shopware.Context.api),await this.getList()}catch(t){this.notifyRequestError(t,"Lieferzeiten Settings")}},async onDelete(e){if(!this.hasEditAccess)return Promise.resolve();this.isLoading=!0;try{await this.repository.delete(e.id,Shopware.Context.api),await this.getList()}catch(t){this.notifyRequestError(t,"Lieferzeiten Settings")}},async onCreate(){if(!this.hasEditAccess)return Promise.resolve();const e=this.repository.create(Shopware.Context.api);e.triggerKey="commande.creee",e.channel="email",e.salesChannelId=null,e.code=`${e.triggerKey}:${e.channel}`,e.enabled=!0;try{await this.repository.save(e,Shopware.Context.api),await this.getList()}catch(t){this.notifyRequestError(t,"Lieferzeiten Settings")}}}});const{Module:O}=Shopware;O.register("lieferzeiten-settings",{type:"plugin",name:"lieferzeiten-settings",title:"Lieferzeiten Settings",description:"Einstellungen für Lieferzeiten",color:"#009ee3",icon:"regular-cog",routes:{channelSettings:{component:"lieferzeiten-channel-settings-list",path:"channel-settings",meta:{privilege:"admin"}},taskAssignmentRules:{component:"lieferzeiten-task-assignment-rule-list",path:"task-assignment-rules",meta:{privilege:"admin"}},notificationToggles:{component:"lieferzeiten-notification-toggle-list",path:"notification-toggles",meta:{privilege:"admin"}}},navigation:[{id:"lieferzeiten-settings",label:"Lieferzeiten Settings",color:"#009ee3",path:"lieferzeiten.settings.channelSettings",icon:"regular-cog",parent:"sw-settings",position:90},{id:"lieferzeiten-settings-channel",label:"Channel Settings",color:"#009ee3",path:"lieferzeiten.settings.channelSettings",parent:"lieferzeiten-settings",position:10},{id:"lieferzeiten-settings-task",label:"Task Assignment Rules",color:"#009ee3",path:"lieferzeiten.settings.taskAssignmentRules",parent:"lieferzeiten-settings",position:20},{id:"lieferzeiten-settings-notifications",label:"Notification Toggles",color:"#009ee3",path:"lieferzeiten.settings.notificationToggles",parent:"lieferzeiten-settings",position:30}]});const T={general:{mainMenuItemGeneral:"Lieferzeiten",description:"Monitoring der Lieferzeiten im Admin",infoTitle:"Hinweis",timezoneInfo:"Zeitberechnungen basieren auf der Zeitzone Europe/Berlin.",openDefinition:"„Offen“ bedeutet mindestens ein noch nicht geschlossenes Paket."},tabs:{all:"Alle Bestellungen",open:"Offene Bestellungen",statistics:"Statistiken"},zones:{order:"Bestellung",delivery:"Lieferung",status:"Status"},domainSelection:{placeholder:"Bitte Bereich wählen",reset:"Auswahl zurücksetzen",modalTitle:"Bereich auswählen",modalDescription:"Wähle einen Bereich aus, um die Lieferzeiten-Ansichten zu laden.",persistLabel:"Auswahl auf diesem Gerät speichern",confirm:"Auswahl übernehmen"},kpi:{totalOrders:"Bestellungen gesamt",openOrders:"Offene Bestellungen",closedOrders:"Abgeschlossene Bestellungen",openParcels:"Offene Pakete",filteredDomain:"Bereich"},table:{orderNumber:"Bestellnummer",domain:"Bereich",parcels:"Pakete offen/gesamt",openParcels:"Offene Pakete",positions:"Positionen",position:"Position",article:"Artikel",quantity:"Menge",packageNumbers:"Pakete",status:"Status"},fields:{supplierDate:"Liefertermin Lieferant (1-14 Tage)",supplierWeek:"KW",newDate:"Neuer Liefertermin (1-4 Tage)",comment:"Kommentar",history:"Historie",shippingType:"Versandart",audit:"Audit",days:"Tage"},shipping:{unclear:"Unklar",complete:"Gesamt",partial:"Teil",split:"Trennung"},audit:{savedSupplierDate:"Liefertermin Lieferant gespeichert",savedNewDate:"Neuer Liefertermin gespeichert",savedComment:"Kommentar gespeichert"},additionalRequest:{button:"Zusätzliche Liefertermin-Anfrage",historyEntry:"Zusätzliche Liefertermin-Anfrage ausgelöst",auditCreated:"Zusätzliche Liefertermin-Anfrage erstellt",auditClosed:"Initiator über Abschluss informiert",notificationTitle:"Liefertermin-Anfrage",notificationRequested:"Anfrage wurde erstellt (Initiator: {initiator}).",notificationClosed:"Bestellung geschlossen – Initiator {initiator} wurde benachrichtigt.",defaultInitiator:"Admin"},status:{open:"Offen",closed:"Abgeschlossen"},emptyState:{title:"Keine offenen Bestellungen",description:"Für den ausgewählten Bereich liegen aktuell keine offenen Bestellungen vor."},tracking:{loading:"Tracking-Historie wird geladen …",empty:"Keine Tracking-Ereignisse gefunden.",loadError:"Tracking konnte nicht geladen werden.",missingCarrier:"Tracking nicht möglich: Kein Versanddienstleister hinterlegt."},statistics:{periodLabel:"Periode",channelLabel:"Kanal",allChannels:"Alle Kanäle",open:"Offen",activities:"Aktivitäten",chartTitle:"Aktivitäten nach Kanal",tableTitle:"Aktivitäten",drilldown:"Drilldown",drilldownTitle:"Aktivitätsdetails",exportCsv:"CSV exportieren",promisedDate:"Lieferdatum",period:{7:"Letzte 7 Tage",30:"Letzte 30 Tage",90:"Letzte 90 Tage"},status:{overdue:"Überfällig"},overdueShipping:"Versand überfällig",overdueDelivery:"Lieferung überfällig",activityDate:"Aktiv am"},loading:{errorTitle:"Bestellungen konnten nicht geladen werden",errorDescription:"Beim Laden der Bestellungen ist ein Fehler aufgetreten.",retry:"Erneut versuchen"}},_={lieferzeiten:T},R={general:{mainMenuItemGeneral:"Delivery times",description:"Delivery time monitoring in admin",infoTitle:"Notice",timezoneInfo:"Time calculations are based on timezone Europe/Berlin.",openDefinition:'"Open" means at least one parcel is still not closed.'},tabs:{all:"All orders",open:"Open orders",statistics:"Statistics"},zones:{order:"Order",delivery:"Delivery",status:"Status"},domainSelection:{placeholder:"Choose domain",reset:"Reset selection",modalTitle:"Choose domain",modalDescription:"Choose a domain to load delivery-time views.",persistLabel:"Persist selection on this device",confirm:"Apply selection"},kpi:{totalOrders:"Total orders",openOrders:"Open orders",closedOrders:"Closed orders",openParcels:"Open parcels",filteredDomain:"Domain"},table:{orderNumber:"Order number",domain:"Domain",parcels:"Open/total parcels",openParcels:"Open parcels",positions:"Positions",position:"Position",article:"Article",quantity:"Quantity",packageNumbers:"Parcels",status:"Status"},fields:{supplierDate:"Supplier delivery date (1-14 days)",supplierWeek:"Week",newDate:"New delivery date (1-4 days)",comment:"Comment",history:"History",shippingType:"Shipping type",audit:"Audit",days:"days"},shipping:{unclear:"Unclear",complete:"Complete",partial:"Partial",split:"Split"},audit:{savedSupplierDate:"Supplier date saved",savedNewDate:"New date saved",savedComment:"Comment saved"},additionalRequest:{button:"Additional delivery date request",historyEntry:"Additional delivery date request triggered",auditCreated:"Additional delivery date request created",auditClosed:"Initiator notified on closure",notificationTitle:"Delivery date request",notificationRequested:"Request created (initiator: {initiator}).",notificationClosed:"Order closed – initiator {initiator} was notified.",defaultInitiator:"Admin"},status:{open:"Open",closed:"Closed"},emptyState:{title:"No open orders",description:"There are currently no open orders for the selected domain."},tracking:{loading:"Loading tracking history …",empty:"No tracking events found.",loadError:"Unable to load tracking history.",missingCarrier:"Tracking unavailable: carrier is missing."},statistics:{periodLabel:"Period",channelLabel:"Channel",allChannels:"All channels",open:"Open",activities:"Activities",chartTitle:"Activities by channel",tableTitle:"Activities",drilldown:"Drilldown",drilldownTitle:"Activity details",exportCsv:"Export CSV",promisedDate:"Delivery date",period:{7:"Last 7 days",30:"Last 30 days",90:"Last 90 days"},status:{overdue:"Overdue"},overdueShipping:"Overdue shipping",overdueDelivery:"Overdue delivery",activityDate:"Activity at"},loading:{errorTitle:"Unable to load orders",errorDescription:"An error occurred while loading orders.",retry:"Retry"}},N={lieferzeiten:R};Shopware.Locale.extend("de-DE",_);Shopware.Locale.extend("en-GB",N);const{ApiService:f}=Shopware.Classes;class x extends f{constructor(t,i,s="lieferzeiten"){super(t,i,s),this.name="lieferzeitenTrackingService"}async history(t,i){const s=await this.httpClient.get(`_action/${this.getApiBasePath()}/tracking/${encodeURIComponent(t)}/${encodeURIComponent(i)}`,{headers:this.getBasicHeaders()}),a=f.handleResponse(s)??(s==null?void 0:s.data);return(a==null?void 0:a.data)??a}}Shopware.Application.addServiceProvider("lieferzeitenTrackingService",e=>{const t=Shopware.Application.getContainer("init"),i=(t==null?void 0:t.httpClient)??e.httpClient,s=e.loginService??Shopware.Service("loginService");return new x(i,s)});const{ApiService:o}=Shopware.Classes;class I extends o{constructor(t,i){super(t,i,"lieferzeiten"),this.name="lieferzeitenOrdersService"}async getOrders(){const t=await this.httpClient.get(`_action/${this.getApiBasePath()}/orders`,{headers:this.getBasicHeaders()}),i=o.handleResponse(t)??(t==null?void 0:t.data);return(i==null?void 0:i.data)??i??[]}async getStatistics(t={}){const i=await this.httpClient.get(`_action/${this.getApiBasePath()}/statistics`,{params:t,headers:this.getBasicHeaders()});return o.handleResponse(i)??(i==null?void 0:i.data)??{}}async getDemoDataStatus(){const t=await this.httpClient.get(`_action/${this.getApiBasePath()}/demo-data/status`,{headers:this.getBasicHeaders()});return o.handleResponse(t)??(t==null?void 0:t.data)??{}}async toggleDemoData(){const t=await this.httpClient.post(`_action/${this.getApiBasePath()}/demo-data/toggle`,{},{headers:this.getBasicHeaders()});return o.handleResponse(t)??(t==null?void 0:t.data)??{}}async seedDemoData(t=!1){const i=await this.httpClient.post(`_action/${this.getApiBasePath()}/demo-data`,{reset:t},{headers:this.getBasicHeaders()});return o.handleResponse(i)??(i==null?void 0:i.data)??{}}async updateLieferterminLieferant(t,i){return this.post(`position/${t}/liefertermin-lieferant`,i)}async updateNeuerLiefertermin(t,i){return this.post(`position/${t}/neuer-liefertermin`,i)}async updateComment(t,i){return this.post(`position/${t}/comment`,i)}async createAdditionalDeliveryRequest(t,i){return this.post(`position/${t}/additional-delivery-request`,{initiator:i})}async post(t,i){const s=await this.httpClient.post(`_action/${this.getApiBasePath()}/${t}`,i,{headers:this.getBasicHeaders()});return o.handleResponse(s)??(s==null?void 0:s.data)}}Shopware.Application.addServiceProvider("lieferzeitenOrdersService",e=>{const t=Shopware.Application.getContainer("init"),i=(t==null?void 0:t.httpClient)??e.httpClient,s=e.loginService??Shopware.Service("loginService");return new I(i,s)});const u="__lieferzeitenStoreApiFallbackInterceptorInstalled",g="/api/_action/store/updates",P="/api/_action/extension/installed";function q(e=""){return e.includes(g)||e.includes(P)}function B(e){const t=(e==null?void 0:e.config)||{};return String(t.url||"").includes(g)?{data:{total:0,updates:[],items:[]},status:200,statusText:"OK",headers:{},config:t}:{data:{data:[],total:0},status:200,statusText:"OK",headers:{},config:t}}function M(){var i;if(window[u])return;const e=Shopware.Application.getContainer("init"),t=e==null?void 0:e.httpClient;(i=t==null?void 0:t.interceptors)!=null&&i.response&&(t.interceptors.response.use(s=>s,s=>{var r,c;const a=(r=s==null?void 0:s.response)==null?void 0:r.status,n=String(((c=s==null?void 0:s.config)==null?void 0:c.url)||"");return a===500&&q(n)?(console.warn("[LieferzeitenAdmin] Store API unavailable, using empty fallback response for:",n),Promise.resolve(B(s))):Promise.reject(s)}),window[u]=!0)}M();const{Component:F,Mixin:K}=Shopware;F.register("lieferzeiten-demo-data-button",{template:`
        <div class="lieferzeiten-demo-data-button">
            <label class="sw-field__label" v-if="label">{{ label }}</label>
            <sw-button
                variant="primary"
                size="small"
                :disabled="isLoading"
                @click="onToggleDemoData"
            >
                {{ buttonLabel }}
            </sw-button>
            <div v-if="helpText" class="sw-field__help-text">
                {{ helpText }}
            </div>
        </div>
    `,inject:["lieferzeitenOrdersService"],mixins:[K.getByName("notification")],props:{element:{type:Object,required:!1,default:null}},data(){return{isLoading:!1,hasDemoData:!1}},computed:{label(){var e;return((e=this.element)==null?void 0:e.label)??""},helpText(){var e;return((e=this.element)==null?void 0:e.helpText)??""},buttonLabel(){return this.hasDemoData?"Demo-Daten entfernen":"Demo-Daten speichern"}},async created(){await this.loadStatus()},methods:{async loadStatus(){this.isLoading=!0;try{const e=await this.lieferzeitenOrdersService.getDemoDataStatus();this.hasDemoData=!!(e!=null&&e.hasDemoData)}catch(e){this.createNotificationError({title:"Demo-Daten Status",message:(e==null?void 0:e.message)||"Status konnte nicht geladen werden."})}finally{this.isLoading=!1}},async onToggleDemoData(){var e,t;if(!this.isLoading){this.isLoading=!0;try{const i=await this.lieferzeitenOrdersService.toggleDemoData();if(this.hasDemoData=!!(i!=null&&i.hasDemoData),(i==null?void 0:i.action)==="removed"){const n=(i==null?void 0:i.deleted)||{},r=Object.values(n).reduce((c,d)=>c+Number(d||0),0);this.createNotificationSuccess({title:"Demo-Daten entfernt",message:r>0?`${r} Demo-Datensätze wurden entfernt.`:"Keine Demo-Daten waren vorhanden."});return}const s=(i==null?void 0:i.created)||{},a=Object.values(s).reduce((n,r)=>n+Number(r||0),0);this.createNotificationSuccess({title:"Demo-Daten gespeichert",message:a>0?`${a} Demo-Datensätze wurden gespeichert.`:"Keine neuen Demo-Datensätze wurden gespeichert."})}catch(i){this.createNotificationError({title:"Demo-Daten",message:((t=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:t.message)||(i==null?void 0:i.message)||"Aktion konnte nicht ausgeführt werden."})}finally{this.isLoading=!1}}}}});
//# sourceMappingURL=lieferzeiten-admin-w8tKv3Cv.js.map
