{"version":3,"file":"lieferzeiten-admin-Bi97KOOt.js","sources":["../../../app/administration/src/module/lieferzeiten/page/lieferzeiten-index/lieferzeiten-index.html.twig","../../../app/administration/src/module/lieferzeiten/utils/domain-source-mapping.js","../../../app/administration/src/module/lieferzeiten/page/lieferzeiten-index/index.js","../../../app/administration/src/module/lieferzeiten/page/lieferzeiten-all/lieferzeiten-all.html.twig","../../../app/administration/src/module/lieferzeiten/page/lieferzeiten-all/index.js","../../../app/administration/src/module/lieferzeiten/page/lieferzeiten-open/lieferzeiten-open.html.twig","../../../app/administration/src/module/lieferzeiten/page/lieferzeiten-open/index.js","../../../app/administration/src/module/lieferzeiten/page/lieferzeiten-statistics/lieferzeiten-statistics.html.twig","../../../app/administration/src/module/lieferzeiten/page/lieferzeiten-statistics/timeline.util.js","../../../app/administration/src/module/lieferzeiten/page/lieferzeiten-statistics/index.js","../../../app/administration/src/module/lieferzeiten/component/lieferzeiten-domain-selection/lieferzeiten-domain-selection.html.twig","../../../app/administration/src/module/lieferzeiten/component/lieferzeiten-domain-selection/index.js","../../../app/administration/src/module/lieferzeiten/component/lieferzeiten-order-table/lieferzeiten-order-table.html.twig","../../../app/administration/src/module/lieferzeiten/component/lieferzeiten-order-table/index.js","../../../app/administration/src/module/lieferzeiten/index.js","../../../app/administration/src/module/lieferzeiten-settings/page/lieferzeiten-channel-settings-list/lieferzeiten-channel-settings-list.html.twig","../../../app/administration/src/module/lieferzeiten/utils/lms-target-channel-mapping.js","../../../app/administration/src/module/lieferzeiten-settings/page/lieferzeiten-channel-settings-list/index.js","../../../app/administration/src/module/lieferzeiten-settings/page/lieferzeiten-task-assignment-rule-list/lieferzeiten-task-assignment-rule-list.html.twig","../../../app/administration/src/module/lieferzeiten-settings/page/lieferzeiten-task-assignment-rule-list/index.js","../../../app/administration/src/module/lieferzeiten-settings/page/lieferzeiten-notification-toggle-list/lieferzeiten-notification-toggle-list.html.twig","../../../app/administration/src/module/lieferzeiten-settings/page/lieferzeiten-notification-toggle-list/index.js","../../../app/administration/src/module/lieferzeiten-settings/index.js","../../../app/administration/src/init/translation.init.js","../../../app/administration/src/core/service/lieferzeiten-tracking.service.js","../../../app/administration/src/core/service/lieferzeiten-orders.service.js","../../../app/administration/src/init/store-api-fallback.init.js","../../../app/administration/src/component/lieferzeiten-demo-data-button/index.js"],"sourcesContent":["{% block lieferzeiten_index %}\r\n    <sw-page class=\"lieferzeiten-index\">\r\n        <template #smart-bar-header>\r\n            <h2>\r\n                {{ $t('lieferzeiten.general.mainMenuItemGeneral') }}\r\n            </h2>\r\n        </template>\r\n\r\n        <template #smart-bar-actions>\r\n            <lieferzeiten-domain-selection v-model=\"selectedDomain\" @bereich-change=\"onBereichChange\" />\r\n            <lieferzeiten-demo-data-button class=\"lieferzeiten-index__demo-data\" />\r\n        </template>\r\n\r\n        <template #content>\r\n            <sw-card-view>\r\n                <sw-card class=\"lieferzeiten-index__info\" :title=\"$t('lieferzeiten.general.infoTitle')\">\r\n                    <p>{{ $t('lieferzeiten.general.timezoneInfo') }}</p>\r\n                    <p>{{ $t('lieferzeiten.general.openDefinition') }}</p>\r\n                    <p>{{ $t('lieferzeiten.general.navigationHint') }}</p>\r\n                </sw-card>\r\n\r\n\r\n                <sw-empty-state\r\n                    v-if=\"!canAccessMainViews\"\r\n                    :title=\"$t('lieferzeiten.domainSelection.accessPendingTitle')\"\r\n                    :subline=\"$t('lieferzeiten.domainSelection.statisticsAccessPendingDescription')\"\r\n                />\r\n\r\n                <template v-else>\r\n                <sw-card class=\"lieferzeiten-index__filters\" :title=\"$t('global.sw-data-grid.filterPanel.title')\">\r\n                    <sw-container columns=\"repeat(auto-fit, minmax(220px, 1fr))\" gap=\"16px\">\r\n                        <sw-text-field v-model:value=\"filters.bestellnummer\" label=\"Bestellnummer\" />\r\n                        <sw-text-field v-model:value=\"filters.san6\" label=\"San6 Auftragsnummer\" />\r\n                        <sw-text-field v-model:value=\"filters.user\" label=\"Username\" />\r\n                        <sw-text-field v-model:value=\"filters.sendenummer\" label=\"Sendenummer\" />\r\n                        <sw-text-field v-model:value=\"filters.status\" label=\"Status\" />\r\n\r\n                        <sw-datepicker v-model:value=\"filters.shippingDateFrom\" label=\"spätester Versandzeitpunkt (von)\" />\r\n                        <sw-datepicker v-model:value=\"filters.shippingDateTo\" label=\"spätester Versandzeitpunkt (bis)\" />\r\n\r\n                        <sw-datepicker v-model:value=\"filters.businessDateFrom\" label=\"Versand-Datum (von)\" />\r\n                        <sw-datepicker v-model:value=\"filters.businessDateTo\" label=\"Versand-Datum (bis)\" />\r\n\r\n                        <sw-datepicker v-model:value=\"filters.deliveryDateFrom\" label=\"spätester Lieferzeitpunkt (von)\" />\r\n                        <sw-datepicker v-model:value=\"filters.deliveryDateTo\" label=\"spätester Lieferzeitpunkt (bis)\" />\r\n\r\n                        <sw-datepicker v-model:value=\"filters.businessDateEndFrom\" label=\"Liefer-Datum (von)\" />\r\n                        <sw-datepicker v-model:value=\"filters.businessDateEndTo\" label=\"Liefer-Datum (bis)\" />\r\n\r\n                        <sw-datepicker v-model:value=\"filters.lieferterminLieferantFrom\" label=\"Liefertermin Lieferant (von)\" />\r\n                        <sw-datepicker v-model:value=\"filters.lieferterminLieferantTo\" label=\"Liefertermin Lieferant (bis)\" />\r\n\r\n                        <sw-datepicker v-model:value=\"filters.neuerLieferterminFrom\" label=\"Liefertermin Auftragsbearbeitung (von)\" />\r\n                        <sw-datepicker v-model:value=\"filters.neuerLieferterminTo\" label=\"Liefertermin Auftragsbearbeitung (bis)\" />\r\n                    </sw-container>\r\n\r\n                    <div class=\"lieferzeiten-index__filter-actions\">\r\n                        <sw-button variant=\"primary\" @click=\"applyFilters\">Filtern</sw-button>\r\n                        <sw-button variant=\"ghost\" @click=\"resetFilters\">Zurücksetzen</sw-button>\r\n                    </div>\r\n                </sw-card>\r\n\r\n                <sw-card class=\"lieferzeiten-index__tabs\">\r\n                    <sw-loader v-if=\"isLoading\" />\r\n\r\n                    <sw-empty-state\r\n                        v-else-if=\"loadError\"\r\n                        :title=\"$t('lieferzeiten.loading.errorTitle')\"\r\n                        :subline=\"$t('lieferzeiten.loading.errorDescription')\"\r\n                    >\r\n                        <template #actions>\r\n                            <sw-button variant=\"primary\" @click=\"reloadData\">\r\n                                {{ $t('lieferzeiten.loading.retry') }}\r\n                            </sw-button>\r\n                        </template>\r\n                    </sw-empty-state>\r\n\r\n                    <template v-else>\r\n                        <sw-tabs>\r\n                            <sw-tabs-item\r\n                                :to=\"{ name: 'lieferzeiten.index.all' }\"\r\n                                :title=\"$t('lieferzeiten.tabs.all')\"\r\n                            >\r\n                                {{ $t('lieferzeiten.tabs.all') }}\r\n                            </sw-tabs-item>\r\n                            <sw-tabs-item\r\n                                :to=\"{ name: 'lieferzeiten.index.open' }\"\r\n                                :title=\"$t('lieferzeiten.tabs.open')\"\r\n                            >\r\n                                {{ $t('lieferzeiten.tabs.open') }}\r\n                            </sw-tabs-item>\r\n\r\n                            <sw-tabs-item\r\n                                :to=\"{ name: 'lieferzeiten.index.statistics' }\"\r\n                                :title=\"$t('lieferzeiten.tabs.statistics')\"\r\n                            >\r\n                                {{ $t('lieferzeiten.tabs.statistics') }}\r\n                            </sw-tabs-item>\r\n                        </sw-tabs>\r\n\r\n                        <router-view\r\n                            :orders=\"filteredOrders\"\r\n                            :selected-domain=\"selectedDomain\"\r\n                            :on-reload-order=\"loadOrders\"\r\n                            :statistics-metrics=\"statisticsMetrics\"\r\n                        />\r\n                    </template>\r\n                </sw-card>\r\n                </template>\r\n            </sw-card-view>\r\n        </template>\r\n    </sw-page>\r\n{% endblock %}\r\n","export const DOMAIN_GROUPS = [\r\n    {\r\n        id: 'first-medical-e-commerce',\r\n        labelSnippet: 'lieferzeiten.domainSelection.groups.firstMedicalECommerce',\r\n        channels: [\r\n            {\r\n                value: 'first-medical-shop.de',\r\n                labelSnippet: 'lieferzeiten.domainSelection.channels.firstMedicalShop',\r\n            },\r\n            {\r\n                value: 'ebay.de',\r\n                labelSnippet: 'lieferzeiten.domainSelection.channels.ebayDe',\r\n            },\r\n            {\r\n                value: 'ebay.at',\r\n                labelSnippet: 'lieferzeiten.domainSelection.channels.ebayAt',\r\n            },\r\n            {\r\n                value: 'kaufland',\r\n                labelSnippet: 'lieferzeiten.domainSelection.channels.kaufland',\r\n            },\r\n            {\r\n                value: 'peg',\r\n                labelSnippet: 'lieferzeiten.domainSelection.channels.peg',\r\n            },\r\n            {\r\n                value: 'zonami',\r\n                labelSnippet: 'lieferzeiten.domainSelection.channels.zonami',\r\n            },\r\n        ],\r\n    },\r\n    {\r\n        id: 'medical-solutions',\r\n        labelSnippet: 'lieferzeiten.domainSelection.groups.medicalSolutions',\r\n        channels: [\r\n            {\r\n                value: 'medical-solutions-germany.de',\r\n                labelSnippet: 'lieferzeiten.domainSelection.channels.medicalSolutionsGermany',\r\n            },\r\n        ],\r\n    },\r\n];\r\n\r\nexport const DEFAULT_DOMAIN_KEY = 'first-medical-shop.de';\r\nexport const DEFAULT_GROUP_ID = 'first-medical-e-commerce';\r\n\r\nconst DOMAIN_SOURCE_MAPPING = {\r\n    'first-medical-shop.de': ['first-medical-shop.de', 'first medical', 'e-commerce', 'shopware', 'gambio', 'first-medical-e-commerce'],\r\n    'ebay.de': ['ebay.de', 'ebay de'],\r\n    'ebay.at': ['ebay.at', 'ebay at'],\r\n    kaufland: ['kaufland'],\r\n    peg: ['peg'],\r\n    zonami: ['zonami'],\r\n    'medical-solutions-germany.de': ['medical-solutions-germany.de', 'medical solutions', 'medical-solutions', 'medical_solutions'],\r\n};\r\n\r\nconst LEGACY_DOMAIN_KEY_MAPPING = {\r\n    'first medical': DEFAULT_DOMAIN_KEY,\r\n    'e-commerce': DEFAULT_DOMAIN_KEY,\r\n    'first medical - e-commerce': DEFAULT_DOMAIN_KEY,\r\n    'first-medical-e-commerce': DEFAULT_DOMAIN_KEY,\r\n    'medical solutions': 'medical-solutions-germany.de',\r\n    'medical-solutions': 'medical-solutions-germany.de',\r\n};\r\n\r\nconst LEGACY_GROUP_KEY_MAPPING = {\r\n    'first medical': DEFAULT_GROUP_ID,\r\n    'e-commerce': DEFAULT_GROUP_ID,\r\n    'first medical - e-commerce': DEFAULT_GROUP_ID,\r\n    'first-medical-e-commerce': DEFAULT_GROUP_ID,\r\n    'medical solutions': 'medical-solutions',\r\n    'medical-solutions': 'medical-solutions',\r\n};\r\n\r\nexport function getChannelsForGroup(groupId) {\r\n    return DOMAIN_GROUPS.find((group) => group.id === groupId)?.channels || [];\r\n}\r\n\r\nexport function getDefaultDomainForGroup(groupId) {\r\n    return getChannelsForGroup(groupId)[0]?.value || null;\r\n}\r\n\r\nexport function normalizeGroupKey(groupId) {\r\n    const normalized = String(groupId || '').trim().toLowerCase();\r\n    if (!normalized) {\r\n        return null;\r\n    }\r\n\r\n    if (LEGACY_GROUP_KEY_MAPPING[normalized]) {\r\n        return LEGACY_GROUP_KEY_MAPPING[normalized];\r\n    }\r\n\r\n    return DOMAIN_GROUPS.some((group) => group.id === normalized) ? normalized : null;\r\n}\r\n\r\nexport function resolveGroupKeyForDomain(domain) {\r\n    const normalizedDomain = normalizeDomainKey(domain);\r\n    if (!normalizedDomain) {\r\n        return null;\r\n    }\r\n\r\n    return DOMAIN_GROUPS.find((group) => group.channels.some((channel) => channel.value === normalizedDomain))?.id || null;\r\n}\r\n\r\nexport function normalizeDomainKey(domain) {\r\n    const normalized = String(domain || '').trim().toLowerCase();\r\n    if (!normalized) {\r\n        return null;\r\n    }\r\n\r\n    if (LEGACY_DOMAIN_KEY_MAPPING[normalized]) {\r\n        return LEGACY_DOMAIN_KEY_MAPPING[normalized];\r\n    }\r\n\r\n    if (DOMAIN_SOURCE_MAPPING[normalized]) {\r\n        return normalized;\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport function resolveDomainKeyForSourceSystem(sourceSystem) {\r\n    const normalizedSource = String(sourceSystem || '').trim().toLowerCase();\r\n    if (!normalizedSource) {\r\n        return null;\r\n    }\r\n\r\n    const mappedDomain = Object.entries(DOMAIN_SOURCE_MAPPING)\r\n        .find(([, sources]) => sources.includes(normalizedSource));\r\n\r\n    return mappedDomain ? mappedDomain[0] : normalizeDomainKey(normalizedSource);\r\n}\r\n","import template from './lieferzeiten-index.html.twig';\r\nimport { normalizeDomainKey, resolveDomainKeyForSourceSystem } from '../../utils/domain-source-mapping';\r\n\r\nconst DOMAIN_SOURCE_MAP = {\r\n    'first-medical-shop.de': ['first-medical-shop.de', 'first medical', 'e-commerce', 'shopware', 'gambio', 'first-medical-e-commerce'],\r\n    'ebay.de': ['ebay.de', 'ebay de'],\r\n    'ebay.at': ['ebay.at', 'ebay at'],\r\n    kaufland: ['kaufland'],\r\n    peg: ['peg'],\r\n    zonami: ['zonami'],\r\n    'medical-solutions-germany.de': ['medical-solutions-germany.de', 'medical solutions', 'medical-solutions'],\r\n};\r\n\r\nconst DOMAIN_LABEL_ALIASES = {\r\n    'First Medical': 'first-medical-shop.de',\r\n    'E-Commerce': 'first-medical-shop.de',\r\n    'First Medical - E-Commerce': 'first-medical-shop.de',\r\n    'Medical Solutions': 'medical-solutions-germany.de',\r\n};\r\n\r\nconst createDefaultFilters = () => ({\r\n    bestellnummer: '',\r\n    san6: '',\r\n    user: '',\r\n    sendenummer: '',\r\n    status: '',\r\n    shippingDateFrom: null,\r\n    shippingDateTo: null,\r\n    businessDateFrom: null,\r\n    businessDateTo: null,\r\n    deliveryDateFrom: null,\r\n    deliveryDateTo: null,\r\n    businessDateEndFrom: null,\r\n    businessDateEndTo: null,\r\n    lieferterminLieferantFrom: null,\r\n    lieferterminLieferantTo: null,\r\n    neuerLieferterminFrom: null,\r\n    neuerLieferterminTo: null,\r\n});\r\n\r\nShopware.Component.register('lieferzeiten-index', {\r\n    template,\r\n\r\n    inject: [\r\n        'lieferzeitenOrdersService',\r\n    ],\r\n\r\n    data() {\r\n        return {\r\n            selectedDomain: null,\r\n            selectedBereich: null,\r\n            filters: createDefaultFilters(),\r\n            orders: [],\r\n            isLoading: false,\r\n            isStatisticsLoading: false,\r\n            loadError: null,\r\n            statisticsMetrics: {\r\n                openOrders: 0,\r\n                overdueShipping: 0,\r\n                overdueDelivery: 0,\r\n            },\r\n        };\r\n    },\r\n\r\n    created() {\r\n        this.loadOrders();\r\n        this.loadStatistics();\r\n    },\r\n\r\n    watch: {\r\n        selectedDomain() {\r\n            if (!this.canAccessMainViews) {\r\n                return;\r\n            }\r\n\r\n            this.loadOrders();\r\n            this.loadStatistics();\r\n        },\r\n    },\r\n\r\n    computed: {\r\n        canAccessMainViews() {\r\n            return Boolean(this.selectedBereich) && Boolean(normalizeDomainKey(this.selectedDomain));\r\n        },\r\n\r\n        filteredOrders() {\r\n            const domainKey = normalizeDomainKey(this.selectedDomain);\r\n            if (!domainKey) {\r\n                return [];\r\n            }\r\n\r\n            return this.orders.filter((order) => order.domainKey === domainKey);\r\n        },\r\n    },\r\n\r\n    methods: {\r\n\r\n        onBereichChange(bereich) {\r\n            this.selectedBereich = bereich;\r\n\r\n            if (!this.canAccessMainViews) {\r\n                this.orders = [];\r\n                this.statisticsMetrics = {\r\n                    openOrders: 0,\r\n                    overdueShipping: 0,\r\n                    overdueDelivery: 0,\r\n                };\r\n                return;\r\n            }\r\n\r\n            this.loadOrders();\r\n            this.loadStatistics();\r\n        },\r\n\r\n        async loadStatistics() {\r\n            if (!this.canAccessMainViews) {\r\n                this.statisticsMetrics = {\r\n                    openOrders: 0,\r\n                    overdueShipping: 0,\r\n                    overdueDelivery: 0,\r\n                };\r\n                return;\r\n            }\r\n            try {\r\n                const payload = await this.lieferzeitenOrdersService.getStatistics({\r\n                    period: 30,\r\n                    domain: normalizeDomainKey(this.selectedDomain),\r\n                    channel: 'all',\r\n                });\r\n\r\n                this.statisticsMetrics = {\r\n                    openOrders: payload?.metrics?.openOrders ?? 0,\r\n                    overdueShipping: payload?.metrics?.overdueShipping ?? 0,\r\n                    overdueDelivery: payload?.metrics?.overdueDelivery ?? 0,\r\n                };\r\n            } catch (error) {\r\n                this.statisticsMetrics = {\r\n                    openOrders: 0,\r\n                    overdueShipping: 0,\r\n                    overdueDelivery: 0,\r\n                };\r\n            }\r\n        },\r\n\r\n        resolveOrderDomainKey(order) {\r\n            const orderDomain = String(order?.domain || order?.sourceSystem || '').trim();\r\n            if (orderDomain === '') {\r\n                return null;\r\n            }\r\n\r\n            const aliasMatch = DOMAIN_LABEL_ALIASES[orderDomain];\r\n            if (aliasMatch) {\r\n                return aliasMatch;\r\n            }\r\n\r\n            const normalizedOrderDomain = orderDomain.toLowerCase();\r\n\r\n            return Object.keys(DOMAIN_SOURCE_MAP).find((domainKey) => DOMAIN_SOURCE_MAP[domainKey]\r\n                .map((source) => source.toLowerCase())\r\n                .includes(normalizedOrderDomain)) || null;\r\n        },\r\n\r\n        async reloadData() {\r\n            await Promise.all([\r\n                this.loadOrders(),\r\n                this.loadStatistics(),\r\n            ]);\r\n        },\r\n\r\n        async loadOrders() {\r\n            if (!this.canAccessMainViews) {\r\n                this.orders = [];\r\n                this.isLoading = false;\r\n                return;\r\n            }\r\n            this.isLoading = true;\r\n            this.loadError = null;\r\n\r\n            try {\r\n                const domainKey = normalizeDomainKey(this.selectedDomain);\r\n                const result = await this.lieferzeitenOrdersService.getOrders({\r\n                    ...this.buildFilterParams(),\r\n                    domain: domainKey,\r\n                });\r\n                const orders = Array.isArray(result) ? result : [];\r\n\r\n                this.orders = orders.map((order) => ({\r\n                    ...order,\r\n                    domainKey: resolveDomainKeyForSourceSystem(order.sourceSystem || order.domain),\r\n                }));\r\n            } catch (error) {\r\n                this.orders = [];\r\n                this.loadError = error;\r\n            } finally {\r\n                this.isLoading = false;\r\n            }\r\n        },\r\n\r\n        buildFilterParams() {\r\n            return Object.entries(this.filters).reduce((params, [key, value]) => {\r\n                if (value === null || value === undefined) {\r\n                    return params;\r\n                }\r\n\r\n                const normalizedValue = typeof value === 'string' ? value.trim() : value;\r\n                if (normalizedValue === '') {\r\n                    return params;\r\n                }\r\n\r\n                params[key] = normalizedValue;\r\n\r\n                return params;\r\n            }, {});\r\n        },\r\n\r\n        applyFilters() {\r\n            this.loadOrders();\r\n        },\r\n\r\n        resetFilters() {\r\n            this.filters = createDefaultFilters();\r\n\r\n            this.loadOrders();\r\n        },\r\n    },\r\n});\r\n","{% block lieferzeiten_all %}\r\n    <div class=\"lieferzeiten-all\">\r\n        <sw-container columns=\"repeat(auto-fit, minmax(180px, 1fr))\" gap=\"16px\">\r\n            <sw-card class=\"lieferzeiten-kpi\">\r\n                <p class=\"lieferzeiten-kpi__label\">{{ $t('lieferzeiten.statistics.open') }}</p>\r\n                <p class=\"lieferzeiten-kpi__value\">{{ statisticsMetrics.openOrders }}</p>\r\n            </sw-card>\r\n            <sw-card class=\"lieferzeiten-kpi\">\r\n                <p class=\"lieferzeiten-kpi__label\">{{ $t('lieferzeiten.statistics.overdueShipping') }}</p>\r\n                <p class=\"lieferzeiten-kpi__value\">{{ statisticsMetrics.overdueShipping }}</p>\r\n            </sw-card>\r\n            <sw-card class=\"lieferzeiten-kpi\">\r\n                <p class=\"lieferzeiten-kpi__label\">{{ $t('lieferzeiten.statistics.overdueDelivery') }}</p>\r\n                <p class=\"lieferzeiten-kpi__value\">{{ statisticsMetrics.overdueDelivery }}</p>\r\n            </sw-card>\r\n        </sw-container>\r\n\r\n        <lieferzeiten-order-table :orders=\"orders\" :on-reload-order=\"onReloadOrder\" />\r\n    </div>\r\n{% endblock %}\r\n","import template from './lieferzeiten-all.html.twig';\r\n\r\nShopware.Component.register('lieferzeiten-all', {\r\n    template,\r\n\r\n    props: {\r\n        orders: {\r\n            type: Array,\r\n            required: true,\r\n            default: () => [],\r\n        },\r\n        selectedDomain: {\r\n            type: String,\r\n            required: false,\r\n            default: null,\r\n        },\r\n        onReloadOrder: {\r\n            type: Function,\r\n            required: false,\r\n            default: null,\r\n        },\r\n        statisticsMetrics: {\r\n            type: Object,\r\n            required: false,\r\n            default: () => ({\r\n                openOrders: 0,\r\n                overdueShipping: 0,\r\n                overdueDelivery: 0,\r\n            }),\r\n        },\r\n    },\r\n});\r\n","{% block lieferzeiten_open %}\r\n    <div class=\"lieferzeiten-open\">\r\n        <sw-container columns=\"repeat(auto-fit, minmax(180px, 1fr))\" gap=\"16px\">\r\n            <sw-card class=\"lieferzeiten-kpi\">\r\n                <p class=\"lieferzeiten-kpi__label\">{{ $t('lieferzeiten.statistics.open') }}</p>\r\n                <p class=\"lieferzeiten-kpi__value\">{{ statisticsMetrics.openOrders }}</p>\r\n            </sw-card>\r\n            <sw-card class=\"lieferzeiten-kpi\">\r\n                <p class=\"lieferzeiten-kpi__label\">{{ $t('lieferzeiten.statistics.overdueShipping') }}</p>\r\n                <p class=\"lieferzeiten-kpi__value\">{{ statisticsMetrics.overdueShipping }}</p>\r\n            </sw-card>\r\n            <sw-card class=\"lieferzeiten-kpi\">\r\n                <p class=\"lieferzeiten-kpi__label\">{{ $t('lieferzeiten.statistics.overdueDelivery') }}</p>\r\n                <p class=\"lieferzeiten-kpi__value\">{{ statisticsMetrics.overdueDelivery }}</p>\r\n            </sw-card>\r\n        </sw-container>\r\n\r\n        <lieferzeiten-order-table :orders=\"orders\" :only-open=\"true\" :on-reload-order=\"onReloadOrder\" />\r\n    </div>\r\n{% endblock %}\r\n","import template from './lieferzeiten-open.html.twig';\r\n\r\nShopware.Component.register('lieferzeiten-open', {\r\n    template,\r\n\r\n    props: {\r\n        orders: {\r\n            type: Array,\r\n            required: true,\r\n            default: () => [],\r\n        },\r\n        selectedDomain: {\r\n            type: String,\r\n            required: false,\r\n            default: null,\r\n        },\r\n        onReloadOrder: {\r\n            type: Function,\r\n            required: false,\r\n            default: null,\r\n        },\r\n        statisticsMetrics: {\r\n            type: Object,\r\n            required: false,\r\n            default: () => ({\r\n                openOrders: 0,\r\n                overdueShipping: 0,\r\n                overdueDelivery: 0,\r\n            }),\r\n        },\r\n    },\r\n});\r\n","{% block lieferzeiten_statistics %}\r\n    <div class=\"lieferzeiten-statistics\">\r\n        <sw-container columns=\"1fr auto auto\" gap=\"16px\" class=\"lieferzeiten-statistics__filters\">\r\n            <sw-single-select\r\n                v-model:value=\"selectedPeriod\"\r\n                :label=\"$t('lieferzeiten.statistics.periodLabel')\"\r\n                :options=\"periodOptions\"\r\n                labelProperty=\"label\"\r\n                valueProperty=\"value\"\r\n            />\r\n            <sw-single-select\r\n                v-model:value=\"selectedChannel\"\r\n                :label=\"$t('lieferzeiten.statistics.channelLabel')\"\r\n                :options=\"channelOptions\"\r\n                labelProperty=\"label\"\r\n                valueProperty=\"value\"\r\n            />\r\n            <sw-button variant=\"primary\" @click=\"exportCsv\">\r\n                {{ $t('lieferzeiten.statistics.exportCsv') }}\r\n            </sw-button>\r\n        </sw-container>\r\n\r\n        <sw-loader v-if=\"isLoading\" />\r\n\r\n        <sw-empty-state\r\n            v-else-if=\"loadError\"\r\n            :title=\"$t('lieferzeiten.loading.errorTitle')\"\r\n            :description=\"$t('lieferzeiten.loading.errorDescription')\"\r\n        />\r\n\r\n        <template v-else>\r\n        <sw-container columns=\"repeat(3, 1fr)\" gap=\"16px\" class=\"lieferzeiten-statistics__metrics\">\r\n            <sw-card :title=\"$t('lieferzeiten.statistics.open')\">\r\n                <div class=\"lieferzeiten-statistics__metric\">{{ metrics.open }}</div>\r\n            </sw-card>\r\n            <sw-card :title=\"$t('lieferzeiten.statistics.overdueShipping')\">\r\n                <div class=\"lieferzeiten-statistics__metric\">{{ metrics.overdueShipping }}</div>\r\n            </sw-card>\r\n            <sw-card :title=\"$t('lieferzeiten.statistics.overdueDelivery')\">\r\n                <div class=\"lieferzeiten-statistics__metric\">{{ metrics.overdueDelivery }}</div>\r\n            </sw-card>\r\n        </sw-container>\r\n\r\n        <sw-card :title=\"$t('lieferzeiten.statistics.chartTitle')\" class=\"lieferzeiten-statistics__chart-card\">\r\n            <div v-if=\"channelChartData.length\" class=\"lieferzeiten-statistics__chart\">\r\n                <div v-for=\"item in channelChartData\" :key=\"item.channel\" class=\"lieferzeiten-statistics__chart-row\">\r\n                    <span>{{ item.channel }}</span>\r\n                    <div class=\"lieferzeiten-statistics__bar-wrap\">\r\n                        <div class=\"lieferzeiten-statistics__bar\" :style=\"{ width: getChartBarWidth(item.value) }\"></div>\r\n                    </div>\r\n                    <strong>{{ item.value }}</strong>\r\n                </div>\r\n            </div>\r\n            <sw-empty-state\r\n                v-else\r\n                :title=\"$t('lieferzeiten.emptyState.title')\"\r\n                :description=\"$t('lieferzeiten.emptyState.description')\"\r\n            />\r\n        </sw-card>\r\n\r\n        <sw-card :title=\"$t('lieferzeiten.statistics.timelineTitle')\" class=\"lieferzeiten-statistics__timeline-card\">\r\n            <div v-if=\"timelineSeries.length > 1\" class=\"lieferzeiten-statistics__timeline-chart\">\r\n                <svg viewBox=\"0 0 100 60\" preserveAspectRatio=\"none\" class=\"lieferzeiten-statistics__timeline-svg\">\r\n                    <path :d=\"timelineChartPaths.areaPath\" class=\"lieferzeiten-statistics__timeline-area\" />\r\n                    <path :d=\"timelineChartPaths.linePath\" class=\"lieferzeiten-statistics__timeline-line\" />\r\n                </svg>\r\n                <div class=\"lieferzeiten-statistics__timeline-axis\">\r\n                    <span>{{ formatTimelineLabel(timelineSeries[0].date) }}</span>\r\n                    <span>{{ formatTimelineLabel(timelineSeries[timelineSeries.length - 1].date) }}</span>\r\n                </div>\r\n            </div>\r\n            <div v-else-if=\"timelineSeries.length === 1\" class=\"lieferzeiten-statistics__timeline-fallback\">\r\n                <strong>{{ timelineSeries[0].value }}</strong>\r\n                <span>{{ formatTimelineLabel(timelineSeries[0].date) }}</span>\r\n            </div>\r\n            <sw-empty-state\r\n                v-else\r\n                :title=\"$t('lieferzeiten.statistics.timelineEmptyTitle')\"\r\n                :description=\"$t('lieferzeiten.statistics.timelineEmptyDescription')\"\r\n            />\r\n        </sw-card>\r\n\r\n        <sw-card :title=\"$t('lieferzeiten.statistics.tableTitle')\">\r\n            <sw-data-grid\r\n                :data-source=\"filteredOrders\"\r\n                :columns=\"tableColumns\"\r\n                :show-selection=\"false\"\r\n            >\r\n                <template #column-status=\"{ item }\">\r\n                    <sw-label :appearance=\"item.status === $t('lieferzeiten.statistics.status.overdue') ? 'error' : 'info'\">\r\n                        {{ item.status }}\r\n                    </sw-label>\r\n                </template>\r\n\r\n                <template #column-eventAt=\"{ item }\">\r\n                    {{ formatDate(item.eventAt) }}\r\n                </template>\r\n\r\n                <template #column-promisedAt=\"{ item }\">\r\n                    {{ formatDate(item.promisedAt) }}\r\n                </template>\r\n\r\n                <template #column-actions=\"{ item }\">\r\n                    <div class=\"lieferzeiten-statistics__actions\">\r\n                        <sw-button\r\n                            v-for=\"action in resolveActivityActions(item)\"\r\n                            :key=\"`${item.id}-${action.id}`\"\r\n                            size=\"x-small\"\r\n                            :variant=\"action.disabled ? 'ghost' : 'secondary'\"\r\n                            :disabled=\"action.disabled || action.isLoading\"\r\n                            :is-loading=\"action.isLoading\"\r\n                            v-tooltip=\"actionTooltip(action)\"\r\n                            @click=\"action.onClick && action.onClick()\"\r\n                        >\r\n                            <sw-icon v-if=\"action.icon\" :name=\"action.icon\" size=\"12px\" />\r\n                            {{ action.label }}\r\n                        </sw-button>\r\n                    </div>\r\n                </template>\r\n\r\n                <template #actions=\"{ item }\">\r\n                    <sw-context-menu-item @click=\"onDrilldown(item)\">\r\n                        {{ $t('lieferzeiten.statistics.drilldown') }}\r\n                    </sw-context-menu-item>\r\n                </template>\r\n            </sw-data-grid>\r\n        </sw-card>\r\n\r\n        <sw-modal\r\n            v-if=\"selectedActivity\"\r\n            :title=\"$t('lieferzeiten.statistics.drilldownTitle')\"\r\n            @modal-close=\"closeDrilldown\"\r\n        >\r\n            <p><strong>{{ $t('lieferzeiten.table.orderNumber') }}:</strong> {{ selectedActivity.orderNumber }}</p>\r\n            <p><strong>{{ $t('lieferzeiten.table.domain') }}:</strong> {{ selectedActivity.domain }}</p>\r\n            <p><strong>{{ $t('lieferzeiten.table.status') }}:</strong> {{ selectedActivity.status }}</p>\r\n            <p><strong>{{ $t('lieferzeiten.statistics.activityDate') }}:</strong> {{ formatDate(selectedActivity.eventAt) }}</p>\r\n            <p><strong>{{ $t('lieferzeiten.statistics.promisedDate') }}:</strong> {{ formatDate(selectedActivity.promisedAt) }}</p>\r\n        </sw-modal>\r\n        </template>\r\n    </div>\r\n{% endblock %}\r\n","const toNumber = (value) => {\r\n    const parsed = Number(value);\r\n\r\n    if (Number.isFinite(parsed)) {\r\n        return parsed;\r\n    }\r\n\r\n    return 0;\r\n};\r\n\r\nconst toTimelineDate = (point) => {\r\n    return point.date || point.day || point.eventAt || point.createdAt || null;\r\n};\r\n\r\nconst toTimelineValue = (point) => {\r\n    return toNumber(point.count ?? point.value ?? point.total ?? point.orders ?? 0);\r\n};\r\n\r\nconst toIsoDate = (dateString) => {\r\n    const date = new Date(dateString);\r\n\r\n    if (Number.isNaN(date.getTime())) {\r\n        return null;\r\n    }\r\n\r\n    return date.toISOString().slice(0, 10);\r\n};\r\n\r\nconst matchesFilter = (point, selectedChannel, selectedDomain) => {\r\n    if (selectedChannel && selectedChannel !== 'all' && point.channel && point.channel !== selectedChannel) {\r\n        return false;\r\n    }\r\n\r\n    if (selectedDomain && point.domain && point.domain !== selectedDomain) {\r\n        return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\nexport function normalizeTimelinePoints(timeline, { selectedChannel = 'all', selectedDomain = null } = {}) {\r\n    if (!Array.isArray(timeline)) {\r\n        return [];\r\n    }\r\n\r\n    const groupedPoints = timeline.reduce((accumulator, point) => {\r\n        if (!point || !matchesFilter(point, selectedChannel, selectedDomain)) {\r\n            return accumulator;\r\n        }\r\n\r\n        const timelineDate = toTimelineDate(point);\r\n        const isoDate = toIsoDate(timelineDate);\r\n\r\n        if (!isoDate) {\r\n            return accumulator;\r\n        }\r\n\r\n        accumulator[isoDate] = (accumulator[isoDate] || 0) + toTimelineValue(point);\r\n\r\n        return accumulator;\r\n    }, {});\r\n\r\n    return Object.entries(groupedPoints)\r\n        .sort(([left], [right]) => left.localeCompare(right))\r\n        .map(([date, value]) => ({ date, value }));\r\n}\r\n","import template from './lieferzeiten-statistics.html.twig';\r\nimport './lieferzeiten-statistics.scss';\r\nimport { normalizeTimelinePoints } from './timeline.util';\r\n\r\nconst TASK_CLOSABLE_STATUSES = ['open', 'in_progress', 'reopened'];\r\nconst TASK_REOPENABLE_STATUSES = ['done', 'cancelled'];\r\n\r\nShopware.Component.register('lieferzeiten-statistics', {\r\n    template,\r\n\r\n    inject: [\r\n        'lieferzeitenOrdersService',\r\n        'lieferzeitenTrackingService',\r\n        'acl',\r\n    ],\r\n\r\n    mixins: ['notification'],\r\n\r\n    props: {\r\n        selectedDomain: {\r\n            type: String,\r\n            required: false,\r\n            default: null,\r\n        },\r\n    },\r\n\r\n    data() {\r\n        return {\r\n            periodOptions: [\r\n                { value: 7, label: this.$t('lieferzeiten.statistics.period.7') },\r\n                { value: 30, label: this.$t('lieferzeiten.statistics.period.30') },\r\n                { value: 90, label: this.$t('lieferzeiten.statistics.period.90') },\r\n            ],\r\n            selectedPeriod: 30,\r\n            selectedChannel: 'all',\r\n            selectedActivity: null,\r\n            isLoading: false,\r\n            loadError: null,\r\n            statistics: {\r\n                metrics: {\r\n                    openOrders: 0,\r\n                    overdueShipping: 0,\r\n                    overdueDelivery: 0,\r\n                },\r\n                channels: [],\r\n                timeline: [],\r\n                activitiesData: [],\r\n            },\r\n            tableColumns: [\r\n                { property: 'orderNumber', label: this.$t('lieferzeiten.table.orderNumber'), primary: true },\r\n                { property: 'domain', label: this.$t('lieferzeiten.table.domain') },\r\n                { property: 'status', label: this.$t('lieferzeiten.table.status') },\r\n                { property: 'eventAt', label: this.$t('lieferzeiten.statistics.activityDate') },\r\n                { property: 'promisedAt', label: this.$t('lieferzeiten.statistics.promisedDate') },\r\n                { property: 'actions', label: this.$t('lieferzeiten.statistics.actionsColumn') },\r\n            ],\r\n            actionLoadingByActivity: {},\r\n        };\r\n    },\r\n\r\n    created() {\r\n        this.loadStatistics();\r\n    },\r\n\r\n    watch: {\r\n        selectedPeriod() {\r\n            this.loadStatistics();\r\n        },\r\n        selectedChannel() {\r\n            this.loadStatistics();\r\n        },\r\n        selectedDomain() {\r\n            this.selectedChannel = 'all';\r\n            this.loadStatistics();\r\n        },\r\n    },\r\n\r\n    computed: {\r\n        channelOptions() {\r\n            return [\r\n                { value: 'all', label: this.$t('lieferzeiten.statistics.allChannels') },\r\n                ...this.statistics.channels.map((item) => ({ value: item.channel, label: item.channel })),\r\n            ];\r\n        },\r\n\r\n        metrics() {\r\n            return {\r\n                open: this.statistics.metrics.openOrders,\r\n                overdueShipping: this.statistics.metrics.overdueShipping,\r\n                overdueDelivery: this.statistics.metrics.overdueDelivery,\r\n            };\r\n        },\r\n\r\n        filteredOrders() {\r\n            return this.statistics.activitiesData.map((activity) => ({\r\n                ...activity,\r\n                status: activity.status === 'open'\r\n                    ? this.$t('lieferzeiten.status.open')\r\n                    : (activity.status === 'done' ? this.$t('lieferzeiten.status.closed') : activity.status),\r\n            }));\r\n        },\r\n\r\n        channelChartData() {\r\n            return this.statistics.channels;\r\n        },\r\n\r\n        maxChartValue() {\r\n            if (!this.channelChartData.length) {\r\n                return 1;\r\n            }\r\n\r\n            return Math.max(...this.channelChartData.map((item) => item.value));\r\n        },\r\n\r\n        timelineSeries() {\r\n            return normalizeTimelinePoints(this.statistics.timeline, {\r\n                selectedChannel: this.selectedChannel,\r\n                selectedDomain: this.selectedDomain,\r\n            });\r\n        },\r\n\r\n        timelineMaxValue() {\r\n            if (!this.timelineSeries.length) {\r\n                return 0;\r\n            }\r\n\r\n            return Math.max(...this.timelineSeries.map((item) => item.value));\r\n        },\r\n\r\n        timelineChartPaths() {\r\n            if (this.timelineSeries.length < 2) {\r\n                return null;\r\n            }\r\n\r\n            const width = 100;\r\n            const height = 60;\r\n            const maxValue = this.timelineMaxValue || 1;\r\n            const step = width / (this.timelineSeries.length - 1);\r\n            const points = this.timelineSeries.map((item, index) => {\r\n                const x = Number((index * step).toFixed(2));\r\n                const normalized = Math.min(item.value / maxValue, 1);\r\n                const y = Number((height - (normalized * height)).toFixed(2));\r\n\r\n                return { x, y };\r\n            });\r\n\r\n            const linePath = points\r\n                .map((point, index) => `${index === 0 ? 'M' : 'L'} ${point.x} ${point.y}`)\r\n                .join(' ');\r\n            const areaPath = `${linePath} L ${width} ${height} L 0 ${height} Z`;\r\n\r\n            return { linePath, areaPath };\r\n        },\r\n    },\r\n\r\n    methods: {\r\n        hasViewAccess() {\r\n            if (typeof this.acl?.can !== 'function') {\r\n                return false;\r\n            }\r\n\r\n            return this.acl.can('lieferzeiten.viewer') || this.acl.can('admin');\r\n        },\r\n\r\n        hasEditAccess() {\r\n            if (typeof this.acl?.can !== 'function') {\r\n                return false;\r\n            }\r\n\r\n            return this.acl.can('lieferzeiten.editor') || this.acl.can('admin');\r\n        },\r\n\r\n        resolveActivityActions(item) {\r\n            const actions = [];\r\n            const eventType = String(item?.eventType || '').toLowerCase();\r\n\r\n            if (['paket', 'position', 'audit'].includes(eventType)) {\r\n                actions.push(this.createOrderAction(item));\r\n            }\r\n\r\n            if (eventType === 'task') {\r\n                actions.push(this.createTaskRouteAction(item));\r\n                actions.push(this.createTaskTransitionAction(item));\r\n            }\r\n\r\n            if (item?.trackingNumber) {\r\n                actions.push(this.createTrackingAction(item));\r\n            }\r\n\r\n            if (actions.length === 0) {\r\n                return [{\r\n                    id: 'unavailable',\r\n                    label: this.$t('lieferzeiten.statistics.actionsUnavailable'),\r\n                    icon: 'regular-ban',\r\n                    disabled: true,\r\n                    disabledReason: this.$t('lieferzeiten.statistics.actionUnavailableReason'),\r\n                    onClick: null,\r\n                }];\r\n            }\r\n\r\n            return actions;\r\n        },\r\n\r\n        createOrderAction(item) {\r\n            const hasOrderReference = Boolean(item?.paketId || item?.orderNumber);\r\n\r\n            return {\r\n                id: 'open-order',\r\n                label: this.$t('lieferzeiten.statistics.actions.openOrder'),\r\n                icon: 'regular-shopping-bag',\r\n                disabled: !this.hasViewAccess() || !hasOrderReference,\r\n                disabledReason: !this.hasViewAccess()\r\n                    ? this.$t('lieferzeiten.statistics.actionReasons.noViewAcl')\r\n                    : this.$t('lieferzeiten.statistics.actionReasons.missingOrderReference'),\r\n                onClick: () => this.navigateToOrder(item),\r\n            };\r\n        },\r\n\r\n        createTaskRouteAction(item) {\r\n            return {\r\n                id: 'open-task',\r\n                label: this.$t('lieferzeiten.statistics.actions.openTask'),\r\n                icon: 'regular-briefcase',\r\n                disabled: !this.hasViewAccess() || !item?.taskId,\r\n                disabledReason: !this.hasViewAccess()\r\n                    ? this.$t('lieferzeiten.statistics.actionReasons.noViewAcl')\r\n                    : this.$t('lieferzeiten.statistics.actionReasons.missingTaskReference'),\r\n                onClick: () => this.navigateToTask(item),\r\n            };\r\n        },\r\n\r\n        createTaskTransitionAction(item) {\r\n            const normalizedStatus = String(item?.status || '').toLowerCase();\r\n            const isClosable = TASK_CLOSABLE_STATUSES.includes(normalizedStatus);\r\n            const isReopenable = TASK_REOPENABLE_STATUSES.includes(normalizedStatus);\r\n\r\n            const operation = isReopenable ? 'reopen' : 'close';\r\n            const isActionAvailable = isClosable || isReopenable;\r\n\r\n            return {\r\n                id: `task-${operation}`,\r\n                label: this.$t(`lieferzeiten.statistics.actions.${operation}Task`),\r\n                icon: isReopenable ? 'regular-redo' : 'regular-checkmark',\r\n                disabled: !this.hasEditAccess() || !item?.taskId || !isActionAvailable,\r\n                disabledReason: !this.hasEditAccess()\r\n                    ? this.$t('lieferzeiten.statistics.actionReasons.noEditAcl')\r\n                    : (!item?.taskId\r\n                        ? this.$t('lieferzeiten.statistics.actionReasons.missingTaskReference')\r\n                        : this.$t('lieferzeiten.statistics.actionReasons.unsupportedTaskStatus')),\r\n                onClick: () => this.performTaskAction(item, operation),\r\n                isLoading: Boolean(this.actionLoadingByActivity[this.getActionLoadingKey(item, operation)]),\r\n            };\r\n        },\r\n\r\n        createTrackingAction(item) {\r\n            return {\r\n                id: 'open-tracking',\r\n                label: this.$t('lieferzeiten.statistics.actions.openTracking'),\r\n                icon: 'regular-shipping',\r\n                disabled: !this.hasViewAccess() || !item?.trackingNumber,\r\n                disabledReason: !this.hasViewAccess()\r\n                    ? this.$t('lieferzeiten.statistics.actionReasons.noViewAcl')\r\n                    : this.$t('lieferzeiten.statistics.actionReasons.missingTrackingReference'),\r\n                onClick: () => this.navigateToTracking(item),\r\n            };\r\n        },\r\n\r\n        getActionLoadingKey(item, operation) {\r\n            return `${item?.id || 'unknown'}:${operation}`;\r\n        },\r\n\r\n        async performTaskAction(item, operation) {\r\n            if (!item?.taskId || !['close', 'reopen'].includes(operation)) {\r\n                return;\r\n            }\r\n\r\n            const loadingKey = this.getActionLoadingKey(item, operation);\r\n            this.$set(this.actionLoadingByActivity, loadingKey, true);\r\n\r\n            try {\r\n                await this.lieferzeitenOrdersService.post(`tasks/${encodeURIComponent(item.taskId)}/${operation}`, {});\r\n                this.createNotificationSuccess({\r\n                    title: this.$t('lieferzeiten.statistics.actionSuccessTitle'),\r\n                    message: this.$t(`lieferzeiten.statistics.actionSuccess.${operation}Task`),\r\n                });\r\n                await this.loadStatistics();\r\n            } catch (error) {\r\n                this.createNotificationError({\r\n                    title: this.$t('lieferzeiten.statistics.actionErrorTitle'),\r\n                    message: this.$t(`lieferzeiten.statistics.actionError.${operation}Task`),\r\n                });\r\n            } finally {\r\n                this.$delete(this.actionLoadingByActivity, loadingKey);\r\n            }\r\n        },\r\n\r\n        navigateToOrder(item) {\r\n            this.$router.push({\r\n                name: 'lieferzeiten.index',\r\n                query: {\r\n                    bestellnummer: item?.orderNumber || undefined,\r\n                    paketId: item?.paketId || undefined,\r\n                },\r\n            });\r\n        },\r\n\r\n        navigateToTask(item) {\r\n            this.$router.push({\r\n                name: 'lieferzeiten.index',\r\n                query: {\r\n                    taskId: item?.taskId || undefined,\r\n                    bestellnummer: item?.orderNumber || undefined,\r\n                },\r\n            });\r\n        },\r\n\r\n        async navigateToTracking(item) {\r\n            const trackingNumber = String(item?.trackingNumber || '').trim();\r\n            if (trackingNumber === '') {\r\n                return;\r\n            }\r\n\r\n            try {\r\n                await this.lieferzeitenTrackingService.history('dhl', trackingNumber);\r\n            } catch (error) {\r\n                this.createNotificationError({\r\n                    title: this.$t('lieferzeiten.statistics.actionErrorTitle'),\r\n                    message: this.$t('lieferzeiten.statistics.actionError.openTracking'),\r\n                });\r\n                return;\r\n            }\r\n\r\n            window.open(`https://www.dhl.de/de/privatkunden/pakete-empfangen/verfolgen.html?piececode=${encodeURIComponent(trackingNumber)}`, '_blank', 'noopener');\r\n        },\r\n\r\n        actionTooltip(action) {\r\n            if (!action?.disabled) {\r\n                return '';\r\n            }\r\n\r\n            return action.disabledReason || this.$t('lieferzeiten.statistics.actionUnavailableReason');\r\n        },\r\n\r\n        async loadStatistics() {\r\n            this.isLoading = true;\r\n            this.loadError = null;\r\n\r\n            try {\r\n                const payload = await this.lieferzeitenOrdersService.getStatistics({\r\n                    period: this.selectedPeriod,\r\n                    domain: this.selectedDomain,\r\n                    channel: this.selectedChannel,\r\n                });\r\n\r\n                this.statistics = {\r\n                    metrics: payload.metrics ?? {\r\n                        openOrders: 0,\r\n                        overdueShipping: 0,\r\n                        overdueDelivery: 0,\r\n                    },\r\n                    channels: Array.isArray(payload.channels) ? payload.channels : [],\r\n                    timeline: Array.isArray(payload.timeline) ? payload.timeline : [],\r\n                    activitiesData: Array.isArray(payload.activitiesData) ? payload.activitiesData : [],\r\n                };\r\n            } catch (error) {\r\n                this.statistics = {\r\n                    metrics: {\r\n                        openOrders: 0,\r\n                        overdueShipping: 0,\r\n                        overdueDelivery: 0,\r\n                    },\r\n                    channels: [],\r\n                    timeline: [],\r\n                    activitiesData: [],\r\n                };\r\n                this.loadError = error;\r\n            } finally {\r\n                this.isLoading = false;\r\n            }\r\n        },\r\n\r\n        formatDate(dateString) {\r\n            if (!dateString) {\r\n                return '—';\r\n            }\r\n\r\n            return Shopware.Utils.format.date(dateString);\r\n        },\r\n\r\n        getChartBarWidth(value) {\r\n            return `${Math.max(Math.round((value / this.maxChartValue) * 100), 6)}%`;\r\n        },\r\n\r\n        formatTimelineLabel(dateString) {\r\n            return Shopware.Utils.format.date(dateString);\r\n        },\r\n\r\n        onDrilldown(item) {\r\n            this.selectedActivity = item;\r\n        },\r\n\r\n        closeDrilldown() {\r\n            this.selectedActivity = null;\r\n        },\r\n\r\n        exportCsv() {\r\n            const headers = [\r\n                this.$t('lieferzeiten.table.orderNumber'),\r\n                this.$t('lieferzeiten.table.domain'),\r\n                this.$t('lieferzeiten.table.status'),\r\n                this.$t('lieferzeiten.statistics.activityDate'),\r\n                this.$t('lieferzeiten.statistics.promisedDate'),\r\n            ];\r\n\r\n            const rows = this.filteredOrders.map((order) => [\r\n                order.orderNumber,\r\n                order.domain,\r\n                order.status,\r\n                this.formatDate(order.eventAt),\r\n                this.formatDate(order.promisedAt),\r\n            ]);\r\n\r\n            const csv = [headers, ...rows]\r\n                .map((line) => line.map((value) => `\"${String(value).replace(/\"/g, '\"\"')}\"`).join(';'))\r\n                .join('\\n');\r\n\r\n            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\r\n            const link = document.createElement('a');\r\n\r\n            link.href = URL.createObjectURL(blob);\r\n            link.download = 'lieferzeiten-statistiken.csv';\r\n            link.click();\r\n\r\n            URL.revokeObjectURL(link.href);\r\n        },\r\n    },\r\n});\r\n","{% block lieferzeiten_domain_selection %}\r\n    <div class=\"lieferzeiten-domain-selection\">\r\n        <sw-label>\r\n            {{ $t('lieferzeiten.domainSelection.steps.bereich') }}\r\n        </sw-label>\r\n\r\n        <sw-single-select\r\n            v-model=\"selectedBereich\"\r\n            :options=\"groupOptions\"\r\n            :placeholder=\"$t('lieferzeiten.domainSelection.bereichPlaceholder')\"\r\n            :clearable=\"false\"\r\n        />\r\n\r\n        <sw-label>\r\n            {{ $t('lieferzeiten.domainSelection.steps.channel') }}\r\n        </sw-label>\r\n\r\n        <sw-single-select\r\n            v-model=\"selectedChannel\"\r\n            :options=\"channelOptions\"\r\n            :placeholder=\"$t('lieferzeiten.domainSelection.channelPlaceholder')\"\r\n            :clearable=\"false\"\r\n            :disabled=\"!canSelectChannel\"\r\n        />\r\n\r\n        <sw-switch-field\r\n            v-model=\"persistSelection\"\r\n            :label=\"$t('lieferzeiten.domainSelection.persistLabel')\"\r\n        />\r\n\r\n        <sw-button\r\n            size=\"small\"\r\n            variant=\"ghost\"\r\n            class=\"lieferzeiten-domain-selection__reset\"\r\n            @click=\"resetDomainSelection\"\r\n        >\r\n            {{ $t('lieferzeiten.domainSelection.reset') }}\r\n        </sw-button>\r\n    </div>\r\n{% endblock %}\r\n","import template from './lieferzeiten-domain-selection.html.twig';\r\nimport {\r\n    DEFAULT_GROUP_ID,\r\n    DOMAIN_GROUPS,\r\n    getChannelsForGroup,\r\n    getDefaultDomainForGroup,\r\n    normalizeDomainKey,\r\n    normalizeGroupKey,\r\n    resolveGroupKeyForDomain,\r\n} from '../../utils/domain-source-mapping';\r\n\r\nconst STORAGE_CHANNEL_KEY = 'lieferzeitenManagementChannel';\r\nconst STORAGE_BEREICH_KEY = 'lieferzeitenManagementBereich';\r\nconst LEGACY_STORAGE_GROUP_KEY = 'lieferzeitenManagementGroup';\r\nconst LEGACY_STORAGE_DOMAIN_KEY = 'lieferzeitenManagementDomain';\r\n\r\nShopware.Component.register('lieferzeiten-domain-selection', {\r\n    template,\r\n\r\n    props: {\r\n        value: {\r\n            type: String,\r\n            required: false,\r\n            default: null,\r\n        },\r\n    },\r\n\r\n    data() {\r\n        return {\r\n            selectedBereich: null,\r\n            selectedChannel: normalizeDomainKey(this.value),\r\n            persistSelection: false,\r\n            isInternalUpdate: false,\r\n        };\r\n    },\r\n\r\n    created() {\r\n        this.loadStoredSelection();\r\n    },\r\n\r\n    watch: {\r\n        value(newValue) {\r\n            const normalizedChannel = normalizeDomainKey(newValue);\r\n            if (!normalizedChannel || normalizedChannel === this.selectedChannel) {\r\n                return;\r\n            }\r\n\r\n            this.applySelection(this.resolveInitialGroup(normalizedChannel, this.selectedBereich), normalizedChannel, false, false);\r\n        },\r\n\r\n        selectedBereich(newValue, oldValue) {\r\n            if (this.isInternalUpdate || newValue === oldValue) {\r\n                return;\r\n            }\r\n\r\n            if (!newValue) {\r\n                this.selectedChannel = null;\r\n                this.$emit('bereich-change', null);\r\n                this.$emit('group-change', null);\r\n                this.$emit('input', null);\r\n                return;\r\n            }\r\n\r\n            const allowedChannels = getChannelsForGroup(newValue).map((channel) => channel.value);\r\n            const nextChannel = allowedChannels.includes(this.selectedChannel)\r\n                ? this.selectedChannel\r\n                : getDefaultDomainForGroup(newValue);\r\n\r\n            this.isInternalUpdate = true;\r\n            this.selectedChannel = nextChannel;\r\n            this.isInternalUpdate = false;\r\n\r\n            this.$emit('bereich-change', newValue);\r\n            this.$emit('group-change', newValue);\r\n            this.$emit('input', nextChannel);\r\n            this.persistDomainSelection(newValue, nextChannel);\r\n        },\r\n\r\n        selectedChannel(newValue, oldValue) {\r\n            if (this.isInternalUpdate || !this.selectedBereich || !newValue || newValue === oldValue) {\r\n                return;\r\n            }\r\n\r\n            this.$emit('input', newValue);\r\n            this.persistDomainSelection(this.selectedBereich, newValue);\r\n        },\r\n    },\r\n\r\n    computed: {\r\n        groupOptions() {\r\n            return DOMAIN_GROUPS.map((group) => ({\r\n                value: group.id,\r\n                label: this.$t(group.labelSnippet),\r\n            }));\r\n        },\r\n\r\n        channelOptions() {\r\n            return getChannelsForGroup(this.selectedBereich).map((channel) => ({\r\n                value: channel.value,\r\n                label: this.$t(channel.labelSnippet),\r\n            }));\r\n        },\r\n\r\n        canSelectChannel() {\r\n            return Boolean(this.selectedBereich);\r\n        },\r\n    },\r\n\r\n    methods: {\r\n        resolveInitialGroup(channel, fallbackGroup = null) {\r\n            return resolveGroupKeyForDomain(channel)\r\n                || normalizeGroupKey(fallbackGroup)\r\n                || DEFAULT_GROUP_ID;\r\n        },\r\n\r\n        getStoredSelection(storage) {\r\n            const rawBereich = storage.getItem(STORAGE_BEREICH_KEY);\r\n            const rawLegacyGroup = storage.getItem(LEGACY_STORAGE_GROUP_KEY);\r\n            const rawChannel = storage.getItem(STORAGE_CHANNEL_KEY);\r\n            const rawLegacyDomain = storage.getItem(LEGACY_STORAGE_DOMAIN_KEY);\r\n\r\n            const normalizedBereich = normalizeGroupKey(rawBereich || rawLegacyGroup);\r\n            const normalizedChannel = normalizeDomainKey(rawChannel || rawLegacyDomain);\r\n\r\n            if (!normalizedBereich && !normalizedChannel) {\r\n                return null;\r\n            }\r\n\r\n            return {\r\n                bereich: normalizedBereich || this.resolveInitialGroup(normalizedChannel),\r\n                channel: normalizedChannel,\r\n                requiresMigration: (!rawBereich && Boolean(rawLegacyGroup)) || (!rawChannel && Boolean(rawLegacyDomain)),\r\n            };\r\n        },\r\n\r\n        loadStoredSelection() {\r\n            const localSelection = this.getStoredSelection(localStorage);\r\n            if (localSelection) {\r\n                this.persistSelection = true;\r\n                this.applySelection(localSelection.bereich, localSelection.channel, true, false);\r\n                if (localSelection.requiresMigration) {\r\n                    this.persistDomainSelection(localSelection.bereich, localSelection.channel);\r\n                }\r\n                return;\r\n            }\r\n\r\n            const sessionSelection = this.getStoredSelection(sessionStorage);\r\n            if (sessionSelection) {\r\n                this.persistSelection = false;\r\n                this.applySelection(sessionSelection.bereich, sessionSelection.channel, true, false);\r\n                if (sessionSelection.requiresMigration) {\r\n                    this.persistDomainSelection(sessionSelection.bereich, sessionSelection.channel);\r\n                }\r\n                return;\r\n            }\r\n\r\n            const propChannel = normalizeDomainKey(this.value);\r\n            if (propChannel) {\r\n                this.applySelection(null, propChannel, true, false);\r\n                return;\r\n            }\r\n\r\n            this.$emit('bereich-change', null);\r\n            this.$emit('group-change', null);\r\n            this.$emit('input', null);\r\n        },\r\n\r\n        applySelection(group, channel, emit = true, persist = true) {\r\n            const resolvedGroup = this.resolveInitialGroup(channel, group);\r\n            const allowedChannels = getChannelsForGroup(resolvedGroup).map((item) => item.value);\r\n            const resolvedChannel = allowedChannels.includes(channel)\r\n                ? channel\r\n                : getDefaultDomainForGroup(resolvedGroup);\r\n\r\n            this.isInternalUpdate = true;\r\n            this.selectedBereich = resolvedGroup;\r\n            this.selectedChannel = resolvedChannel;\r\n            this.isInternalUpdate = false;\r\n\r\n            if (emit) {\r\n                this.$emit('bereich-change', resolvedGroup);\r\n                this.$emit('group-change', resolvedGroup);\r\n                this.$emit('input', resolvedChannel);\r\n            }\r\n\r\n            if (persist) {\r\n                this.persistDomainSelection(resolvedGroup, resolvedChannel);\r\n            }\r\n        },\r\n\r\n        persistDomainSelection(group, channel) {\r\n            if (!group || !channel) {\r\n                return;\r\n            }\r\n\r\n            const targetStorage = this.persistSelection ? localStorage : sessionStorage;\r\n            const secondaryStorage = this.persistSelection ? sessionStorage : localStorage;\r\n\r\n            targetStorage.setItem(STORAGE_BEREICH_KEY, group);\r\n            targetStorage.setItem(LEGACY_STORAGE_GROUP_KEY, group);\r\n            targetStorage.setItem(STORAGE_CHANNEL_KEY, channel);\r\n            targetStorage.setItem(LEGACY_STORAGE_DOMAIN_KEY, channel);\r\n\r\n            secondaryStorage.removeItem(STORAGE_BEREICH_KEY);\r\n            secondaryStorage.removeItem(LEGACY_STORAGE_GROUP_KEY);\r\n            secondaryStorage.removeItem(STORAGE_CHANNEL_KEY);\r\n            secondaryStorage.removeItem(LEGACY_STORAGE_DOMAIN_KEY);\r\n        },\r\n\r\n        resetDomainSelection() {\r\n            localStorage.removeItem(STORAGE_BEREICH_KEY);\r\n            localStorage.removeItem(LEGACY_STORAGE_GROUP_KEY);\r\n            localStorage.removeItem(STORAGE_CHANNEL_KEY);\r\n            localStorage.removeItem(LEGACY_STORAGE_DOMAIN_KEY);\r\n            sessionStorage.removeItem(STORAGE_BEREICH_KEY);\r\n            sessionStorage.removeItem(LEGACY_STORAGE_GROUP_KEY);\r\n            sessionStorage.removeItem(STORAGE_CHANNEL_KEY);\r\n            sessionStorage.removeItem(LEGACY_STORAGE_DOMAIN_KEY);\r\n\r\n            this.selectedBereich = null;\r\n            this.selectedChannel = null;\r\n\r\n            this.$emit('bereich-change', null);\r\n            this.$emit('group-change', null);\r\n            this.$emit('input', null);\r\n        },\r\n    },\r\n});\r\n","{% block lieferzeiten_order_table %}\r\n    <div class=\"lieferzeiten-order-table\">\r\n        <table class=\"sw-data-grid__table\">\r\n            <thead>\r\n                <tr class=\"lieferzeiten-order-table__zone-row\">\r\n                    <th colspan=\"10\" title=\"Bestellung: Auftrags-, Kunden- und Positionsdaten\">{{ $t('lieferzeiten.zones.order') }}</th>\r\n                    <th colspan=\"11\" title=\"Lieferung: Paket-, Tracking- und Termininformationen\">{{ $t('lieferzeiten.zones.delivery') }}</th>\r\n                    <th colspan=\"5\" title=\"Status: interne Hinweise, Statuspflege und Protokoll\">{{ $t('lieferzeiten.zones.status') }}</th>\r\n                </tr>\r\n                <tr class=\"lieferzeiten-order-table__column-row\">\r\n                    <th>{{ $t('lieferzeiten.table.orderNumber') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.san6OrderNumber') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.san6Position') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.totalQuantity') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.orderDate') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.paymentMethod') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.paymentDate') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.customerNames') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.domain') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.positions') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.parcels') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.tracking') }}</th>\r\n                    <th>{{ $t('lieferzeiten.fields.supplierDate') }}</th>\r\n                    <th>{{ $t('lieferzeiten.fields.supplierWeek') }}</th>\r\n                    <th>{{ $t('lieferzeiten.fields.newDate') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.packageStatus') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.latestShippingDeadline') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.shippingDate') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.latestDeliveryDeadline') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.deliveryDate') }}</th>\r\n                    <th>{{ $t('lieferzeiten.fields.shippingType') }}</th>\r\n                    <th>{{ $t('lieferzeiten.fields.comment') }}</th>\r\n                    <th>{{ $t('lieferzeiten.fields.history') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.businessStatus') }}</th>\r\n                    <th>{{ $t('lieferzeiten.table.status') }}</th>\r\n                    <th>{{ $t('lieferzeiten.fields.audit') }}</th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                <template v-for=\"row in displayedRows\">\r\n                    <tr :key=\"row.key\">\r\n                        <td>\r\n                            <sw-button size=\"small\" variant=\"ghost\" @click=\"toggleOrder(row.order.id)\">\r\n                                {{ isExpanded(row.order.id) ? '-' : '+' }}\r\n                            </sw-button>\r\n                            {{ displayOrDash(row.order.orderNumber) }}\r\n                        </td>\r\n                        <td>{{ displayOrDash(row.order.san6OrderNumberDisplay) }}</td>\r\n                        <td>{{ displayOrDash(row.san6PositionDisplay) }}</td>\r\n                        <td>{{ displayOrDash(row.quantityDisplay) }}</td>\r\n                        <td>{{ displayOrDash(row.order.orderDateDisplay) }}</td>\r\n                        <td>{{ displayOrDash(row.order.paymentMethodDisplay) }}</td>\r\n                        <td>{{ displayOrDash(row.order.paymentDateDisplay) }}</td>\r\n                        <td>{{ displayOrDash(row.order.customerNamesDisplay) }}</td>\r\n                        <td>{{ displayOrDash(row.order.domain) }}</td>\r\n                        <td>{{ displayOrDash(row.positionsDisplay) }}</td>\r\n                        <td>{{ row.parcelsDisplay }}</td>\r\n                        <td>\r\n                            <template v-if=\"row.trackingEntries.length\">\r\n                                <button\r\n                                    v-for=\"entry in row.trackingEntries\"\r\n                                    :key=\"`${row.key}-${entry.carrier}-${entry.number}`\"\r\n                                    type=\"button\"\r\n                                    class=\"lieferzeiten-order-table__tracking-link\"\r\n                                    @click=\"openTrackingHistory(entry)\"\r\n                                >\r\n                                    {{ entry.number }}\r\n                                </button>\r\n                            </template>\r\n                            <template v-else>\r\n                                -\r\n                            </template>\r\n                        </td>\r\n                        <td>{{ displayOrDash(row.supplierDateDisplay) }}</td>\r\n                        <td>{{ displayOrDash(row.supplierWeekDisplay) }}</td>\r\n                        <td>{{ displayOrDash(row.newDateDisplay) }}</td>\r\n                        <td>{{ displayOrDash(row.packageStatusDisplay) }}</td>\r\n                        <td>{{ displayOrDash(row.order.latestShippingDeadlineDisplay) }}</td>\r\n                        <td>{{ displayOrDash(row.order.shippingDateDisplay) }}</td>\r\n                        <td>{{ displayOrDash(row.order.latestDeliveryDeadlineDisplay) }}</td>\r\n                        <td>{{ displayOrDash(row.order.deliveryDateDisplay) }}</td>\r\n                        <td>{{ row.shippingLabelDisplay }}</td>\r\n                        <td>\r\n                            <sw-text-field v-model:value=\"row.order.comment\" :disabled=\"!hasEditAccess()\" size=\"small\" />\r\n                            <sw-button v-if=\"hasEditAccess()\" size=\"small\" :disabled=\"!canSaveComment(row.order)\" @click=\"saveComment(row.order)\">\r\n                                {{ $t('global.default.save') }}\r\n                            </sw-button>\r\n                        </td>\r\n                        <td>\r\n                            <ul>\r\n                                <li v-for=\"(entry, index) in row.order.lieferterminLieferantHistory\" :key=\"`liefertermin-${row.order.id}-${index}`\">{{ formatHistoryEntry(entry) }}</li>\r\n                                <li v-for=\"(entry, index) in row.order.neuerLieferterminHistory\" :key=\"`neuer-liefertermin-${row.order.id}-${index}`\">{{ formatHistoryEntry(entry) }}</li>\r\n                                <li v-for=\"(entry, index) in row.order.commentHistory\" :key=\"`comment-${row.order.id}-${index}`\">{{ formatHistoryEntry(entry) }}</li>\r\n                            </ul>\r\n                        </td>\r\n                        <td>\r\n                            <sw-single-select\r\n                                v-model:value=\"row.order.selectedBusinessStatus\"\r\n                                :options=\"editableBusinessStatuses\"\r\n                                :disabled=\"!hasEditAccess()\"\r\n                                size=\"small\"\r\n                                :placeholder=\"$t('lieferzeiten.statusChange.placeholder')\"\r\n                            />\r\n                            <sw-button\r\n                                v-if=\"hasEditAccess()\"\r\n                                size=\"small\"\r\n                                variant=\"primary\"\r\n                                :disabled=\"!canSaveBusinessStatus(row.order)\"\r\n                                @click=\"saveBusinessStatus(row.order)\"\r\n                            >\r\n                                {{ $t('lieferzeiten.statusChange.save') }}\r\n                            </sw-button>\r\n                            <div class=\"lieferzeiten-order-table__business-status-current\">{{ businessStatusLabel(row.order) }}</div>\r\n                        </td>\r\n                        <td>\r\n                            <sw-label :variant=\"isOrderOpen(row.order) ? 'warning' : 'success'\">\r\n                                {{ isOrderOpen(row.order) ? $t('lieferzeiten.status.open') : $t('lieferzeiten.status.closed') }}\r\n                            </sw-label>\r\n                            <div v-if=\"canUpdateOrderStatus(row.order)\" class=\"lieferzeiten-order-table__status-editor\">\r\n                                <sw-single-select\r\n                                    v-model:value=\"row.order.selectedManualStatus\"\r\n                                    size=\"small\"\r\n                                    :options=\"statusOptions()\"\r\n                                    value-property=\"value\"\r\n                                    label-property=\"label\"\r\n                                />\r\n                                <sw-button\r\n                                    size=\"small\"\r\n                                    variant=\"primary\"\r\n                                    :is-loading=\"Boolean(statusUpdateLoadingByOrder[row.order.id])\"\r\n                                    @click=\"saveOrderStatus(row.order)\"\r\n                                >\r\n                                    {{ $t('lieferzeiten.status.manual.save') }}\r\n                                </sw-button>\r\n                            </div>\r\n                        </td>\r\n                        <td>{{ resolveAuditDisplay(row.order) }}</td>\r\n                    </tr>\r\n                    <tr v-if=\"row.showDetailsRow && isExpanded(row.order.id)\" :key=\"`${row.order.id}-positions`\">\r\n                        <td colspan=\"26\">\r\n                            <sw-loader v-if=\"isDetailsLoading(row.order.id)\" />\r\n\r\n                            <template v-else>\r\n                            <table class=\"sw-data-grid__table\">\r\n                                <thead>\r\n                                    <tr>\r\n                                        <th>{{ $t('lieferzeiten.table.position') }}</th>\r\n                                        <th>{{ $t('lieferzeiten.table.article') }}</th>\r\n                                        <th>{{ $t('lieferzeiten.table.quantity') }}</th>\r\n                                        <th>{{ $t('lieferzeiten.table.packageNumbers') }}</th>\r\n                                        <th>{{ $t('lieferzeiten.fields.shippingType') }}</th>\r\n                                        <th>{{ $t('lieferzeiten.fields.supplierDate') }}</th>\r\n                                        <th>{{ $t('lieferzeiten.fields.supplierWeek') }}</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody>\r\n                                    <tr v-for=\"position in row.order.positions\" :key=\"position.id\">\r\n                                        <td>{{ displayOrDash(position.number || position.positionNumber) }}</td>\r\n                                        <td>{{ displayOrDash(position.label || position.article) }}</td>\r\n                                        <td>{{ positionQuantityDisplay(position) }}</td>\r\n                                        <td>\r\n                                            <template v-for=\"entry in resolveTrackingEntries(row.order, position)\">\r\n                                                <button\r\n                                                    :key=\"`${position.id}-${entry.number}`\"\r\n                                                    type=\"button\"\r\n                                                    class=\"lieferzeiten-order-table__tracking-link\"\r\n                                                    @click=\"openTrackingHistory(entry)\"\r\n                                                >\r\n                                                    {{ entry.number }}\r\n                                                </button>\r\n                                            </template>\r\n                                        </td>\r\n                                        <td>{{ resolvePackageStatusField(row.order, position) }}</td>\r\n                                        <td>\r\n                                            <sw-datepicker v-model:value=\"position.lieferterminLieferantRange.from\" :disabled=\"!hasEditAccess()\" size=\"small\" />\r\n                                            <sw-datepicker v-model:value=\"position.lieferterminLieferantRange.to\" :disabled=\"!hasEditAccess()\" size=\"small\" />\r\n                                            <sw-button v-if=\"hasEditAccess()\" size=\"small\" variant=\"primary\" :disabled=\"!canSaveLiefertermin(row.order, position)\" @click=\"saveLiefertermin(row.order, position)\">\r\n                                                {{ $t('global.default.save') }}\r\n                                            </sw-button>\r\n                                            <sw-button v-if=\"hasEditAccess()\" size=\"small\" variant=\"ghost\" @click=\"requestAdditionalDeliveryDate(row.order, position.id)\">\r\n                                                {{ $t('lieferzeiten.additionalRequest.button') }}\r\n                                            </sw-button>\r\n                                        </td>\r\n                                        <td>{{ weekLabelFromDate(position.lieferterminLieferantRange.to) }}</td>\r\n                                    </tr>\r\n                                </tbody>\r\n                            </table>\r\n\r\n                            <table class=\"sw-data-grid__table\">\r\n                                <thead>\r\n                                    <tr>\r\n                                        <th>{{ $t('lieferzeiten.table.parcels') }}</th>\r\n                                        <th>{{ $t('lieferzeiten.table.packageStatus') }}</th>\r\n                                        <th>Versand-Datum</th>\r\n                                        <th>Liefer-Datum</th>\r\n                                        <th>{{ $t('lieferzeiten.fields.newDate') }}</th>\r\n                                        <th>{{ $t('lieferzeiten.fields.supplierWeek') }}</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody>\r\n                                    <tr v-for=\"parcel in row.order.parcels\" :key=\"parcel.id\">\r\n                                        <td>{{ displayOrDash(parcel.paketId || parcel.id) }}</td>\r\n                                        <td>{{ displayOrDash(parcel.statusDisplay) }}</td>\r\n                                        <td>{{ displayOrDash(parcel.shippingDateDisplay) }}</td>\r\n                                        <td>{{ displayOrDash(parcel.deliveryDateDisplay) }}</td>\r\n                                        <td>\r\n                                            <sw-datepicker v-model:value=\"parcel.neuerLieferterminRange.from\" :disabled=\"!hasEditAccess() || !parcel.supplierRange.from || !isParcelEditableByStatus(parcel)\" size=\"small\" />\r\n                                            <sw-datepicker v-model:value=\"parcel.neuerLieferterminRange.to\" :disabled=\"!hasEditAccess() || !parcel.supplierRange.to || !isParcelEditableByStatus(parcel)\" size=\"small\" />\r\n                                            <sw-button v-if=\"hasEditAccess()\" size=\"small\" variant=\"primary\" :disabled=\"!canSaveNeuerLiefertermin(parcel)\" @click=\"saveNeuerLiefertermin(row.order, parcel)\">\r\n                                                {{ $t('global.default.save') }}\r\n                                            </sw-button>\r\n                                        </td>\r\n                                        <td>{{ weekLabelFromDate(parcel.neuerLieferterminRange.to) }}</td>\r\n                                    </tr>\r\n                                </tbody>\r\n                            </table>\r\n                            </template>\r\n                        </td>\r\n                    </tr>\r\n                </template>\r\n            </tbody>\r\n        </table>\r\n\r\n\r\n        <div\r\n            v-if=\"showTrackingModal\"\r\n            class=\"lieferzeiten-order-table__tracking-overlay\"\r\n            role=\"dialog\"\r\n            aria-modal=\"true\"\r\n        >\r\n            <div class=\"lieferzeiten-order-table__tracking-dialog\">\r\n                <header class=\"lieferzeiten-order-table__tracking-header\">\r\n                    <h3>\r\n                        Tracking {{ activeTracking && activeTracking.carrier && activeTracking.carrier.toUpperCase() }} / {{ activeTracking && activeTracking.number }}\r\n                    </h3>\r\n                    <button type=\"button\" class=\"lieferzeiten-order-table__tracking-close\" @click=\"closeTrackingModal\">×</button>\r\n                </header>\r\n\r\n                <div class=\"lieferzeiten-order-table__tracking-body\">\r\n                    <div v-if=\"isTrackingLoading\">{{ $t('lieferzeiten.tracking.loading') }}</div>\r\n                    <div v-else-if=\"trackingError\" class=\"lieferzeiten-order-table__tracking-error\">{{ trackingError }}</div>\r\n                    <div v-else-if=\"!trackingEvents.length\">{{ $t('lieferzeiten.tracking.empty') }}</div>\r\n                    <ul v-else class=\"lieferzeiten-order-table__tracking-list\">\r\n                        <li v-for=\"(event, index) in trackingEvents\" :key=\"`${event.timestamp}-${index}`\">\r\n                            <strong>{{ event.status }}</strong>\r\n                            <div>{{ event.label }}</div>\r\n                            <small>{{ event.timestamp }}<span v-if=\"event.location\"> · {{ event.location }}</span></small>\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <sw-empty-state\r\n            v-if=\"displayedOrders.length === 0\"\r\n            :title=\"$t('lieferzeiten.emptyState.title')\"\r\n            :description=\"$t('lieferzeiten.emptyState.description')\"\r\n        />\r\n    </div>\r\n{% endblock %}\r\n","import template from './lieferzeiten-order-table.html.twig';\r\nimport './lieferzeiten-order-table.scss';\r\n\r\nconst BUSINESS_STATUS_SNIPPETS = {\r\n    '1': 'lieferzeiten.businessStatus.1',\r\n    '2': 'lieferzeiten.businessStatus.2',\r\n    '3': 'lieferzeiten.businessStatus.3',\r\n    '4': 'lieferzeiten.businessStatus.4',\r\n    '5': 'lieferzeiten.businessStatus.5',\r\n    '6': 'lieferzeiten.businessStatus.6',\r\n    '7': 'lieferzeiten.businessStatus.7',\r\n    '8': 'lieferzeiten.businessStatus.8',\r\n};\r\n\r\nconst INTERNAL_SHIPPING_LABEL = 'Versand durch First Medical';\r\n\r\nShopware.Component.register('lieferzeiten-order-table', {\r\n    template,\r\n\r\n    mixins: ['notification'],\r\n\r\n    inject: ['lieferzeitenTrackingService', 'lieferzeitenOrdersService', 'acl'],\r\n\r\n    props: {\r\n        orders: {\r\n            type: Array,\r\n            required: true,\r\n            default: () => [],\r\n        },\r\n        onlyOpen: {\r\n            type: Boolean,\r\n            required: false,\r\n            default: false,\r\n        },\r\n        onReloadOrder: {\r\n            type: Function,\r\n            required: false,\r\n            default: null,\r\n        },\r\n        rowMode: {\r\n            type: String,\r\n            required: false,\r\n            default: 'position',\r\n        },\r\n    },\r\n\r\n    data() {\r\n        return {\r\n            expandedOrderIds: [],\r\n            editableOrders: {},\r\n            showTrackingModal: false,\r\n            isTrackingLoading: false,\r\n            trackingError: '',\r\n            trackingEvents: [],\r\n            activeTracking: null,\r\n            statusUpdateLoadingByOrder: {},\r\n            detailsLoadingByOrder: {},\r\n            additionalRequestTaskStatusByPosition: {},\r\n            additionalRequestTaskInitialized: false,\r\n        };\r\n    },\r\n\r\n\r\n    watch: {\r\n        orders: {\r\n            handler(newOrders) {\r\n                this.handleAdditionalDeliveryRequestTaskTransitions(newOrders);\r\n            },\r\n            immediate: true,\r\n        },\r\n    },\r\n\r\n    computed: {\r\n        displayedOrders() {\r\n            return this.orders\r\n                .filter((order) => (this.onlyOpen ? this.isOrderOpen(order) : true))\r\n                .map((order) => this.getEditableOrder(order));\r\n        },\r\n        displayedRows() {\r\n            const aggregatedMode = this.rowMode === 'aggregated';\r\n\r\n            return this.displayedOrders.flatMap((order) => {\r\n                const positions = Array.isArray(order?.positions) ? order.positions : [];\r\n                const baseRows = aggregatedMode || positions.length === 0\r\n                    ? [{ position: null, positionIndex: 0 }]\r\n                    : positions.map((position, positionIndex) => ({ position, positionIndex }));\r\n\r\n                return baseRows.map(({ position, positionIndex }) => {\r\n                    const trackingEntries = position\r\n                        ? this.resolveTrackingEntries(order, position)\r\n                        : this.resolveOrderTrackingEntries(order);\r\n                    const supplierRange = position?.lieferterminLieferantRange || order?.lieferterminLieferantRange || {};\r\n\r\n                    return {\r\n                        key: `${order.id}-${position?.id || `row-${positionIndex}`}`,\r\n                        order,\r\n                        position,\r\n                        showDetailsRow: positionIndex === 0,\r\n                        san6PositionDisplay: position\r\n                            ? this.displayOrDash(this.pickFirstDefined(position, ['number', 'positionNumber', 'san6Position', 'san6Pos']))\r\n                            : order.san6PositionDisplay,\r\n                        quantityDisplay: position ? this.positionQuantityDisplay(position) : order.quantityDisplay,\r\n                        positionsDisplay: position ? '1' : order.positionsCountDisplay,\r\n                        parcelsDisplay: position\r\n                            ? String((Array.isArray(position?.packages) ? position.packages : []).length)\r\n                            : this.parcelSummary(order),\r\n                        trackingEntries,\r\n                        supplierDateDisplay: supplierRange?.from || supplierRange?.to || '-',\r\n                        supplierWeekDisplay: this.weekLabelFromDate(supplierRange?.to),\r\n                        newDateDisplay: position\r\n                            ? this.formatDate(this.pickFirstDefined(position, ['newDeliveryDate', 'neuerLiefertermin']))\r\n                            : this.formatDate(this.pickFirstDefined(order, ['newDeliveryDate', 'neuerLiefertermin'])),\r\n                        packageStatusDisplay: this.resolvePackageStatusField(order, position),\r\n                        shippingLabelDisplay: this.shippingLabel(order),\r\n                    };\r\n                });\r\n            });\r\n        },\r\n        editableBusinessStatuses() {\r\n            return [7, 8].map((status) => ({\r\n                value: String(status),\r\n                label: `${status} · ${this.$t(BUSINESS_STATUS_SNIPPETS[String(status)])}`,\r\n            }));\r\n        },\r\n    },\r\n\r\n    methods: {\r\n\r\n        hasViewAccess() {\r\n            if (typeof this.acl?.can !== 'function') {\r\n                return false;\r\n            }\r\n\r\n            return this.acl.can('lieferzeiten.viewer') || this.acl.can('admin');\r\n        },\r\n\r\n        hasEditAccess() {\r\n            if (typeof this.acl?.can !== 'function') {\r\n                return false;\r\n            }\r\n\r\n            return this.acl.can('lieferzeiten.editor') || this.acl.can('admin');\r\n        },\r\n\r\n        canUpdateOrderStatus(order) {\r\n            return this.hasEditAccess() && !!order?.id;\r\n        },\r\n\r\n        statusOptions() {\r\n            return [7, 8].map((code) => ({\r\n                value: code,\r\n                label: this.$t(BUSINESS_STATUS_SNIPPETS[String(code)]),\r\n            }));\r\n        },\r\n\r\n        statusOptionLabel(code) {\r\n            const snippet = BUSINESS_STATUS_SNIPPETS[String(code)] || 'lieferzeiten.businessStatus.unknown';\r\n            return `${code} · ${this.$t(snippet)}`;\r\n        },\r\n\r\n        resolveBusinessStatus(order) {\r\n            const businessStatus = order?.business_status || order?.businessStatus || null;\r\n            const code = Number(businessStatus?.code ?? order?.status);\r\n\r\n            if (!Number.isInteger(code) || code < 1 || code > 8) {\r\n                return '-';\r\n            }\r\n\r\n            const labelKey = businessStatus?.labelKey || `lieferzeiten.businessStatus.${code}`;\r\n\r\n            return `${code} - ${this.$t(labelKey)}`;\r\n        },\r\n\r\n        isOrderOpen(order) {\r\n            const parcels = Array.isArray(order?.parcels) ? order.parcels : [];\r\n            return parcels.some((parcel) => !parcel.closed);\r\n        },\r\n\r\n        getEditableOrder(order) {\r\n            if (!this.editableOrders[order.id]) {\r\n                const supplierRange = this.resolveInitialRange(order, 'lieferterminLieferant', 14);\r\n                const newRange = this.resolveInitialRange(order, 'neuerLiefertermin', 4);\r\n\r\n                const positions = (order.positions || []).map((position) => ({\r\n                    ...position,\r\n                    lieferterminLieferantRange: { ...supplierRange },\r\n                    originalLieferterminLieferantRange: { ...supplierRange },\r\n                }));\r\n\r\n                const parcels = (order.parcels || []).map((parcel) => {\r\n                    const parcelNewRange = this.resolveParcelInitialRange(parcel, newRange);\r\n\r\n                    return {\r\n                        ...parcel,\r\n                        supplierRange: { ...supplierRange },\r\n                        neuerLieferterminRange: { ...parcelNewRange },\r\n                        originalNeuerLieferterminRange: { ...parcelNewRange },\r\n                        statusDisplay: this.resolveParcelStatus(parcel),\r\n                        shippingDateDisplay: this.resolveParcelShippingDate(parcel),\r\n                        deliveryDateDisplay: this.resolveParcelDeliveryDate(parcel),\r\n                    };\r\n                });\r\n\r\n                const commentTargetPositionId = this.resolveCommentTargetPositionId(positions);\r\n\r\n                this.$set(this.editableOrders, order.id, {\r\n                    ...order,\r\n                    san6OrderNumberDisplay: this.resolveSan6OrderNumber(order),\r\n                    san6PositionDisplay: this.resolveSan6Position(order, positions),\r\n                    quantityDisplay: this.resolveQuantity(order, positions),\r\n                    orderDateDisplay: this.resolveOrderDate(order),\r\n                    paymentMethodDisplay: this.resolvePaymentMethod(order),\r\n                    paymentDateDisplay: this.resolvePaymentDate(order),\r\n                    customerNamesDisplay: this.resolveCustomerNames(order),\r\n                    positionsCountDisplay: positions.length,\r\n                    packageStatusDisplay: this.resolvePackageStatus(order),\r\n                    trackingSummaryDisplay: this.resolveTrackingSummaryDisplay(order),\r\n                    latestShippingDeadlineDisplay: this.formatDateTime(this.resolveDeadlineValue(order, [\r\n                        'latestShippingDeadline',\r\n                        'spaetester_versand',\r\n                        'spaetesterVersand',\r\n                        'latestShippingDate',\r\n                    ])),\r\n                    shippingDateDisplay: this.resolveShippingDate(order),\r\n                    latestDeliveryDeadlineDisplay: this.formatDateTime(this.resolveDeadlineValue(order, [\r\n                        'latestDeliveryDeadline',\r\n                        'spaeteste_lieferung',\r\n                        'spaetesteLieferung',\r\n                        'latestDeliveryDate',\r\n                    ])),\r\n                    deliveryDateDisplay: this.resolveDeliveryDate(order),\r\n                    lieferterminLieferantRange: supplierRange,\r\n                    neuerLieferterminRange: newRange,\r\n                    originalLieferterminLieferantRange: { ...supplierRange },\r\n                    originalNeuerLieferterminRange: { ...newRange },\r\n                    comment: this.resolveInitialComment(order),\r\n                    commentTargetPositionId,\r\n                    additionalDeliveryRequest: order.additionalDeliveryRequest || null,\r\n                    additionalDeliveryRequestTasksByPosition: this.mapAdditionalDeliveryRequestTasksByPosition(positions),\r\n                    latestShippingDeadline: this.resolveDeadlineValue(order, ['spaetester_versand', 'spaetesterVersand', 'latestShippingDeadline']),\r\n                    latestDeliveryDeadline: this.resolveDeadlineValue(order, ['spaeteste_lieferung', 'spaetesteLieferung', 'latestDeliveryDeadline']),\r\n                    selectedManualStatus: [7, 8].includes(Number(order?.status)) ? Number(order.status) : 7,\r\n                });\r\n            }\r\n\r\n            return this.editableOrders[order.id];\r\n        },\r\n\r\n        resolveInitialComment(order) {\r\n            const rawComment = this.pickFirstDefined(order, ['currentComment', 'comment']);\r\n\r\n            if (rawComment === null || rawComment === undefined) {\r\n                return '';\r\n            }\r\n\r\n            return String(rawComment);\r\n        },\r\n\r\n        isOpenPosition(position) {\r\n            const normalized = String(position?.status || '').trim().toLowerCase();\r\n\r\n            if (position?.closed === true) {\r\n                return false;\r\n            }\r\n\r\n            return !['closed', 'done', 'completed', 'shipped', 'delivered', '8'].includes(normalized);\r\n        },\r\n\r\n        resolveCommentTargetPositionId(positions) {\r\n            if (!Array.isArray(positions) || positions.length === 0) {\r\n                return null;\r\n            }\r\n\r\n            const firstOpenPosition = positions.find((position) => this.isOpenPosition(position) && position?.id);\r\n            if (firstOpenPosition?.id) {\r\n                return firstOpenPosition.id;\r\n            }\r\n\r\n            return positions.find((position) => !!position?.id)?.id || null;\r\n        },\r\n\r\n        canSaveComment(order) {\r\n            return this.hasEditAccess() && !!this.getValidCommentTargetPositionId(order);\r\n        },\r\n\r\n        getValidCommentTargetPositionId(order) {\r\n            if (!order || !Array.isArray(order.positions)) {\r\n                return null;\r\n            }\r\n\r\n            const currentTargetPositionId = order.commentTargetPositionId;\r\n            if (currentTargetPositionId\r\n                && order.positions.some((position) => position?.id === currentTargetPositionId)) {\r\n                return currentTargetPositionId;\r\n            }\r\n\r\n            return this.resolveCommentTargetPositionId(order.positions);\r\n        },\r\n\r\n        ensureCommentTargetPositionId(order) {\r\n            const validPositionId = this.getValidCommentTargetPositionId(order);\r\n\r\n            if (order && order.commentTargetPositionId !== validPositionId) {\r\n                this.$set(order, 'commentTargetPositionId', validPositionId);\r\n            }\r\n\r\n            return validPositionId;\r\n        },\r\n\r\n\r\n        resolveParcelInitialRange(parcel, fallbackRange) {\r\n            const from = this.normalizeDate(parcel?.neuerLieferterminFrom || parcel?.neuer_liefertermin_from || parcel?.neuerLiefertermin?.from);\r\n            const to = this.normalizeDate(parcel?.neuerLieferterminTo || parcel?.neuer_liefertermin_to || parcel?.neuerLiefertermin?.to || parcel?.neuerLiefertermin);\r\n\r\n            if (from && to) {\r\n                return { from, to };\r\n            }\r\n\r\n            return { ...fallbackRange };\r\n        },\r\n\r\n        resolveParcelStatus(parcel) {\r\n            const status = String(parcel?.status || '').trim();\r\n\r\n            if (status === '') {\r\n                return parcel?.closed ? this.$t('lieferzeiten.status.closed') : this.$t('lieferzeiten.status.open');\r\n            }\r\n\r\n            return status;\r\n        },\r\n\r\n        isParcelEditableByStatus(parcel) {\r\n            const status = String(parcel?.status || '').trim().toLowerCase();\r\n\r\n            if (parcel?.closed === true) {\r\n                return false;\r\n            }\r\n\r\n            return !['closed', 'done', 'completed', 'shipped', 'delivered', '8'].includes(status);\r\n        },\r\n\r\n        resolveInitialRange(order, fieldPrefix, fallbackMaxDays) {\r\n            const from = this.normalizeDate(order[`${fieldPrefix}From`]);\r\n            const to = this.normalizeDate(order[`${fieldPrefix}To`] || order[fieldPrefix]);\r\n\r\n            if (from && to) {\r\n                return { from, to };\r\n            }\r\n\r\n            const fallbackDays = Number(order[`${fieldPrefix}Days`]);\r\n            if (Number.isInteger(fallbackDays) && fallbackDays >= 1 && fallbackDays <= fallbackMaxDays) {\r\n                return this.buildRangeFromDayOffset(fallbackDays);\r\n            }\r\n\r\n            return { from: null, to: null };\r\n        },\r\n\r\n        normalizeDate(value) {\r\n            if (!value) {\r\n                return null;\r\n            }\r\n\r\n            const date = new Date(value);\r\n            if (Number.isNaN(date.getTime())) {\r\n                return null;\r\n            }\r\n\r\n            return date.toISOString().slice(0, 10);\r\n        },\r\n\r\n        buildRangeFromDayOffset(days) {\r\n            const fromDate = new Date();\r\n            fromDate.setDate(fromDate.getDate() + 1);\r\n            const toDate = new Date();\r\n            toDate.setDate(toDate.getDate() + days);\r\n\r\n            return {\r\n                from: fromDate.toISOString().slice(0, 10),\r\n                to: toDate.toISOString().slice(0, 10),\r\n            };\r\n        },\r\n\r\n        async toggleOrder(orderId) {\r\n            if (this.expandedOrderIds.includes(orderId)) {\r\n                this.expandedOrderIds = this.expandedOrderIds.filter((id) => id !== orderId);\r\n                return;\r\n            }\r\n\r\n            await this.loadOrderDetails(orderId);\r\n\r\n            this.expandedOrderIds = [...this.expandedOrderIds, orderId];\r\n        },\r\n\r\n        hasOrderDetails(order) {\r\n            return Array.isArray(order?.positions)\r\n                && Array.isArray(order?.parcels)\r\n                && Array.isArray(order?.lieferterminLieferantHistory)\r\n                && Array.isArray(order?.neuerLieferterminHistory)\r\n                && Array.isArray(order?.commentHistory);\r\n        },\r\n\r\n        mergeOrderDetails(orderId, details) {\r\n            const source = this.editableOrders[orderId] || this.orders.find((item) => item?.id === orderId);\r\n            if (!source || !details) {\r\n                return;\r\n            }\r\n\r\n            const mergedOrder = {\r\n                ...source,\r\n                ...details,\r\n            };\r\n\r\n            this.$delete(this.editableOrders, orderId);\r\n            const editable = this.getEditableOrder(mergedOrder);\r\n\r\n            this.$set(this.editableOrders, orderId, {\r\n                ...editable,\r\n                lieferterminLieferantHistory: details.lieferterminLieferantHistory || [],\r\n                neuerLieferterminHistory: details.neuerLieferterminHistory || [],\r\n                commentHistory: details.commentHistory || [],\r\n                trackingSummaryDisplay: this.resolveTrackingSummaryDisplay(editable),\r\n            });\r\n\r\n            this.handleAdditionalDeliveryRequestTaskTransitions(Object.values(this.editableOrders));\r\n        },\r\n\r\n        async loadOrderDetails(orderId) {\r\n            if (!orderId) {\r\n                return;\r\n            }\r\n\r\n            const existing = this.editableOrders[orderId] || this.orders.find((order) => order.id === orderId);\r\n            if (this.hasOrderDetails(existing)) {\r\n                return;\r\n            }\r\n\r\n            this.$set(this.detailsLoadingByOrder, orderId, true);\r\n            try {\r\n                const details = await this.lieferzeitenOrdersService.getOrderDetails(orderId);\r\n                this.mergeOrderDetails(orderId, details);\r\n            } catch (error) {\r\n                this.createNotificationError({\r\n                    title: this.$t('global.default.error'),\r\n                    message: error?.response?.data?.message || error?.message || this.$t('global.default.error'),\r\n                });\r\n            } finally {\r\n                this.$set(this.detailsLoadingByOrder, orderId, false);\r\n            }\r\n        },\r\n\r\n        isDetailsLoading(orderId) {\r\n            return this.detailsLoadingByOrder[orderId] === true;\r\n        },\r\n\r\n        isExpanded(orderId) {\r\n            return this.expandedOrderIds.includes(orderId);\r\n        },\r\n\r\n        parcelSummary(order) {\r\n            const parcels = Array.isArray(order?.parcels) ? order.parcels : [];\r\n            const openParcels = parcels.filter((parcel) => !parcel.closed).length;\r\n            return `${openParcels}/${parcels.length}`;\r\n        },\r\n\r\n        displayOrDash(value) {\r\n            if (value === null || value === undefined) {\r\n                return '-';\r\n            }\r\n\r\n            const normalized = String(value).trim();\r\n            return normalized === '' ? '-' : normalized;\r\n        },\r\n\r\n        resolveSan6OrderNumber(order) {\r\n            return this.pickFirstDefined(order, ['san6OrderNumber']);\r\n        },\r\n\r\n        resolveSan6Position(order, positions) {\r\n            if (!positions.length) {\r\n                return this.displayOrDash(this.pickFirstDefined(order, ['san6Position', 'san6Pos']));\r\n            }\r\n\r\n            const values = positions\r\n                .map((position) => this.pickFirstDefined(position, ['number']))\r\n                .filter((value) => value !== null && value !== undefined && String(value).trim() !== '');\r\n\r\n            return values.length ? values.join(', ') : '-';\r\n        },\r\n\r\n        resolveQuantity(order, positions) {\r\n            if (!positions.length) {\r\n                return this.displayOrDash(this.pickFirstDefined(order, ['quantity', 'positionsCount']));\r\n            }\r\n\r\n            const total = positions.reduce((acc, position) => {\r\n                const raw = this.pickFirstDefined(position, ['quantity', 'orderedQuantity', 'menge']);\r\n                const numeric = Number(raw);\r\n                return Number.isFinite(numeric) ? acc + numeric : acc;\r\n            }, 0);\r\n\r\n            return total > 0 ? String(total) : '-';\r\n        },\r\n\r\n        resolveOrderDate(order) {\r\n            return this.formatDate(this.pickFirstDefined(order, ['orderDate']));\r\n        },\r\n\r\n        resolvePaymentMethod(order) {\r\n            return this.pickFirstDefined(order, ['paymentMethod']) || '-';\r\n        },\r\n\r\n        resolvePaymentDate(order) {\r\n            return this.formatDate(this.pickFirstDefined(order, ['paymentDate']));\r\n        },\r\n\r\n        resolveCustomerNames(order) {\r\n            const primaryParts = [\r\n                this.pickFirstDefined(order, ['customerFirstName', 'customer_first_name']),\r\n                this.pickFirstDefined(order, ['customerLastName', 'customer_last_name']),\r\n            ];\r\n\r\n            const additionalParts = [\r\n                this.pickFirstDefined(order, ['customerAdditionalName', 'customer_additional_name']),\r\n                this.pickFirstDefined(order, ['customerNames', 'customer_names']),\r\n            ];\r\n\r\n            const nameParts = [...primaryParts, ...additionalParts]\r\n                .map((value) => (value === null || value === undefined ? '' : String(value).trim()))\r\n                .filter((value) => value !== '');\r\n\r\n            if (nameParts.length > 0) {\r\n                return nameParts.join(' ');\r\n            }\r\n\r\n            return this.pickFirstDefined(order, ['customerEmail', 'customer_email']) || '-';\r\n        },\r\n\r\n        resolveDeadlineValue(order, keys) {\r\n            const value = keys.map((key) => order[key]).find((candidate) => candidate);\r\n\r\n            if (!value) {\r\n                return null;\r\n            }\r\n\r\n            const date = new Date(value);\r\n            if (Number.isNaN(date.getTime())) {\r\n                return null;\r\n            }\r\n\r\n            return date.toISOString();\r\n        },\r\n\r\n        resolvePackageStatus(order) {\r\n            const rawStatus = this.pickFirstDefined(order, ['packageStatus', 'status']);\r\n\r\n            if (!rawStatus || String(rawStatus).trim() === '') {\r\n                return null;\r\n            }\r\n\r\n            const normalized = String(rawStatus).trim();\r\n            const labels = {\r\n                open: this.$t('lieferzeiten.status.open'),\r\n                closed: this.$t('lieferzeiten.status.closed'),\r\n                pending: 'Pending',\r\n                shipped: 'Shipped',\r\n                delivered: 'Delivered',\r\n            };\r\n\r\n            return labels[normalized.toLowerCase()] || normalized;\r\n        },\r\n\r\n        resolveLatestShippingAt(order) {\r\n            return this.formatDateTime(this.pickFirstDefined(order, ['latestShippingDate']));\r\n        },\r\n\r\n        resolveShippingDate(order) {\r\n            return this.formatDate(this.pickFirstDefined(order, ['shippingDate', 'businessDateFrom']));\r\n        },\r\n\r\n        resolveParcelShippingDate(parcel) {\r\n            return this.formatDate(this.pickFirstDefined(parcel, ['shippingDate', 'shipping_date']));\r\n        },\r\n\r\n        resolveLatestDeliveryAt(order) {\r\n            return this.formatDateTime(this.pickFirstDefined(order, ['latestDeliveryDate']));\r\n        },\r\n\r\n        resolveDeliveryDate(order) {\r\n            return this.formatDate(this.pickFirstDefined(order, ['deliveryDate', 'businessDateTo', 'calculatedDeliveryDate']));\r\n        },\r\n\r\n        resolveParcelDeliveryDate(parcel) {\r\n            return this.formatDate(this.pickFirstDefined(parcel, ['deliveryDate', 'delivery_date']));\r\n        },\r\n\r\n        pickFirstDefined(source, keys) {\r\n            if (!source || !Array.isArray(keys)) {\r\n                return null;\r\n            }\r\n\r\n            for (const key of keys) {\r\n                if (Object.prototype.hasOwnProperty.call(source, key) && source[key] !== null && source[key] !== undefined) {\r\n                    return source[key];\r\n                }\r\n            }\r\n\r\n            return null;\r\n        },\r\n\r\n        formatDate(value) {\r\n            if (!value) {\r\n                return '-';\r\n            }\r\n\r\n            const date = new Date(value);\r\n            if (Number.isNaN(date.getTime())) {\r\n                return '-';\r\n            }\r\n\r\n            return date.toLocaleDateString('de-DE', { timeZone: 'Europe/Berlin' });\r\n        },\r\n\r\n        formatDateTime(value) {\r\n            if (!value) {\r\n                return null;\r\n            }\r\n\r\n            const date = new Date(value);\r\n            if (Number.isNaN(date.getTime())) {\r\n                return null;\r\n            }\r\n\r\n            return date.toLocaleString('de-DE', {\r\n                timeZone: 'Europe/Berlin',\r\n                year: 'numeric',\r\n                month: '2-digit',\r\n                day: '2-digit',\r\n                hour: '2-digit',\r\n                minute: '2-digit',\r\n            });\r\n        },\r\n\r\n        formatHistoryEntry(entry) {\r\n            if (typeof entry === 'string') {\r\n                return entry;\r\n            }\r\n\r\n            if (!entry || typeof entry !== 'object') {\r\n                return '-';\r\n            }\r\n\r\n            const actor = String(entry.lastChangedBy || entry.user || entry.actor || 'system').trim() || 'system';\r\n            const changedAt = this.formatDateTime(entry.lastChangedAt || entry.createdAt || entry.timestamp || null);\r\n\r\n            if (entry.label) {\r\n                return changedAt ? `${entry.label}: ${actor} · ${changedAt}` : `${entry.label}: ${actor}`;\r\n            }\r\n\r\n            return changedAt ? `${actor} · ${changedAt}` : actor;\r\n        },\r\n\r\n        resolveAuditDisplay(order) {\r\n            if (!order || typeof order !== 'object') {\r\n                return '-';\r\n            }\r\n\r\n            const actor = String(order.lastChangedBy || order.user || '').trim();\r\n            const changedAt = this.formatDateTime(order.lastChangedAt || order.updatedAt || order.currentUpdatedAt || null);\r\n\r\n            if (actor && changedAt) {\r\n                return `${actor} · ${changedAt}`;\r\n            }\r\n\r\n            if (actor) {\r\n                return actor;\r\n            }\r\n\r\n            if (changedAt) {\r\n                return changedAt;\r\n            }\r\n\r\n            return order.audit || '-';\r\n        },\r\n\r\n        resolveTrackingEntries(order, position) {\r\n            const fallbackCarrier = String(position.trackingCarrier || order.trackingCarrier || '').toLowerCase();\r\n\r\n            if (Array.isArray(position?.trackingEntries) && position.trackingEntries.length > 0) {\r\n                return position.trackingEntries.map((entry) => ({\r\n                    number: String(entry?.number || '').trim(),\r\n                    carrier: String(entry?.carrier || fallbackCarrier).trim().toLowerCase(),\r\n                })).filter((entry) => entry.number !== '');\r\n            }\r\n\r\n            const carrier = fallbackCarrier;\r\n            const packageEntries = Array.isArray(position.packages) ? position.packages : [];\r\n            const fallbackPackages = packageEntries.length === 0\r\n                ? [position.sendenummer || order.sendenummer || '']\r\n                : packageEntries;\r\n\r\n            return fallbackPackages.map((pkg) => {\r\n                if (typeof pkg === 'string') {\r\n                    const number = String(pkg || '').trim();\r\n                    if (number.toLowerCase() === INTERNAL_SHIPPING_LABEL.toLowerCase()) {\r\n                        return { number, carrier: 'internal', isInternal: true };\r\n                    }\r\n\r\n                    return { number, carrier };\r\n                }\r\n\r\n                const number = String(pkg?.number || '').trim();\r\n                if (number.toLowerCase() === INTERNAL_SHIPPING_LABEL.toLowerCase()) {\r\n                    return { number, carrier: 'internal', isInternal: true };\r\n                }\r\n\r\n                return {\r\n                    number,\r\n                    carrier: String(pkg?.carrier || carrier).toLowerCase(),\r\n                };\r\n            }).filter((entry) => entry.number !== '');\r\n        },\r\n\r\n\r\n        resolveOrderTrackingEntries(order) {\r\n            const positions = Array.isArray(order?.positions) ? order.positions : [];\r\n            const entries = positions.flatMap((position) => this.resolveTrackingEntries(order, position));\r\n\r\n            if (entries.length === 0) {\r\n                const fallbackEntry = this.resolveTrackingEntries(order, {\r\n                    packages: [order?.sendenummer || ''],\r\n                    trackingCarrier: order?.trackingCarrier,\r\n                });\r\n\r\n                if (fallbackEntry.length > 0) {\r\n                    entries.push(...fallbackEntry);\r\n                }\r\n            }\r\n\r\n            if (entries.length === 0 && this.isInternalShippingMode(order)) {\r\n                entries.push({ number: INTERNAL_SHIPPING_LABEL, carrier: 'internal', isInternal: true });\r\n            }\r\n\r\n            const seen = new Set();\r\n\r\n            return entries.filter((entry) => {\r\n                const key = `${entry.carrier}-${entry.number}`;\r\n\r\n                if (seen.has(key)) {\r\n                    return false;\r\n                }\r\n\r\n                seen.add(key);\r\n                return true;\r\n            });\r\n        },\r\n\r\n        resolveTrackingSummaryDisplay(order) {\r\n            const entries = this.resolveOrderTrackingEntries(order)\r\n                .filter((entry) => ['dhl', 'gls'].includes(entry.carrier));\r\n\r\n            if (entries.length > 0) {\r\n                return entries.map((entry) => entry.number).join(', ');\r\n            }\r\n\r\n            if (this.isInternalShippingMode(order)) {\r\n                return INTERNAL_SHIPPING_LABEL;\r\n            }\r\n\r\n            return '-';\r\n        },\r\n\r\n        isInternalShippingMode(order) {\r\n            const candidates = [\r\n                order?.shippingMode,\r\n                order?.shipping_mode,\r\n                order?.shippingType,\r\n                order?.shipping_type,\r\n                order?.shippingMethod,\r\n                order?.shipping_method,\r\n                order?.versandart,\r\n                order?.versandArt,\r\n                order?.versand_art,\r\n            ].filter((value) => value !== null && value !== undefined);\r\n\r\n            if (order?.internalShipping === true || order?.isInternalShipping === true) {\r\n                return true;\r\n            }\r\n\r\n            return candidates.some((value) => {\r\n                const normalized = String(value).toLowerCase();\r\n                return normalized.includes('internal')\r\n                    || normalized.includes('intern')\r\n                    || normalized.includes('first medical')\r\n                    || normalized.includes('hausversand');\r\n            });\r\n        },\r\n\r\n        async openTrackingHistory(entry) {\r\n            if (entry?.isInternal) {\r\n                this.activeTracking = entry;\r\n                this.trackingError = this.$t('lieferzeiten.tracking.internalShipmentInfo');\r\n                this.trackingEvents = [];\r\n                this.isTrackingLoading = false;\r\n                this.showTrackingModal = true;\r\n\r\n                return;\r\n            }\r\n\r\n            if (!entry?.number || !entry?.carrier) {\r\n                this.trackingError = this.$t('lieferzeiten.tracking.missingCarrier');\r\n                this.showTrackingModal = true;\r\n                return;\r\n            }\r\n\r\n            this.activeTracking = entry;\r\n            this.showTrackingModal = true;\r\n            this.isTrackingLoading = true;\r\n            this.trackingError = '';\r\n            this.trackingEvents = [];\r\n\r\n            try {\r\n                const response = await this.lieferzeitenTrackingService.history(entry.carrier, entry.number);\r\n                if (response?.ok === false) {\r\n                    this.trackingError = response?.message || this.$t('lieferzeiten.tracking.loadError');\r\n                    return;\r\n                }\r\n                this.trackingEvents = Array.isArray(response?.events) ? response.events : [];\r\n            } catch (error) {\r\n                this.trackingError = error?.response?.data?.message || error?.message || this.$t('lieferzeiten.tracking.loadError');\r\n            } finally {\r\n                this.isTrackingLoading = false;\r\n            }\r\n        },\r\n\r\n        closeTrackingModal() {\r\n            this.showTrackingModal = false;\r\n            this.isTrackingLoading = false;\r\n            this.trackingError = '';\r\n            this.trackingEvents = [];\r\n            this.activeTracking = null;\r\n        },\r\n\r\n\r\n        resolveLastChangedBy(order) {\r\n            const changedBy = this.pickFirstDefined(order, ['lastChangedBy', 'user']);\r\n\r\n            return changedBy ? String(changedBy).trim() : null;\r\n        },\r\n\r\n        resolveBusinessStatusDisplay(order) {\r\n            const businessStatus = order?.business_status || order?.businessStatus || null;\r\n            const statusCode = String(businessStatus?.code || order?.status || '').trim();\r\n            const statusLabel = String(\r\n                businessStatus?.label\r\n                || order?.business_status_label\r\n                || order?.statusLabel\r\n                || '',\r\n            ).trim();\r\n\r\n            if (!statusCode && !statusLabel) {\r\n                return null;\r\n            }\r\n\r\n            if (!statusCode) {\r\n                return statusLabel;\r\n            }\r\n\r\n            if (!statusLabel) {\r\n                return statusCode;\r\n            }\r\n\r\n            return `${statusCode} · ${statusLabel}`;\r\n        },\r\n\r\n        businessStatusLabel(order) {\r\n            const statusCode = String(order?.businessStatus?.code || order?.status || '').trim();\r\n            const snippetKey = BUSINESS_STATUS_SNIPPETS[statusCode] || 'lieferzeiten.businessStatus.unknown';\r\n            const fallbackLabel = String(order?.businessStatus?.label || '').trim();\r\n            const translatedLabel = this.$t(snippetKey);\r\n            const resolvedLabel = translatedLabel === snippetKey ? (fallbackLabel || this.$t('lieferzeiten.businessStatus.unknown')) : translatedLabel;\r\n\r\n            return `${statusCode || '-'} · ${resolvedLabel}`;\r\n        },\r\n\r\n        resolveEditableBusinessStatus(order) {\r\n            const statusCode = Number(order?.businessStatus?.code ?? order?.status ?? 0);\r\n\r\n            if (statusCode === 7 || statusCode === 8) {\r\n                return String(statusCode);\r\n            }\r\n\r\n            return null;\r\n        },\r\n\r\n        canSaveBusinessStatus(order) {\r\n            if (!this.hasEditAccess()) {\r\n                return false;\r\n            }\r\n\r\n            const nextStatus = Number(order?.selectedBusinessStatus || 0);\r\n            if (![7, 8].includes(nextStatus)) {\r\n                return false;\r\n            }\r\n\r\n            const currentStatus = Number(order?.businessStatus?.code ?? order?.status ?? 0);\r\n\r\n            return nextStatus !== currentStatus;\r\n        },\r\n\r\n        async saveBusinessStatus(order) {\r\n            if (!this.hasEditAccess()) {\r\n                return;\r\n            }\r\n\r\n            const paketId = order?.id || null;\r\n            const status = Number(order?.selectedBusinessStatus || 0);\r\n            if (!paketId || ![7, 8].includes(status)) {\r\n                this.createNotificationError({\r\n                    title: this.$t('global.default.error'),\r\n                    message: this.$t('lieferzeiten.statusChange.invalidSelection'),\r\n                });\r\n                return;\r\n            }\r\n\r\n            try {\r\n                await this.lieferzeitenOrdersService.updateOrderStatus(paketId, status);\r\n                this.createNotificationSuccess({\r\n                    title: this.$t('global.default.success'),\r\n                    message: this.$t('lieferzeiten.statusChange.saved'),\r\n                });\r\n                await this.reloadOrder(order);\r\n            } catch (error) {\r\n                this.createNotificationError({\r\n                    title: this.$t('global.default.error'),\r\n                    message: error?.response?.data?.message || error?.message || this.$t('global.default.error'),\r\n                });\r\n            }\r\n        },\r\n\r\n        resolvePackageStatusField(order, position = null) {\r\n            const shippingType = this.normalizeShippingType(order?.shippingAssignmentType || order?.versandart);\r\n            const orderedQuantity = this.parseQuantity(position?.orderedQuantity);\r\n            const shippedQuantity = this.parseQuantity(position?.shippedQuantity);\r\n\r\n            if (shippingType === 'unknown') {\r\n                return this.$t('lieferzeiten.shipping.unclear');\r\n            }\r\n\r\n            if (shippingType === 'gesamt') {\r\n                return this.$t('lieferzeiten.shipping.completeShipment');\r\n            }\r\n\r\n            if (shippingType === 'teil') {\r\n                return `${this.$t('lieferzeiten.shipping.partialShipment')} ${this.positionQuantitySuffix(shippedQuantity, orderedQuantity)}`;\r\n            }\r\n\r\n            if (shippingType === 'trennung') {\r\n                return `${this.$t('lieferzeiten.shipping.splitPosition')} ${this.positionQuantitySuffix(shippedQuantity, orderedQuantity)}`;\r\n            }\r\n\r\n            return this.$t('lieferzeiten.shipping.unclear');\r\n        },\r\n\r\n        shippingLabel(order) {\r\n            const shippingType = this.normalizeShippingType(order?.shippingAssignmentType || order?.versandart);\r\n\r\n            if (shippingType === 'gesamt') {\r\n                return this.$t('lieferzeiten.shipping.complete');\r\n            }\r\n\r\n            if (shippingType === 'teil') {\r\n                return this.$t('lieferzeiten.shipping.partial');\r\n            }\r\n\r\n            if (shippingType === 'trennung') {\r\n                return this.$t('lieferzeiten.shipping.split');\r\n            }\r\n\r\n            return this.$t('lieferzeiten.shipping.unclear');\r\n        },\r\n\r\n        normalizeShippingType(value) {\r\n            const normalized = String(value || '').trim().toLowerCase();\r\n\r\n            if (normalized === '') {\r\n                return 'unknown';\r\n            }\r\n\r\n            if (['gesamt', 'complete', 'all_in_one', 'full'].includes(normalized)) {\r\n                return 'gesamt';\r\n            }\r\n\r\n            if (['teil', 'partial', 'teillieferung', 'partial_shipment'].includes(normalized)) {\r\n                return 'teil';\r\n            }\r\n\r\n            if (['trennung', 'split', 'split_position'].includes(normalized)) {\r\n                return 'trennung';\r\n            }\r\n\r\n            return normalized;\r\n        },\r\n\r\n        parseQuantity(value) {\r\n            if (value === null || value === undefined || value === '') {\r\n                return null;\r\n            }\r\n\r\n            const numeric = Number(value);\r\n            if (!Number.isFinite(numeric) || numeric < 0) {\r\n                return null;\r\n            }\r\n\r\n            return Math.round(numeric);\r\n        },\r\n\r\n        positionQuantitySuffix(shippedQuantity, orderedQuantity) {\r\n            const shipped = shippedQuantity ?? 0;\r\n            const ordered = orderedQuantity ?? 0;\r\n\r\n            return `${shipped}/${ordered} ${this.$t('lieferzeiten.shipping.pieces')}`;\r\n        },\r\n\r\n        positionQuantityDisplay(position) {\r\n            const orderedQuantity = this.parseQuantity(position?.orderedQuantity);\r\n            const shippedQuantity = this.parseQuantity(position?.shippedQuantity);\r\n\r\n            if (orderedQuantity !== null || shippedQuantity !== null) {\r\n                return this.positionQuantitySuffix(shippedQuantity, orderedQuantity);\r\n            }\r\n\r\n            const fallbackQuantity = this.pickFirstDefined(position, ['quantity', 'menge']);\r\n\r\n            return this.displayOrDash(fallbackQuantity);\r\n        },\r\n\r\n        rangeToDays(range) {\r\n            if (!range?.from || !range?.to) {\r\n                return null;\r\n            }\r\n\r\n            const from = new Date(range.from);\r\n            const to = new Date(range.to);\r\n            if (Number.isNaN(from.getTime()) || Number.isNaN(to.getTime())) {\r\n                return null;\r\n            }\r\n\r\n            return Math.floor((to.getTime() - from.getTime()) / 86400000) + 1;\r\n        },\r\n\r\n        isRangeValid(range, minDays, maxDays) {\r\n            const days = this.rangeToDays(range);\r\n            return Number.isInteger(days) && days >= minDays && days <= maxDays;\r\n        },\r\n\r\n        isRangeChanged(range, originalRange) {\r\n            return (range?.from || null) !== (originalRange?.from || null)\r\n                || (range?.to || null) !== (originalRange?.to || null);\r\n        },\r\n\r\n        hasValidNeuerLieferterminRange(order) {\r\n            return Array.isArray(order?.parcels)\r\n                && order.parcels.some((parcel) => this.isRangeValid(parcel.neuerLieferterminRange, 1, 4));\r\n        },\r\n\r\n        canSaveLiefertermin(order, target) {\r\n            return this.isRangeValid(target.lieferterminLieferantRange, 1, 14)\r\n                && this.isRangeChanged(target.lieferterminLieferantRange, target.originalLieferterminLieferantRange)\r\n                && this.hasValidNeuerLieferterminRange(order);\r\n        },\r\n\r\n        canSaveNeuerLiefertermin(target) {\r\n            const supplierRange = target.supplierRange;\r\n            const newRange = target.neuerLieferterminRange;\r\n\r\n            if (!this.isParcelEditableByStatus(target)\r\n                || !this.isRangeValid(supplierRange, 1, 14)\r\n                || !this.isRangeValid(newRange, 1, 4)\r\n                || !this.isRangeChanged(newRange, target.originalNeuerLieferterminRange)) {\r\n                return false;\r\n            }\r\n\r\n            return newRange.from >= supplierRange.from && newRange.to <= supplierRange.to;\r\n        },\r\n\r\n\r\n\r\n        resolveConcurrencyToken(order) {\r\n            return order.updatedAt || order.lastChangedAt || order.currentUpdatedAt || null;\r\n        },\r\n\r\n        applyConflictRefresh(order, refresh) {\r\n            if (!refresh || refresh.exists === false) {\r\n                return;\r\n            }\r\n\r\n            if (refresh.updatedAt) {\r\n                order.updatedAt = refresh.updatedAt;\r\n            }\r\n            if (refresh.lastChangedAt) {\r\n                order.lastChangedAt = refresh.lastChangedAt;\r\n            }\r\n            if (Object.prototype.hasOwnProperty.call(refresh, 'comment')) {\r\n                order.comment = refresh.comment || '';\r\n            }\r\n\r\n            if (refresh.lieferterminLieferant) {\r\n                order.lieferterminLieferantRange = {\r\n                    from: refresh.lieferterminLieferant.from || null,\r\n                    to: refresh.lieferterminLieferant.to || null,\r\n                };\r\n                order.originalLieferterminLieferantRange = { ...order.lieferterminLieferantRange };\r\n            }\r\n\r\n            if (refresh.neuerLiefertermin) {\r\n                order.neuerLieferterminRange = {\r\n                    from: refresh.neuerLiefertermin.from || null,\r\n                    to: refresh.neuerLiefertermin.to || null,\r\n                };\r\n                order.originalNeuerLieferterminRange = { ...order.neuerLieferterminRange };\r\n            }\r\n        },\r\n\r\n        handleConflictError(error, order) {\r\n            const data = error?.response?.data;\r\n            if (data?.code !== 'CONCURRENT_MODIFICATION') {\r\n                return false;\r\n            }\r\n\r\n            this.applyConflictRefresh(order, data?.refresh || null);\r\n            this.createNotificationWarning({\r\n                title: this.$t('global.default.warning'),\r\n                message: data?.message || 'Conflit d’édition détecté. Ligne rafraîchie, veuillez réappliquer vos modifications.',\r\n            });\r\n\r\n            return true;\r\n        },\r\n        weekLabelFromDate(dateValue) {\r\n            if (!dateValue) {\r\n                return '-';\r\n            }\r\n\r\n            const base = new Date(dateValue);\r\n            if (Number.isNaN(base.getTime())) {\r\n                return '-';\r\n            }\r\n\r\n            const date = new Date(Date.UTC(base.getFullYear(), base.getMonth(), base.getDate()));\r\n            const dayNum = date.getUTCDay() || 7;\r\n            date.setUTCDate(date.getUTCDate() + 4 - dayNum);\r\n            const yearStart = new Date(Date.UTC(date.getUTCFullYear(), 0, 1));\r\n            const week = Math.ceil((((date - yearStart) / 86400000) + 1) / 7);\r\n\r\n            return `KW ${week}`;\r\n        },\r\n\r\n        async saveLiefertermin(order, position) {\r\n            if (!this.hasEditAccess()) {\r\n                return;\r\n            }\r\n\r\n            if (!this.canSaveLiefertermin(order, position)) {\r\n                this.createNotificationWarning({\r\n                    title: this.$t('global.default.warning'),\r\n                    message: this.$t('lieferzeiten.validation.supplierSaveRequiresCombinedRange'),\r\n                });\r\n\r\n                return;\r\n            }\r\n\r\n            const positionId = position?.id || null;\r\n            if (!positionId) {\r\n                this.createNotificationError({ title: this.$t('global.default.error'), message: 'Missing position id' });\r\n                return;\r\n            }\r\n\r\n            try {\r\n                await this.lieferzeitenOrdersService.updateLieferterminLieferant(positionId, {\r\n                    from: position.lieferterminLieferantRange.from,\r\n                    to: position.lieferterminLieferantRange.to,\r\n                    updatedAt: this.resolveConcurrencyToken(order),\r\n                });\r\n                this.createNotificationSuccess({ title: this.$t('global.default.success'), message: this.$t('lieferzeiten.audit.savedSupplierDate') });\r\n                await this.reloadOrder(order);\r\n            } catch (error) {\r\n                if (this.handleConflictError(error, order)) {\r\n                    return;\r\n                }\r\n\r\n                this.createNotificationError({\r\n                    title: this.$t('global.default.error'),\r\n                    message: error?.response?.data?.message || error?.message || this.$t('global.default.error'),\r\n                });\r\n            }\r\n        },\r\n\r\n        async saveNeuerLiefertermin(order, parcel) {\r\n            if (!this.hasEditAccess() || !this.canSaveNeuerLiefertermin(parcel)) {\r\n                return;\r\n            }\r\n\r\n            const paketId = parcel?.id || null;\r\n            if (!paketId) {\r\n                this.createNotificationError({ title: this.$t('global.default.error'), message: 'Missing paket id' });\r\n                return;\r\n            }\r\n\r\n            try {\r\n                await this.lieferzeitenOrdersService.updateNeuerLieferterminByPaket(paketId, {\r\n                    from: parcel.neuerLieferterminRange.from,\r\n                    to: parcel.neuerLieferterminRange.to,\r\n                    updatedAt: this.resolveConcurrencyToken(order),\r\n                });\r\n                this.createNotificationSuccess({ title: this.$t('global.default.success'), message: this.$t('lieferzeiten.audit.savedNewDate') });\r\n                await this.reloadOrder(order);\r\n            } catch (error) {\r\n                if (this.handleConflictError(error, order)) {\r\n                    return;\r\n                }\r\n\r\n                this.createNotificationError({\r\n                    title: this.$t('global.default.error'),\r\n                    message: error?.response?.data?.message || error?.message || this.$t('global.default.error'),\r\n                });\r\n            }\r\n        },\r\n\r\n        async saveComment(order) {\r\n            if (!this.canSaveComment(order)) {\r\n                return;\r\n            }\r\n\r\n            const positionId = this.ensureCommentTargetPositionId(order);\r\n\r\n            if (!positionId) {\r\n                this.createNotificationError({ title: this.$t('global.default.error'), message: 'Missing position id' });\r\n                return;\r\n            }\r\n\r\n            try {\r\n                await this.lieferzeitenOrdersService.updateComment(positionId, {\r\n                    comment: order.comment || '',\r\n                    updatedAt: this.resolveConcurrencyToken(order),\r\n                });\r\n                this.createNotificationSuccess({ title: this.$t('global.default.success'), message: this.$t('lieferzeiten.audit.savedComment') });\r\n                await this.reloadOrder(order);\r\n            } catch (error) {\r\n                if (this.handleConflictError(error, order)) {\r\n                    return;\r\n                }\r\n\r\n                this.createNotificationError({\r\n                    title: this.$t('global.default.error'),\r\n                    message: error?.response?.data?.message || error?.message || this.$t('global.default.error'),\r\n                });\r\n            }\r\n        },\r\n\r\n        async requestAdditionalDeliveryDate(order, positionId) {\r\n            if (!this.hasEditAccess()) {\r\n                return;\r\n            }\r\n\r\n            if (!positionId) {\r\n                this.createNotificationError({ title: this.$t('global.default.error'), message: 'Missing position id' });\r\n                return;\r\n            }\r\n\r\n            const initiator = this.resolveAdditionalRequestInitiator();\r\n\r\n            try {\r\n                await this.lieferzeitenOrdersService.createAdditionalDeliveryRequest(positionId, initiator);\r\n                this.createNotificationSuccess({\r\n                    title: this.$t('lieferzeiten.additionalRequest.notificationTitle'),\r\n                    message: this.$t('lieferzeiten.additionalRequest.notificationRequested', {\r\n                        initiator: initiator?.display || this.$t('lieferzeiten.additionalRequest.defaultInitiator'),\r\n                    }),\r\n                });\r\n\r\n                await this.reloadOrder(order);\r\n            } catch (error) {\r\n                this.createNotificationError({\r\n                    title: this.$t('global.default.error'),\r\n                    message: error?.response?.data?.message || error?.message || this.$t('global.default.error'),\r\n                });\r\n            }\r\n        },\r\n\r\n\r\n        async saveOrderStatus(order) {\r\n            if (!this.canUpdateOrderStatus(order)) {\r\n                return;\r\n            }\r\n\r\n            const targetStatus = Number(order.selectedManualStatus);\r\n            if (![7, 8].includes(targetStatus)) {\r\n                this.createNotificationError({\r\n                    title: this.$t('global.default.error'),\r\n                    message: this.$t('lieferzeiten.status.manual.invalid'),\r\n                });\r\n                return;\r\n            }\r\n\r\n            this.$set(this.statusUpdateLoadingByOrder, order.id, true);\r\n\r\n            try {\r\n                await this.lieferzeitenOrdersService.updatePaketStatus(order.id, {\r\n                    status: targetStatus,\r\n                    updatedAt: this.resolveConcurrencyToken(order),\r\n                });\r\n\r\n                this.createNotificationSuccess({\r\n                    title: this.$t('global.default.success'),\r\n                    message: this.$t('lieferzeiten.status.manual.updated', { status: targetStatus }),\r\n                });\r\n\r\n                await this.reloadOrder(order);\r\n            } catch (error) {\r\n                if (this.handleConflictError(error, order)) {\r\n                    return;\r\n                }\r\n\r\n                this.createNotificationError({\r\n                    title: this.$t('global.default.error'),\r\n                    message: error?.response?.data?.message || error?.message || this.$t('global.default.error'),\r\n                });\r\n            } finally {\r\n                this.$set(this.statusUpdateLoadingByOrder, order.id, false);\r\n            }\r\n        },\r\n\r\n        mapAdditionalDeliveryRequestTasksByPosition(positions) {\r\n            if (!Array.isArray(positions) || positions.length === 0) {\r\n                return {};\r\n            }\r\n\r\n            return positions.reduce((accumulator, position) => {\r\n                if (!position?.id) {\r\n                    return accumulator;\r\n                }\r\n\r\n                accumulator[position.id] = position.additionalDeliveryRequestTask || null;\r\n                return accumulator;\r\n            }, {});\r\n        },\r\n\r\n        extractAdditionalDeliveryRequestTaskStatusByPosition(orders) {\r\n            const result = {};\r\n            const normalizedOrders = Array.isArray(orders) ? orders : [];\r\n\r\n            normalizedOrders.forEach((order) => {\r\n                const positions = Array.isArray(order?.positions) ? order.positions : [];\r\n                positions.forEach((position) => {\r\n                    if (!position?.id) {\r\n                        return;\r\n                    }\r\n\r\n                    const task = position.additionalDeliveryRequestTask;\r\n                    if (!task || typeof task !== 'object') {\r\n                        return;\r\n                    }\r\n\r\n                    result[position.id] = {\r\n                        status: typeof task.status === 'string' ? task.status.trim().toLowerCase() : null,\r\n                        closedAt: task.closedAt || null,\r\n                        initiator: task.initiator || null,\r\n                    };\r\n                });\r\n            });\r\n\r\n            return result;\r\n        },\r\n\r\n        isAdditionalDeliveryRequestTaskClosed(status) {\r\n            return ['done', 'cancelled'].includes(String(status || '').trim().toLowerCase());\r\n        },\r\n\r\n        handleAdditionalDeliveryRequestTaskTransitions(orders) {\r\n            const currentStatusByPosition = this.extractAdditionalDeliveryRequestTaskStatusByPosition(orders);\r\n\r\n            if (!this.additionalRequestTaskInitialized) {\r\n                this.additionalRequestTaskStatusByPosition = currentStatusByPosition;\r\n                this.additionalRequestTaskInitialized = true;\r\n                return;\r\n            }\r\n\r\n            Object.entries(currentStatusByPosition).forEach(([positionId, currentTask]) => {\r\n                const previousTask = this.additionalRequestTaskStatusByPosition[positionId] || null;\r\n                const movedToClosed = previousTask\r\n                    && !this.isAdditionalDeliveryRequestTaskClosed(previousTask.status)\r\n                    && this.isAdditionalDeliveryRequestTaskClosed(currentTask.status);\r\n\r\n                if (!movedToClosed) {\r\n                    return;\r\n                }\r\n\r\n                this.createNotificationInfo({\r\n                    title: this.$t('lieferzeiten.additionalRequest.notificationTitle'),\r\n                    message: this.$t('lieferzeiten.additionalRequest.notificationClosed', {\r\n                        initiator: currentTask.initiator || this.$t('lieferzeiten.additionalRequest.defaultInitiator'),\r\n                    }),\r\n                });\r\n            });\r\n\r\n            this.additionalRequestTaskStatusByPosition = currentStatusByPosition;\r\n        },\r\n\r\n        resolveAdditionalRequestInitiator() {\r\n            const contextUser = Shopware?.Context?.api?.user || null;\r\n            const sessionUser = Shopware?.Store?.get?.('session')?.currentUser || Shopware?.State?.get?.('session')?.currentUser || null;\r\n            const user = contextUser || sessionUser;\r\n\r\n            const userId = typeof user?.id === 'string' ? user.id.trim() : '';\r\n            const fullName = [user?.firstName, user?.lastName]\r\n                .filter((part) => typeof part === 'string' && part.trim() !== '')\r\n                .join(' ')\r\n                .trim();\r\n            const readableName = fullName || String(user?.username || user?.email || '').trim();\r\n\r\n            if (!userId && !readableName) {\r\n                return null;\r\n            }\r\n\r\n            return {\r\n                userId: userId || null,\r\n                display: readableName || this.$t('lieferzeiten.additionalRequest.defaultInitiator'),\r\n            };\r\n        },\r\n\r\n        async reloadOrder(order) {\r\n            if (typeof this.onReloadOrder === 'function') {\r\n                await this.onReloadOrder(order);\r\n                return;\r\n            }\r\n\r\n        },\r\n    },\r\n});\r\n","import './page/lieferzeiten-index';\r\nimport './page/lieferzeiten-all';\r\nimport './page/lieferzeiten-open';\r\nimport './page/lieferzeiten-statistics';\r\nimport './component/lieferzeiten-domain-selection';\r\nimport './component/lieferzeiten-order-table';\r\n\r\nconst { Module } = Shopware;\r\n\r\nModule.register('lieferzeiten', {\r\n    type: 'plugin',\r\n    name: 'lieferzeiten',\r\n    title: 'lieferzeiten.general.mainMenuItemGeneral',\r\n    description: 'lieferzeiten.general.description',\r\n    color: '#2B8CBF',\r\n    icon: 'regular-clock',\r\n\r\n    privileges: {\r\n        viewer: {\r\n            permissions: ['admin'],\r\n            dependencies: [],\r\n        },\r\n        editor: {\r\n            permissions: ['admin'],\r\n            dependencies: ['viewer'],\r\n        },\r\n    },\r\n\r\n    routes: {\r\n        index: {\r\n            component: 'lieferzeiten-index',\r\n            path: 'index',\r\n            redirect: { name: 'lieferzeiten.index.all' },\r\n            children: {\r\n                all: {\r\n                    component: 'lieferzeiten-all',\r\n                    path: 'all',\r\n                    meta: {\r\n                        parentPath: 'lieferzeiten.index',\r\n                        privilege: 'admin',\r\n                    },\r\n                },\r\n                open: {\r\n                    component: 'lieferzeiten-open',\r\n                    path: 'open',\r\n                    meta: {\r\n                        parentPath: 'lieferzeiten.index',\r\n                        privilege: 'admin',\r\n                    },\r\n                },\r\n                statistics: {\r\n                    component: 'lieferzeiten-statistics',\r\n                    path: 'statistics',\r\n                    meta: {\r\n                        parentPath: 'lieferzeiten.index',\r\n                        privilege: 'admin',\r\n                    },\r\n                },\r\n            },\r\n        },\r\n    },\r\n\r\n    navigation: [\r\n        {\r\n            id: 'lieferzeiten',\r\n            label: 'lieferzeiten.general.mainMenuItemGeneral',\r\n            color: '#2B8CBF',\r\n            path: 'lieferzeiten.index',\r\n            icon: 'regular-clock',\r\n            parent: 'sw-order',\r\n            position: 100,\r\n            privilege: 'admin',\r\n        },\r\n        {\r\n            id: 'lieferzeiten-statistics',\r\n            label: 'lieferzeiten.general.mainMenuItemStatistics',\r\n            color: '#2B8CBF',\r\n            path: 'lieferzeiten.index.statistics',\r\n            icon: 'regular-chart-bar',\r\n            parent: 'sw-dashboard',\r\n            position: 110,\r\n            privilege: 'admin',\r\n        },\r\n    ],\r\n});\r\n","<sw-page class=\"lieferzeiten-channel-settings-list\">\r\n    <template #smart-bar-header>\r\n        <h2>{{ $tc('lieferzeiten.lms.dashboard.title') }}</h2>\r\n    </template>\r\n\r\n    <template #smart-bar-actions>\r\n        <sw-button v-if=\"hasEditAccess\" :isLoading=\"isSeedingDemoData\" :variant=\"hasDemoData ? 'danger' : 'default'\" @click=\"onToggleDemoData\">{{ hasDemoData ? $tc('lieferzeiten.lms.dashboard.removeDemoData') : $tc('lieferzeiten.lms.dashboard.seedDemoData') }}</sw-button>\r\n        <sw-button-process v-if=\"hasEditAccess\" variant=\"primary\" :isLoading=\"isSaving\" @click=\"onSave\">{{ $tc('global.default.save') }}</sw-button-process>\r\n    </template>\r\n\r\n    <template #content>\r\n        <sw-card :isLoading=\"isLoading\" :title=\"$tc('lieferzeiten.lms.dashboard.cardTitle')\">\r\n            <sw-alert variant=\"info\" appearance=\"default\" :showIcon=\"true\">\r\n                {{ $tc('lieferzeiten.lms.dashboard.introText') }}\r\n            </sw-alert>\r\n\r\n            <sw-alert v-if=\"hasValidationErrors\" variant=\"error\" appearance=\"default\" :showIcon=\"true\" class=\"sw-mt-16\">\r\n                {{ $tc('lieferzeiten.lms.dashboard.validationError') }}\r\n            </sw-alert>\r\n\r\n            <section v-for=\"group in groupedChannels\" :key=\"group.id\" class=\"sw-mt-24\">\r\n                <h3 class=\"sw-mb-8\">{{ group.title }}</h3>\r\n\r\n                <div class=\"sw-flex sw-flex--wrap sw-gap-8 sw-mb-12\">\r\n                    <sw-button\r\n                        v-for=\"channel in group.channels\"\r\n                        :key=\"`${group.id}-${channel.id}`\"\r\n                        size=\"small\"\r\n                        :variant=\"getSelectedChannelId(group.id) === channel.id ? 'primary' : 'ghost'\"\r\n                        @click=\"onSelectChannel(group.id, channel.id)\"\r\n                    >\r\n                        {{ channel.name || channel.id }}\r\n                    </sw-button>\r\n                </div>\r\n\r\n                <template v-if=\"getActiveChannel(group)\">\r\n                    <div class=\"sw-flex sw-flex--align-center sw-flex--justify-space-between\">\r\n                        <h4 class=\"sw-m-0\">{{ getActiveChannel(group).name || getActiveChannel(group).id }}</h4>\r\n                        <sw-label v-if=\"hasIncompletePdmsMapping(getActiveChannel(group).id)\" appearance=\"pill\" variant=\"warning\" size=\"small\">\r\n                            {{ $tc('lieferzeiten.lms.dashboard.incompleteMappingBadge') }}\r\n                        </sw-label>\r\n                    </div>\r\n\r\n                    <sw-alert v-if=\"hasIncompletePdmsMapping(getActiveChannel(group).id)\" variant=\"warning\" appearance=\"default\" :showIcon=\"true\" class=\"sw-mt-8 sw-mb-8\">\r\n                        {{ $t('lieferzeiten.lms.dashboard.incompleteMappingWarning', { channelName: getActiveChannel(group).name || getActiveChannel(group).id }) }}\r\n                    </sw-alert>\r\n\r\n                    <sw-data-grid\r\n                        :dataSource=\"getChannelPdmsLieferzeiten(getActiveChannel(group).id)\"\r\n                        :columns=\"[\r\n                            { property: 'label', label: $tc('lieferzeiten.lms.dashboard.columns.pdmsLieferzeit'), width: '160px' },\r\n                            { property: 'shippingOverdueWorkingDays', label: $tc('lieferzeiten.lms.dashboard.columns.shippingOverdueWorkingDays') },\r\n                            { property: 'deliveryOverdueWorkingDays', label: $tc('lieferzeiten.lms.dashboard.columns.deliveryOverdueWorkingDays') }\r\n                        ]\"\r\n                        :showSelection=\"false\"\r\n                        :showActions=\"false\"\r\n                        :allowColumnEdit=\"false\"\r\n                    >\r\n                        <template #column-label=\"{ item }\">\r\n                            {{ item.label }}\r\n                        </template>\r\n\r\n                        <template #column-shippingOverdueWorkingDays=\"{ item }\">\r\n                            <sw-number-field\r\n                                numberType=\"int\"\r\n                                :min=\"0\"\r\n                                :disabled=\"!hasEditAccess\"\r\n                                :value=\"getMatrixValue(getActiveChannel(group).id, item.key, 'shippingOverdueWorkingDays')\"\r\n                                :error=\"getFieldError(getActiveChannel(group).id, item.key, 'shippingOverdueWorkingDays')\"\r\n                                @input=\"onChangeNumberField(getActiveChannel(group).id, item.key, 'shippingOverdueWorkingDays', $event)\"\r\n                            />\r\n                        </template>\r\n\r\n                        <template #column-deliveryOverdueWorkingDays=\"{ item }\">\r\n                            <sw-number-field\r\n                                numberType=\"int\"\r\n                                :min=\"0\"\r\n                                :disabled=\"!hasEditAccess\"\r\n                                :value=\"getMatrixValue(getActiveChannel(group).id, item.key, 'deliveryOverdueWorkingDays')\"\r\n                                :error=\"getFieldError(getActiveChannel(group).id, item.key, 'deliveryOverdueWorkingDays')\"\r\n                                @input=\"onChangeNumberField(getActiveChannel(group).id, item.key, 'deliveryOverdueWorkingDays', $event)\"\r\n                            />\r\n                        </template>\r\n                    </sw-data-grid>\r\n                </template>\r\n            </section>\r\n        </sw-card>\r\n    </template>\r\n</sw-page>\r\n","import { normalizeDomainKey } from './domain-source-mapping';\r\n\r\n/**\r\n * LMS channel matching rules (in priority order):\r\n * 1) Match by mapped sales-channel domain hostname only\r\n *    (canonical + legacy aliases via normalizeDomainKey).\r\n * 2) If no mapped domain exists, match by explicit technical identifiers only\r\n *    (technicalName, shortName, technical custom-field keys; exact match after normalization).\r\n *\r\n * Freely editable display labels (name, translated.name) are intentionally excluded\r\n * from technical matching to avoid false-positive LMS assignments after renames/translations.\r\n */\r\nexport const LMS_TARGET_CHANNELS = Object.freeze([\r\n    {\r\n        domainKey: 'first-medical-shop.de',\r\n        technicalIdentifiers: ['first-medical-shop.de', 'first-medical-shop', 'first_medical_shop', 'first-medical-e-commerce'],\r\n    },\r\n    {\r\n        domainKey: 'ebay.de',\r\n        technicalIdentifiers: ['ebay.de', 'ebay_de', 'ebay-de'],\r\n    },\r\n    {\r\n        domainKey: 'ebay.at',\r\n        technicalIdentifiers: ['ebay.at', 'ebay_at', 'ebay-at'],\r\n    },\r\n    {\r\n        domainKey: 'kaufland',\r\n        technicalIdentifiers: ['kaufland'],\r\n    },\r\n    {\r\n        domainKey: 'peg',\r\n        technicalIdentifiers: ['peg'],\r\n    },\r\n    {\r\n        domainKey: 'zonami',\r\n        technicalIdentifiers: ['zonami'],\r\n    },\r\n    {\r\n        domainKey: 'medical-solutions-germany.de',\r\n        technicalIdentifiers: ['medical-solutions-germany.de', 'medical-solutions-germany', 'medical_solutions_germany'],\r\n    },\r\n]);\r\n\r\nconst TECHNICAL_IDENTIFIER_TO_DOMAIN_KEY = Object.freeze(\r\n    LMS_TARGET_CHANNELS.reduce((acc, config) => {\r\n        config.technicalIdentifiers.forEach((identifier) => {\r\n            acc[normalizeIdentifier(identifier)] = config.domainKey;\r\n        });\r\n\r\n        return acc;\r\n    }, {}),\r\n);\r\n\r\nfunction normalizeIdentifier(value) {\r\n    return String(value || '').trim().toLowerCase();\r\n}\r\n\r\nfunction normalizeDomainFromUrl(url) {\r\n    if (!url) {\r\n        return null;\r\n    }\r\n\r\n    try {\r\n        const parsedUrl = new URL(url);\r\n        return normalizeDomainKey(parsedUrl.hostname);\r\n    } catch (error) {\r\n        return normalizeDomainKey(url);\r\n    }\r\n}\r\n\r\nexport function resolveLmsTargetChannelKey(channel) {\r\n    const domainMatch = channel?.domains\r\n        ?.map((domain) => normalizeDomainFromUrl(domain?.url))\r\n        .find((domainKey) => domainKey !== null);\r\n\r\n    if (domainMatch && LMS_TARGET_CHANNELS.some((config) => config.domainKey === domainMatch)) {\r\n        return domainMatch;\r\n    }\r\n\r\n    // Important: display names are not technical identifiers and can be edited/translatable.\r\n    // Matching must stay strict to domain hostnames and explicit technical keys only.\r\n    const technicalIdentifierCandidates = [\r\n        channel?.technicalName,\r\n        channel?.shortName,\r\n        channel?.customFields?.technicalIdentifier,\r\n        channel?.customFields?.technicalName,\r\n        channel?.customFields?.technical_name,\r\n        channel?.customFields?.technical_identifier,\r\n    ]\r\n        .map((identifier) => normalizeIdentifier(identifier))\r\n        .filter((identifier) => identifier.length > 0);\r\n\r\n    return technicalIdentifierCandidates\r\n        .map((identifier) => TECHNICAL_IDENTIFIER_TO_DOMAIN_KEY[identifier] || null)\r\n        .find((domainKey) => domainKey !== null) || null;\r\n}\r\n\r\nexport function isLmsTargetChannel(channel) {\r\n    return resolveLmsTargetChannelKey(channel) !== null;\r\n}\r\n","import template from './lieferzeiten-channel-settings-list.html.twig';\r\nimport { DOMAIN_GROUPS, normalizeDomainKey } from '../../../lieferzeiten/utils/domain-source-mapping';\r\nimport {\r\n    isLmsTargetChannel,\r\n    LMS_TARGET_CHANNELS,\r\n    resolveLmsTargetChannelKey,\r\n} from '../../../lieferzeiten/utils/lms-target-channel-mapping';\r\n\r\nconst { Component } = Shopware;\r\nconst { Criteria } = Shopware.Data;\r\n\r\nconst PDMS_SLOTS = [1, 2, 3, 4];\r\n\r\n/**\r\n * LMS whitelist matching is resolved in lms-target-channel-mapping via:\r\n * 1) canonical sales-channel domain mapping (normalized hostname)\r\n * 2) explicit technical identifiers (exact match after normalization)\r\n *\r\n * Display names are not used as fuzzy matching input.\r\n */\r\nconst LMS_TARGET_DOMAIN_KEYS = LMS_TARGET_CHANNELS.map((targetChannel) => targetChannel.domainKey);\r\n\r\nconst CHANNEL_GROUP_TITLES = {\r\n    'first-medical-e-commerce': 'First Medical - E-Commerce',\r\n    'medical-solutions': 'Medical Solutions',\r\n};\r\n\r\nconst LMS_FALLBACK_CHANNEL_IDS = Object.freeze({\r\n    'first-medical-shop.de': '11111111-1111-4111-8111-111111111111',\r\n    'ebay.de': '22222222-2222-4222-8222-222222222222',\r\n    'ebay.at': '33333333-3333-4333-8333-333333333333',\r\n    kaufland: '44444444-4444-4444-8444-444444444444',\r\n    peg: '55555555-5555-4555-8555-555555555555',\r\n    zonami: '66666666-6666-4666-8666-666666666666',\r\n    'medical-solutions-germany.de': '77777777-7777-4777-8777-777777777777',\r\n});\r\n\r\nconst CHANNEL_GROUPS = Object.entries(CHANNEL_GROUP_TITLES)\r\n    .map(([groupId, groupTitle]) => {\r\n        const sourceGroup = DOMAIN_GROUPS.find((group) => group.id === groupId);\r\n\r\n        return {\r\n            id: groupId,\r\n            title: groupTitle,\r\n            domainKeys: (sourceGroup?.channels || [])\r\n                .map((channel) => channel.value)\r\n                .filter((channelDomainKey) => LMS_TARGET_DOMAIN_KEYS.includes(channelDomainKey)),\r\n        };\r\n    });\r\n\r\nconst OTHER_CHANNELS_GROUP = {\r\n    id: 'other-channels',\r\n    title: 'Weitere Kanäle',\r\n};\r\n\r\nComponent.register('lieferzeiten-channel-settings-list', {\r\n    template,\r\n\r\n    mixins: ['notification'],\r\n\r\n    inject: ['repositoryFactory', 'lieferzeitenOrdersService', 'acl'],\r\n\r\n    data() {\r\n        return {\r\n            thresholdRepository: null,\r\n            salesChannelRepository: null,\r\n            channels: [],\r\n            matrixValues: {},\r\n            existingEntryIds: {},\r\n            existingEntries: {},\r\n            validationErrors: {},\r\n            isLoading: false,\r\n            isSaving: false,\r\n            isSeedingDemoData: false,\r\n            hasDemoData: false,\r\n            channelPdmsLieferzeiten: {},\r\n            channelPdmsMappingIncomplete: {},\r\n            selectedChannelByGroup: {},\r\n        };\r\n    },\r\n\r\n    computed: {\r\n        groupedChannels() {\r\n            const groupedEntries = CHANNEL_GROUPS.map((group) => ({\r\n                ...group,\r\n                channels: [],\r\n            }));\r\n\r\n            const channelsWithoutMapping = [];\r\n\r\n            this.channels.forEach((channel) => {\r\n                const domainKey = this.resolveChannelDomainKey(channel);\r\n                const matchingGroup = groupedEntries.find((group) => group.domainKeys.includes(domainKey));\r\n\r\n                if (matchingGroup) {\r\n                    matchingGroup.channels.push(channel);\r\n                    return;\r\n                }\r\n\r\n                channelsWithoutMapping.push(channel);\r\n            });\r\n\r\n            const visibleGroups = groupedEntries.filter((group) => group.channels.length > 0);\r\n\r\n            if (channelsWithoutMapping.length > 0) {\r\n                visibleGroups.push({\r\n                    ...OTHER_CHANNELS_GROUP,\r\n                    channels: channelsWithoutMapping,\r\n                });\r\n            }\r\n\r\n            return visibleGroups;\r\n        },\r\n\r\n        hasEditAccess() {\r\n            if (typeof this.acl?.can !== 'function') {\r\n                return false;\r\n            }\r\n\r\n            return this.acl.can('lieferzeiten.editor') || this.acl.can('admin');\r\n        },\r\n\r\n        hasValidationErrors() {\r\n            return Object.keys(this.validationErrors).length > 0;\r\n        },\r\n    },\r\n\r\n    created() {\r\n        this.thresholdRepository = this.repositoryFactory.create('lieferzeiten_channel_pdms_threshold');\r\n        this.salesChannelRepository = this.repositoryFactory.create('sales_channel');\r\n        this.loadData();\r\n        this.loadDemoDataStatus();\r\n    },\r\n\r\n    methods: {\r\n        createSyntheticLmsChannel(domainKey) {\r\n            return {\r\n                id: LMS_FALLBACK_CHANNEL_IDS[domainKey] || Shopware.Utils.createId(),\r\n                name: domainKey,\r\n                technicalName: domainKey,\r\n                domains: [{ url: `https://${domainKey}` }],\r\n                _isSyntheticLmsChannel: true,\r\n            };\r\n        },\r\n\r\n        appendMissingLmsTargetChannels(channels) {\r\n            const resolvedDomainKeys = new Set(channels\r\n                .map((channel) => this.resolveChannelDomainKey(channel))\r\n                .filter((domainKey) => domainKey !== null));\r\n\r\n            const mergedChannels = [...channels];\r\n\r\n            LMS_TARGET_DOMAIN_KEYS.forEach((domainKey) => {\r\n                if (resolvedDomainKeys.has(domainKey)) {\r\n                    return;\r\n                }\r\n\r\n                mergedChannels.push(this.createSyntheticLmsChannel(domainKey));\r\n            });\r\n\r\n            return mergedChannels;\r\n        },\r\n\r\n        getWhitelistedChannels(salesChannels) {\r\n            const whitelistedChannels = salesChannels.filter((channel) => isLmsTargetChannel(channel));\r\n\r\n            return this.appendMissingLmsTargetChannels(whitelistedChannels);\r\n        },\r\n\r\n        getSelectedChannelId(groupId) {\r\n            return this.selectedChannelByGroup[groupId] || null;\r\n        },\r\n\r\n        setSelectedChannel(groupId, channelId) {\r\n            this.selectedChannelByGroup = {\r\n                ...this.selectedChannelByGroup,\r\n                [groupId]: channelId,\r\n            };\r\n        },\r\n\r\n        initializeGroupSelections() {\r\n            const nextSelections = {};\r\n\r\n            this.groupedChannels.forEach((group) => {\r\n                if (group.channels.length === 0) {\r\n                    return;\r\n                }\r\n\r\n                const currentSelection = this.selectedChannelByGroup[group.id];\r\n                const hasCurrentSelection = group.channels.some((channel) => channel.id === currentSelection);\r\n\r\n                nextSelections[group.id] = hasCurrentSelection ? currentSelection : group.channels[0].id;\r\n            });\r\n\r\n            this.selectedChannelByGroup = nextSelections;\r\n        },\r\n\r\n        getActiveChannel(group) {\r\n            const selectedChannelId = this.getSelectedChannelId(group.id);\r\n\r\n            return group.channels.find((channel) => channel.id === selectedChannelId) || group.channels[0] || null;\r\n        },\r\n\r\n        onSelectChannel(groupId, channelId) {\r\n            this.setSelectedChannel(groupId, channelId);\r\n        },\r\n\r\n        getSelectedChannelId(groupId) {\r\n            return this.selectedChannelByGroup[groupId] || null;\r\n        },\r\n\r\n        setSelectedChannel(groupId, channelId) {\r\n            this.selectedChannelByGroup = {\r\n                ...this.selectedChannelByGroup,\r\n                [groupId]: channelId,\r\n            };\r\n        },\r\n\r\n        initializeGroupSelections() {\r\n            const nextSelections = {};\r\n\r\n            this.groupedChannels.forEach((group) => {\r\n                if (group.channels.length === 0) {\r\n                    return;\r\n                }\r\n\r\n                const currentSelection = this.selectedChannelByGroup[group.id];\r\n                const hasCurrentSelection = group.channels.some((channel) => channel.id === currentSelection);\r\n\r\n                nextSelections[group.id] = hasCurrentSelection ? currentSelection : group.channels[0].id;\r\n            });\r\n\r\n            this.selectedChannelByGroup = nextSelections;\r\n        },\r\n\r\n        getActiveChannel(group) {\r\n            const selectedChannelId = this.getSelectedChannelId(group.id);\r\n\r\n            return group.channels.find((channel) => channel.id === selectedChannelId) || group.channels[0] || null;\r\n        },\r\n\r\n        onSelectChannel(groupId, channelId) {\r\n            this.setSelectedChannel(groupId, channelId);\r\n        },\r\n\r\n        getWhitelistedChannelIds() {\r\n            return new Set(this.channels.map((channel) => channel.id));\r\n        },\r\n\r\n        resolveChannelDomainKey(channel) {\r\n            const lmsTargetDomainKey = resolveLmsTargetChannelKey(channel);\r\n\r\n            if (lmsTargetDomainKey) {\r\n                return lmsTargetDomainKey;\r\n            }\r\n\r\n            const domainFromChannelDomain = channel?.domains\r\n                ?.map((domain) => this.normalizeDomainFromUrl(domain?.url))\r\n                .find((domainKey) => domainKey !== null);\r\n\r\n            if (domainFromChannelDomain) {\r\n                return domainFromChannelDomain;\r\n            }\r\n\r\n            return normalizeDomainKey(channel?.name);\r\n        },\r\n\r\n        normalizeDomainFromUrl(url) {\r\n            if (!url) {\r\n                return null;\r\n            }\r\n\r\n            try {\r\n                const parsedUrl = new URL(url);\r\n                return normalizeDomainKey(parsedUrl.hostname);\r\n            } catch (error) {\r\n                return normalizeDomainKey(url);\r\n            }\r\n        },\r\n\r\n        extractErrorMessage(error) {\r\n            return error?.response?.data?.errors?.[0]?.detail\r\n                || error?.response?.data?.message\r\n                || error?.message\r\n                || this.$tc('global.default.error');\r\n        },\r\n\r\n        notifyRequestError(error, fallbackTitle) {\r\n            this.createNotificationError({\r\n                title: fallbackTitle,\r\n                message: this.extractErrorMessage(error),\r\n            });\r\n        },\r\n\r\n        getChannelPdmsLieferzeiten(channelId) {\r\n            return this.channelPdmsLieferzeiten[channelId] || this.buildNormalizedPdmsSlots();\r\n        },\r\n\r\n        createMissingSlotEntry(slot) {\r\n            return {\r\n                key: `PDMS_${slot}`,\r\n                label: this.$t('lieferzeiten.lms.dashboard.incompleteMappingSlotLabel', { slot }),\r\n                isPlaceholder: true,\r\n            };\r\n        },\r\n\r\n        buildNormalizedPdmsSlots(entriesBySlot = new Map()) {\r\n            return PDMS_SLOTS.map((slot) => entriesBySlot.get(slot) || this.createMissingSlotEntry(slot));\r\n        },\r\n\r\n        getEntryKey(channelId, pdmsKey) {\r\n            return `${channelId}.${pdmsKey}`;\r\n        },\r\n\r\n        hasIncompletePdmsMapping(channelId) {\r\n            return Boolean(this.channelPdmsMappingIncomplete[channelId]);\r\n        },\r\n\r\n        getFieldKey(channelId, pdmsKey, fieldName) {\r\n            return `${channelId}.${pdmsKey}.${fieldName}`;\r\n        },\r\n\r\n        ensureChannelMatrix(channelId) {\r\n            if (!this.matrixValues[channelId]) {\r\n                this.matrixValues[channelId] = {};\r\n            }\r\n\r\n            this.getChannelPdmsLieferzeiten(channelId).forEach(({ key }) => {\r\n                if (!this.matrixValues[channelId][key]) {\r\n                    this.matrixValues[channelId][key] = {\r\n                        shippingOverdueWorkingDays: 0,\r\n                        deliveryOverdueWorkingDays: 0,\r\n                    };\r\n                }\r\n            });\r\n        },\r\n\r\n        async loadChannelPdmsLieferzeiten(channelId) {\r\n            try {\r\n                const response = await this.lieferzeitenOrdersService.getSalesChannelLieferzeiten(channelId);\r\n                const entriesBySlot = new Map();\r\n\r\n                if (Array.isArray(response?.lieferzeiten)) {\r\n                    response.lieferzeiten.forEach((entry) => {\r\n                        const slot = Number.parseInt(entry?.slot, 10);\r\n\r\n                        if (!Number.isInteger(slot) || slot < 1 || slot > 4 || entriesBySlot.has(slot)) {\r\n                            return;\r\n                        }\r\n\r\n                        entriesBySlot.set(slot, {\r\n                            key: `PDMS_${slot}`,\r\n                            label: entry?.lieferzeit?.name || `PDMS ${slot}`,\r\n                            isPlaceholder: false,\r\n                        });\r\n                    });\r\n                }\r\n\r\n                const normalizedEntries = this.buildNormalizedPdmsSlots(entriesBySlot);\r\n\r\n                this.channelPdmsLieferzeiten[channelId] = normalizedEntries;\r\n                this.channelPdmsMappingIncomplete[channelId] = normalizedEntries.some((entry) => entry.isPlaceholder);\r\n            } catch (error) {\r\n                this.channelPdmsLieferzeiten[channelId] = this.buildNormalizedPdmsSlots();\r\n                this.channelPdmsMappingIncomplete[channelId] = true;\r\n                this.notifyRequestError(error, this.$tc('lieferzeiten.lms.dashboard.title'));\r\n            }\r\n        },\r\n\r\n        normalizeNonNegativeInteger(rawValue) {\r\n            if (typeof rawValue === 'number') {\r\n                return Number.isInteger(rawValue) ? rawValue : rawValue;\r\n            }\r\n\r\n            if (typeof rawValue !== 'string') {\r\n                return rawValue;\r\n            }\r\n\r\n            const trimmed = rawValue.trim();\r\n            if (!/^\\d+$/.test(trimmed)) {\r\n                return rawValue;\r\n            }\r\n\r\n            return Number.parseInt(trimmed, 10);\r\n        },\r\n\r\n        validateValue(channelId, pdmsKey, fieldName) {\r\n            const fieldKey = this.getFieldKey(channelId, pdmsKey, fieldName);\r\n            const value = this.matrixValues[channelId]?.[pdmsKey]?.[fieldName];\r\n            const isValid = Number.isInteger(value) && value >= 0;\r\n\r\n            if (!isValid) {\r\n                this.validationErrors[fieldKey] = this.$tc('lieferzeiten.lms.dashboard.inlineValidationError');\r\n                return;\r\n            }\r\n\r\n            delete this.validationErrors[fieldKey];\r\n        },\r\n\r\n        onChangeNumberField(channelId, pdmsKey, fieldName, rawValue) {\r\n            this.ensureChannelMatrix(channelId);\r\n            this.matrixValues[channelId][pdmsKey][fieldName] = this.normalizeNonNegativeInteger(rawValue);\r\n            this.validateValue(channelId, pdmsKey, fieldName);\r\n        },\r\n\r\n        getMatrixValue(channelId, pdmsKey, fieldName) {\r\n            return this.matrixValues[channelId]?.[pdmsKey]?.[fieldName] ?? 0;\r\n        },\r\n\r\n        getFieldError(channelId, pdmsKey, fieldName) {\r\n            return this.validationErrors[this.getFieldKey(channelId, pdmsKey, fieldName)] || null;\r\n        },\r\n\r\n        async loadData() {\r\n            this.isLoading = true;\r\n\r\n            const thresholdCriteria = new Criteria(1, 500);\r\n            const salesChannelCriteria = new Criteria(1, 500);\r\n            salesChannelCriteria.addSorting(Criteria.sort('name', 'ASC'));\r\n            salesChannelCriteria.addAssociation('domains');\r\n\r\n            try {\r\n                const [thresholds, salesChannels] = await Promise.all([\r\n                    this.thresholdRepository.search(thresholdCriteria, Shopware.Context.api),\r\n                    this.salesChannelRepository.search(salesChannelCriteria, Shopware.Context.api),\r\n                ]);\r\n\r\n                this.channels = this.getWhitelistedChannels(salesChannels);\r\n                this.matrixValues = {};\r\n                this.existingEntryIds = {};\r\n                this.existingEntries = {};\r\n                this.channelPdmsLieferzeiten = {};\r\n                this.channelPdmsMappingIncomplete = {};\r\n\r\n                const loadedChannelIds = this.getWhitelistedChannelIds();\r\n\r\n                await Promise.all(this.channels.map((channel) => this.loadChannelPdmsLieferzeiten(channel.id)));\r\n\r\n                this.channels.forEach((channel) => {\r\n                    this.ensureChannelMatrix(channel.id);\r\n                });\r\n\r\n                this.initializeGroupSelections();\r\n\r\n                thresholds.forEach((entry) => {\r\n                    if (!loadedChannelIds.has(entry.salesChannelId)) {\r\n                        return;\r\n                    }\r\n\r\n                    this.ensureChannelMatrix(entry.salesChannelId);\r\n                    this.matrixValues[entry.salesChannelId][entry.pdmsLieferzeit] = {\r\n                        shippingOverdueWorkingDays: entry.shippingOverdueWorkingDays,\r\n                        deliveryOverdueWorkingDays: entry.deliveryOverdueWorkingDays,\r\n                    };\r\n                    const entryKey = this.getEntryKey(entry.salesChannelId, entry.pdmsLieferzeit);\r\n                    this.existingEntryIds[entryKey] = entry.id;\r\n                });\r\n            } catch (error) {\r\n                this.notifyRequestError(error, this.$tc('lieferzeiten.lms.dashboard.title'));\r\n            } finally {\r\n                this.isLoading = false;\r\n            }\r\n        },\r\n\r\n        async onSave() {\r\n            if (!this.hasEditAccess) {\r\n                return;\r\n            }\r\n\r\n            this.validationErrors = {};\r\n            this.channels.forEach((channel) => {\r\n                this.getChannelPdmsLieferzeiten(channel.id).forEach(({ key }) => {\r\n                    this.validateValue(channel.id, key, 'shippingOverdueWorkingDays');\r\n                    this.validateValue(channel.id, key, 'deliveryOverdueWorkingDays');\r\n                });\r\n            });\r\n\r\n            if (this.hasValidationErrors) {\r\n                this.createNotificationError({\r\n                    title: this.$tc('lieferzeiten.lms.dashboard.title'),\r\n                    message: this.$tc('lieferzeiten.lms.dashboard.validationError'),\r\n                });\r\n\r\n                return;\r\n            }\r\n\r\n            this.isSaving = true;\r\n\r\n            try {\r\n                const whitelistedChannelIds = this.getWhitelistedChannelIds();\r\n                const existingEntries = new Map();\r\n\r\n                this.channels.forEach((channel) => {\r\n                    this.getChannelPdmsLieferzeiten(channel.id).forEach(({ key }) => {\r\n                        const existingEntryId = this.existingEntryIds[this.getEntryKey(channel.id, key)];\r\n\r\n                        if (existingEntryId) {\r\n                            existingEntries.set(this.getEntryKey(channel.id, key), null);\r\n                        }\r\n                    });\r\n                });\r\n\r\n                if (existingEntries.size > 0) {\r\n                    const criteria = new Criteria(1, existingEntries.size);\r\n                    criteria.setIds(Object.values(this.existingEntryIds));\r\n                    const persistedEntries = await this.thresholdRepository.search(criteria, Shopware.Context.api);\r\n\r\n                    persistedEntries.forEach((entry) => {\r\n                        existingEntries.set(this.getEntryKey(entry.salesChannelId, entry.pdmsLieferzeit), entry);\r\n                    });\r\n                }\r\n\r\n                for (const channel of this.channels) {\r\n                    if (!whitelistedChannelIds.has(channel.id)) {\r\n                        continue;\r\n                    }\r\n\r\n                    this.ensureChannelMatrix(channel.id);\r\n\r\n                    for (const { key } of this.getChannelPdmsLieferzeiten(channel.id)) {\r\n                        const entryKey = this.getEntryKey(channel.id, key);\r\n                        const existingEntity = existingEntries.get(entryKey) || null;\r\n                        const entity = existingEntity || this.thresholdRepository.create(Shopware.Context.api);\r\n\r\n                        if (!existingEntity) {\r\n                            entity.id = this.existingEntryIds[entryKey] || entity.id;\r\n                        }\r\n\r\n                        entity.salesChannelId = channel.id;\r\n                        entity.pdmsLieferzeit = key;\r\n                        entity.shippingOverdueWorkingDays = this.matrixValues[channel.id][key].shippingOverdueWorkingDays;\r\n                        entity.deliveryOverdueWorkingDays = this.matrixValues[channel.id][key].deliveryOverdueWorkingDays;\r\n\r\n                        await this.thresholdRepository.save(entity, Shopware.Context.api);\r\n                    }\r\n                }\r\n\r\n                this.createNotificationSuccess({\r\n                    title: this.$tc('lieferzeiten.lms.dashboard.title'),\r\n                    message: this.$tc('lieferzeiten.lms.dashboard.saveSuccess'),\r\n                });\r\n\r\n                await this.loadData();\r\n            } catch (error) {\r\n                this.notifyRequestError(error, this.$tc('lieferzeiten.lms.dashboard.title'));\r\n            } finally {\r\n                this.isSaving = false;\r\n            }\r\n        },\r\n\r\n        async loadDemoDataStatus() {\r\n            try {\r\n                const response = await this.lieferzeitenOrdersService.getDemoDataStatus();\r\n                this.hasDemoData = Boolean(response?.hasDemoData);\r\n            } catch (error) {\r\n                this.notifyRequestError(error, this.$tc('lieferzeiten.lms.dashboard.demoDataTitle'));\r\n            }\r\n        },\r\n\r\n        async onToggleDemoData() {\r\n            if (!this.hasEditAccess) {\r\n                return;\r\n            }\r\n\r\n            this.isSeedingDemoData = true;\r\n\r\n            try {\r\n                const response = await this.lieferzeitenOrdersService.toggleDemoData();\r\n                const isRemoved = response?.action === 'removed';\r\n                const hasSummary = Object.prototype.hasOwnProperty.call(response || {}, 'createdExternalOrders');\r\n                this.hasDemoData = isRemoved ? false : (hasSummary ? true : Boolean(response?.hasDemoData));\r\n                await this.loadData();\r\n\r\n                this.createNotificationSuccess({\r\n                    title: this.$tc('lieferzeiten.lms.dashboard.demoDataTitle'),\r\n                    message: isRemoved\r\n                        ? this.$tc('lieferzeiten.lms.dashboard.demoDataRemoved')\r\n                        : (hasSummary\r\n                            ? `${response?.createdExternalOrders ?? 0} externe Bestellungen, ${response?.createdLieferzeiten ?? 0} Lieferzeiten-Datensätze, ${response?.linked ?? 0} verknüpft.`\r\n                            : this.$tc('lieferzeiten.lms.dashboard.demoDataSaved')),\r\n                });\r\n            } catch (error) {\r\n                this.notifyRequestError(error, this.$tc('lieferzeiten.lms.dashboard.demoDataTitle'));\r\n            } finally {\r\n                this.isSeedingDemoData = false;\r\n            }\r\n        },\r\n    },\r\n});\r\n","<sw-page class=\"lieferzeiten-task-assignment-rule-list\">\r\n    <template #smart-bar-header>\r\n        <h2>{{ $tc('lieferzeiten.lms.navigation.taskAssignmentRules') }}</h2>\r\n    </template>\r\n\r\n    <template #smart-bar-actions>\r\n        <sw-button v-if=\"hasEditAccess\" variant=\"primary\" @click=\"onCreate\">Create</sw-button>\r\n    </template>\r\n\r\n    <template #content>\r\n        <div class=\"lza-task-rule-layout\">\r\n            <section class=\"lza-task-rule-hero\">\r\n                <div>\r\n                    <h3>Task rules designer</h3>\r\n                    <p>\r\n                        Règles d'assignation avec un affichage amélioré et repères clairs pour les champs obligatoires.\r\n                    </p>\r\n                </div>\r\n                <div class=\"lza-task-rule-tags\">\r\n                    <span class=\"lza-tag\">Trigger *</span>\r\n                    <span class=\"lza-tag\">Assignee type *</span>\r\n                    <span class=\"lza-tag\">Assignee *</span>\r\n                </div>\r\n            </section>\r\n\r\n            <sw-alert variant=\"info\" appearance=\"notification\" :showIcon=\"true\">\r\n                Les données de démonstration de cette grille proviennent du seeder backend\r\n                <strong>DemoDataSeederService</strong> via l'endpoint\r\n                <code>POST /api/_action/lieferzeiten/demo-data</code>.\r\n                Les règles créées en démo utilisent le préfixe <code>demo_</code>.\r\n            </sw-alert>\r\n\r\n            <sw-card class=\"lza-task-rule-card\">\r\n                <sw-entity-listing\r\n                    v-if=\"items\"\r\n                    :items=\"items\"\r\n                    :repository=\"repository\"\r\n                    :columns=\"columns\"\r\n                    :isLoading=\"isLoading\"\r\n                    :showSelection=\"false\"\r\n                    :allowInlineEdit=\"hasEditAccess\"\r\n                    :allowDelete=\"hasEditAccess\"\r\n                    :total=\"total\"\r\n                    :page=\"page\"\r\n                    :limit=\"limit\"\r\n                    @page-change=\"onPageChange\"\r\n                    @inline-edit-save=\"onInlineEditSave\"\r\n                    @inline-edit-cancel=\"getList\"\r\n                    @delete=\"onDelete\"\r\n                />\r\n            </sw-card>\r\n        </div>\r\n    </template>\r\n</sw-page>\r\n","import './lieferzeiten-task-assignment-rule-list.scss';\r\nimport template from './lieferzeiten-task-assignment-rule-list.html.twig';\r\n\r\nconst { Component } = Shopware;\r\nconst { Criteria } = Shopware.Data;\r\n\r\nComponent.register('lieferzeiten-task-assignment-rule-list', {\r\n    template,\r\n\r\n    mixins: ['notification'],\r\n\r\n    inject: ['repositoryFactory', 'acl'],\r\n\r\n    data() {\r\n        return {\r\n            repository: null,\r\n            items: null,\r\n            isLoading: false,\r\n            total: 0,\r\n            page: 1,\r\n            limit: 25,\r\n            triggerOptions: [\r\n                'versand.datum.ueberfaellig',\r\n                'liefertermin.anfrage.zusaetzlich',\r\n                'liefertermin.anfrage.geschlossen',\r\n            ],\r\n            assigneeTypeOptions: ['user', 'team'],\r\n        };\r\n    },\r\n\r\n    computed: {\r\n        hasEditAccess() {\r\n            if (typeof this.acl?.can !== 'function') {\r\n                return false;\r\n            }\r\n\r\n            return this.acl.can('lieferzeiten.editor') || this.acl.can('admin');\r\n        },\r\n\r\n        columns() {\r\n            return [\r\n                { property: 'name', label: 'Name', inlineEdit: 'string', primary: true },\r\n                { property: 'status', label: 'Status (optional)', inlineEdit: 'string' },\r\n                { property: 'triggerKey', label: 'Trigger *', inlineEdit: 'string' },\r\n                { property: 'ruleId', label: 'Rule (Rules Engine, optional)', inlineEdit: 'string' },\r\n                { property: 'assigneeType', label: 'Assignee type *', inlineEdit: 'string' },\r\n                { property: 'assigneeIdentifier', label: 'Assignee *', inlineEdit: 'string' },\r\n                { property: 'priority', label: 'Priority', inlineEdit: 'number' },\r\n                { property: 'active', label: 'Active', inlineEdit: 'boolean' },\r\n                { property: 'lastChangedBy', label: 'Last Changed By', inlineEdit: 'string' },\r\n                { property: 'lastChangedAt', label: 'Last Changed At', inlineEdit: 'date' },\r\n            ];\r\n        },\r\n    },\r\n\r\n    created() {\r\n        this.repository = this.repositoryFactory.create('lieferzeiten_task_assignment_rule');\r\n        this.getList();\r\n    },\r\n\r\n    methods: {\r\n        extractErrorMessage(error) {\r\n            return error?.response?.data?.errors?.[0]?.detail\r\n                || error?.response?.data?.message\r\n                || error?.message\r\n                || this.$tc('global.default.error');\r\n        },\r\n\r\n        notifyRequestError(error, fallbackTitle) {\r\n            this.createNotificationError({\r\n                title: fallbackTitle,\r\n                message: this.extractErrorMessage(error),\r\n            });\r\n        },\r\n\r\n        validateRule(item) {\r\n            const triggerKey = String(item?.triggerKey ?? '').trim();\r\n            const assigneeType = String(item?.assigneeType ?? '').trim();\r\n            const assigneeIdentifier = String(item?.assigneeIdentifier ?? '').trim();\r\n            const ruleId = String(item?.ruleId ?? '').trim();\r\n            const rawConditions = item?.conditions;\r\n\r\n            const hasConditions = (typeof rawConditions === 'string' && rawConditions.trim() !== '')\r\n                || (rawConditions && typeof rawConditions === 'object' && Object.keys(rawConditions).length > 0);\r\n\r\n            if (!triggerKey || !assigneeType || !assigneeIdentifier) {\r\n                return 'Die Pflichtfelder Trigger, Assignee type und Assignee müssen gesetzt sein.';\r\n            }\r\n\r\n            if (item?.active && !ruleId && !hasConditions) {\r\n                return 'Aktive Regeln benötigen mindestens Rule (Rules Engine) oder Conditions JSON, sonst sind sie nicht operant.';\r\n            }\r\n\r\n            return null;\r\n        },\r\n\r\n        notifyValidationError(message) {\r\n            this.createNotificationError({\r\n                title: this.$tc('lieferzeiten.lms.navigation.taskAssignmentRules'),\r\n                message,\r\n            });\r\n        },\r\n\r\n        async getList() {\r\n            this.isLoading = true;\r\n            const criteria = new Criteria(this.page, this.limit);\r\n            criteria.addSorting(Criteria.sort('createdAt', 'DESC'));\r\n\r\n            try {\r\n                const result = await this.repository.search(criteria, Shopware.Context.api);\r\n                this.items = result;\r\n                this.total = result.total;\r\n            } catch (error) {\r\n                this.notifyRequestError(error, this.$tc('lieferzeiten.lms.navigation.taskAssignmentRules'));\r\n            } finally {\r\n                this.isLoading = false;\r\n            }\r\n        },\r\n        onPageChange({ page, limit }) {\r\n            this.page = page;\r\n            this.limit = limit;\r\n            this.getList();\r\n        },\r\n        async onInlineEditSave(item) {\r\n            if (!this.hasEditAccess) {\r\n                return Promise.resolve();\r\n            }\r\n\r\n            const validationError = this.validateRule(item);\r\n            if (validationError) {\r\n                this.notifyValidationError(validationError);\r\n                return Promise.resolve();\r\n            }\r\n\r\n            this.isLoading = true;\r\n            try {\r\n                await this.repository.save(item, Shopware.Context.api);\r\n                await this.getList();\r\n            } catch (error) {\r\n                this.notifyRequestError(error, this.$tc('lieferzeiten.lms.navigation.taskAssignmentRules'));\r\n            }\r\n        },\r\n        async onDelete(item) {\r\n            if (!this.hasEditAccess) {\r\n                return Promise.resolve();\r\n            }\r\n\r\n            this.isLoading = true;\r\n            try {\r\n                await this.repository.delete(item.id, Shopware.Context.api);\r\n                await this.getList();\r\n            } catch (error) {\r\n                this.notifyRequestError(error, this.$tc('lieferzeiten.lms.navigation.taskAssignmentRules'));\r\n            }\r\n        },\r\n        async onCreate() {\r\n            if (!this.hasEditAccess) {\r\n                return Promise.resolve();\r\n            }\r\n\r\n            const entity = this.repository.create(Shopware.Context.api);\r\n            entity.name = 'New rule';\r\n            entity.triggerKey = this.triggerOptions[0];\r\n            entity.assigneeType = this.assigneeTypeOptions[0];\r\n            entity.assigneeIdentifier = '';\r\n            entity.active = false;\r\n            try {\r\n                await this.repository.save(entity, Shopware.Context.api);\r\n                await this.getList();\r\n            } catch (error) {\r\n                this.notifyRequestError(error, this.$tc('lieferzeiten.lms.navigation.taskAssignmentRules'));\r\n            }\r\n        },\r\n    },\r\n});\r\n","<sw-page class=\"lieferzeiten-notification-toggle-list\">\r\n    <template #smart-bar-header>\r\n        <h2>{{ $tc('lieferzeiten.lms.navigation.notificationToggles') }}</h2>\r\n    </template>\r\n\r\n    <template #content>\r\n        <sw-card :isLoading=\"isLoading\" :title=\"$tc('lieferzeiten.lms.notificationMatrix.title')\">\r\n            <sw-alert variant=\"info\" appearance=\"default\" :showIcon=\"true\">\r\n                {{ $tc('lieferzeiten.lms.notificationMatrix.source') }}\r\n                <code>(triggerKey, channel, salesChannelId)</code>.\r\n            </sw-alert>\r\n\r\n            <sw-alert variant=\"info\" appearance=\"default\" :showIcon=\"true\">\r\n                {{ $tc('lieferzeiten.lms.notificationMatrix.emailOnlyHint') }}\r\n            </sw-alert>\r\n\r\n            <sw-alert v-if=\"invalidEntries.length\" variant=\"warning\" appearance=\"default\" :showIcon=\"true\">\r\n                {{ $tc('lieferzeiten.lms.notificationMatrix.invalidEntries', invalidEntries.length, { count: invalidEntries.length }) }}\r\n            </sw-alert>\r\n\r\n            <div class=\"sw-data-grid sw-data-grid--compact\">\r\n                <table class=\"sw-data-grid__table\">\r\n                    <thead class=\"sw-data-grid__header\">\r\n                        <tr class=\"sw-data-grid__row\">\r\n                            <th class=\"sw-data-grid__cell\">{{ $tc('lieferzeiten.lms.notificationMatrix.notificationType') }}</th>\r\n                            <th\r\n                                v-for=\"scope in salesChannelColumns\"\r\n                                :key=\"scope.id\"\r\n                                class=\"sw-data-grid__cell\"\r\n                            >\r\n                                {{ scope.name }}\r\n                            </th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody class=\"sw-data-grid__body\">\r\n                        <tr\r\n                            v-for=\"triggerKey in triggerOptions\"\r\n                            :key=\"triggerKey\"\r\n                            class=\"sw-data-grid__row\"\r\n                        >\r\n                            <td class=\"sw-data-grid__cell\"><strong>{{ triggerKey }}</strong></td>\r\n                            <td\r\n                                v-for=\"scope in salesChannelColumns\"\r\n                                :key=\"`${triggerKey}-${scope.id}`\"\r\n                                class=\"sw-data-grid__cell\"\r\n                            >\r\n                                <div\r\n                                    v-for=\"channel in channelOptions\"\r\n                                    :key=\"`${triggerKey}-${scope.id}-${channel}`\"\r\n                                    style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;\"\r\n                                >\r\n                                    <span>{{ channel }}</span>\r\n                                    <sw-switch-field\r\n                                        :value=\"getToggleValue(triggerKey, channel, scope.id === 'global' ? null : scope.id)\"\r\n                                        :disabled=\"!hasEditAccess || isCellDisabled(triggerKey, channel, scope.id === 'global' ? null : scope.id)\"\r\n                                        @update:value=\"onToggleChanged(triggerKey, channel, scope.id === 'global' ? null : scope.id, $event)\"\r\n                                    />\r\n                                </div>\r\n                            </td>\r\n                        </tr>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </sw-card>\r\n    </template>\r\n</sw-page>\r\n","import template from './lieferzeiten-notification-toggle-list.html.twig';\r\n\r\nconst { Component } = Shopware;\r\nconst { Criteria } = Shopware.Data;\r\n\r\nComponent.register('lieferzeiten-notification-toggle-list', {\r\n    template,\r\n\r\n    mixins: ['notification'],\r\n\r\n    inject: ['repositoryFactory', 'acl'],\r\n\r\n    data() {\r\n        return {\r\n            repository: null,\r\n            salesChannelRepository: null,\r\n            items: [],\r\n            salesChannels: [],\r\n            isLoading: false,\r\n            triggerOptions: [\r\n                'commande.creee',\r\n                'commande.changement_statut',\r\n                'tracking.mis_a_jour',\r\n                'expedition.confirmee',\r\n                'changements.date_livraison',\r\n                'livraison.date.attribuee',\r\n                'livraison.date.modifiee',\r\n                'douane.requise',\r\n                'commande.storno',\r\n                'livraison.impossible',\r\n                'livraison.retoure',\r\n                'rappel.vorkasse',\r\n                'paiement.recu.vorkasse',\r\n                'commande.terminee.rappel_evaluation',\r\n                'versand.datum.ueberfaellig',\r\n                'liefertermin.anfrage.zusaetzlich',\r\n                'liefertermin.anfrage.geschlossen',\r\n                'liefertermin.anfrage.wiedereroeffnet',\r\n            ],\r\n            channelOptions: ['email'],\r\n            invalidEntries: [],\r\n        };\r\n    },\r\n\r\n    computed: {\r\n        hasEditAccess() {\r\n            if (typeof this.acl?.can !== 'function') {\r\n                return false;\r\n            }\r\n\r\n            return this.acl.can('lieferzeiten.editor') || this.acl.can('admin');\r\n        },\r\n\r\n        salesChannelColumns() {\r\n            return [\r\n                {\r\n                    id: 'global',\r\n                    name: 'Global',\r\n                },\r\n                ...this.salesChannels.map((salesChannel) => ({\r\n                    id: salesChannel.id,\r\n                    name: salesChannel.name || salesChannel.id,\r\n                })),\r\n            ];\r\n        },\r\n    },\r\n\r\n    created() {\r\n        this.repository = this.repositoryFactory.create('lieferzeiten_notification_toggle');\r\n        this.salesChannelRepository = this.repositoryFactory.create('sales_channel');\r\n        this.loadData();\r\n    },\r\n\r\n    methods: {\r\n        extractErrorMessage(error) {\r\n            return error?.response?.data?.errors?.[0]?.detail\r\n                || error?.response?.data?.message\r\n                || error?.message\r\n                || this.$tc('global.default.error');\r\n        },\r\n\r\n        notifyRequestError(error, fallbackTitle) {\r\n            this.createNotificationError({\r\n                title: fallbackTitle,\r\n                message: this.extractErrorMessage(error),\r\n            });\r\n        },\r\n\r\n        async loadData() {\r\n            this.isLoading = true;\r\n\r\n            try {\r\n                const toggleCriteria = new Criteria(1, 500);\r\n                toggleCriteria.addSorting(Criteria.sort('triggerKey', 'ASC'));\r\n                toggleCriteria.addSorting(Criteria.sort('channel', 'ASC'));\r\n                toggleCriteria.addSorting(Criteria.sort('salesChannelId', 'ASC'));\r\n\r\n                const salesChannelCriteria = new Criteria(1, 500);\r\n                salesChannelCriteria.addSorting(Criteria.sort('name', 'ASC'));\r\n\r\n                const [toggleResult, salesChannelResult] = await Promise.all([\r\n                    this.repository.search(toggleCriteria, Shopware.Context.api),\r\n                    this.salesChannelRepository.search(salesChannelCriteria, Shopware.Context.api),\r\n                ]);\r\n\r\n                this.items = [...toggleResult];\r\n                this.salesChannels = [...salesChannelResult];\r\n                this.invalidEntries = this.items.filter((item) => !this.isValidToggle(item));\r\n            } catch (error) {\r\n                this.notifyRequestError(error, this.$tc('lieferzeiten.lms.general.mainMenuItem'));\r\n            } finally {\r\n                this.isLoading = false;\r\n            }\r\n        },\r\n\r\n        getToggleEntity(triggerKey, channel, salesChannelId) {\r\n            const scopeId = salesChannelId || null;\r\n\r\n            return this.items.find((item) => item.triggerKey === triggerKey\r\n                && item.channel === channel\r\n                && (item.salesChannelId || null) === scopeId);\r\n        },\r\n\r\n        getToggleValue(triggerKey, channel, salesChannelId) {\r\n            return Boolean(this.getToggleEntity(triggerKey, channel, salesChannelId)?.enabled);\r\n        },\r\n\r\n        isValidToggle(item) {\r\n            const expectedCode = `${item.triggerKey}:${item.channel}`;\r\n\r\n            return this.triggerOptions.includes(item.triggerKey)\r\n                && this.channelOptions.includes(item.channel)\r\n                && item.code === expectedCode;\r\n        },\r\n\r\n        isCellDisabled(triggerKey, channel, salesChannelId) {\r\n            const existingEntity = this.getToggleEntity(triggerKey, channel, salesChannelId);\r\n\r\n            if (!existingEntity) {\r\n                return false;\r\n            }\r\n\r\n            return !this.isValidToggle(existingEntity);\r\n        },\r\n\r\n        async onToggleChanged(triggerKey, channel, salesChannelId, enabled) {\r\n            if (!this.hasEditAccess) {\r\n                return;\r\n            }\r\n\r\n            if (!this.triggerOptions.includes(triggerKey)) {\r\n                this.createNotificationError({\r\n                    title: 'Validation',\r\n                    message: `Trigger invalide: ${triggerKey}`,\r\n                });\r\n\r\n                return;\r\n            }\r\n\r\n            if (!this.channelOptions.includes(channel)) {\r\n                this.createNotificationError({\r\n                    title: 'Validation',\r\n                    message: `Canal invalide: ${channel}`,\r\n                });\r\n\r\n                return;\r\n            }\r\n\r\n            const normalizedSalesChannelId = salesChannelId || null;\r\n            let entity = this.getToggleEntity(triggerKey, channel, normalizedSalesChannelId);\r\n\r\n            if (entity && !this.isValidToggle(entity)) {\r\n                this.createNotificationError({\r\n                    title: 'Validation',\r\n                    message: 'Impossible de modifier une entrée incohérente. Corrigez triggerKey/channel/code via API ou supprimez-la.',\r\n                });\r\n\r\n                return;\r\n            }\r\n\r\n            if (!entity) {\r\n                entity = this.repository.create(Shopware.Context.api);\r\n                entity.triggerKey = triggerKey;\r\n                entity.channel = channel;\r\n                entity.salesChannelId = normalizedSalesChannelId;\r\n            }\r\n\r\n            entity.code = `${triggerKey}:${channel}`;\r\n            entity.enabled = Boolean(enabled);\r\n\r\n            this.isLoading = true;\r\n\r\n            try {\r\n                await this.repository.save(entity, Shopware.Context.api);\r\n                await this.loadData();\r\n            } catch (error) {\r\n                this.notifyRequestError(error, this.$tc('lieferzeiten.lms.general.mainMenuItem'));\r\n            } finally {\r\n                this.isLoading = false;\r\n            }\r\n        },\r\n    },\r\n});\r\n","import './page/lieferzeiten-channel-settings-list';\r\nimport './page/lieferzeiten-task-assignment-rule-list';\r\nimport './page/lieferzeiten-notification-toggle-list';\r\n\r\nconst { Module } = Shopware;\r\n\r\nModule.register('lieferzeiten-settings', {\r\n    type: 'plugin',\r\n    name: 'lieferzeiten-settings',\r\n    title: 'lieferzeiten.lms.general.mainMenuItem',\r\n    description: 'lieferzeiten.lms.general.description',\r\n    color: '#009ee3',\r\n    icon: 'regular-cog',\r\n\r\n    routes: {\r\n        index: {\r\n            component: 'lieferzeiten-channel-settings-list',\r\n            path: '',\r\n            meta: {\r\n                privilege: 'admin',\r\n            },\r\n        },\r\n        channelSettings: {\r\n            component: 'lieferzeiten-channel-settings-list',\r\n            path: 'channel-settings',\r\n            meta: {\r\n                privilege: 'admin',\r\n            },\r\n        },\r\n        taskAssignmentRules: {\r\n            component: 'lieferzeiten-task-assignment-rule-list',\r\n            path: 'task-assignment-rules',\r\n            meta: {\r\n                privilege: 'admin',\r\n            },\r\n        },\r\n        notificationToggles: {\r\n            component: 'lieferzeiten-notification-toggle-list',\r\n            path: 'notification-toggles',\r\n            meta: {\r\n                privilege: 'admin',\r\n            },\r\n        },\r\n    },\r\n\r\n    navigation: [\r\n        {\r\n            id: 'lieferzeiten-settings',\r\n            label: 'lieferzeiten.lms.general.mainMenuItem',\r\n            color: '#009ee3',\r\n            path: 'lieferzeiten.settings.index',\r\n            icon: 'regular-cog',\r\n            parent: 'sw-order',\r\n            position: 90,\r\n        },\r\n        {\r\n            id: 'lieferzeiten-settings-main-list',\r\n            label: 'lieferzeiten.general.mainMenuItemGeneral',\r\n            color: '#009ee3',\r\n            path: 'lieferzeiten.index',\r\n            parent: 'lieferzeiten-settings',\r\n            position: 5,\r\n        },\r\n        {\r\n            id: 'lieferzeiten-settings-channel',\r\n            label: 'lieferzeiten.lms.navigation.thresholdsByChannel',\r\n            color: '#009ee3',\r\n            path: 'lieferzeiten.settings.index',\r\n            parent: 'lieferzeiten-settings',\r\n            position: 10,\r\n        },\r\n        {\r\n            id: 'lieferzeiten-settings-task',\r\n            label: 'lieferzeiten.lms.navigation.taskAssignmentRules',\r\n            color: '#009ee3',\r\n            path: 'lieferzeiten.settings.taskAssignmentRules',\r\n            parent: 'lieferzeiten-settings',\r\n            position: 20,\r\n        },\r\n        {\r\n            id: 'lieferzeiten-settings-notifications',\r\n            label: 'lieferzeiten.lms.navigation.notificationToggles',\r\n            color: '#009ee3',\r\n            path: 'lieferzeiten.settings.notificationToggles',\r\n            parent: 'lieferzeiten-settings',\r\n            position: 30,\r\n        },\r\n    ],\r\n});\r\n","/* eslint-disable */\r\nimport deSnippets from '../module/lieferzeiten/snippet/de-DE.json';\r\nimport enSnippets from '../module/lieferzeiten/snippet/en-GB.json';\r\n\r\nShopware.Locale.extend('de-DE', deSnippets);\r\nShopware.Locale.extend('en-GB', enSnippets);\r\n","const { ApiService } = Shopware.Classes;\r\n\r\nclass LieferzeitenTrackingService extends ApiService {\r\n    constructor(httpClient, loginService, apiEndpoint = 'lieferzeiten') {\r\n        super(httpClient, loginService, apiEndpoint);\r\n        this.name = 'lieferzeitenTrackingService';\r\n    }\r\n\r\n    async history(carrier, trackingNumber) {\r\n        const response = await this.httpClient.get(`_action/${this.getApiBasePath()}/tracking/${encodeURIComponent(carrier)}/${encodeURIComponent(trackingNumber)}`, {\r\n            headers: this.getBasicHeaders(),\r\n        });\r\n\r\n        const data = ApiService.handleResponse(response) ?? response?.data;\r\n        return data?.data ?? data;\r\n    }\r\n}\r\n\r\nShopware.Application.addServiceProvider('lieferzeitenTrackingService', (container) => {\r\n    const initContainer = Shopware.Application.getContainer('init');\r\n    const httpClient = initContainer?.httpClient ?? container.httpClient;\r\n    const loginService = container.loginService ?? Shopware.Service('loginService');\r\n\r\n    return new LieferzeitenTrackingService(httpClient, loginService);\r\n});\r\n","const { ApiService } = Shopware.Classes;\r\n\r\nclass LieferzeitenOrdersService extends ApiService {\r\n    constructor(httpClient, loginService) {\r\n        super(httpClient, loginService, 'lieferzeiten');\r\n        this.name = 'lieferzeitenOrdersService';\r\n    }\r\n\r\n    async getOrders(params = {}) {\r\n        const response = await this.httpClient.get(`_action/${this.getApiBasePath()}/orders`, {\r\n            params,\r\n            headers: this.getBasicHeaders(),\r\n        });\r\n\r\n        const data = ApiService.handleResponse(response) ?? response?.data;\r\n        const rows = data?.data ?? data ?? [];\r\n\r\n        if (!Array.isArray(rows)) {\r\n            return [];\r\n        }\r\n\r\n        return rows.map((row) => this.normalizeOrderRow(row));\r\n    }\r\n\r\n    async getOrderDetails(paketId) {\r\n        const response = await this.httpClient.get(`_action/${this.getApiBasePath()}/orders/${encodeURIComponent(paketId)}/details`, {\r\n            headers: this.getBasicHeaders(),\r\n        });\r\n\r\n        const data = ApiService.handleResponse(response) ?? response?.data ?? {};\r\n\r\n        const details = data?.data || data;\r\n\r\n        return this.normalizeOrderDetails(details);\r\n    }\r\n\r\n    normalizeOrderRow(row = {}) {\r\n        return {\r\n            ...row,\r\n            orderNumber: row.orderNumber || null,\r\n            san6OrderNumber: row.san6OrderNumber || null,\r\n            san6Position: row.san6Position || null,\r\n            quantity: row.quantity || null,\r\n            paymentMethod: row.paymentMethod || null,\r\n            paymentDate: row.paymentDate || null,\r\n            trackingSummary: row.trackingSummary || null,\r\n            shippingAssignmentType: row.shippingAssignmentType || null,\r\n            sourceSystem: row.sourceSystem || null,\r\n            domain: row.domain || null,\r\n            positions: Array.isArray(row.positions) ? row.positions : [],\r\n            parcels: Array.isArray(row.parcels) ? row.parcels : [],\r\n            lieferterminLieferantHistory: Array.isArray(row.lieferterminLieferantHistory) ? row.lieferterminLieferantHistory : [],\r\n            neuerLieferterminHistory: Array.isArray(row.neuerLieferterminHistory) ? row.neuerLieferterminHistory : [],\r\n            commentHistory: Array.isArray(row.commentHistory) ? row.commentHistory : [],\r\n        };\r\n    }\r\n\r\n    normalizeOrderDetails(details) {\r\n        if (!details || typeof details !== 'object') {\r\n            return details;\r\n        }\r\n\r\n        return this.normalizeOrderRow(details);\r\n    }\r\n\r\n    async getStatistics(params = {}) {\r\n        try {\r\n            const response = await this.httpClient.get(`_action/${this.getApiBasePath()}/v1/statistics`, {\r\n                params,\r\n                headers: this.getBasicHeaders(),\r\n            });\r\n\r\n            return ApiService.handleResponse(response) ?? response?.data ?? {};\r\n        } catch (error) {\r\n            const statusCode = error?.response?.status;\r\n            if (statusCode !== 404) {\r\n                throw error;\r\n            }\r\n\r\n            const response = await this.httpClient.get(`_action/${this.getApiBasePath()}/statistics`, {\r\n                params,\r\n                headers: this.getBasicHeaders(),\r\n            });\r\n\r\n            return ApiService.handleResponse(response) ?? response?.data ?? {};\r\n        }\r\n    }\r\n\r\n\r\n\r\n    async getDemoDataStatus() {\r\n        const response = await this.httpClient.get(`_action/${this.getApiBasePath()}/demo-data/status`, {\r\n            headers: this.getBasicHeaders(),\r\n        });\r\n\r\n        return ApiService.handleResponse(response) ?? response?.data ?? {};\r\n    }\r\n\r\n    async toggleDemoData() {\r\n        const status = await this.getDemoDataStatus();\r\n\r\n        if (Boolean(status?.hasDemoData)) {\r\n            const response = await this.httpClient.post(`_action/${this.getApiBasePath()}/demo-data/toggle`, {}, {\r\n                headers: this.getBasicHeaders(),\r\n            });\r\n\r\n            return ApiService.handleResponse(response) ?? response?.data ?? {};\r\n        }\r\n\r\n        return this.seedLinkedDemoData();\r\n    }\r\n\r\n    async seedLinkedDemoData() {\r\n        const response = await this.httpClient.post('_action/external-orders/demo-data/seed-linked', {}, {\r\n            headers: this.getBasicHeaders(),\r\n        });\r\n\r\n        return ApiService.handleResponse(response) ?? response?.data ?? {};\r\n    }\r\n\r\n    async seedDemoData(reset = false) {\r\n        const response = await this.httpClient.post(`_action/${this.getApiBasePath()}/demo-data`, { reset }, {\r\n            headers: this.getBasicHeaders(),\r\n        });\r\n\r\n        return ApiService.handleResponse(response) ?? response?.data ?? {};\r\n    }\r\n\r\n    async getSalesChannelLieferzeiten(salesChannelId) {\r\n        const response = await this.httpClient.get(`_action/${this.getApiBasePath()}/sales-channel/${encodeURIComponent(salesChannelId)}/lieferzeiten`, {\r\n            headers: this.getBasicHeaders(),\r\n        });\r\n\r\n        return ApiService.handleResponse(response) ?? response?.data ?? {};\r\n    }\r\n\r\n    async updateLieferterminLieferant(positionId, payload) {\r\n        return this.post(`position/${positionId}/liefertermin-lieferant`, payload);\r\n    }\r\n\r\n    async updateNeuerLiefertermin(positionId, payload) {\r\n        return this.post(`position/${positionId}/neuer-liefertermin`, payload);\r\n    }\r\n\r\n    async updateNeuerLieferterminByPaket(paketId, payload) {\r\n        return this.post(`paket/${paketId}/neuer-liefertermin`, payload);\r\n    }\r\n\r\n    async updateComment(positionId, payload) {\r\n        if (!positionId) {\r\n            throw new Error('Missing position id');\r\n        }\r\n\r\n        return this.post(`position/${positionId}/comment`, payload);\r\n    }\r\n\r\n    async createAdditionalDeliveryRequest(positionId, initiator = null) {\r\n        const payload = {};\r\n\r\n        if (initiator && typeof initiator === 'object') {\r\n            if (typeof initiator.display === 'string' && initiator.display.trim() !== '') {\r\n                payload.initiatorDisplay = initiator.display.trim();\r\n            }\r\n\r\n            if (typeof initiator.userId === 'string' && initiator.userId.trim() !== '') {\r\n                payload.initiatorUserId = initiator.userId.trim();\r\n            }\r\n        } else if (typeof initiator === 'string' && initiator.trim() !== '') {\r\n            payload.initiator = initiator.trim();\r\n        }\r\n\r\n        return this.post(`position/${positionId}/additional-delivery-request`, payload);\r\n    }\r\n\r\n    async updatePaketStatus(paketId, payload) {\r\n        return this.post(`paket/${paketId}/status`, payload);\r\n    }\r\n\r\n    async post(path, payload) {\r\n        const response = await this.httpClient.post(`_action/${this.getApiBasePath()}/${path}`, payload, {\r\n            headers: this.getBasicHeaders(),\r\n        });\r\n\r\n        return ApiService.handleResponse(response) ?? response?.data;\r\n    }\r\n}\r\n\r\nShopware.Application.addServiceProvider('lieferzeitenOrdersService', (container) => {\r\n    const initContainer = Shopware.Application.getContainer('init');\r\n    const httpClient = initContainer?.httpClient ?? container.httpClient;\r\n    const loginService = container.loginService ?? Shopware.Service('loginService');\r\n\r\n    return new LieferzeitenOrdersService(httpClient, loginService);\r\n});\r\n","const INTERCEPTOR_FLAG = '__lieferzeitenStoreApiFallbackInterceptorInstalled';\r\nconst STORE_UPDATES_PATH = '/api/_action/store/updates';\r\nconst EXTENSION_INSTALLED_PATH = '/api/_action/extension/installed';\r\n\r\nfunction isKnownStoreEndpoint(url = '') {\r\n    return url.includes(STORE_UPDATES_PATH) || url.includes(EXTENSION_INSTALLED_PATH);\r\n}\r\n\r\nfunction createFallbackResponse(error) {\r\n    const config = error?.config || {};\r\n    const url = String(config.url || '');\r\n\r\n    if (url.includes(STORE_UPDATES_PATH)) {\r\n        return {\r\n            data: {\r\n                total: 0,\r\n                updates: [],\r\n                items: [],\r\n            },\r\n            status: 200,\r\n            statusText: 'OK',\r\n            headers: {},\r\n            config,\r\n        };\r\n    }\r\n\r\n    return {\r\n        data: {\r\n            data: [],\r\n            total: 0,\r\n        },\r\n        status: 200,\r\n        statusText: 'OK',\r\n        headers: {},\r\n        config,\r\n    };\r\n}\r\n\r\nfunction installStoreApiFallbackInterceptor() {\r\n    if (window[INTERCEPTOR_FLAG]) {\r\n        return;\r\n    }\r\n\r\n    const initContainer = Shopware.Application.getContainer('init');\r\n    const httpClient = initContainer?.httpClient;\r\n\r\n    if (!httpClient?.interceptors?.response) {\r\n        return;\r\n    }\r\n\r\n    httpClient.interceptors.response.use(\r\n        (response) => response,\r\n        (error) => {\r\n            const status = error?.response?.status;\r\n            const url = String(error?.config?.url || '');\r\n\r\n            if (status === 500 && isKnownStoreEndpoint(url)) {\r\n                // eslint-disable-next-line no-console\r\n                console.warn('[LieferzeitenAdmin] Store API unavailable, using empty fallback response for:', url);\r\n                return Promise.resolve(createFallbackResponse(error));\r\n            }\r\n\r\n            return Promise.reject(error);\r\n        },\r\n    );\r\n\r\n    window[INTERCEPTOR_FLAG] = true;\r\n}\r\n\r\ninstallStoreApiFallbackInterceptor();\r\n","const { Component, Mixin } = Shopware;\r\n\r\nComponent.register('lieferzeiten-demo-data-button', {\r\n    template: `\r\n        <div class=\"lieferzeiten-demo-data-button\">\r\n            <label class=\"sw-field__label\" v-if=\"label\">{{ label }}</label>\r\n            <sw-button\r\n                variant=\"primary\"\r\n                size=\"small\"\r\n                :disabled=\"isLoading\"\r\n                @click=\"onToggleDemoData\"\r\n            >\r\n                {{ buttonLabel }}\r\n            </sw-button>\r\n            <div v-if=\"helpText\" class=\"sw-field__help-text\">\r\n                {{ helpText }}\r\n            </div>\r\n        </div>\r\n    `,\r\n\r\n    inject: ['lieferzeitenOrdersService'],\r\n\r\n    mixins: [\r\n        Mixin.getByName('notification'),\r\n    ],\r\n\r\n    props: {\r\n        element: {\r\n            type: Object,\r\n            required: false,\r\n            default: null,\r\n        },\r\n    },\r\n\r\n    data() {\r\n        return {\r\n            isLoading: false,\r\n            hasDemoData: false,\r\n        };\r\n    },\r\n\r\n    computed: {\r\n        label() {\r\n            return this.element?.label ?? '';\r\n        },\r\n        helpText() {\r\n            return this.element?.helpText ?? '';\r\n        },\r\n        buttonLabel() {\r\n            return this.hasDemoData ? 'Demo-Daten entfernen' : 'Demo-Daten speichern';\r\n        },\r\n    },\r\n\r\n    async created() {\r\n        await this.loadStatus();\r\n    },\r\n\r\n    methods: {\r\n        async loadStatus() {\r\n            this.isLoading = true;\r\n\r\n            try {\r\n                const response = await this.lieferzeitenOrdersService.getDemoDataStatus();\r\n                this.hasDemoData = Boolean(response?.hasDemoData);\r\n            } catch (error) {\r\n                this.createNotificationError({\r\n                    title: 'Demo-Daten Status',\r\n                    message: error?.message || 'Status konnte nicht geladen werden.',\r\n                });\r\n            } finally {\r\n                this.isLoading = false;\r\n            }\r\n        },\r\n\r\n        async onToggleDemoData() {\r\n            if (this.isLoading) {\r\n                return;\r\n            }\r\n\r\n            this.isLoading = true;\r\n\r\n            try {\r\n                const response = await this.lieferzeitenOrdersService.toggleDemoData();\r\n                const isRemoved = response?.action === 'removed';\r\n                const hasSummary = Object.prototype.hasOwnProperty.call(response || {}, 'createdExternalOrders');\r\n                this.hasDemoData = isRemoved ? false : (hasSummary ? true : Boolean(response?.hasDemoData));\r\n\r\n                if (isRemoved) {\r\n                    const removed = response?.deleted || {};\r\n                    const totalRemoved = Object.values(removed).reduce((sum, value) => sum + Number(value || 0), 0);\r\n\r\n                    this.createNotificationSuccess({\r\n                        title: 'Demo-Daten entfernt',\r\n                        message: totalRemoved > 0\r\n                            ? `${totalRemoved} Demo-Datensätze wurden entfernt.`\r\n                            : 'Keine Demo-Daten waren vorhanden.',\r\n                    });\r\n\r\n                    return;\r\n                }\r\n\r\n                if (hasSummary) {\r\n                    const missing = Array.isArray(response?.missing) ? response.missing.length : 0;\r\n                    this.createNotificationSuccess({\r\n                        title: 'Demo-Daten gespeichert',\r\n                        message: `${response?.createdExternalOrders ?? 0} externe Bestellungen, ${response?.createdLieferzeiten ?? 0} Lieferzeiten-Datensätze, ${response?.linked ?? 0} verknüpft${missing > 0 ? `, ${missing} fehlend` : ''}.`,\r\n                    });\r\n\r\n                    return;\r\n                }\r\n\r\n                const created = response?.created || {};\r\n                const totalCreated = Object.values(created).reduce((sum, value) => sum + Number(value || 0), 0);\r\n\r\n                this.createNotificationSuccess({\r\n                    title: 'Demo-Daten gespeichert',\r\n                    message: totalCreated > 0\r\n                        ? `${totalCreated} Demo-Datensätze wurden gespeichert.`\r\n                        : 'Keine neuen Demo-Datensätze wurden gespeichert.',\r\n                });\r\n            } catch (error) {\r\n                this.createNotificationError({\r\n                    title: 'Demo-Daten',\r\n                    message: error?.response?.data?.message || error?.message || 'Aktion konnte nicht ausgeführt werden.',\r\n                });\r\n            } finally {\r\n                this.isLoading = false;\r\n            }\r\n        },\r\n    },\r\n});\r\n"],"names":["template$8","DOMAIN_GROUPS","DEFAULT_DOMAIN_KEY","DEFAULT_GROUP_ID","DOMAIN_SOURCE_MAPPING","LEGACY_DOMAIN_KEY_MAPPING","LEGACY_GROUP_KEY_MAPPING","getChannelsForGroup","groupId","_a","group","getDefaultDomainForGroup","normalizeGroupKey","normalized","resolveGroupKeyForDomain","domain","normalizedDomain","normalizeDomainKey","channel","resolveDomainKeyForSourceSystem","sourceSystem","normalizedSource","mappedDomain","sources","DOMAIN_SOURCE_MAP","DOMAIN_LABEL_ALIASES","createDefaultFilters","template","domainKey","order","bereich","_b","_c","payload","orderDomain","aliasMatch","normalizedOrderDomain","source","result","orders","error","params","key","value","normalizedValue","template$7","template$6","template$5","toNumber","parsed","toTimelineDate","point","toTimelineValue","toIsoDate","dateString","date","matchesFilter","selectedChannel","selectedDomain","normalizeTimelinePoints","timeline","groupedPoints","accumulator","timelineDate","isoDate","left","right","TASK_CLOSABLE_STATUSES","TASK_REOPENABLE_STATUSES","item","activity","width","height","maxValue","step","linePath","index","x","y","areaPath","actions","eventType","hasOrderReference","normalizedStatus","isClosable","isReopenable","operation","isActionAvailable","loadingKey","trackingNumber","action","headers","rows","csv","line","blob","link","template$4","STORAGE_CHANNEL_KEY","STORAGE_BEREICH_KEY","LEGACY_STORAGE_GROUP_KEY","LEGACY_STORAGE_DOMAIN_KEY","newValue","normalizedChannel","oldValue","nextChannel","fallbackGroup","storage","rawBereich","rawLegacyGroup","rawChannel","rawLegacyDomain","normalizedBereich","localSelection","sessionSelection","propChannel","emit","persist","resolvedGroup","resolvedChannel","targetStorage","secondaryStorage","template$3","BUSINESS_STATUS_SNIPPETS","INTERNAL_SHIPPING_LABEL","newOrders","aggregatedMode","positions","position","positionIndex","trackingEntries","supplierRange","status","code","snippet","businessStatus","labelKey","parcel","newRange","parcelNewRange","commentTargetPositionId","rawComment","firstOpenPosition","currentTargetPositionId","validPositionId","fallbackRange","from","to","fieldPrefix","fallbackMaxDays","fallbackDays","days","fromDate","toDate","orderId","id","details","mergedOrder","editable","existing","parcels","values","total","acc","raw","numeric","primaryParts","additionalParts","nameParts","keys","candidate","rawStatus","entry","actor","changedAt","fallbackCarrier","carrier","packageEntries","pkg","number","entries","fallbackEntry","seen","candidates","response","changedBy","statusCode","statusLabel","snippetKey","fallbackLabel","translatedLabel","resolvedLabel","nextStatus","currentStatus","paketId","shippingType","orderedQuantity","shippedQuantity","fallbackQuantity","range","minDays","maxDays","originalRange","target","refresh","data","dateValue","base","dayNum","yearStart","positionId","initiator","targetStatus","task","currentStatusByPosition","currentTask","previousTask","_d","_e","_f","_g","_h","contextUser","sessionUser","user","userId","readableName","part","Module","template$2","LMS_TARGET_CHANNELS","TECHNICAL_IDENTIFIER_TO_DOMAIN_KEY","config","identifier","normalizeIdentifier","normalizeDomainFromUrl","url","parsedUrl","resolveLmsTargetChannelKey","domainMatch","isLmsTargetChannel","Component","Criteria","PDMS_SLOTS","LMS_TARGET_DOMAIN_KEYS","targetChannel","CHANNEL_GROUP_TITLES","LMS_FALLBACK_CHANNEL_IDS","CHANNEL_GROUPS","groupTitle","sourceGroup","channelDomainKey","OTHER_CHANNELS_GROUP","groupedEntries","channelsWithoutMapping","matchingGroup","visibleGroups","channels","resolvedDomainKeys","mergedChannels","salesChannels","whitelistedChannels","channelId","nextSelections","currentSelection","hasCurrentSelection","selectedChannelId","lmsTargetDomainKey","domainFromChannelDomain","fallbackTitle","slot","entriesBySlot","pdmsKey","fieldName","normalizedEntries","rawValue","trimmed","fieldKey","thresholdCriteria","salesChannelCriteria","thresholds","loadedChannelIds","entryKey","whitelistedChannelIds","existingEntries","criteria","existingEntity","entity","isRemoved","hasSummary","template$1","triggerKey","assigneeType","assigneeIdentifier","ruleId","rawConditions","hasConditions","message","page","limit","validationError","salesChannel","toggleCriteria","toggleResult","salesChannelResult","salesChannelId","scopeId","expectedCode","enabled","normalizedSalesChannelId","deSnippets","enSnippets","ApiService","LieferzeitenTrackingService","httpClient","loginService","apiEndpoint","container","initContainer","LieferzeitenOrdersService","row","reset","path","INTERCEPTOR_FLAG","STORE_UPDATES_PATH","EXTENSION_INSTALLED_PATH","isKnownStoreEndpoint","createFallbackResponse","installStoreApiFallbackInterceptor","Mixin","removed","totalRemoved","sum","missing","created","totalCreated"],"mappings":"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"}