const F=`{% block lieferzeiten_index %} <sw-page class="lieferzeiten-index"> <template #smart-bar-header> <h2> {{ $t('lieferzeiten.general.mainMenuItemGeneral') }} </h2> </template> <template #smart-bar-actions> <lieferzeiten-domain-selection v-model="selectedDomain" /> </template> <template #content> <sw-card-view> <sw-card class="lieferzeiten-index__info" :title="$t('lieferzeiten.general.infoTitle')"> <p>{{ $t('lieferzeiten.general.timezoneInfo') }}</p> <p>{{ $t('lieferzeiten.general.openDefinition') }}</p> </sw-card> <sw-card class="lieferzeiten-index__filters" :title="$t('global.sw-data-grid.filterPanel.title')"> <sw-container columns="repeat(auto-fit, minmax(220px, 1fr))" gap="16px"> <sw-text-field v-model:value="filters.bestellnummer" label="Bestellnummer" /> <sw-text-field v-model:value="filters.san6" label="San6 Auftragsnummer" /> <sw-text-field v-model:value="filters.user" label="Username" /> <sw-text-field v-model:value="filters.sendenummer" label="Sendenummer" /> <sw-text-field v-model:value="filters.status" label="Status" /> <sw-datepicker v-model:value="filters.shippingDateFrom" label="spätester Versandzeitpunkt (von)" /> <sw-datepicker v-model:value="filters.shippingDateTo" label="spätester Versandzeitpunkt (bis)" /> <sw-datepicker v-model:value="filters.businessDateFrom" label="Versand-Datum (von)" /> <sw-datepicker v-model:value="filters.businessDateTo" label="Versand-Datum (bis)" /> <sw-datepicker v-model:value="filters.deliveryDateFrom" label="spätester Lieferzeitpunkt (von)" /> <sw-datepicker v-model:value="filters.deliveryDateTo" label="spätester Lieferzeitpunkt (bis)" /> <sw-datepicker v-model:value="filters.businessDateEndFrom" label="Liefer-Datum (von)" /> <sw-datepicker v-model:value="filters.businessDateEndTo" label="Liefer-Datum (bis)" /> <sw-datepicker v-model:value="filters.lieferterminLieferantFrom" label="Liefertermin Lieferant (von)" /> <sw-datepicker v-model:value="filters.lieferterminLieferantTo" label="Liefertermin Lieferant (bis)" /> <sw-datepicker v-model:value="filters.neuerLieferterminFrom" label="Liefertermin Auftragsbearbeitung (von)" /> <sw-datepicker v-model:value="filters.neuerLieferterminTo" label="Liefertermin Auftragsbearbeitung (bis)" /> </sw-container> <div class="lieferzeiten-index__filter-actions"> <sw-button variant="primary" @click="applyFilters">Filtern</sw-button> <sw-button variant="ghost" @click="resetFilters">Zurücksetzen</sw-button> </div> </sw-card> <sw-card class="lieferzeiten-index__tabs"> <sw-loader v-if="isLoading" /> <sw-empty-state v-else-if="loadError" :title="$t('lieferzeiten.loading.errorTitle')" :subline="$t('lieferzeiten.loading.errorDescription')" > <template #actions> <sw-button variant="primary" @click="reloadData"> {{ $t('lieferzeiten.loading.retry') }} </sw-button> </template> </sw-empty-state> <template v-else> <sw-tabs> <sw-tabs-item :to="{ name: 'lieferzeiten.all' }" :title="$t('lieferzeiten.tabs.all')" > {{ $t('lieferzeiten.tabs.all') }} </sw-tabs-item> <sw-tabs-item :to="{ name: 'lieferzeiten.open' }" :title="$t('lieferzeiten.tabs.open')" > {{ $t('lieferzeiten.tabs.open') }} </sw-tabs-item> <sw-tabs-item :to="{ name: 'lieferzeiten.statistics' }" :title="$t('lieferzeiten.tabs.statistics')" > {{ $t('lieferzeiten.tabs.statistics') }} </sw-tabs-item> </sw-tabs> <router-view :orders="filteredOrders" :selected-domain="selectedDomain" :on-reload-order="loadOrders" :statistics-metrics="statisticsMetrics" /> </template> </sw-card> </sw-card-view> </template> </sw-page> {% endblock %}`,v=[{id:"first-medical-e-commerce",labelSnippet:"lieferzeiten.domainSelection.groups.firstMedicalECommerce",channels:[{value:"first-medical-shop.de",labelSnippet:"lieferzeiten.domainSelection.channels.firstMedicalShop"},{value:"ebay.de",labelSnippet:"lieferzeiten.domainSelection.channels.ebayDe"},{value:"ebay.at",labelSnippet:"lieferzeiten.domainSelection.channels.ebayAt"},{value:"kaufland",labelSnippet:"lieferzeiten.domainSelection.channels.kaufland"},{value:"peg",labelSnippet:"lieferzeiten.domainSelection.channels.peg"},{value:"zonami",labelSnippet:"lieferzeiten.domainSelection.channels.zonami"}]},{id:"medical-solutions",labelSnippet:"lieferzeiten.domainSelection.groups.medicalSolutions",channels:[{value:"medical-solutions-germany.de",labelSnippet:"lieferzeiten.domainSelection.channels.medicalSolutionsGermany"}]}],g="first-medical-shop.de",u="first-medical-e-commerce",M={"first-medical-shop.de":["first-medical-shop.de","first medical","e-commerce","shopware","gambio","first-medical-e-commerce"],"ebay.de":["ebay.de","ebay de"],"ebay.at":["ebay.at","ebay at"],kaufland:["kaufland"],peg:["peg"],zonami:["zonami"],"medical-solutions-germany.de":["medical-solutions-germany.de","medical solutions","medical-solutions","medical_solutions"]},T={"first medical":g,"e-commerce":g,"first medical - e-commerce":g,"first-medical-e-commerce":g,"medical solutions":"medical-solutions-germany.de","medical-solutions":"medical-solutions-germany.de"},C={"first medical":u,"e-commerce":u,"first medical - e-commerce":u,"first-medical-e-commerce":u,"medical solutions":"medical-solutions","medical-solutions":"medical-solutions"};function D(e){var t;return((t=v.find(i=>i.id===e))==null?void 0:t.channels)||[]}function O(e){var t;return((t=D(e)[0])==null?void 0:t.value)||null}function z(e){const t=String(e||"").trim().toLowerCase();return t?C[t]?C[t]:v.some(i=>i.id===t)?t:null:null}function V(e){var i;const t=c(e);return t&&((i=v.find(s=>s.channels.some(a=>a.value===t)))==null?void 0:i.id)||null}function c(e){const t=String(e||"").trim().toLowerCase();return t?T[t]?T[t]:M[t]?t:null:null}function K(e){const t=String(e||"").trim().toLowerCase();if(!t)return null;const i=Object.entries(M).find(([,s])=>s.includes(t));return i?i[0]:c(t)}const E={"first-medical-shop.de":["first-medical-shop.de","first medical","e-commerce","shopware","gambio","first-medical-e-commerce"],"ebay.de":["ebay.de","ebay de"],"ebay.at":["ebay.at","ebay at"],kaufland:["kaufland"],peg:["peg"],zonami:["zonami"],"medical-solutions-germany.de":["medical-solutions-germany.de","medical solutions","medical-solutions"]},q={"First Medical":"first-medical-shop.de","E-Commerce":"first-medical-shop.de","First Medical - E-Commerce":"first-medical-shop.de","Medical Solutions":"medical-solutions-germany.de"};Shopware.Component.register("lieferzeiten-index",{template:F,inject:["lieferzeitenOrdersService"],data(){return{selectedDomain:null,orders:[],isLoading:!1,isStatisticsLoading:!1,loadError:null,statisticsMetrics:{openOrders:0,overdueShipping:0,overdueDelivery:0}}},created(){this.loadOrders(),this.loadStatistics()},watch:{selectedDomain(){this.loadOrders(),this.loadStatistics()}},computed:{filteredOrders(){const e=c(this.selectedDomain);return e?this.orders.filter(t=>t.domainKey===e):[]}},methods:{async loadStatistics(){var e,t,i;try{const s=await this.lieferzeitenOrdersService.getStatistics({period:30,domain:c(this.selectedDomain),channel:"all"});this.statisticsMetrics={openOrders:((e=s==null?void 0:s.metrics)==null?void 0:e.openOrders)??0,overdueShipping:((t=s==null?void 0:s.metrics)==null?void 0:t.overdueShipping)??0,overdueDelivery:((i=s==null?void 0:s.metrics)==null?void 0:i.overdueDelivery)??0}}catch{this.statisticsMetrics={openOrders:0,overdueShipping:0,overdueDelivery:0}}},resolveOrderDomainKey(e){const t=String((e==null?void 0:e.domain)||(e==null?void 0:e.sourceSystem)||"").trim();if(t==="")return null;const i=q[t];if(i)return i;const s=t.toLowerCase();return Object.keys(E).find(a=>E[a].map(n=>n.toLowerCase()).includes(s))||null},async reloadData(){await Promise.all([this.loadOrders(),this.loadStatistics()])},async loadOrders(){this.isLoading=!0,this.loadError=null;try{const e=c(this.selectedDomain),t=await this.lieferzeitenOrdersService.getOrders({...this.buildFilterParams(),domain:e}),i=Array.isArray(t)?t:[];this.orders=i.map(s=>({...s,domainKey:K(s.sourceSystem||s.domain)}))}catch(e){this.orders=[],this.loadError=e}finally{this.isLoading=!1}},buildFilterParams(){return Object.entries(this.filters).reduce((e,[t,i])=>{if(i==null)return e;const s=typeof i=="string"?i.trim():i;return s===""||(e[t]=s),e},{})},applyFilters(){this.loadOrders()},resetFilters(){this.filters={bestellnummer:"",san6:"",shippingDateFrom:null,shippingDateTo:null,businessDateFrom:null,businessDateTo:null,deliveryDateFrom:null,deliveryDateTo:null,businessDateEndFrom:null,businessDateEndTo:null,lieferterminLieferantFrom:null,lieferterminLieferantTo:null,neuerLieferterminFrom:null,neuerLieferterminTo:null,user:"",sendenummer:"",status:""},this.loadOrders()}}});const U=`{% block lieferzeiten_all %} <div class="lieferzeiten-all"> <sw-container columns="repeat(auto-fit, minmax(180px, 1fr))" gap="16px"> <sw-card class="lieferzeiten-kpi"> <p class="lieferzeiten-kpi__label">{{ $t('lieferzeiten.statistics.open') }}</p> <p class="lieferzeiten-kpi__value">{{ statisticsMetrics.openOrders }}</p> </sw-card> <sw-card class="lieferzeiten-kpi"> <p class="lieferzeiten-kpi__label">{{ $t('lieferzeiten.statistics.overdueShipping') }}</p> <p class="lieferzeiten-kpi__value">{{ statisticsMetrics.overdueShipping }}</p> </sw-card> <sw-card class="lieferzeiten-kpi"> <p class="lieferzeiten-kpi__label">{{ $t('lieferzeiten.statistics.overdueDelivery') }}</p> <p class="lieferzeiten-kpi__value">{{ statisticsMetrics.overdueDelivery }}</p> </sw-card> </sw-container> <lieferzeiten-order-table :orders="orders" :on-reload-order="onReloadOrder" /> </div> {% endblock %}`;Shopware.Component.register("lieferzeiten-all",{template:U,props:{orders:{type:Array,required:!0,default:()=>[]},selectedDomain:{type:String,required:!1,default:null},onReloadOrder:{type:Function,required:!1,default:null},statisticsMetrics:{type:Object,required:!1,default:()=>({openOrders:0,overdueShipping:0,overdueDelivery:0})}}});const G=`{% block lieferzeiten_open %} <div class="lieferzeiten-open"> <sw-container columns="repeat(auto-fit, minmax(180px, 1fr))" gap="16px"> <sw-card class="lieferzeiten-kpi"> <p class="lieferzeiten-kpi__label">{{ $t('lieferzeiten.statistics.open') }}</p> <p class="lieferzeiten-kpi__value">{{ statisticsMetrics.openOrders }}</p> </sw-card> <sw-card class="lieferzeiten-kpi"> <p class="lieferzeiten-kpi__label">{{ $t('lieferzeiten.statistics.overdueShipping') }}</p> <p class="lieferzeiten-kpi__value">{{ statisticsMetrics.overdueShipping }}</p> </sw-card> <sw-card class="lieferzeiten-kpi"> <p class="lieferzeiten-kpi__label">{{ $t('lieferzeiten.statistics.overdueDelivery') }}</p> <p class="lieferzeiten-kpi__value">{{ statisticsMetrics.overdueDelivery }}</p> </sw-card> </sw-container> <lieferzeiten-order-table :orders="orders" :only-open="true" :on-reload-order="onReloadOrder" /> </div> {% endblock %}`;Shopware.Component.register("lieferzeiten-open",{template:G,props:{orders:{type:Array,required:!0,default:()=>[]},selectedDomain:{type:String,required:!1,default:null},onReloadOrder:{type:Function,required:!1,default:null},statisticsMetrics:{type:Object,required:!1,default:()=>({openOrders:0,overdueShipping:0,overdueDelivery:0})}}});const H=`{% block lieferzeiten_statistics %} <div class="lieferzeiten-statistics"> <sw-container columns="1fr auto auto" gap="16px" class="lieferzeiten-statistics__filters"> <sw-single-select v-model:value="selectedPeriod" :label="$t('lieferzeiten.statistics.periodLabel')" :options="periodOptions" labelProperty="label" valueProperty="value" /> <sw-single-select v-model:value="selectedChannel" :label="$t('lieferzeiten.statistics.channelLabel')" :options="channelOptions" labelProperty="label" valueProperty="value" /> <sw-button variant="primary" @click="exportCsv"> {{ $t('lieferzeiten.statistics.exportCsv') }} </sw-button> </sw-container> <sw-loader v-if="isLoading" /> <sw-empty-state v-else-if="loadError" :title="$t('lieferzeiten.loading.errorTitle')" :description="$t('lieferzeiten.loading.errorDescription')" /> <template v-else> <sw-container columns="repeat(3, 1fr)" gap="16px" class="lieferzeiten-statistics__metrics"> <sw-card :title="$t('lieferzeiten.statistics.open')"> <div class="lieferzeiten-statistics__metric">{{ metrics.open }}</div> </sw-card> <sw-card :title="$t('lieferzeiten.statistics.overdueShipping')"> <div class="lieferzeiten-statistics__metric">{{ metrics.overdueShipping }}</div> </sw-card> <sw-card :title="$t('lieferzeiten.statistics.overdueDelivery')"> <div class="lieferzeiten-statistics__metric">{{ metrics.overdueDelivery }}</div> </sw-card> </sw-container> <sw-card :title="$t('lieferzeiten.statistics.chartTitle')" class="lieferzeiten-statistics__chart-card"> <div v-if="channelChartData.length" class="lieferzeiten-statistics__chart"> <div v-for="item in channelChartData" :key="item.channel" class="lieferzeiten-statistics__chart-row"> <span>{{ item.channel }}</span> <div class="lieferzeiten-statistics__bar-wrap"> <div class="lieferzeiten-statistics__bar" :style="{ width: getChartBarWidth(item.value) }"></div> </div> <strong>{{ item.value }}</strong> </div> </div> <sw-empty-state v-else :title="$t('lieferzeiten.emptyState.title')" :description="$t('lieferzeiten.emptyState.description')" /> </sw-card> <sw-card :title="$t('lieferzeiten.statistics.timelineTitle')" class="lieferzeiten-statistics__timeline-card"> <div v-if="timelineSeries.length > 1" class="lieferzeiten-statistics__timeline-chart"> <svg viewBox="0 0 100 60" preserveAspectRatio="none" class="lieferzeiten-statistics__timeline-svg"> <path :d="timelineChartPaths.areaPath" class="lieferzeiten-statistics__timeline-area" /> <path :d="timelineChartPaths.linePath" class="lieferzeiten-statistics__timeline-line" /> </svg> <div class="lieferzeiten-statistics__timeline-axis"> <span>{{ formatTimelineLabel(timelineSeries[0].date) }}</span> <span>{{ formatTimelineLabel(timelineSeries[timelineSeries.length - 1].date) }}</span> </div> </div> <div v-else-if="timelineSeries.length === 1" class="lieferzeiten-statistics__timeline-fallback"> <strong>{{ timelineSeries[0].value }}</strong> <span>{{ formatTimelineLabel(timelineSeries[0].date) }}</span> </div> <sw-empty-state v-else :title="$t('lieferzeiten.statistics.timelineEmptyTitle')" :description="$t('lieferzeiten.statistics.timelineEmptyDescription')" /> </sw-card> <sw-card :title="$t('lieferzeiten.statistics.tableTitle')"> <sw-data-grid :data-source="filteredOrders" :columns="tableColumns" :show-selection="false" > <template #column-status="{ item }"> <sw-label :appearance="item.status === $t('lieferzeiten.statistics.status.overdue') ? 'error' : 'info'"> {{ item.status }} </sw-label> </template> <template #column-eventAt="{ item }"> {{ formatDate(item.eventAt) }} </template> <template #column-promisedAt="{ item }"> {{ formatDate(item.promisedAt) }} </template> <template #column-actions="{ item }"> <div class="lieferzeiten-statistics__actions"> <sw-button v-for="action in resolveActivityActions(item)" :key="\`\${item.id}-\${action.id}\`" size="x-small" :variant="action.disabled ? 'ghost' : 'secondary'" :disabled="action.disabled || action.isLoading" :is-loading="action.isLoading" v-tooltip="actionTooltip(action)" @click="action.onClick && action.onClick()" > <sw-icon v-if="action.icon" :name="action.icon" size="12px" /> {{ action.label }} </sw-button> </div> </template> <template #actions="{ item }"> <sw-context-menu-item @click="onDrilldown(item)"> {{ $t('lieferzeiten.statistics.drilldown') }} </sw-context-menu-item> </template> </sw-data-grid> </sw-card> <sw-modal v-if="selectedActivity" :title="$t('lieferzeiten.statistics.drilldownTitle')" @modal-close="closeDrilldown" > <p><strong>{{ $t('lieferzeiten.table.orderNumber') }}:</strong> {{ selectedActivity.orderNumber }}</p> <p><strong>{{ $t('lieferzeiten.table.domain') }}:</strong> {{ selectedActivity.domain }}</p> <p><strong>{{ $t('lieferzeiten.table.status') }}:</strong> {{ selectedActivity.status }}</p> <p><strong>{{ $t('lieferzeiten.statistics.activityDate') }}:</strong> {{ formatDate(selectedActivity.eventAt) }}</p> <p><strong>{{ $t('lieferzeiten.statistics.promisedDate') }}:</strong> {{ formatDate(selectedActivity.promisedAt) }}</p> </sw-modal> </template> </div> {% endblock %}`,W=e=>{const t=Number(e);return Number.isFinite(t)?t:0},j=e=>e.date||e.day||e.eventAt||e.createdAt||null,Z=e=>W(e.count??e.value??e.total??e.orders??0),Q=e=>{const t=new Date(e);return Number.isNaN(t.getTime())?null:t.toISOString().slice(0,10)},Y=(e,t,i)=>!(t&&t!=="all"&&e.channel&&e.channel!==t||i&&e.domain&&e.domain!==i);function X(e,{selectedChannel:t="all",selectedDomain:i=null}={}){if(!Array.isArray(e))return[];const s=e.reduce((a,n)=>{if(!n||!Y(n,t,i))return a;const r=j(n),l=Q(r);return l&&(a[l]=(a[l]||0)+Z(n)),a},{});return Object.entries(s).sort(([a],[n])=>a.localeCompare(n)).map(([a,n])=>({date:a,value:n}))}const J=["open","in_progress","reopened"],ee=["done","cancelled"];Shopware.Component.register("lieferzeiten-statistics",{template:H,inject:["lieferzeitenOrdersService","lieferzeitenTrackingService","acl"],mixins:["notification"],props:{selectedDomain:{type:String,required:!1,default:null}},data(){return{periodOptions:[{value:7,label:this.$t("lieferzeiten.statistics.period.7")},{value:30,label:this.$t("lieferzeiten.statistics.period.30")},{value:90,label:this.$t("lieferzeiten.statistics.period.90")}],selectedPeriod:30,selectedChannel:"all",selectedActivity:null,isLoading:!1,loadError:null,statistics:{metrics:{openOrders:0,overdueShipping:0,overdueDelivery:0},channels:[],timeline:[],activitiesData:[]},tableColumns:[{property:"orderNumber",label:this.$t("lieferzeiten.table.orderNumber"),primary:!0},{property:"domain",label:this.$t("lieferzeiten.table.domain")},{property:"status",label:this.$t("lieferzeiten.table.status")},{property:"eventAt",label:this.$t("lieferzeiten.statistics.activityDate")},{property:"promisedAt",label:this.$t("lieferzeiten.statistics.promisedDate")},{property:"actions",label:this.$t("lieferzeiten.statistics.actionsColumn")}],actionLoadingByActivity:{}}},created(){this.loadStatistics()},watch:{selectedPeriod(){this.loadStatistics()},selectedChannel(){this.loadStatistics()},selectedDomain(){this.selectedChannel="all",this.loadStatistics()}},computed:{channelOptions(){return[{value:"all",label:this.$t("lieferzeiten.statistics.allChannels")},...this.statistics.channels.map(e=>({value:e.channel,label:e.channel}))]},metrics(){return{open:this.statistics.metrics.openOrders,overdueShipping:this.statistics.metrics.overdueShipping,overdueDelivery:this.statistics.metrics.overdueDelivery}},filteredOrders(){return this.statistics.activitiesData.map(e=>({...e,status:e.status==="open"?this.$t("lieferzeiten.status.open"):e.status==="done"?this.$t("lieferzeiten.status.closed"):e.status}))},channelChartData(){return this.statistics.channels},maxChartValue(){return this.channelChartData.length?Math.max(...this.channelChartData.map(e=>e.value)):1},timelineSeries(){return X(this.statistics.timeline,{selectedChannel:this.selectedChannel,selectedDomain:this.selectedDomain})},timelineMaxValue(){return this.timelineSeries.length?Math.max(...this.timelineSeries.map(e=>e.value)):0},timelineChartPaths(){if(this.timelineSeries.length<2)return null;const e=100,t=60,i=this.timelineMaxValue||1,s=e/(this.timelineSeries.length-1),n=this.timelineSeries.map((l,o)=>{const y=Number((o*s).toFixed(2)),b=Math.min(l.value/i,1),m=Number((t-b*t).toFixed(2));return{x:y,y:m}}).map((l,o)=>`${o===0?"M":"L"} ${l.x} ${l.y}`).join(" "),r=`${n} L ${e} ${t} L 0 ${t} Z`;return{linePath:n,areaPath:r}}},methods:{hasViewAccess(){var e;return typeof((e=this.acl)==null?void 0:e.can)!="function"?!1:this.acl.can("lieferzeiten.viewer")||this.acl.can("admin")},hasEditAccess(){var e;return typeof((e=this.acl)==null?void 0:e.can)!="function"?!1:this.acl.can("lieferzeiten.editor")||this.acl.can("admin")},resolveActivityActions(e){const t=[],i=String((e==null?void 0:e.eventType)||"").toLowerCase();return["paket","position","audit"].includes(i)&&t.push(this.createOrderAction(e)),i==="task"&&(t.push(this.createTaskRouteAction(e)),t.push(this.createTaskTransitionAction(e))),e!=null&&e.trackingNumber&&t.push(this.createTrackingAction(e)),t.length===0?[{id:"unavailable",label:this.$t("lieferzeiten.statistics.actionsUnavailable"),icon:"regular-ban",disabled:!0,disabledReason:this.$t("lieferzeiten.statistics.actionUnavailableReason"),onClick:null}]:t},createOrderAction(e){const t=!!(e!=null&&e.paketId||e!=null&&e.orderNumber);return{id:"open-order",label:this.$t("lieferzeiten.statistics.actions.openOrder"),icon:"regular-shopping-bag",disabled:!this.hasViewAccess()||!t,disabledReason:this.hasViewAccess()?this.$t("lieferzeiten.statistics.actionReasons.missingOrderReference"):this.$t("lieferzeiten.statistics.actionReasons.noViewAcl"),onClick:()=>this.navigateToOrder(e)}},createTaskRouteAction(e){return{id:"open-task",label:this.$t("lieferzeiten.statistics.actions.openTask"),icon:"regular-briefcase",disabled:!this.hasViewAccess()||!(e!=null&&e.taskId),disabledReason:this.hasViewAccess()?this.$t("lieferzeiten.statistics.actionReasons.missingTaskReference"):this.$t("lieferzeiten.statistics.actionReasons.noViewAcl"),onClick:()=>this.navigateToTask(e)}},createTaskTransitionAction(e){const t=String((e==null?void 0:e.status)||"").toLowerCase(),i=J.includes(t),s=ee.includes(t),a=s?"reopen":"close",n=i||s;return{id:`task-${a}`,label:this.$t(`lieferzeiten.statistics.actions.${a}Task`),icon:s?"regular-redo":"regular-checkmark",disabled:!this.hasEditAccess()||!(e!=null&&e.taskId)||!n,disabledReason:this.hasEditAccess()?e!=null&&e.taskId?this.$t("lieferzeiten.statistics.actionReasons.unsupportedTaskStatus"):this.$t("lieferzeiten.statistics.actionReasons.missingTaskReference"):this.$t("lieferzeiten.statistics.actionReasons.noEditAcl"),onClick:()=>this.performTaskAction(e,a),isLoading:!!this.actionLoadingByActivity[this.getActionLoadingKey(e,a)]}},createTrackingAction(e){return{id:"open-tracking",label:this.$t("lieferzeiten.statistics.actions.openTracking"),icon:"regular-shipping",disabled:!this.hasViewAccess()||!(e!=null&&e.trackingNumber),disabledReason:this.hasViewAccess()?this.$t("lieferzeiten.statistics.actionReasons.missingTrackingReference"):this.$t("lieferzeiten.statistics.actionReasons.noViewAcl"),onClick:()=>this.navigateToTracking(e)}},getActionLoadingKey(e,t){return`${(e==null?void 0:e.id)||"unknown"}:${t}`},async performTaskAction(e,t){if(!(e!=null&&e.taskId)||!["close","reopen"].includes(t))return;const i=this.getActionLoadingKey(e,t);this.$set(this.actionLoadingByActivity,i,!0);try{await this.lieferzeitenOrdersService.post(`tasks/${encodeURIComponent(e.taskId)}/${t}`,{}),this.createNotificationSuccess({title:this.$t("lieferzeiten.statistics.actionSuccessTitle"),message:this.$t(`lieferzeiten.statistics.actionSuccess.${t}Task`)}),await this.loadStatistics()}catch{this.createNotificationError({title:this.$t("lieferzeiten.statistics.actionErrorTitle"),message:this.$t(`lieferzeiten.statistics.actionError.${t}Task`)})}finally{this.$delete(this.actionLoadingByActivity,i)}},navigateToOrder(e){this.$router.push({name:"lieferzeiten.index",query:{bestellnummer:(e==null?void 0:e.orderNumber)||void 0,paketId:(e==null?void 0:e.paketId)||void 0}})},navigateToTask(e){this.$router.push({name:"lieferzeiten.index",query:{taskId:(e==null?void 0:e.taskId)||void 0,bestellnummer:(e==null?void 0:e.orderNumber)||void 0}})},async navigateToTracking(e){const t=String((e==null?void 0:e.trackingNumber)||"").trim();if(t!==""){try{await this.lieferzeitenTrackingService.history("dhl",t)}catch{this.createNotificationError({title:this.$t("lieferzeiten.statistics.actionErrorTitle"),message:this.$t("lieferzeiten.statistics.actionError.openTracking")});return}window.open(`https://www.dhl.de/de/privatkunden/pakete-empfangen/verfolgen.html?piececode=${encodeURIComponent(t)}`,"_blank","noopener")}},actionTooltip(e){return e!=null&&e.disabled?e.disabledReason||this.$t("lieferzeiten.statistics.actionUnavailableReason"):""},async loadStatistics(){this.isLoading=!0,this.loadError=null;try{const e=await this.lieferzeitenOrdersService.getStatistics({period:this.selectedPeriod,domain:this.selectedDomain,channel:this.selectedChannel});this.statistics={metrics:e.metrics??{openOrders:0,overdueShipping:0,overdueDelivery:0},channels:Array.isArray(e.channels)?e.channels:[],timeline:Array.isArray(e.timeline)?e.timeline:[],activitiesData:Array.isArray(e.activitiesData)?e.activitiesData:[]}}catch(e){this.statistics={metrics:{openOrders:0,overdueShipping:0,overdueDelivery:0},channels:[],timeline:[],activitiesData:[]},this.loadError=e}finally{this.isLoading=!1}},formatDate(e){return e?Shopware.Utils.format.date(e):"—"},getChartBarWidth(e){return`${Math.max(Math.round(e/this.maxChartValue*100),6)}%`},formatTimelineLabel(e){return Shopware.Utils.format.date(e)},onDrilldown(e){this.selectedActivity=e},closeDrilldown(){this.selectedActivity=null},exportCsv(){const e=[this.$t("lieferzeiten.table.orderNumber"),this.$t("lieferzeiten.table.domain"),this.$t("lieferzeiten.table.status"),this.$t("lieferzeiten.statistics.activityDate"),this.$t("lieferzeiten.statistics.promisedDate")],t=this.filteredOrders.map(n=>[n.orderNumber,n.domain,n.status,this.formatDate(n.eventAt),this.formatDate(n.promisedAt)]),i=[e,...t].map(n=>n.map(r=>`"${String(r).replace(/"/g,'""')}"`).join(";")).join(`
`),s=new Blob([i],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(s),a.download="lieferzeiten-statistiken.csv",a.click(),URL.revokeObjectURL(a.href)}}});const te=`{% block lieferzeiten_domain_selection %} <div class="lieferzeiten-domain-selection"> <sw-single-select v-model="selectedDomain" :options="channelOptions" :placeholder="$t('lieferzeiten.domainSelection.channelPlaceholder')" :clearable="false" :disabled="showDomainModal || !selectedGroup" /> <sw-button size="small" variant="ghost" class="lieferzeiten-domain-selection__reset" @click="resetDomainSelection" > {{ $t('lieferzeiten.domainSelection.reset') }} </sw-button> <sw-modal v-if="showDomainModal" :title="$t('lieferzeiten.domainSelection.modalTitle')" @modal-close="confirmDomainSelection" > <p>{{ $t('lieferzeiten.domainSelection.modalDescription') }}</p> <sw-label> {{ $t('lieferzeiten.domainSelection.steps.group') }} </sw-label> <sw-single-select v-model="selectedGroup" :options="groupOptions" :placeholder="$t('lieferzeiten.domainSelection.groupPlaceholder')" :clearable="false" required /> <template v-if="modalStep === 2"> <sw-label> {{ $t('lieferzeiten.domainSelection.steps.channel') }} </sw-label> <sw-single-select v-model="selectedDomain" :options="channelOptions" :placeholder="$t('lieferzeiten.domainSelection.channelPlaceholder')" :clearable="false" required /> </template> <sw-switch-field v-model="persistSelection" :label="$t('lieferzeiten.domainSelection.persistLabel')" /> <template #modal-footer> <sw-button v-if="modalStep === 2" size="small" variant="ghost" @click="goToGroupStep" > {{ $t('lieferzeiten.domainSelection.back') }} </sw-button> <sw-button v-if="modalStep === 1" size="small" variant="primary" :disabled="!canGoToChannelStep" @click="goToChannelStep" > {{ $t('lieferzeiten.domainSelection.next') }} </sw-button> <sw-button v-else size="small" variant="primary" :disabled="!canConfirmSelection" @click="confirmDomainSelection" > {{ $t('lieferzeiten.domainSelection.confirm') }} </sw-button> </template> </sw-modal> </div> {% endblock %}`,h="lieferzeitenManagementDomain",p="lieferzeitenManagementGroup";Shopware.Component.register("lieferzeiten-domain-selection",{template:te,props:{value:{type:String,required:!1,default:null}},data(){return{selectedGroup:null,selectedDomain:c(this.value),persistSelection:!1,showDomainModal:!1,modalStep:1}},created(){this.loadStoredSelection()},watch:{value(e){const t=c(e);this.selectedDomain=t,this.selectedGroup=this.resolveInitialGroup(t,this.selectedGroup)},selectedGroup(e){if(!e){this.selectedDomain=null;return}D(e).some(i=>i.value===this.selectedDomain)||(this.selectedDomain=O(e))}},computed:{groupOptions(){return v.map(e=>({value:e.id,label:this.$t(e.labelSnippet)}))},channelOptions(){return D(this.selectedGroup).map(e=>({value:e.value,label:this.$t(e.labelSnippet)}))},canGoToChannelStep(){return!!this.selectedGroup},canConfirmSelection(){return!!(this.selectedGroup&&this.selectedDomain)}},methods:{resolveInitialGroup(e,t=null){return V(e)||z(t)||u},loadStoredSelection(){const e=z(localStorage.getItem(p)),t=c(localStorage.getItem(h));if(e||t){this.persistSelection=!0,this.applySelection(e,t,!0,!1);return}const i=z(sessionStorage.getItem(p)),s=c(sessionStorage.getItem(h));if(i||s){this.persistSelection=!1,this.applySelection(i,s,!0,!1);return}const a=c(this.value);if(a){this.applySelection(null,a,!0,!1);return}this.applySelection(u,g,!1,!1),this.showDomainModal=!0,this.modalStep=1},applySelection(e,t,i=!0,s=!0){const a=this.resolveInitialGroup(t,e),r=D(a).map(l=>l.value).includes(t)?t:O(a);this.selectedGroup=a,this.selectedDomain=r,i&&r&&this.$emit("input",r),s&&this.persistDomainSelection(a,r)},persistDomainSelection(e,t){if(!e||!t)return;const i=this.persistSelection?localStorage:sessionStorage,s=this.persistSelection?sessionStorage:localStorage;i.setItem(p,e),i.setItem(h,t),s.removeItem(p),s.removeItem(h)},goToChannelStep(){this.canGoToChannelStep&&(this.modalStep=2)},goToGroupStep(){this.modalStep=1},confirmDomainSelection(){this.canConfirmSelection&&(this.applySelection(this.selectedGroup,this.selectedDomain,!0),this.showDomainModal=!1)},resetDomainSelection(){localStorage.removeItem(p),localStorage.removeItem(h),sessionStorage.removeItem(p),sessionStorage.removeItem(h),this.applySelection(u,g,!0),this.showDomainModal=!0,this.modalStep=1}}});const ie=`{% block lieferzeiten_order_table %} <div class="lieferzeiten-order-table"> <table class="sw-data-grid__table"> <thead> <tr class="lieferzeiten-order-table__zone-row"> <th colspan="10" title="Bestellung: Auftrags-, Kunden- und Positionsdaten">{{ $t('lieferzeiten.zones.order') }}</th> <th colspan="11" title="Lieferung: Paket-, Tracking- und Termininformationen">{{ $t('lieferzeiten.zones.delivery') }}</th> <th colspan="5" title="Status: interne Hinweise, Statuspflege und Protokoll">{{ $t('lieferzeiten.zones.status') }}</th> </tr> <tr class="lieferzeiten-order-table__column-row"> <th>{{ $t('lieferzeiten.table.orderNumber') }}</th> <th>{{ $t('lieferzeiten.table.san6OrderNumber') }}</th> <th>{{ $t('lieferzeiten.table.san6Position') }}</th> <th>{{ $t('lieferzeiten.table.totalQuantity') }}</th> <th>{{ $t('lieferzeiten.table.orderDate') }}</th> <th>{{ $t('lieferzeiten.table.paymentMethod') }}</th> <th>{{ $t('lieferzeiten.table.paymentDate') }}</th> <th>{{ $t('lieferzeiten.table.customerNames') }}</th> <th>{{ $t('lieferzeiten.table.domain') }}</th> <th>{{ $t('lieferzeiten.table.positions') }}</th> <th>{{ $t('lieferzeiten.table.parcels') }}</th> <th>{{ $t('lieferzeiten.table.tracking') }}</th> <th>{{ $t('lieferzeiten.fields.supplierDate') }}</th> <th>{{ $t('lieferzeiten.fields.supplierWeek') }}</th> <th>{{ $t('lieferzeiten.fields.newDate') }}</th> <th>{{ $t('lieferzeiten.table.packageStatus') }}</th> <th>{{ $t('lieferzeiten.table.latestShippingDeadline') }}</th> <th>{{ $t('lieferzeiten.table.shippingDate') }}</th> <th>{{ $t('lieferzeiten.table.latestDeliveryDeadline') }}</th> <th>{{ $t('lieferzeiten.table.deliveryDate') }}</th> <th>{{ $t('lieferzeiten.fields.shippingType') }}</th> <th>{{ $t('lieferzeiten.fields.comment') }}</th> <th>{{ $t('lieferzeiten.fields.history') }}</th> <th>{{ $t('lieferzeiten.table.businessStatus') }}</th> <th>{{ $t('lieferzeiten.table.status') }}</th> <th>{{ $t('lieferzeiten.fields.audit') }}</th> </tr> </thead> <tbody> <template v-for="order in displayedOrders"> <tr :key="order.id"> <td> <sw-button size="small" variant="ghost" @click="toggleOrder(order.id)"> {{ isExpanded(order.id) ? '-' : '+' }} </sw-button> {{ displayOrDash(order.orderNumber) }} </td> <td>{{ displayOrDash(order.san6OrderNumberDisplay) }}</td> <td>{{ displayOrDash(order.san6PositionDisplay) }}</td> <td>{{ displayOrDash(order.quantityDisplay) }}</td> <td>{{ displayOrDash(order.orderDateDisplay) }}</td> <td>{{ displayOrDash(order.paymentMethodDisplay) }}</td> <td>{{ displayOrDash(order.paymentDateDisplay) }}</td> <td>{{ displayOrDash(order.customerNamesDisplay) }}</td> <td>{{ displayOrDash(order.domain) }}</td> <td>{{ displayOrDash(order.positionsCountDisplay) }}</td> <td>{{ parcelSummary(order) }}</td> <td>{{ displayOrDash(order.trackingSummaryDisplay || order.trackingSummary) }}</td> <td>-</td> <td>-</td> <td>-</td> <td>{{ displayOrDash(order.packageStatusDisplay) }}</td> <td>{{ displayOrDash(order.latestShippingDeadlineDisplay) }}</td> <td>{{ displayOrDash(order.shippingDateDisplay) }}</td> <td>{{ displayOrDash(order.latestDeliveryDeadlineDisplay) }}</td> <td>{{ displayOrDash(order.deliveryDateDisplay) }}</td> <td>{{ shippingLabel(order) }}</td> <td> <sw-text-field v-model:value="order.comment" :disabled="!hasEditAccess()" size="small" /> <sw-button v-if="hasEditAccess()" size="small" :disabled="!canSaveComment(order)" @click="saveComment(order)"> {{ $t('global.default.save') }} </sw-button> </td> <td> <ul> <li v-for="(entry, index) in order.lieferterminLieferantHistory" :key="\`liefertermin-\${order.id}-\${index}\`">{{ formatHistoryEntry(entry) }}</li> <li v-for="(entry, index) in order.neuerLieferterminHistory" :key="\`neuer-liefertermin-\${order.id}-\${index}\`">{{ formatHistoryEntry(entry) }}</li> <li v-for="(entry, index) in order.commentHistory" :key="\`comment-\${order.id}-\${index}\`">{{ formatHistoryEntry(entry) }}</li> </ul> </td> <td> <sw-single-select v-model:value="order.selectedBusinessStatus" :options="editableBusinessStatuses" :disabled="!hasEditAccess()" size="small" :placeholder="$t('lieferzeiten.statusChange.placeholder')" /> <sw-button v-if="hasEditAccess()" size="small" variant="primary" :disabled="!canSaveBusinessStatus(order)" @click="saveBusinessStatus(order)" > {{ $t('lieferzeiten.statusChange.save') }} </sw-button> <div class="lieferzeiten-order-table__business-status-current">{{ businessStatusLabel(order) }}</div> </td> <td> <sw-label :variant="isOrderOpen(order) ? 'warning' : 'success'"> {{ isOrderOpen(order) ? $t('lieferzeiten.status.open') : $t('lieferzeiten.status.closed') }} </sw-label> <div v-if="canUpdateOrderStatus(order)" class="lieferzeiten-order-table__status-editor"> <sw-single-select v-model:value="order.selectedManualStatus" size="small" :options="statusOptions()" value-property="value" label-property="label" /> <sw-button size="small" variant="primary" :is-loading="Boolean(statusUpdateLoadingByOrder[order.id])" @click="saveOrderStatus(order)" > {{ $t('lieferzeiten.status.manual.save') }} </sw-button> </div> </td> <td>{{ resolveAuditDisplay(order) }}</td> </tr> <tr v-if="isExpanded(order.id)" :key="\`\${order.id}-positions\`"> <td colspan="26"> <sw-loader v-if="isDetailsLoading(order.id)" /> <template v-else> <table class="sw-data-grid__table"> <thead> <tr> <th>{{ $t('lieferzeiten.table.position') }}</th> <th>{{ $t('lieferzeiten.table.article') }}</th> <th>{{ $t('lieferzeiten.table.quantity') }}</th> <th>{{ $t('lieferzeiten.table.packageNumbers') }}</th> <th>{{ $t('lieferzeiten.fields.shippingType') }}</th> <th>{{ $t('lieferzeiten.fields.supplierDate') }}</th> <th>{{ $t('lieferzeiten.fields.supplierWeek') }}</th> </tr> </thead> <tbody> <tr v-for="position in order.positions" :key="position.id"> <td>{{ displayOrDash(position.number || position.positionNumber) }}</td> <td>{{ displayOrDash(position.label || position.article) }}</td> <td>{{ displayOrDash(position.quantity) }}</td> <td> <template v-for="entry in resolveTrackingEntries(order, position)"> <button :key="\`\${position.id}-\${entry.number}\`" type="button" class="lieferzeiten-order-table__tracking-link" @click="openTrackingHistory(entry)" > {{ entry.number }} </button> </template> </td> <td>{{ shippingLabelForPosition(order, position) }}</td> <td> <sw-datepicker v-model:value="position.lieferterminLieferantRange.from" :disabled="!hasEditAccess()" size="small" /> <sw-datepicker v-model:value="position.lieferterminLieferantRange.to" :disabled="!hasEditAccess()" size="small" /> <sw-button v-if="hasEditAccess()" size="small" variant="primary" :disabled="!canSaveLiefertermin(order, position)" @click="saveLiefertermin(order, position)"> {{ $t('global.default.save') }} </sw-button> <sw-button v-if="hasEditAccess()" size="small" variant="ghost" @click="requestAdditionalDeliveryDate(order, position.id)"> {{ $t('lieferzeiten.additionalRequest.button') }} </sw-button> </td> <td>{{ weekLabelFromDate(position.lieferterminLieferantRange.to) }}</td> </tr> </tbody> </table> <table class="sw-data-grid__table"> <thead> <tr> <th>{{ $t('lieferzeiten.table.parcels') }}</th> <th>{{ $t('lieferzeiten.table.packageStatus') }}</th> <th>{{ $t('lieferzeiten.fields.newDate') }}</th> <th>{{ $t('lieferzeiten.fields.supplierWeek') }}</th> </tr> </thead> <tbody> <tr v-for="parcel in order.parcels" :key="parcel.id"> <td>{{ displayOrDash(parcel.paketId || parcel.id) }}</td> <td>{{ displayOrDash(parcel.statusDisplay) }}</td> <td> <sw-datepicker v-model:value="parcel.neuerLieferterminRange.from" :disabled="!hasEditAccess() || !parcel.supplierRange.from || !isParcelEditableByStatus(parcel)" size="small" /> <sw-datepicker v-model:value="parcel.neuerLieferterminRange.to" :disabled="!hasEditAccess() || !parcel.supplierRange.to || !isParcelEditableByStatus(parcel)" size="small" /> <sw-button v-if="hasEditAccess()" size="small" variant="primary" :disabled="!canSaveNeuerLiefertermin(parcel)" @click="saveNeuerLiefertermin(order, parcel)"> {{ $t('global.default.save') }} </sw-button> </td> <td>{{ weekLabelFromDate(parcel.neuerLieferterminRange.to) }}</td> </tr> </tbody> </table> </template> </td> </tr> </template> </tbody> </table> <div v-if="showTrackingModal" class="lieferzeiten-order-table__tracking-overlay" role="dialog" aria-modal="true" > <div class="lieferzeiten-order-table__tracking-dialog"> <header class="lieferzeiten-order-table__tracking-header"> <h3> Tracking {{ activeTracking && activeTracking.carrier && activeTracking.carrier.toUpperCase() }} / {{ activeTracking && activeTracking.number }} </h3> <button type="button" class="lieferzeiten-order-table__tracking-close" @click="closeTrackingModal">×</button> </header> <div class="lieferzeiten-order-table__tracking-body"> <div v-if="isTrackingLoading">{{ $t('lieferzeiten.tracking.loading') }}</div> <div v-else-if="trackingError" class="lieferzeiten-order-table__tracking-error">{{ trackingError }}</div> <div v-else-if="!trackingEvents.length">{{ $t('lieferzeiten.tracking.empty') }}</div> <ul v-else class="lieferzeiten-order-table__tracking-list"> <li v-for="(event, index) in trackingEvents" :key="\`\${event.timestamp}-\${index}\`"> <strong>{{ event.status }}</strong> <div>{{ event.label }}</div> <small>{{ event.timestamp }}<span v-if="event.location"> · {{ event.location }}</span></small> </li> </ul> </div> </div> </div> <sw-empty-state v-if="displayedOrders.length === 0" :title="$t('lieferzeiten.emptyState.title')" :description="$t('lieferzeiten.emptyState.description')" /> </div> {% endblock %}`,S={1:"lieferzeiten.businessStatus.new",2:"lieferzeiten.businessStatus.inClarification",3:"lieferzeiten.businessStatus.awaitingSupplier",4:"lieferzeiten.businessStatus.partiallyAvailable",5:"lieferzeiten.businessStatus.readyForShipping",6:"lieferzeiten.businessStatus.partiallyShipped",7:"lieferzeiten.businessStatus.shipped",8:"lieferzeiten.businessStatus.closed"},_="Versand durch First Medical";Shopware.Component.register("lieferzeiten-order-table",{template:ie,mixins:["notification"],inject:["lieferzeitenTrackingService","lieferzeitenOrdersService","acl"],props:{orders:{type:Array,required:!0,default:()=>[]},onlyOpen:{type:Boolean,required:!1,default:!1},onReloadOrder:{type:Function,required:!1,default:null}},data(){return{expandedOrderIds:[],editableOrders:{},showTrackingModal:!1,isTrackingLoading:!1,trackingError:"",trackingEvents:[],activeTracking:null,statusUpdateLoadingByOrder:{},detailsLoadingByOrder:{}}},computed:{displayedOrders(){return this.orders.filter(e=>this.onlyOpen?this.isOrderOpen(e):!0).map(e=>this.getEditableOrder(e))},editableBusinessStatuses(){return[7,8].map(e=>({value:String(e),label:`${e} · ${this.$t(S[String(e)])}`}))}},methods:{hasViewAccess(){var e;return typeof((e=this.acl)==null?void 0:e.can)!="function"?!1:this.acl.can("lieferzeiten.viewer")||this.acl.can("admin")},hasEditAccess(){var e;return typeof((e=this.acl)==null?void 0:e.can)!="function"?!1:this.acl.can("lieferzeiten.editor")||this.acl.can("admin")},canUpdateOrderStatus(e){return this.hasEditAccess()&&!!(e!=null&&e.id)},statusOptions(){return[7,8].map(e=>({value:e,label:this.$t(S[String(e)])}))},statusOptionLabel(e){const t=S[String(e)]||"lieferzeiten.businessStatus.unknown";return`${e} · ${this.$t(t)}`},resolveBusinessStatus(e){const t=(e==null?void 0:e.business_status)||(e==null?void 0:e.businessStatus)||null,i=Number((t==null?void 0:t.code)??(e==null?void 0:e.status));if(!Number.isInteger(i)||i<1||i>8)return"-";const s=(t==null?void 0:t.labelKey)||`lieferzeiten.businessStatus.${i}`;return`${i} - ${this.$t(s)}`},isOrderOpen(e){return(Array.isArray(e==null?void 0:e.parcels)?e.parcels:[]).some(i=>!i.closed)},getEditableOrder(e){if(!this.editableOrders[e.id]){const t=this.resolveInitialRange(e,"lieferterminLieferant",14),i=this.resolveInitialRange(e,"neuerLiefertermin",4),s=(e.positions||[]).map(n=>({...n,lieferterminLieferantRange:{...t},originalLieferterminLieferantRange:{...t}}));(e.parcels||[]).map(n=>{const r=this.resolveParcelInitialRange(n,i);return{...n,supplierRange:{...t},neuerLieferterminRange:{...r},originalNeuerLieferterminRange:{...r},statusDisplay:this.resolveParcelStatus(n)}});const a=this.resolveCommentTargetPositionId(s);this.$set(this.editableOrders,e.id,{...e,san6OrderNumberDisplay:this.resolveSan6OrderNumber(e),san6PositionDisplay:this.resolveSan6Position(e,s),quantityDisplay:this.resolveQuantity(e,s),orderDateDisplay:this.resolveOrderDate(e),paymentMethodDisplay:this.resolvePaymentMethod(e),paymentDateDisplay:this.resolvePaymentDate(e),customerNamesDisplay:this.resolveCustomerNames(e),positionsCountDisplay:s.length,packageStatusDisplay:this.resolvePackageStatus(e),trackingSummaryDisplay:this.resolveTrackingSummaryDisplay(e),latestShippingDeadlineDisplay:this.formatDateTime(this.resolveDeadlineValue(e,["latestShippingDeadline","spaetester_versand","spaetesterVersand","latestShippingDate"])),shippingDateDisplay:this.resolveShippingDate(e),latestDeliveryDeadlineDisplay:this.formatDateTime(this.resolveDeadlineValue(e,["latestDeliveryDeadline","spaeteste_lieferung","spaetesteLieferung","latestDeliveryDate"])),deliveryDateDisplay:this.resolveDeliveryDate(e),lieferterminLieferantRange:t,neuerLieferterminRange:i,originalLieferterminLieferantRange:{...t},originalNeuerLieferterminRange:{...i},comment:this.resolveInitialComment(e),commentTargetPositionId:a,additionalDeliveryRequest:e.additionalDeliveryRequest||null,latestShippingDeadline:this.resolveDeadlineValue(e,["spaetester_versand","spaetesterVersand","latestShippingDeadline"]),latestDeliveryDeadline:this.resolveDeadlineValue(e,["spaeteste_lieferung","spaetesteLieferung","latestDeliveryDeadline"]),selectedManualStatus:[7,8].includes(Number(e==null?void 0:e.status))?Number(e.status):7})}return this.editableOrders[e.id]},resolveInitialComment(e){const t=this.pickFirstDefined(e,["currentComment","comment"]);return t==null?"":String(t)},isOpenPosition(e){const t=String((e==null?void 0:e.status)||"").trim().toLowerCase();return(e==null?void 0:e.closed)===!0?!1:!["closed","done","completed","shipped","delivered","8"].includes(t)},resolveCommentTargetPositionId(e){var i;if(!Array.isArray(e)||e.length===0)return null;const t=e.find(s=>this.isOpenPosition(s)&&(s==null?void 0:s.id));return t!=null&&t.id?t.id:((i=e.find(s=>!!(s!=null&&s.id)))==null?void 0:i.id)||null},canSaveComment(e){return this.hasEditAccess()&&!!this.getValidCommentTargetPositionId(e)},getValidCommentTargetPositionId(e){if(!e||!Array.isArray(e.positions))return null;const t=e.commentTargetPositionId;return t&&e.positions.some(i=>(i==null?void 0:i.id)===t)?t:this.resolveCommentTargetPositionId(e.positions)},ensureCommentTargetPositionId(e){const t=this.getValidCommentTargetPositionId(e);return e&&e.commentTargetPositionId!==t&&this.$set(e,"commentTargetPositionId",t),t},resolveParcelInitialRange(e,t){var a,n;const i=this.normalizeDate((e==null?void 0:e.neuerLieferterminFrom)||(e==null?void 0:e.neuer_liefertermin_from)||((a=e==null?void 0:e.neuerLiefertermin)==null?void 0:a.from)),s=this.normalizeDate((e==null?void 0:e.neuerLieferterminTo)||(e==null?void 0:e.neuer_liefertermin_to)||((n=e==null?void 0:e.neuerLiefertermin)==null?void 0:n.to)||(e==null?void 0:e.neuerLiefertermin));return i&&s?{from:i,to:s}:{...t}},resolveParcelStatus(e){const t=String((e==null?void 0:e.status)||"").trim();return t===""?e!=null&&e.closed?this.$t("lieferzeiten.status.closed"):this.$t("lieferzeiten.status.open"):t},isParcelEditableByStatus(e){const t=String((e==null?void 0:e.status)||"").trim().toLowerCase();return(e==null?void 0:e.closed)===!0?!1:!["closed","done","completed","shipped","delivered","8"].includes(t)},resolveInitialRange(e,t,i){const s=this.normalizeDate(e[`${t}From`]),a=this.normalizeDate(e[`${t}To`]||e[t]);if(s&&a)return{from:s,to:a};const n=Number(e[`${t}Days`]);return Number.isInteger(n)&&n>=1&&n<=i?this.buildRangeFromDayOffset(n):{from:null,to:null}},normalizeDate(e){if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t.toISOString().slice(0,10)},buildRangeFromDayOffset(e){const t=new Date;t.setDate(t.getDate()+1);const i=new Date;return i.setDate(i.getDate()+e),{from:t.toISOString().slice(0,10),to:i.toISOString().slice(0,10)}},async toggleOrder(e){if(this.expandedOrderIds.includes(e)){this.expandedOrderIds=this.expandedOrderIds.filter(t=>t!==e);return}await this.loadOrderDetails(e),this.expandedOrderIds=[...this.expandedOrderIds,e]},hasOrderDetails(e){return Array.isArray(e==null?void 0:e.positions)&&Array.isArray(e==null?void 0:e.parcels)&&Array.isArray(e==null?void 0:e.lieferterminLieferantHistory)&&Array.isArray(e==null?void 0:e.neuerLieferterminHistory)&&Array.isArray(e==null?void 0:e.commentHistory)},mergeOrderDetails(e,t){const i=this.editableOrders[e]||this.orders.find(n=>(n==null?void 0:n.id)===e);if(!i||!t)return;const s={...i,...t};this.$delete(this.editableOrders,e);const a=this.getEditableOrder(s);this.$set(this.editableOrders,e,{...a,lieferterminLieferantHistory:t.lieferterminLieferantHistory||[],neuerLieferterminHistory:t.neuerLieferterminHistory||[],commentHistory:t.commentHistory||[],trackingSummaryDisplay:this.resolveTrackingSummaryDisplay(a)})},async loadOrderDetails(e){var i,s;if(!e)return;const t=this.editableOrders[e]||this.orders.find(a=>a.id===e);if(!this.hasOrderDetails(t)){this.$set(this.detailsLoadingByOrder,e,!0);try{const a=await this.lieferzeitenOrdersService.getOrderDetails(e);this.mergeOrderDetails(e,a)}catch(a){this.createNotificationError({title:this.$t("global.default.error"),message:((s=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:s.message)||(a==null?void 0:a.message)||this.$t("global.default.error")})}finally{this.$set(this.detailsLoadingByOrder,e,!1)}}},isDetailsLoading(e){return this.detailsLoadingByOrder[e]===!0},isExpanded(e){return this.expandedOrderIds.includes(e)},parcelSummary(e){const t=Array.isArray(e==null?void 0:e.parcels)?e.parcels:[];return`${t.filter(s=>!s.closed).length}/${t.length}`},displayOrDash(e){if(e==null)return"-";const t=String(e).trim();return t===""?"-":t},resolveSan6OrderNumber(e){return this.pickFirstDefined(e,["san6OrderNumber"])},resolveSan6Position(e,t){if(!t.length)return this.displayOrDash(this.pickFirstDefined(e,["san6Position","san6Pos"]));const i=t.map(s=>this.pickFirstDefined(s,["number"])).filter(s=>s!=null&&String(s).trim()!=="");return i.length?i.join(", "):"-"},resolveQuantity(e,t){if(!t.length)return this.displayOrDash(this.pickFirstDefined(e,["quantity","positionsCount"]));const i=t.reduce((s,a)=>{const n=this.pickFirstDefined(a,["quantity","orderedQuantity","menge"]),r=Number(n);return Number.isFinite(r)?s+r:s},0);return i>0?String(i):"-"},resolveOrderDate(e){return this.formatDate(this.pickFirstDefined(e,["orderDate"]))},resolvePaymentMethod(e){return this.pickFirstDefined(e,["paymentMethod"])||"-"},resolvePaymentDate(e){return this.formatDate(this.pickFirstDefined(e,["paymentDate"]))},resolveCustomerNames(e){const t=[this.pickFirstDefined(e,["customerFirstName","customer_first_name"]),this.pickFirstDefined(e,["customerLastName","customer_last_name"])],i=[this.pickFirstDefined(e,["customerAdditionalName","customer_additional_name"]),this.pickFirstDefined(e,["customerNames","customer_names"])],s=[...t,...i].map(a=>a==null?"":String(a).trim()).filter(a=>a!=="");return s.length>0?s.join(" "):this.pickFirstDefined(e,["customerEmail","customer_email"])||"-"},resolveDeadlineValue(e,t){const i=t.map(a=>e[a]).find(a=>a);if(!i)return null;const s=new Date(i);return Number.isNaN(s.getTime())?null:s.toISOString()},resolvePackageStatus(e){const t=this.pickFirstDefined(e,["packageStatus","status"]);if(!t||String(t).trim()==="")return null;const i=String(t).trim();return{open:this.$t("lieferzeiten.status.open"),closed:this.$t("lieferzeiten.status.closed"),pending:"Pending",shipped:"Shipped",delivered:"Delivered"}[i.toLowerCase()]||i},resolveLatestShippingAt(e){return this.formatDateTime(this.pickFirstDefined(e,["latestShippingDate"]))},resolveShippingDate(e){return this.formatDate(this.pickFirstDefined(e,["shippingDate","businessDateFrom"]))},resolveLatestDeliveryAt(e){return this.formatDateTime(this.pickFirstDefined(e,["latestDeliveryDate"]))},resolveDeliveryDate(e){return this.formatDate(this.pickFirstDefined(e,["deliveryDate","businessDateTo","calculatedDeliveryDate"]))},pickFirstDefined(e,t){if(!e||!Array.isArray(t))return null;for(const i of t)if(Object.prototype.hasOwnProperty.call(e,i)&&e[i]!==null&&e[i]!==void 0)return e[i];return null},formatDate(e){if(!e)return"-";const t=new Date(e);return Number.isNaN(t.getTime())?"-":t.toLocaleDateString("de-DE",{timeZone:"Europe/Berlin"})},formatDateTime(e){if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t.toLocaleString("de-DE",{timeZone:"Europe/Berlin",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},formatHistoryEntry(e){if(typeof e=="string")return e;if(!e||typeof e!="object")return"-";const t=String(e.lastChangedBy||e.user||e.actor||"system").trim()||"system",i=this.formatDateTime(e.lastChangedAt||e.createdAt||e.timestamp||null);return e.label?i?`${e.label}: ${t} · ${i}`:`${e.label}: ${t}`:i?`${t} · ${i}`:t},resolveAuditDisplay(e){if(!e||typeof e!="object")return"-";const t=String(e.lastChangedBy||e.user||"").trim(),i=this.formatDateTime(e.lastChangedAt||e.updatedAt||e.currentUpdatedAt||null);return t&&i?`${t} · ${i}`:t||i||e.audit||"-"},resolveTrackingEntries(e,t){if(Array.isArray(t==null?void 0:t.trackingEntries)&&t.trackingEntries.length>0)return t.trackingEntries.map(n=>({number:String((n==null?void 0:n.number)||"").trim(),carrier:String((n==null?void 0:n.carrier)||"").trim().toLowerCase()})).filter(n=>n.number!=="");const i=String(t.trackingCarrier||e.trackingCarrier||"").toLowerCase(),s=Array.isArray(t.packages)?t.packages:[];return(s.length===0?[t.sendenummer||e.sendenummer||""]:s).map(n=>{if(typeof n=="string"){const l=String(n||"").trim();return l.toLowerCase()===_.toLowerCase()?{number:l,carrier:"internal",isInternal:!0}:{number:l,carrier:i}}const r=String((n==null?void 0:n.number)||"").trim();return r.toLowerCase()===_.toLowerCase()?{number:r,carrier:"internal",isInternal:!0}:{number:r,carrier:String((n==null?void 0:n.carrier)||i).toLowerCase()}}).filter(n=>n.number!=="")},resolveTrackingSummaryDisplay(e){const t=this.resolveOrderTrackingEntries(e).filter(i=>["dhl","gls"].includes(i.carrier));return t.length>0?t.map(i=>i.number).join(", "):this.isInternalShippingMode(e)?"Versand durch First Medical":"-"},isInternalShippingMode(e){const t=[e==null?void 0:e.shippingMode,e==null?void 0:e.shipping_mode,e==null?void 0:e.shippingType,e==null?void 0:e.shipping_type,e==null?void 0:e.shippingMethod,e==null?void 0:e.shipping_method,e==null?void 0:e.versandart,e==null?void 0:e.versandArt,e==null?void 0:e.versand_art].filter(i=>i!=null);return(e==null?void 0:e.internalShipping)===!0||(e==null?void 0:e.isInternalShipping)===!0?!0:t.some(i=>{const s=String(i).toLowerCase();return s.includes("internal")||s.includes("intern")||s.includes("first medical")||s.includes("hausversand")})},async openTrackingHistory(e){var t,i;if(e!=null&&e.isInternal){this.activeTracking=e,this.trackingError=this.$t("lieferzeiten.tracking.internalShipmentInfo"),this.trackingEvents=[],this.isTrackingLoading=!1,this.showTrackingModal=!0;return}if(!(e!=null&&e.number)||!(e!=null&&e.carrier)){this.trackingError=this.$t("lieferzeiten.tracking.missingCarrier"),this.showTrackingModal=!0;return}this.activeTracking=e,this.showTrackingModal=!0,this.isTrackingLoading=!0,this.trackingError="",this.trackingEvents=[];try{const s=await this.lieferzeitenTrackingService.history(e.carrier,e.number);if((s==null?void 0:s.ok)===!1){this.trackingError=(s==null?void 0:s.message)||this.$t("lieferzeiten.tracking.loadError");return}this.trackingEvents=Array.isArray(s==null?void 0:s.events)?s.events:[]}catch(s){this.trackingError=((i=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:i.message)||(s==null?void 0:s.message)||this.$t("lieferzeiten.tracking.loadError")}finally{this.isTrackingLoading=!1}},closeTrackingModal(){this.showTrackingModal=!1,this.isTrackingLoading=!1,this.trackingError="",this.trackingEvents=[],this.activeTracking=null},resolveLastChangedBy(e){const t=this.pickFirstDefined(e,["lastChangedBy","user"]);return t?String(t).trim():null},resolveBusinessStatusDisplay(e){const t=(e==null?void 0:e.business_status)||(e==null?void 0:e.businessStatus)||null,i=String((t==null?void 0:t.code)||(e==null?void 0:e.status)||"").trim(),s=String((t==null?void 0:t.label)||(e==null?void 0:e.business_status_label)||(e==null?void 0:e.statusLabel)||"").trim();return!i&&!s?null:i?s?`${i} · ${s}`:i:s},businessStatusLabel(e){var r,l;const t=String(((r=e==null?void 0:e.businessStatus)==null?void 0:r.code)||(e==null?void 0:e.status)||"").trim(),i=S[t]||"lieferzeiten.businessStatus.unknown",s=String(((l=e==null?void 0:e.businessStatus)==null?void 0:l.label)||"").trim(),a=this.$t(i),n=a===i?s||this.$t("lieferzeiten.businessStatus.unknown"):a;return`${t||"-"} · ${n}`},resolveEditableBusinessStatus(e){var i;const t=Number(((i=e==null?void 0:e.businessStatus)==null?void 0:i.code)??(e==null?void 0:e.status)??0);return t===7||t===8?String(t):null},canSaveBusinessStatus(e){var s;if(!this.hasEditAccess())return!1;const t=Number((e==null?void 0:e.selectedBusinessStatus)||0);if(![7,8].includes(t))return!1;const i=Number(((s=e==null?void 0:e.businessStatus)==null?void 0:s.code)??(e==null?void 0:e.status)??0);return t!==i},async saveBusinessStatus(e){var s,a;if(!this.hasEditAccess())return;const t=(e==null?void 0:e.id)||null,i=Number((e==null?void 0:e.selectedBusinessStatus)||0);if(!t||![7,8].includes(i)){this.createNotificationError({title:this.$t("global.default.error"),message:this.$t("lieferzeiten.statusChange.invalidSelection")});return}try{await this.lieferzeitenOrdersService.updateOrderStatus(t,i),this.createNotificationSuccess({title:this.$t("global.default.success"),message:this.$t("lieferzeiten.statusChange.saved")}),await this.reloadOrder(e)}catch(n){this.createNotificationError({title:this.$t("global.default.error"),message:((a=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:a.message)||(n==null?void 0:n.message)||this.$t("global.default.error")})}},shippingLabel(e){return this.shippingLabelForPosition(e,null)},shippingLabelForPosition(e,t){const i=this.normalizeShippingType((e==null?void 0:e.shippingAssignmentType)||(e==null?void 0:e.versandart)),s=this.parseQuantity(t==null?void 0:t.orderedQuantity),a=this.parseQuantity(t==null?void 0:t.shippedQuantity);return i==="unknown"?this.$t("lieferzeiten.shipping.unclear"):i==="gesamt"?this.$t("lieferzeiten.shipping.completeShipment"):i==="teil"?s!==null&&a!==null&&a>=s?this.$t("lieferzeiten.shipping.partialShipment"):`${this.$t("lieferzeiten.shipping.splitPosition")} ${this.positionQuantitySuffix(a,s)}`:i==="trennung"?`${this.$t("lieferzeiten.shipping.splitPosition")} ${this.positionQuantitySuffix(a,s)}`:this.$t("lieferzeiten.shipping.unclear")},normalizeShippingType(e){const t=String(e||"").trim().toLowerCase();return t===""?"unknown":["gesamt","complete","all_in_one","full"].includes(t)?"gesamt":["teil","partial","teillieferung","partial_shipment"].includes(t)?"teil":["trennung","split","split_position"].includes(t)?"trennung":t},parseQuantity(e){if(e==null||e==="")return null;const t=Number(e);return!Number.isFinite(t)||t<0?null:Math.round(t)},positionQuantitySuffix(e,t){return`${e??0}/${t??0} ${this.$t("lieferzeiten.shipping.pieces")}`},rangeToDays(e){if(!(e!=null&&e.from)||!(e!=null&&e.to))return null;const t=new Date(e.from),i=new Date(e.to);return Number.isNaN(t.getTime())||Number.isNaN(i.getTime())?null:Math.floor((i.getTime()-t.getTime())/864e5)+1},isRangeValid(e,t,i){const s=this.rangeToDays(e);return Number.isInteger(s)&&s>=t&&s<=i},isRangeChanged(e,t){return((e==null?void 0:e.from)||null)!==((t==null?void 0:t.from)||null)||((e==null?void 0:e.to)||null)!==((t==null?void 0:t.to)||null)},hasValidNeuerLieferterminRange(e){return Array.isArray(e==null?void 0:e.parcels)&&e.parcels.some(t=>this.isRangeValid(t.neuerLieferterminRange,1,4))},canSaveLiefertermin(e,t){return this.isRangeValid(t.lieferterminLieferantRange,1,14)&&this.isRangeChanged(t.lieferterminLieferantRange,t.originalLieferterminLieferantRange)&&this.hasValidNeuerLieferterminRange(e)},canSaveNeuerLiefertermin(e){const t=e.supplierRange,i=e.neuerLieferterminRange;return!this.isParcelEditableByStatus(e)||!this.isRangeValid(t,1,14)||!this.isRangeValid(i,1,4)||!this.isRangeChanged(i,e.originalNeuerLieferterminRange)?!1:i.from>=t.from&&i.to<=t.to},resolveConcurrencyToken(e){return e.updatedAt||e.lastChangedAt||e.currentUpdatedAt||null},applyConflictRefresh(e,t){!t||t.exists===!1||(t.updatedAt&&(e.updatedAt=t.updatedAt),t.lastChangedAt&&(e.lastChangedAt=t.lastChangedAt),Object.prototype.hasOwnProperty.call(t,"comment")&&(e.comment=t.comment||""),t.lieferterminLieferant&&(e.lieferterminLieferantRange={from:t.lieferterminLieferant.from||null,to:t.lieferterminLieferant.to||null},e.originalLieferterminLieferantRange={...e.lieferterminLieferantRange}),t.neuerLiefertermin&&(e.neuerLieferterminRange={from:t.neuerLiefertermin.from||null,to:t.neuerLiefertermin.to||null},e.originalNeuerLieferterminRange={...e.neuerLieferterminRange}))},handleConflictError(e,t){var s;const i=(s=e==null?void 0:e.response)==null?void 0:s.data;return(i==null?void 0:i.code)!=="CONCURRENT_MODIFICATION"?!1:(this.applyConflictRefresh(t,(i==null?void 0:i.refresh)||null),this.createNotificationWarning({title:this.$t("global.default.warning"),message:(i==null?void 0:i.message)||"Conflit d’édition détecté. Ligne rafraîchie, veuillez réappliquer vos modifications."}),!0)},weekLabelFromDate(e){if(!e)return"-";const t=new Date(e);if(Number.isNaN(t.getTime()))return"-";const i=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),s=i.getUTCDay()||7;i.setUTCDate(i.getUTCDate()+4-s);const a=new Date(Date.UTC(i.getUTCFullYear(),0,1));return`KW ${Math.ceil(((i-a)/864e5+1)/7)}`},async saveLiefertermin(e,t){var s,a;if(!this.hasEditAccess())return;if(!this.canSaveLiefertermin(e,t)){this.createNotificationWarning({title:this.$t("global.default.warning"),message:this.$t("lieferzeiten.validation.supplierSaveRequiresCombinedRange")});return}const i=(t==null?void 0:t.id)||null;if(!i){this.createNotificationError({title:this.$t("global.default.error"),message:"Missing position id"});return}try{await this.lieferzeitenOrdersService.updateLieferterminLieferant(i,{from:t.lieferterminLieferantRange.from,to:t.lieferterminLieferantRange.to,updatedAt:this.resolveConcurrencyToken(e)}),this.createNotificationSuccess({title:this.$t("global.default.success"),message:this.$t("lieferzeiten.audit.savedSupplierDate")}),await this.reloadOrder(e)}catch(n){if(this.handleConflictError(n,e))return;this.createNotificationError({title:this.$t("global.default.error"),message:((a=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:a.message)||(n==null?void 0:n.message)||this.$t("global.default.error")})}},async saveNeuerLiefertermin(e,t){var s,a;if(!this.hasEditAccess()||!this.canSaveNeuerLiefertermin(t))return;const i=(t==null?void 0:t.id)||null;if(!i){this.createNotificationError({title:this.$t("global.default.error"),message:"Missing paket id"});return}try{await this.lieferzeitenOrdersService.updateNeuerLieferterminByPaket(i,{from:t.neuerLieferterminRange.from,to:t.neuerLieferterminRange.to,updatedAt:this.resolveConcurrencyToken(e)}),this.createNotificationSuccess({title:this.$t("global.default.success"),message:this.$t("lieferzeiten.audit.savedNewDate")}),await this.reloadOrder(e)}catch(n){if(this.handleConflictError(n,e))return;this.createNotificationError({title:this.$t("global.default.error"),message:((a=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:a.message)||(n==null?void 0:n.message)||this.$t("global.default.error")})}},async saveComment(e){var i,s;if(!this.canSaveComment(e))return;const t=this.ensureCommentTargetPositionId(e);if(!t){this.createNotificationError({title:this.$t("global.default.error"),message:"Missing position id"});return}try{await this.lieferzeitenOrdersService.updateComment(t,{comment:e.comment||"",updatedAt:this.resolveConcurrencyToken(e)}),this.createNotificationSuccess({title:this.$t("global.default.success"),message:this.$t("lieferzeiten.audit.savedComment")}),await this.reloadOrder(e)}catch(a){if(this.handleConflictError(a,e))return;this.createNotificationError({title:this.$t("global.default.error"),message:((s=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:s.message)||(a==null?void 0:a.message)||this.$t("global.default.error")})}},async requestAdditionalDeliveryDate(e,t){var s,a;if(!this.hasEditAccess())return;if(!t){this.createNotificationError({title:this.$t("global.default.error"),message:"Missing position id"});return}const i=this.resolveAdditionalRequestInitiator();try{await this.lieferzeitenOrdersService.createAdditionalDeliveryRequest(t,i),this.createNotificationSuccess({title:this.$t("lieferzeiten.additionalRequest.notificationTitle"),message:this.$t("lieferzeiten.additionalRequest.notificationRequested",{initiator:i})}),await this.reloadOrder(e)}catch(n){this.createNotificationError({title:this.$t("global.default.error"),message:((a=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:a.message)||(n==null?void 0:n.message)||this.$t("global.default.error")})}},async saveOrderStatus(e){var i,s;if(!this.canUpdateOrderStatus(e))return;const t=Number(e.selectedManualStatus);if(![7,8].includes(t)){this.createNotificationError({title:this.$t("global.default.error"),message:this.$t("lieferzeiten.status.manual.invalid")});return}this.$set(this.statusUpdateLoadingByOrder,e.id,!0);try{await this.lieferzeitenOrdersService.updatePaketStatus(e.id,{status:t,updatedAt:this.resolveConcurrencyToken(e)}),this.createNotificationSuccess({title:this.$t("global.default.success"),message:this.$t("lieferzeiten.status.manual.updated",{status:t})}),await this.reloadOrder(e)}catch(a){if(this.handleConflictError(a,e))return;this.createNotificationError({title:this.$t("global.default.error"),message:((s=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:s.message)||(a==null?void 0:a.message)||this.$t("global.default.error")})}finally{this.$set(this.statusUpdateLoadingByOrder,e.id,!1)}},notifyInitiatorIfClosed(e){const t=e.additionalDeliveryRequest;!t||t.notifiedAt||this.isOrderOpen(e)||(t.notifiedAt=new Date().toISOString(),this.updateAudit(e,this.$t("lieferzeiten.additionalRequest.auditClosed")),this.createNotificationInfo({title:this.$t("lieferzeiten.additionalRequest.notificationTitle"),message:this.$t("lieferzeiten.additionalRequest.notificationClosed",{initiator:t.initiator||this.$t("lieferzeiten.additionalRequest.defaultInitiator")})}))},resolveAdditionalRequestInitiator(){var r,l,o,y,b,m,$,A;const e=((l=(r=Shopware==null?void 0:Shopware.Context)==null?void 0:r.api)==null?void 0:l.user)||null,t=((b=(y=(o=Shopware==null?void 0:Shopware.Store)==null?void 0:o.get)==null?void 0:y.call(o,"session"))==null?void 0:b.currentUser)||((A=($=(m=Shopware==null?void 0:Shopware.State)==null?void 0:m.get)==null?void 0:$.call(m,"session"))==null?void 0:A.currentUser)||null,i=e||t,s=typeof(i==null?void 0:i.id)=="string"?i.id.trim():"",n=[i==null?void 0:i.firstName,i==null?void 0:i.lastName].filter(L=>typeof L=="string"&&L.trim()!=="").join(" ").trim()||String((i==null?void 0:i.username)||(i==null?void 0:i.email)||"").trim();return n&&s?`${n} (${s})`:s||n||this.$t("lieferzeiten.additionalRequest.defaultInitiator")},updateAudit(e,t){const i=String((e==null?void 0:e.lastChangedBy)||(e==null?void 0:e.user)||"system").trim()||"system";e.audit=`${t} · ${i} · ${new Date().toLocaleString("de-DE")}`},async reloadOrder(e){if(typeof this.onReloadOrder=="function"){await this.onReloadOrder(e);return}}}});const{Module:se}=Shopware;se.register("lieferzeiten",{type:"plugin",name:"lieferzeiten",title:"lieferzeiten.general.mainMenuItemGeneral",description:"lieferzeiten.general.description",color:"#2B8CBF",icon:"regular-clock",privileges:{viewer:{permissions:["lieferzeiten.viewer"],dependencies:[]},editor:{permissions:["lieferzeiten.editor"],dependencies:["lieferzeiten.viewer"]}},routes:{index:{component:"lieferzeiten-index",path:"index",redirect:{name:"lieferzeiten.all"},children:{all:{component:"lieferzeiten-all",path:"all",meta:{parentPath:"lieferzeiten.index",privilege:"lieferzeiten.viewer"}},open:{component:"lieferzeiten-open",path:"open",meta:{parentPath:"lieferzeiten.index",privilege:"lieferzeiten.viewer"}},statistics:{component:"lieferzeiten-statistics",path:"statistics",meta:{parentPath:"lieferzeiten.index",privilege:"lieferzeiten.viewer"}}}}},navigation:[{id:"lieferzeiten",label:"lieferzeiten.general.mainMenuItemGeneral",color:"#2B8CBF",path:"lieferzeiten.index",icon:"regular-clock",parent:"sw-order",position:100,privilege:"lieferzeiten.viewer"},{id:"lieferzeiten-statistics",label:"lieferzeiten.general.mainMenuItemStatistics",color:"#2B8CBF",path:"lieferzeiten.statistics",icon:"regular-chart-bar",parent:"sw-dashboard",position:110,privilege:"lieferzeiten.viewer"}]});const ae=`<sw-page class="lieferzeiten-channel-settings-list"> <template #smart-bar-header> <h2>{{ $tc('lieferzeiten.lms.dashboard.title') }}</h2> </template> <template #smart-bar-actions> <sw-button v-if="hasEditAccess" :isLoading="isSeedingDemoData" :variant="hasDemoData ? 'danger' : 'default'" @click="onToggleDemoData">{{ hasDemoData ? $tc('lieferzeiten.lms.dashboard.removeDemoData') : $tc('lieferzeiten.lms.dashboard.seedDemoData') }}</sw-button> <sw-button-process v-if="hasEditAccess" variant="primary" :isLoading="isSaving" @click="onSave">{{ $tc('global.default.save') }}</sw-button-process> </template> <template #content> <sw-card :isLoading="isLoading" :title="$tc('lieferzeiten.lms.dashboard.cardTitle')"> <sw-alert variant="info" appearance="default" :showIcon="true"> {{ $tc('lieferzeiten.lms.dashboard.introText') }} </sw-alert> <sw-alert v-if="hasValidationErrors" variant="error" appearance="default" :showIcon="true" class="sw-mt-16"> {{ $tc('lieferzeiten.lms.dashboard.validationError') }} </sw-alert> <section v-for="group in groupedChannels" :key="group.id" class="sw-mt-24"> <h3 class="sw-mb-8">{{ group.title }}</h3> <div v-for="channel in group.channels" :key="channel.id" class="sw-mt-16"> <div class="sw-flex sw-flex--align-center sw-flex--justify-space-between"> <h4 class="sw-m-0">{{ channel.name || channel.id }}</h4> <sw-label v-if="hasIncompletePdmsMapping(channel.id)" appearance="pill" variant="warning" size="small"> {{ $tc('lieferzeiten.lms.dashboard.incompleteMappingBadge') }} </sw-label> </div> <sw-alert v-if="hasIncompletePdmsMapping(channel.id)" variant="warning" appearance="default" :showIcon="true" class="sw-mt-8 sw-mb-8"> {{ $tc('lieferzeiten.lms.dashboard.incompleteMappingWarning', 0, { channelName: channel.name || channel.id }) }} </sw-alert> <sw-data-grid :dataSource="getChannelPdmsLieferzeiten(channel.id)" :columns="[ { property: 'label', label: $tc('lieferzeiten.lms.dashboard.columns.pdmsLieferzeit'), width: '160px' }, { property: 'shippingOverdueWorkingDays', label: $tc('lieferzeiten.lms.dashboard.columns.shippingOverdueWorkingDays') }, { property: 'deliveryOverdueWorkingDays', label: $tc('lieferzeiten.lms.dashboard.columns.deliveryOverdueWorkingDays') } ]" :showSelection="false" :showActions="false" :allowColumnEdit="false" > <template #column-label="{ item }"> {{ item.label }} </template> <template #column-shippingOverdueWorkingDays="{ item }"> <sw-number-field numberType="int" :min="0" :disabled="!hasEditAccess" :value="getMatrixValue(channel.id, item.key, 'shippingOverdueWorkingDays')" :error="getFieldError(channel.id, item.key, 'shippingOverdueWorkingDays')" @input="onChangeNumberField(channel.id, item.key, 'shippingOverdueWorkingDays', $event)" /> </template> <template #column-deliveryOverdueWorkingDays="{ item }"> <sw-number-field numberType="int" :min="0" :disabled="!hasEditAccess" :value="getMatrixValue(channel.id, item.key, 'deliveryOverdueWorkingDays')" :error="getFieldError(channel.id, item.key, 'deliveryOverdueWorkingDays')" @input="onChangeNumberField(channel.id, item.key, 'deliveryOverdueWorkingDays', $event)" /> </template> </sw-data-grid> </div> </section> </sw-card> </template> </sw-page>`,k=Object.freeze([{domainKey:"first-medical-shop.de",technicalIdentifiers:["first-medical-shop.de","first-medical-shop","first_medical_shop","first-medical-e-commerce"]},{domainKey:"ebay.de",technicalIdentifiers:["ebay.de","ebay_de","ebay-de"]},{domainKey:"ebay.at",technicalIdentifiers:["ebay.at","ebay_at","ebay-at"]},{domainKey:"kaufland",technicalIdentifiers:["kaufland"]},{domainKey:"peg",technicalIdentifiers:["peg"]},{domainKey:"zonami",technicalIdentifiers:["zonami"]},{domainKey:"medical-solutions-germany.de",technicalIdentifiers:["medical-solutions-germany.de","medical-solutions-germany","medical_solutions_germany"]}]),ne=Object.freeze(k.reduce((e,t)=>(t.technicalIdentifiers.forEach(i=>{e[I(i)]=t.domainKey}),e),{}));function I(e){return String(e||"").trim().toLowerCase()}function re(e){if(!e)return null;try{const t=new URL(e);return c(t.hostname)}catch{return c(e)}}function x(e){var s,a,n,r,l;const t=(s=e==null?void 0:e.domains)==null?void 0:s.map(o=>re(o==null?void 0:o.url)).find(o=>o!==null);return t&&k.some(o=>o.domainKey===t)?t:[e==null?void 0:e.technicalName,e==null?void 0:e.shortName,(a=e==null?void 0:e.customFields)==null?void 0:a.technicalIdentifier,(n=e==null?void 0:e.customFields)==null?void 0:n.technicalName,(r=e==null?void 0:e.customFields)==null?void 0:r.technical_name,(l=e==null?void 0:e.customFields)==null?void 0:l.technical_identifier].map(o=>I(o)).filter(o=>o.length>0).map(o=>ne[o]||null).find(o=>o!==null)||null}function le(e){return x(e)!==null}const{Component:oe}=Shopware,{Criteria:w}=Shopware.Data,ce=[1,2,3,4],de=k.map(e=>e.domainKey),ue={"first-medical-e-commerce":"First Medical - E-Commerce","medical-solutions":"Medical Solutions"},me=Object.entries(ue).map(([e,t])=>{const i=v.find(s=>s.id===e);return{id:e,title:t,domainKeys:((i==null?void 0:i.channels)||[]).map(s=>s.value).filter(s=>de.includes(s))}}),he={id:"other-channels",title:"Weitere Kanäle"};oe.register("lieferzeiten-channel-settings-list",{template:ae,mixins:["notification"],inject:["repositoryFactory","lieferzeitenOrdersService","acl"],data(){return{thresholdRepository:null,salesChannelRepository:null,channels:[],matrixValues:{},existingEntryIds:{},validationErrors:{},isLoading:!1,isSaving:!1,isSeedingDemoData:!1,hasDemoData:!1,channelPdmsLieferzeiten:{},channelPdmsMappingIncomplete:{}}},computed:{groupedChannels(){const e=me.map(s=>({...s,channels:[]})),t=[];this.channels.forEach(s=>{const a=this.resolveChannelDomainKey(s),n=e.find(r=>r.domainKeys.includes(a));if(n){n.channels.push(s);return}t.push(s)});const i=e.filter(s=>s.channels.length>0);return t.length>0&&i.push({...he,channels:t}),i},hasEditAccess(){var e;return typeof((e=this.acl)==null?void 0:e.can)!="function"?!1:this.acl.can("lieferzeiten.editor")||this.acl.can("admin")},hasValidationErrors(){return Object.keys(this.validationErrors).length>0}},created(){this.thresholdRepository=this.repositoryFactory.create("lieferzeiten_channel_pdms_threshold"),this.salesChannelRepository=this.repositoryFactory.create("sales_channel"),this.loadData(),this.loadDemoDataStatus()},methods:{getWhitelistedChannels(e){return e.filter(t=>le(t))},getWhitelistedChannelIds(){return new Set(this.channels.map(e=>e.id))},resolveChannelDomainKey(e){var s;const t=x(e);if(t)return t;const i=(s=e==null?void 0:e.domains)==null?void 0:s.map(a=>this.normalizeDomainFromUrl(a==null?void 0:a.url)).find(a=>a!==null);return i||c(e==null?void 0:e.name)},normalizeDomainFromUrl(e){if(!e)return null;try{const t=new URL(e);return c(t.hostname)}catch{return c(e)}},extractErrorMessage(e){var t,i,s,a,n,r;return((a=(s=(i=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:i.errors)==null?void 0:s[0])==null?void 0:a.detail)||((r=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:r.message)||(e==null?void 0:e.message)||this.$tc("global.default.error")},notifyRequestError(e,t){this.createNotificationError({title:t,message:this.extractErrorMessage(e)})},getChannelPdmsLieferzeiten(e){return this.channelPdmsLieferzeiten[e]||this.buildNormalizedPdmsSlots()},createMissingSlotEntry(e){return{key:`PDMS_${e}`,label:this.$tc("lieferzeiten.lms.dashboard.incompleteMappingSlotLabel",0,{slot:e}),isPlaceholder:!0}},buildNormalizedPdmsSlots(e=new Map){return ce.map(t=>e.get(t)||this.createMissingSlotEntry(t))},getEntryKey(e,t){return`${e}.${t}`},hasIncompletePdmsMapping(e){return!!this.channelPdmsMappingIncomplete[e]},getFieldKey(e,t,i){return`${e}.${t}.${i}`},ensureChannelMatrix(e){this.matrixValues[e]||this.$set(this.matrixValues,e,{}),this.getChannelPdmsLieferzeiten(e).forEach(({key:t})=>{this.matrixValues[e][t]||this.$set(this.matrixValues[e],t,{shippingOverdueWorkingDays:0,deliveryOverdueWorkingDays:0})})},async loadChannelPdmsLieferzeiten(e){try{const t=await this.lieferzeitenOrdersService.getSalesChannelLieferzeiten(e),i=new Map;Array.isArray(t==null?void 0:t.lieferzeiten)&&t.lieferzeiten.forEach(a=>{var r;const n=Number.parseInt(a==null?void 0:a.slot,10);!Number.isInteger(n)||n<1||n>4||i.has(n)||i.set(n,{key:`PDMS_${n}`,label:((r=a==null?void 0:a.lieferzeit)==null?void 0:r.name)||`PDMS ${n}`,isPlaceholder:!1})});const s=this.buildNormalizedPdmsSlots(i);this.$set(this.channelPdmsLieferzeiten,e,s),this.$set(this.channelPdmsMappingIncomplete,e,s.some(a=>a.isPlaceholder))}catch(t){this.$set(this.channelPdmsLieferzeiten,e,this.buildNormalizedPdmsSlots()),this.$set(this.channelPdmsMappingIncomplete,e,!0),this.notifyRequestError(t,this.$tc("lieferzeiten.lms.dashboard.title"))}},normalizeNonNegativeInteger(e){if(typeof e=="number")return Number.isInteger(e),e;if(typeof e!="string")return e;const t=e.trim();return/^\d+$/.test(t)?Number.parseInt(t,10):e},validateValue(e,t,i){var r,l;const s=this.getFieldKey(e,t,i),a=(l=(r=this.matrixValues[e])==null?void 0:r[t])==null?void 0:l[i];if(!(Number.isInteger(a)&&a>=0)){this.$set(this.validationErrors,s,this.$tc("lieferzeiten.lms.dashboard.inlineValidationError"));return}this.$delete(this.validationErrors,s)},onChangeNumberField(e,t,i,s){this.ensureChannelMatrix(e),this.matrixValues[e][t][i]=this.normalizeNonNegativeInteger(s),this.validateValue(e,t,i)},getMatrixValue(e,t,i){var s,a;return((a=(s=this.matrixValues[e])==null?void 0:s[t])==null?void 0:a[i])??0},getFieldError(e,t,i){return this.validationErrors[this.getFieldKey(e,t,i)]||null},async loadData(){this.isLoading=!0;const e=new w(1,500),t=new w(1,500);t.addSorting(w.sort("name","ASC")),t.addAssociation("domains");try{const[i,s]=await Promise.all([this.thresholdRepository.search(e,Shopware.Context.api),this.salesChannelRepository.search(t,Shopware.Context.api)]);this.channels=this.getWhitelistedChannels(s),this.matrixValues={},this.existingEntryIds={},this.channelPdmsLieferzeiten={},this.channelPdmsMappingIncomplete={};const a=this.getWhitelistedChannelIds();await Promise.all(this.channels.map(n=>this.loadChannelPdmsLieferzeiten(n.id))),this.channels.forEach(n=>{this.ensureChannelMatrix(n.id)}),i.forEach(n=>{a.has(n.salesChannelId)&&(this.ensureChannelMatrix(n.salesChannelId),this.$set(this.matrixValues[n.salesChannelId],n.pdmsLieferzeit,{shippingOverdueWorkingDays:n.shippingOverdueWorkingDays,deliveryOverdueWorkingDays:n.deliveryOverdueWorkingDays}),this.$set(this.existingEntryIds,this.getEntryKey(n.salesChannelId,n.pdmsLieferzeit),n.id))})}catch(i){this.notifyRequestError(i,this.$tc("lieferzeiten.lms.dashboard.title"))}finally{this.isLoading=!1}},async onSave(){if(this.hasEditAccess){if(this.validationErrors={},this.channels.forEach(e=>{this.getChannelPdmsLieferzeiten(e.id).forEach(({key:t})=>{this.validateValue(e.id,t,"shippingOverdueWorkingDays"),this.validateValue(e.id,t,"deliveryOverdueWorkingDays")})}),this.hasValidationErrors){this.createNotificationError({title:this.$tc("lieferzeiten.lms.dashboard.title"),message:this.$tc("lieferzeiten.lms.dashboard.validationError")});return}this.isSaving=!0;try{const e=this.getWhitelistedChannelIds();for(const t of this.channels)if(e.has(t.id)){this.ensureChannelMatrix(t.id);for(const{key:i}of this.getChannelPdmsLieferzeiten(t.id)){const s=this.thresholdRepository.create(Shopware.Context.api);s.id=this.existingEntryIds[this.getEntryKey(t.id,i)]||s.id,s.salesChannelId=t.id,s.pdmsLieferzeit=i,s.shippingOverdueWorkingDays=this.matrixValues[t.id][i].shippingOverdueWorkingDays,s.deliveryOverdueWorkingDays=this.matrixValues[t.id][i].deliveryOverdueWorkingDays,await this.thresholdRepository.save(s,Shopware.Context.api)}}this.createNotificationSuccess({title:this.$tc("lieferzeiten.lms.dashboard.title"),message:this.$tc("lieferzeiten.lms.dashboard.saveSuccess")}),await this.loadData()}catch(e){this.notifyRequestError(e,this.$tc("lieferzeiten.lms.dashboard.title"))}finally{this.isSaving=!1}}},async loadDemoDataStatus(){try{const e=await this.lieferzeitenOrdersService.getDemoDataStatus();this.hasDemoData=!!(e!=null&&e.hasDemoData)}catch(e){this.notifyRequestError(e,this.$tc("lieferzeiten.lms.dashboard.demoDataTitle"))}},async onToggleDemoData(){if(this.hasEditAccess){this.isSeedingDemoData=!0;try{const e=await this.lieferzeitenOrdersService.toggleDemoData();this.hasDemoData=!!(e!=null&&e.hasDemoData),await this.loadData(),this.createNotificationSuccess({title:this.$tc("lieferzeiten.lms.dashboard.demoDataTitle"),message:(e==null?void 0:e.action)==="removed"?this.$tc("lieferzeiten.lms.dashboard.demoDataRemoved"):this.$tc("lieferzeiten.lms.dashboard.demoDataSaved")})}catch(e){this.notifyRequestError(e,this.$tc("lieferzeiten.lms.dashboard.demoDataTitle"))}finally{this.isSeedingDemoData=!1}}}}});const pe=`<sw-page class="lieferzeiten-task-assignment-rule-list"> <template #smart-bar-header> <h2>{{ $tc('lieferzeiten.lms.navigation.taskAssignmentRules') }}</h2> </template> <template #smart-bar-actions> <sw-button v-if="hasEditAccess" variant="primary" @click="onCreate">Create</sw-button> </template> <template #content> <sw-card> <sw-entity-listing v-if="items" :items="items" :repository="repository" :columns="columns" :isLoading="isLoading" :showSelection="false" :allowInlineEdit="hasEditAccess" :allowDelete="hasEditAccess" :total="total" :page="page" :limit="limit" @page-change="onPageChange" @inline-edit-save="onInlineEditSave" @inline-edit-cancel="getList" @delete="onDelete" /> </sw-card> </template> </sw-page>`,{Component:fe}=Shopware,{Criteria:N}=Shopware.Data;fe.register("lieferzeiten-task-assignment-rule-list",{template:pe,mixins:["notification"],inject:["repositoryFactory","acl"],data(){return{repository:null,items:null,isLoading:!1,total:0,page:1,limit:25,triggerOptions:["versand.datum.ueberfaellig","liefertermin.anfrage.zusaetzlich","liefertermin.anfrage.geschlossen"],assigneeTypeOptions:["user","team"]}},computed:{hasEditAccess(){var e;return typeof((e=this.acl)==null?void 0:e.can)!="function"?!1:this.acl.can("lieferzeiten.editor")||this.acl.can("admin")},columns(){return[{property:"name",label:"Name",inlineEdit:"string",primary:!0},{property:"status",label:"Status",inlineEdit:"string"},{property:"triggerKey",label:"Trigger",inlineEdit:"string"},{property:"ruleId",label:"Rule (Rules Engine)",inlineEdit:"string"},{property:"assigneeType",label:"Assignee type",inlineEdit:"string"},{property:"assigneeIdentifier",label:"Assignee",inlineEdit:"string"},{property:"priority",label:"Priority",inlineEdit:"number"},{property:"active",label:"Active",inlineEdit:"boolean"},{property:"lastChangedBy",label:"Last Changed By",inlineEdit:"string"},{property:"lastChangedAt",label:"Last Changed At",inlineEdit:"date"}]}},created(){this.repository=this.repositoryFactory.create("lieferzeiten_task_assignment_rule"),this.getList()},methods:{extractErrorMessage(e){var t,i,s,a,n,r;return((a=(s=(i=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:i.errors)==null?void 0:s[0])==null?void 0:a.detail)||((r=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:r.message)||(e==null?void 0:e.message)||this.$tc("global.default.error")},notifyRequestError(e,t){this.createNotificationError({title:t,message:this.extractErrorMessage(e)})},async getList(){this.isLoading=!0;const e=new N(this.page,this.limit);e.addSorting(N.sort("createdAt","DESC"));try{const t=await this.repository.search(e,Shopware.Context.api);this.items=t,this.total=t.total}catch(t){this.notifyRequestError(t,this.$tc("lieferzeiten.lms.navigation.taskAssignmentRules"))}finally{this.isLoading=!1}},onPageChange({page:e,limit:t}){this.page=e,this.limit=t,this.getList()},async onInlineEditSave(e){if(!this.hasEditAccess)return Promise.resolve();this.isLoading=!0;try{await this.repository.save(e,Shopware.Context.api),await this.getList()}catch(t){this.notifyRequestError(t,this.$tc("lieferzeiten.lms.navigation.taskAssignmentRules"))}},async onDelete(e){if(!this.hasEditAccess)return Promise.resolve();this.isLoading=!0;try{await this.repository.delete(e.id,Shopware.Context.api),await this.getList()}catch(t){this.notifyRequestError(t,this.$tc("lieferzeiten.lms.navigation.taskAssignmentRules"))}},async onCreate(){if(!this.hasEditAccess)return Promise.resolve();const e=this.repository.create(Shopware.Context.api);e.name="New rule",e.triggerKey=this.triggerOptions[0],e.assigneeType=this.assigneeTypeOptions[0],e.active=!1;try{await this.repository.save(e,Shopware.Context.api),await this.getList()}catch(t){this.notifyRequestError(t,this.$tc("lieferzeiten.lms.navigation.taskAssignmentRules"))}}}});const ge='<sw-page class="lieferzeiten-notification-toggle-list"> <template #smart-bar-header> <h2>{{ $tc(\'lieferzeiten.lms.navigation.notificationToggles\') }}</h2> </template> <template #content> <sw-card :isLoading="isLoading" title="Matrice des notifications"> <sw-alert variant="info" appearance="default" :showIcon="true"> Source: <code>lieferzeiten_notification_toggle</code> avec clé logique <code>(triggerKey, channel, salesChannelId)</code>. </sw-alert> <sw-alert v-if="invalidEntries.length" variant="warning" appearance="default" :showIcon="true"> {{ invalidEntries.length }} entrée(s) incohérente(s) détectée(s) (triggerKey/channel/code). Elles sont verrouillées dans la matrice. </sw-alert> <div class="sw-data-grid sw-data-grid--compact"> <table class="sw-data-grid__table"> <thead class="sw-data-grid__header"> <tr class="sw-data-grid__row"> <th class="sw-data-grid__cell">Type de notification</th> <th v-for="scope in salesChannelColumns" :key="scope.id" class="sw-data-grid__cell" > {{ scope.name }} </th> </tr> </thead> <tbody class="sw-data-grid__body"> <tr v-for="triggerKey in triggerOptions" :key="triggerKey" class="sw-data-grid__row" > <td class="sw-data-grid__cell"><strong>{{ triggerKey }}</strong></td> <td v-for="scope in salesChannelColumns" :key="`${triggerKey}-${scope.id}`" class="sw-data-grid__cell" > <div v-for="channel in channelOptions" :key="`${triggerKey}-${scope.id}-${channel}`" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;" > <span>{{ channel }}</span> <sw-switch-field :value="getToggleValue(triggerKey, channel, scope.id === \'global\' ? null : scope.id)" :disabled="!hasEditAccess || isCellDisabled(triggerKey, channel, scope.id === \'global\' ? null : scope.id)" @update:value="onToggleChanged(triggerKey, channel, scope.id === \'global\' ? null : scope.id, $event)" /> </div> </td> </tr> </tbody> </table> </div> </sw-card> </template> </sw-page>',{Component:ve}=Shopware,{Criteria:f}=Shopware.Data;ve.register("lieferzeiten-notification-toggle-list",{template:ge,mixins:["notification"],inject:["repositoryFactory","acl"],data(){return{repository:null,salesChannelRepository:null,items:[],salesChannels:[],isLoading:!1,triggerOptions:["commande.creee","commande.changement_statut","tracking.mis_a_jour","expedition.confirmee","changements.date_livraison","livraison.date.attribuee","livraison.date.modifiee","douane.requise","commande.storno","livraison.impossible","livraison.retoure","rappel.vorkasse","paiement.recu.vorkasse","commande.terminee.rappel_evaluation","versand.datum.ueberfaellig","liefertermin.anfrage.zusaetzlich","liefertermin.anfrage.geschlossen","liefertermin.anfrage.wiedereroeffnet"],channelOptions:["email","sms","webhook"],invalidEntries:[]}},computed:{hasEditAccess(){var e;return typeof((e=this.acl)==null?void 0:e.can)!="function"?!1:this.acl.can("lieferzeiten.editor")||this.acl.can("admin")},salesChannelColumns(){return[{id:"global",name:"Global"},...this.salesChannels.map(e=>({id:e.id,name:e.name||e.id}))]}},created(){this.repository=this.repositoryFactory.create("lieferzeiten_notification_toggle"),this.salesChannelRepository=this.repositoryFactory.create("sales_channel"),this.loadData()},methods:{extractErrorMessage(e){var t,i,s,a,n,r;return((a=(s=(i=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:i.errors)==null?void 0:s[0])==null?void 0:a.detail)||((r=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:r.message)||(e==null?void 0:e.message)||this.$tc("global.default.error")},notifyRequestError(e,t){this.createNotificationError({title:t,message:this.extractErrorMessage(e)})},async loadData(){this.isLoading=!0;try{const e=new f(1,500);e.addSorting(f.sort("triggerKey","ASC")),e.addSorting(f.sort("channel","ASC")),e.addSorting(f.sort("salesChannelId","ASC"));const t=new f(1,500);t.addSorting(f.sort("name","ASC"));const[i,s]=await Promise.all([this.repository.search(e,Shopware.Context.api),this.salesChannelRepository.search(t,Shopware.Context.api)]);this.items=[...i],this.salesChannels=[...s],this.invalidEntries=this.items.filter(a=>!this.isValidToggle(a))}catch(e){this.notifyRequestError(e,this.$tc("lieferzeiten.lms.general.mainMenuItem"))}finally{this.isLoading=!1}},getToggleEntity(e,t,i){const s=i||null;return this.items.find(a=>a.triggerKey===e&&a.channel===t&&(a.salesChannelId||null)===s)},getToggleValue(e,t,i){var s;return!!((s=this.getToggleEntity(e,t,i))!=null&&s.enabled)},isValidToggle(e){const t=`${e.triggerKey}:${e.channel}`;return this.triggerOptions.includes(e.triggerKey)&&this.channelOptions.includes(e.channel)&&e.code===t},isCellDisabled(e,t,i){const s=this.getToggleEntity(e,t,i);return s?!this.isValidToggle(s):!1},async onToggleChanged(e,t,i,s){if(!this.hasEditAccess)return;if(!this.triggerOptions.includes(e)){this.createNotificationError({title:"Validation",message:`Trigger invalide: ${e}`});return}if(!this.channelOptions.includes(t)){this.createNotificationError({title:"Validation",message:`Canal invalide: ${t}`});return}const a=i||null;let n=this.getToggleEntity(e,t,a);if(n&&!this.isValidToggle(n)){this.createNotificationError({title:"Validation",message:"Impossible de modifier une entrée incohérente. Corrigez triggerKey/channel/code via API ou supprimez-la."});return}n||(n=this.repository.create(Shopware.Context.api),n.triggerKey=e,n.channel=t,n.salesChannelId=a),n.code=`${e}:${t}`,n.enabled=!!s,this.isLoading=!0;try{await this.repository.save(n,Shopware.Context.api),await this.loadData()}catch(r){this.notifyRequestError(r,this.$tc("lieferzeiten.lms.general.mainMenuItem"))}finally{this.isLoading=!1}}}});const{Module:ye}=Shopware;ye.register("lieferzeiten-settings",{type:"plugin",name:"lieferzeiten-settings",title:"lieferzeiten.lms.general.mainMenuItem",description:"lieferzeiten.lms.general.description",color:"#009ee3",icon:"regular-cog",routes:{index:{component:"lieferzeiten-channel-settings-list",path:"",meta:{privilege:"admin"}},channelSettings:{component:"lieferzeiten-channel-settings-list",path:"channel-settings",meta:{privilege:"admin"}},taskAssignmentRules:{component:"lieferzeiten-task-assignment-rule-list",path:"task-assignment-rules",meta:{privilege:"admin"}},notificationToggles:{component:"lieferzeiten-notification-toggle-list",path:"notification-toggles",meta:{privilege:"admin"}}},navigation:[{id:"lieferzeiten-settings",label:"lieferzeiten.lms.general.mainMenuItem",color:"#009ee3",path:"lieferzeiten.settings.index",icon:"regular-cog",parent:"sw-order",position:90},{id:"lieferzeiten-settings-channel",label:"lieferzeiten.lms.navigation.thresholdsByChannel",color:"#009ee3",path:"lieferzeiten.settings.index",parent:"lieferzeiten-settings",position:10},{id:"lieferzeiten-settings-task",label:"lieferzeiten.lms.navigation.taskAssignmentRules",color:"#009ee3",path:"lieferzeiten.settings.taskAssignmentRules",parent:"lieferzeiten-settings",position:20},{id:"lieferzeiten-settings-notifications",label:"lieferzeiten.lms.navigation.notificationToggles",color:"#009ee3",path:"lieferzeiten.settings.notificationToggles",parent:"lieferzeiten-settings",position:30}]});const be={general:{mainMenuItemGeneral:"Lieferzeiten-Management",description:"Monitoring der Lieferzeiten im Admin",infoTitle:"Hinweis",timezoneInfo:"Zeitberechnungen basieren auf der Zeitzone Europe/Berlin.",openDefinition:"„Offen“ bedeutet mindestens ein noch nicht geschlossenes Paket.",mainMenuItemStatistics:"Statistiken Lieferzeiten-Management"},tabs:{all:"Alle Bestellungen",open:"Offene Bestellungen",statistics:"Statistiken Lieferzeiten-Management"},zones:{order:"Bestellung",delivery:"Lieferung",status:"Status"},domainSelection:{placeholder:"Bitte Kanal wählen",reset:"Auswahl zurücksetzen",modalTitle:"Bereich und Kanal auswählen",modalDescription:"Schritt 1: Bereich auswählen. Schritt 2: Kanal auswählen, um die Lieferzeiten-Ansichten zu laden.",persistLabel:"Auswahl auf diesem Gerät speichern",confirm:"Auswahl übernehmen",groups:{firstMedicalECommerce:"First Medical - E-Commerce",medicalSolutions:"Medical Solutions"},channels:{firstMedicalShop:"first-medical-shop.de",ebayDe:"ebay.de",ebayAt:"ebay.at",kaufland:"Kaufland",peg:"PEG",zonami:"Zonami",medicalSolutionsGermany:"medical-solutions-germany.de"},groupPlaceholder:"Bitte Bereich wählen",channelPlaceholder:"Bitte Kanal wählen",next:"Weiter",back:"Zurück",steps:{group:"Schritt 1 · Bereich",channel:"Schritt 2 · Kanal"}},kpi:{totalOrders:"Bestellungen gesamt",openOrders:"Offene Bestellungen",closedOrders:"Abgeschlossene Bestellungen",openParcels:"Offene Pakete",filteredDomain:"Kanal"},table:{orderNumber:"Bestellnummer",san6OrderNumber:"SAN6 Auftragsnummer",san6Position:"SAN6 Position",totalQuantity:"Menge",orderDate:"Bestelldatum",paymentMethod:"Zahlungsart",paymentDate:"Zahlungsdatum",customerNames:"Kundenname",domain:"Kanal",parcels:"Pakete offen/gesamt",openParcels:"Offene Pakete",positions:"Positionen",position:"Position",article:"Artikel",quantity:"Menge",packageNumbers:"Pakete",status:"Status",businessStatus:"Geschäftsstatus",tracking:"Tracking",packageStatus:"Paket-Status",latestShippingDeadline:"Spätester Versandzeitpunkt",shippingDate:"Versand-Datum",latestDeliveryDeadline:"Spätester Lieferzeitpunkt",deliveryDate:"Liefer-Datum"},fields:{supplierDate:"Liefertermin Lieferant (1-14 Tage)",supplierWeek:"KW",newDate:"Neuer Liefertermin (1-4 Tage)",comment:"Kommentar",history:"Historie",shippingType:"Versandart",audit:"Audit",days:"Tage",latestShipping:"Spätester Versand",latestDelivery:"Späteste Lieferung"},shipping:{unclear:"Unklar",complete:"Gesamt",partial:"Teil",split:"Trennung",completeShipment:"Gesamt-Versand",partialShipment:"Teillieferung",splitPosition:"Trennung Auftragsposition",pieces:"Stück"},audit:{savedSupplierDate:"Liefertermin Lieferant gespeichert",savedNewDate:"Neuer Liefertermin gespeichert",savedComment:"Kommentar gespeichert"},additionalRequest:{button:"Zusätzliche Liefertermin-Anfrage",historyEntry:"Zusätzliche Liefertermin-Anfrage ausgelöst",auditCreated:"Zusätzliche Liefertermin-Anfrage erstellt",auditClosed:"Initiator über Abschluss informiert",notificationTitle:"Liefertermin-Anfrage",notificationRequested:"Anfrage wurde erstellt (Initiator: {initiator}).",notificationClosed:"Bestellung geschlossen – Initiator {initiator} wurde benachrichtigt.",defaultInitiator:"Admin"},status:{open:"Offen",closed:"Abgeschlossen",manual:{save:"Status setzen",updated:"Status {status} zur Push-Queue hinzugefügt",invalid:"Nur Status 7 oder 8 ist erlaubt"}},emptyState:{title:"Keine offenen Bestellungen",description:"Für den ausgewählten Kanal liegen aktuell keine offenen Bestellungen vor."},tracking:{loading:"Tracking-Historie wird geladen …",empty:"Keine Tracking-Ereignisse gefunden.",loadError:"Tracking konnte nicht geladen werden.",missingCarrier:"Tracking nicht möglich: Kein Versanddienstleister hinterlegt.",internalShipmentInfo:"Versand durch First Medical (interne Expedition, kein externes Lieferanten-Tracking verfügbar)."},statistics:{periodLabel:"Periode",channelLabel:"Kanal",allChannels:"Alle Kanäle",open:"Offen",activities:"Lieferzeiten-Aktivitäten",chartTitle:"Visuelle Auswertung der Lieferzeiten-Aktivitäten",tableTitle:"Tabelle der Lieferzeiten-Aktivitäten",drilldown:"Drilldown",drilldownTitle:"Details zur Lieferzeiten-Aktivität",exportCsv:"CSV exportieren",promisedDate:"Lieferdatum",period:{7:"Letzte 7 Tage",30:"Letzte 30 Tage",90:"Letzte 90 Tage"},status:{overdue:"Überfällig"},overdueShipping:"Überfälliger Versand",overdueDelivery:"Überfällige Lieferungen (abgeschlossen)",activityDate:"Aktiv am",timelineTitle:"Aktivitäten über Zeit",timelineEmptyTitle:"Keine Aktivitäten im Zeitraum",timelineEmptyDescription:"Für die ausgewählten Filter sind keine zeitlichen Aktivitäten verfügbar.",actionsColumn:"Aktionen",actionsUnavailable:"Keine Aktion verfügbar",actionUnavailableReason:"Für diese Aktivität ist keine kontextuelle Aktion verfügbar.",actionSuccessTitle:"Aktion ausgeführt",actionErrorTitle:"Aktion fehlgeschlagen",actions:{openOrder:"Bestellung öffnen",openTask:"Aufgabe öffnen",openTracking:"Tracking",closeTask:"Aufgabe schließen",reopenTask:"Aufgabe erneut öffnen"},actionReasons:{noViewAcl:"Fehlende Berechtigung: lieferzeiten.viewer.",noEditAcl:"Fehlende Berechtigung: lieferzeiten.editor.",missingOrderReference:"Für diese Aktivität ist keine Bestellreferenz vorhanden.",missingTaskReference:"Für diese Aktivität ist keine Aufgabenreferenz vorhanden.",missingTrackingReference:"Für diese Aktivität ist keine Trackingnummer vorhanden.",unsupportedTaskStatus:"Aktion für den aktuellen Aufgabenstatus nicht verfügbar."},actionSuccess:{closeTask:"Aufgabe erfolgreich geschlossen.",reopenTask:"Aufgabe erfolgreich erneut geöffnet."},actionError:{closeTask:"Aufgabe konnte nicht geschlossen werden.",reopenTask:"Aufgabe konnte nicht erneut geöffnet werden.",openTracking:"Tracking-Historie konnte nicht geladen werden."}},loading:{errorTitle:"Bestellungen konnten nicht geladen werden",errorDescription:"Beim Laden der Bestellungen ist ein Fehler aufgetreten.",retry:"Erneut versuchen"},lms:{general:{mainMenuItem:"Lieferzeiten-Management-System",description:"LMS-Hauptseite zur Steuerung der Verzögerungsschwellen pro Verkaufskanal"},navigation:{thresholdsByChannel:"LMS-Hauptseite: Verzögerungsschwellen je Kanal",taskAssignmentRules:"Aufgaben-Zuweisungsregeln",notificationToggles:"Benachrichtigungseinstellungen"},channelSettings:{title:"LMS · Schwellenwerte je Verkaufskanal",create:"Schwellenwert anlegen"},dashboard:{title:"Lieferzeiten-Management-System",cardTitle:"Verzögerungsschwellen je Verkaufskanal verwalten",introText:"Hier verwalten Sie die Versand- und Lieferverzögerungsschwellen pro Verkaufskanal und PDMS-Lieferzeit.",validationError:"Bitte ungültige Werte korrigieren (nur ganze Zahlen ≥ 0).",inlineValidationError:"Bitte eine ganze Zahl ≥ 0 eingeben.",saveSuccess:"Verzögerungsschwellen erfolgreich gespeichert.",seedDemoData:"Demo-Daten anlegen",removeDemoData:"Demo-Daten entfernen",demoDataTitle:"Demo-Daten",demoDataRemoved:"Demo-Daten entfernt.",demoDataSaved:"Demo-Daten gespeichert.",columns:{pdmsLieferzeit:"PDMS-Lieferzeit",shippingOverdueWorkingDays:"Spätester Versandzeitpunkt - nach angegebenen Werktagen überschritten",deliveryOverdueWorkingDays:"Spätester Lieferzeitpunkt - nach angegebenen Werktagen überschritten"},incompleteMappingBadge:"Unvollständige PDMS-Zuordnung",incompleteMappingWarning:'Die PDMS-Zuordnung für den Kanal "{channelName}" ist unvollständig. Fehlende Slots sind unten markiert, damit Sie die Zuordnung vervollständigen können.',incompleteMappingSlotLabel:"Slot {slot} nicht konfiguriert"}},businessStatus:{new:"Neu",inClarification:"In Klärung",awaitingSupplier:"Warten auf Lieferanten",partiallyAvailable:"Teilweise verfügbar",readyForShipping:"Versandbereit",partiallyShipped:"Teilversendet",shipped:"Versendet",closed:"Abgeschlossen",unknown:"Unbekannt"},statusChange:{placeholder:"Status 7/8 auswählen",save:"Status speichern",saved:"Status aktualisiert und für Push vorgemerkt.",invalidSelection:"Bitte Status 7 oder 8 auswählen."}},Se={lieferzeiten:be},De={general:{mainMenuItemGeneral:"Delivery Time Management",description:"Delivery time monitoring in admin",infoTitle:"Notice",timezoneInfo:"Time calculations are based on timezone Europe/Berlin.",openDefinition:'"Open" means at least one parcel is still not closed.',mainMenuItemStatistics:"Delivery Time Management Statistics"},tabs:{all:"All orders",open:"Open orders",statistics:"Delivery Time Management Statistics"},zones:{order:"Order",delivery:"Delivery",status:"Status"},domainSelection:{placeholder:"Select channel",reset:"Reset selection",modalTitle:"Select area and channel",modalDescription:"Step 1: Select an area. Step 2: Select a channel to load delivery-time views.",persistLabel:"Persist selection on this device",confirm:"Apply selection",groups:{firstMedicalECommerce:"First Medical - E-Commerce",medicalSolutions:"Medical Solutions"},channels:{firstMedicalShop:"first-medical-shop.de",ebayDe:"ebay.de",ebayAt:"ebay.at",kaufland:"Kaufland",peg:"PEG",zonami:"Zonami",medicalSolutionsGermany:"medical-solutions-germany.de"},groupPlaceholder:"Select area",channelPlaceholder:"Select channel",next:"Next",back:"Back",steps:{group:"Step 1 · Area",channel:"Step 2 · Channel"}},kpi:{totalOrders:"Total orders",openOrders:"Open orders",closedOrders:"Closed orders",openParcels:"Open parcels",filteredDomain:"Channel"},table:{orderNumber:"Order number",san6OrderNumber:"SAN6 order number",san6Position:"SAN6 position",totalQuantity:"Quantity",orderDate:"Order date",paymentMethod:"Payment method",paymentDate:"Payment date",customerNames:"Customer name",domain:"Channel",parcels:"Open/total parcels",openParcels:"Open parcels",positions:"Positions",position:"Position",article:"Article",quantity:"Quantity",packageNumbers:"Parcels",status:"Status",businessStatus:"Business status",tracking:"Tracking",packageStatus:"Parcel status",latestShippingDeadline:"Latest shipping deadline",shippingDate:"Shipping date",latestDeliveryDeadline:"Latest delivery deadline",deliveryDate:"Delivery date"},fields:{supplierDate:"Supplier delivery date (1-14 days)",supplierWeek:"Week",newDate:"New delivery date (1-4 days)",comment:"Comment",history:"History",shippingType:"Shipping type",audit:"Audit",days:"days",latestShipping:"Latest shipping",latestDelivery:"Latest delivery"},shipping:{unclear:"Unklar",complete:"Complete",partial:"Partial",split:"Split",completeShipment:"Gesamt-Versand",partialShipment:"Teillieferung",splitPosition:"Trennung Auftragsposition",pieces:"Stück"},audit:{savedSupplierDate:"Supplier date saved",savedNewDate:"New date saved",savedComment:"Comment saved"},additionalRequest:{button:"Additional delivery date request",historyEntry:"Additional delivery date request triggered",auditCreated:"Additional delivery date request created",auditClosed:"Initiator notified on closure",notificationTitle:"Delivery date request",notificationRequested:"Request created (initiator: {initiator}).",notificationClosed:"Order closed – initiator {initiator} was notified.",defaultInitiator:"Admin"},status:{open:"Open",closed:"Closed",manual:{save:"Set status",updated:"Status {status} added to push queue",invalid:"Only status 7 or 8 is allowed"}},emptyState:{title:"No open orders",description:"There are currently no open orders for the selected channel."},tracking:{loading:"Loading tracking history …",empty:"No tracking events found.",loadError:"Unable to load tracking history.",missingCarrier:"Tracking unavailable: carrier is missing.",internalShipmentInfo:"Shipped by First Medical (internal dispatch, no external carrier tracking available)."},statistics:{periodLabel:"Period",channelLabel:"Channel",allChannels:"All channels",open:"Open",activities:"Delivery-time activities",chartTitle:"Visual delivery-time activity overview",tableTitle:"Delivery-time activity table",drilldown:"Drilldown",drilldownTitle:"Delivery-time activity details",exportCsv:"Export CSV",promisedDate:"Delivery date",period:{7:"Last 7 days",30:"Last 30 days",90:"Last 90 days"},status:{overdue:"Overdue"},overdueShipping:"Overdue shipping",overdueDelivery:"Overdue deliveries (completed)",activityDate:"Activity at",timelineTitle:"Activities over time",timelineEmptyTitle:"No activities in selected period",timelineEmptyDescription:"No timeline activity is available for the selected filters.",actionsColumn:"Actions",actionsUnavailable:"No action available",actionUnavailableReason:"No contextual action is available for this activity.",actionSuccessTitle:"Action executed",actionErrorTitle:"Action failed",actions:{openOrder:"Open order",openTask:"Open task",openTracking:"Tracking",closeTask:"Close task",reopenTask:"Reopen task"},actionReasons:{noViewAcl:"Missing permission: lieferzeiten.viewer.",noEditAcl:"Missing permission: lieferzeiten.editor.",missingOrderReference:"Order reference unavailable for this activity.",missingTaskReference:"Task reference unavailable for this activity.",missingTrackingReference:"Tracking number unavailable for this activity.",unsupportedTaskStatus:"Action unavailable for current task status."},actionSuccess:{closeTask:"Task successfully closed.",reopenTask:"Task successfully reopened."},actionError:{closeTask:"Task could not be closed.",reopenTask:"Task could not be reopened.",openTracking:"Tracking history could not be loaded."}},loading:{errorTitle:"Unable to load orders",errorDescription:"An error occurred while loading orders.",retry:"Retry"},lms:{general:{mainMenuItem:"Delivery Time Management System",description:"LMS landing page to manage delay thresholds per sales channel"},navigation:{thresholdsByChannel:"LMS landing page: Delay thresholds by channel",taskAssignmentRules:"Task assignment rules",notificationToggles:"Notification settings"},channelSettings:{title:"LMS · Thresholds by sales channel",create:"Create threshold"},dashboard:{title:"Delivery Time Management System",cardTitle:"Manage delay thresholds by sales channel",introText:"Manage shipping and delivery delay thresholds per sales channel and PDMS delivery time.",validationError:"Please correct invalid values (only integer values ≥ 0 are allowed).",inlineValidationError:"Please enter an integer value ≥ 0.",saveSuccess:"Delay thresholds saved successfully.",seedDemoData:"Create demo data",removeDemoData:"Remove demo data",demoDataTitle:"Demo data",demoDataRemoved:"Demo data removed.",demoDataSaved:"Demo data saved.",columns:{pdmsLieferzeit:"PDMS delivery time",shippingOverdueWorkingDays:"Latest shipping timestamp - overdue after specified working days",deliveryOverdueWorkingDays:"Latest delivery timestamp - overdue after specified working days"},incompleteMappingBadge:"Incomplete PDMS mapping",incompleteMappingWarning:'PDMS mapping for channel "{channelName}" is incomplete. Missing slots are marked below so you can complete the mapping.',incompleteMappingSlotLabel:"Slot {slot} not configured"}},businessStatus:{new:"New",inClarification:"In clarification",awaitingSupplier:"Awaiting supplier",partiallyAvailable:"Partially available",readyForShipping:"Ready for shipping",partiallyShipped:"Partially shipped",shipped:"Shipped",closed:"Closed",unknown:"Unknown"},statusChange:{placeholder:"Select status 7/8",save:"Save status",saved:"Status updated and queued for push.",invalidSelection:"Please select status 7 or 8."}},ze={lieferzeiten:De};Shopware.Locale.extend("de-DE",Se);Shopware.Locale.extend("en-GB",ze);const{ApiService:P}=Shopware.Classes;class we extends P{constructor(t,i,s="lieferzeiten"){super(t,i,s),this.name="lieferzeitenTrackingService"}async history(t,i){const s=await this.httpClient.get(`_action/${this.getApiBasePath()}/tracking/${encodeURIComponent(t)}/${encodeURIComponent(i)}`,{headers:this.getBasicHeaders()}),a=P.handleResponse(s)??(s==null?void 0:s.data);return(a==null?void 0:a.data)??a}}Shopware.Application.addServiceProvider("lieferzeitenTrackingService",e=>{const t=Shopware.Application.getContainer("init"),i=(t==null?void 0:t.httpClient)??e.httpClient,s=e.loginService??Shopware.Service("loginService");return new we(i,s)});const{ApiService:d}=Shopware.Classes;class ke extends d{constructor(t,i){super(t,i,"lieferzeiten"),this.name="lieferzeitenOrdersService"}async getOrders(t={}){const i=await this.httpClient.get(`_action/${this.getApiBasePath()}/orders`,{params:t,headers:this.getBasicHeaders()}),s=d.handleResponse(i)??(i==null?void 0:i.data),a=(s==null?void 0:s.data)??s??[];return Array.isArray(a)?a.map(n=>this.normalizeOrderRow(n)):[]}async getOrderDetails(t){const i=await this.httpClient.get(`_action/${this.getApiBasePath()}/orders/${encodeURIComponent(t)}/details`,{headers:this.getBasicHeaders()}),s=d.handleResponse(i)??(i==null?void 0:i.data)??{},a=(s==null?void 0:s.data)||s;return this.normalizeOrderDetails(a)}normalizeOrderRow(t={}){return{...t,orderNumber:t.orderNumber||null,san6OrderNumber:t.san6OrderNumber||null,san6Position:t.san6Position||null,quantity:t.quantity||null,paymentMethod:t.paymentMethod||null,paymentDate:t.paymentDate||null,trackingSummary:t.trackingSummary||null,shippingAssignmentType:t.shippingAssignmentType||null,sourceSystem:t.sourceSystem||null,domain:t.domain||null,positions:Array.isArray(t.positions)?t.positions:[],parcels:Array.isArray(t.parcels)?t.parcels:[],lieferterminLieferantHistory:Array.isArray(t.lieferterminLieferantHistory)?t.lieferterminLieferantHistory:[],neuerLieferterminHistory:Array.isArray(t.neuerLieferterminHistory)?t.neuerLieferterminHistory:[],commentHistory:Array.isArray(t.commentHistory)?t.commentHistory:[]}}normalizeOrderDetails(t){return!t||typeof t!="object"?t:this.normalizeOrderRow(t)}async getStatistics(t={}){var i;try{const s=await this.httpClient.get(`_action/${this.getApiBasePath()}/v1/statistics`,{params:t,headers:this.getBasicHeaders()});return d.handleResponse(s)??(s==null?void 0:s.data)??{}}catch(s){if(((i=s==null?void 0:s.response)==null?void 0:i.status)!==404)throw s;const n=await this.httpClient.get(`_action/${this.getApiBasePath()}/statistics`,{params:t,headers:this.getBasicHeaders()});return d.handleResponse(n)??(n==null?void 0:n.data)??{}}}async getDemoDataStatus(){const t=await this.httpClient.get(`_action/${this.getApiBasePath()}/demo-data/status`,{headers:this.getBasicHeaders()});return d.handleResponse(t)??(t==null?void 0:t.data)??{}}async toggleDemoData(){const t=await this.httpClient.post(`_action/${this.getApiBasePath()}/demo-data/toggle`,{},{headers:this.getBasicHeaders()});return d.handleResponse(t)??(t==null?void 0:t.data)??{}}async seedDemoData(t=!1){const i=await this.httpClient.post(`_action/${this.getApiBasePath()}/demo-data`,{reset:t},{headers:this.getBasicHeaders()});return d.handleResponse(i)??(i==null?void 0:i.data)??{}}async getSalesChannelLieferzeiten(t){const i=await this.httpClient.get(`_action/${this.getApiBasePath()}/sales-channel/${encodeURIComponent(t)}/lieferzeiten`,{headers:this.getBasicHeaders()});return d.handleResponse(i)??(i==null?void 0:i.data)??{}}async updateLieferterminLieferant(t,i){return this.post(`position/${t}/liefertermin-lieferant`,i)}async updateNeuerLiefertermin(t,i){return this.post(`position/${t}/neuer-liefertermin`,i)}async updateNeuerLieferterminByPaket(t,i){return this.post(`paket/${t}/neuer-liefertermin`,i)}async updateComment(t,i){if(!t)throw new Error("Missing position id");return this.post(`position/${t}/comment`,i)}async createAdditionalDeliveryRequest(t,i=null){const s={};return typeof i=="string"&&i.trim()!==""&&(s.initiator=i.trim()),this.post(`position/${t}/additional-delivery-request`,s)}async updatePaketStatus(t,i){return this.post(`paket/${t}/status`,i)}async post(t,i){const s=await this.httpClient.post(`_action/${this.getApiBasePath()}/${t}`,i,{headers:this.getBasicHeaders()});return d.handleResponse(s)??(s==null?void 0:s.data)}}Shopware.Application.addServiceProvider("lieferzeitenOrdersService",e=>{const t=Shopware.Application.getContainer("init"),i=(t==null?void 0:t.httpClient)??e.httpClient,s=e.loginService??Shopware.Service("loginService");return new ke(i,s)});const R="__lieferzeitenStoreApiFallbackInterceptorInstalled",B="/api/_action/store/updates",$e="/api/_action/extension/installed";function Ae(e=""){return e.includes(B)||e.includes($e)}function Le(e){const t=(e==null?void 0:e.config)||{};return String(t.url||"").includes(B)?{data:{total:0,updates:[],items:[]},status:200,statusText:"OK",headers:{},config:t}:{data:{data:[],total:0},status:200,statusText:"OK",headers:{},config:t}}function Te(){var i;if(window[R])return;const e=Shopware.Application.getContainer("init"),t=e==null?void 0:e.httpClient;(i=t==null?void 0:t.interceptors)!=null&&i.response&&(t.interceptors.response.use(s=>s,s=>{var r,l;const a=(r=s==null?void 0:s.response)==null?void 0:r.status,n=String(((l=s==null?void 0:s.config)==null?void 0:l.url)||"");return a===500&&Ae(n)?(console.warn("[LieferzeitenAdmin] Store API unavailable, using empty fallback response for:",n),Promise.resolve(Le(s))):Promise.reject(s)}),window[R]=!0)}Te();const{Component:Ce,Mixin:Oe}=Shopware;Ce.register("lieferzeiten-demo-data-button",{template:`
        <div class="lieferzeiten-demo-data-button">
            <label class="sw-field__label" v-if="label">{{ label }}</label>
            <sw-button
                variant="primary"
                size="small"
                :disabled="isLoading"
                @click="onToggleDemoData"
            >
                {{ buttonLabel }}
            </sw-button>
            <div v-if="helpText" class="sw-field__help-text">
                {{ helpText }}
            </div>
        </div>
    `,inject:["lieferzeitenOrdersService"],mixins:[Oe.getByName("notification")],props:{element:{type:Object,required:!1,default:null}},data(){return{isLoading:!1,hasDemoData:!1}},computed:{label(){var e;return((e=this.element)==null?void 0:e.label)??""},helpText(){var e;return((e=this.element)==null?void 0:e.helpText)??""},buttonLabel(){return this.hasDemoData?"Demo-Daten entfernen":"Demo-Daten speichern"}},async created(){await this.loadStatus()},methods:{async loadStatus(){this.isLoading=!0;try{const e=await this.lieferzeitenOrdersService.getDemoDataStatus();this.hasDemoData=!!(e!=null&&e.hasDemoData)}catch(e){this.createNotificationError({title:"Demo-Daten Status",message:(e==null?void 0:e.message)||"Status konnte nicht geladen werden."})}finally{this.isLoading=!1}},async onToggleDemoData(){var e,t;if(!this.isLoading){this.isLoading=!0;try{const i=await this.lieferzeitenOrdersService.toggleDemoData();if(this.hasDemoData=!!(i!=null&&i.hasDemoData),(i==null?void 0:i.action)==="removed"){const n=(i==null?void 0:i.deleted)||{},r=Object.values(n).reduce((l,o)=>l+Number(o||0),0);this.createNotificationSuccess({title:"Demo-Daten entfernt",message:r>0?`${r} Demo-Datensätze wurden entfernt.`:"Keine Demo-Daten waren vorhanden."});return}const s=(i==null?void 0:i.created)||{},a=Object.values(s).reduce((n,r)=>n+Number(r||0),0);this.createNotificationSuccess({title:"Demo-Daten gespeichert",message:a>0?`${a} Demo-Datensätze wurden gespeichert.`:"Keine neuen Demo-Datensätze wurden gespeichert."})}catch(i){this.createNotificationError({title:"Demo-Daten",message:((t=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:t.message)||(i==null?void 0:i.message)||"Aktion konnte nicht ausgeführt werden."})}finally{this.isLoading=!1}}}}});
//# sourceMappingURL=lieferzeiten-admin-BkMS5O8v.js.map
